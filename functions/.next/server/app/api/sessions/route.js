try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},r=(new e.Error).stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="c5f0dcda-45e6-44d1-afea-76b879cc6b0e",e._sentryDebugIdIdentifier="sentry-dbid-c5f0dcda-45e6-44d1-afea-76b879cc6b0e")}()}catch(e){}(()=>{var e={};e.id=772,e.ids=[772],e.modules={48872:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=48872,e.exports=r},95653:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=95653,e.exports=r},98005:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=98005,e.exports=r},83293:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=83293,e.exports=r},12308:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=12308,e.exports=r},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61212:e=>{"use strict";e.exports=require("async_hooks")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},27920:e=>{"use strict";e.exports=require("diagnostics_channel")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},85807:e=>{"use strict";e.exports=require("module")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},96119:e=>{"use strict";e.exports=require("perf_hooks")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},6162:e=>{"use strict";e.exports=require("worker_threads")},71568:e=>{"use strict";e.exports=require("zlib")},17718:e=>{"use strict";e.exports=require("node:child_process")},65714:e=>{"use strict";e.exports=require("node:diagnostics_channel")},87561:e=>{"use strict";e.exports=require("node:fs")},88849:e=>{"use strict";e.exports=require("node:http")},22286:e=>{"use strict";e.exports=require("node:https")},85690:e=>{"use strict";e.exports=require("node:inspector")},87503:e=>{"use strict";e.exports=require("node:net")},70612:e=>{"use strict";e.exports=require("node:os")},49411:e=>{"use strict";e.exports=require("node:path")},51747:e=>{"use strict";e.exports=require("node:readline")},84492:e=>{"use strict";e.exports=require("node:stream")},31764:e=>{"use strict";e.exports=require("node:tls")},47261:e=>{"use strict";e.exports=require("node:util")},24086:e=>{"use strict";e.exports=require("node:worker_threads")},65628:e=>{"use strict";e.exports=require("node:zlib")},29393:(e,r,s)=>{"use strict";s.r(r),s.d(r,{originalPathname:()=>k,patchFetch:()=>_,requestAsyncStorage:()=>v,routeModule:()=>D,serverHooks:()=>U,staticGenerationAsyncStorage:()=>T});var t={};s.r(t),s.d(t,{DELETE:()=>I,GET:()=>E,HEAD:()=>m,OPTIONS:()=>N,PATCH:()=>g,POST:()=>w,PUT:()=>O});var o=s(32829),i=s(85358),n=s(66806),a=s(54580),u=s(46485),c=s(54232),d=s(52489),p=s(21967);async function l(e){try{let{searchParams:r}=new URL(e.url),s=r.get("userId"),t=r.get("limit");if(!s)return u.NextResponse.json({error:"User ID is required"},{status:400});let o=await (0,c.sP)(s,t?parseInt(t):50);return u.NextResponse.json({sessions:o})}catch(e){return console.error("Error fetching sessions:",e),u.NextResponse.json({error:"Failed to fetch sessions"},{status:500})}}async function h(e){try{let{userId:r,schoolId:s,checkInLocation:t}=await e.json();if(!r||!s||!t)return u.NextResponse.json({error:"User ID, School ID, and check-in location are required"},{status:400});let o={userId:r,schoolId:s,checkInTime:d.EK.now(),checkInLocation:t,status:"active",createdAt:d.EK.now(),updatedAt:d.EK.now()},i=await (0,c.OE)(c.Ul.SESSIONS,o);return u.NextResponse.json({id:i,...o},{status:201})}catch(e){return console.error("Error creating session:",e),u.NextResponse.json({error:"Failed to create session"},{status:500})}}async function x(e){try{let{sessionId:r,checkOutLocation:s,status:t,notes:o}=await e.json();if(!r)return u.NextResponse.json({error:"Session ID is required"},{status:400});let i={updatedAt:d.EK.now()};s&&(i.checkOutTime=d.EK.now(),i.checkOutLocation=s,i.status="completed"),t&&(i.status=t),o&&(i.notes=o),await (0,c.gU)(c.Ul.SESSIONS,r,i);let n=await (0,c.Me)(c.Ul.SESSIONS,r);return u.NextResponse.json({id:r,...n||{}})}catch(e){return console.error("Error updating session:",e),u.NextResponse.json({error:"Failed to update session"},{status:500})}}async function f(e){try{let{searchParams:r}=new URL(e.url),s=r.get("sessionId");if(!s)return u.NextResponse.json({error:"Session ID is required"},{status:400});return await (0,c.iH)(c.Ul.SESSIONS,s),u.NextResponse.json({message:"Session deleted successfully"})}catch(e){return console.error("Error deleting session:",e),u.NextResponse.json({error:"Failed to delete session"},{status:500})}}let S={...a},q="workUnitAsyncStorage"in S?S.workUnitAsyncStorage:"requestAsyncStorage"in S?S.requestAsyncStorage:void 0;function y(e,r){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,s,t)=>{let o;try{let e=q?.getStore();o=e?.headers}catch{}return p.wrapRouteHandlerWithSentry(e,{method:r,parameterizedRoute:"/api/sessions",headers:o}).apply(s,t)}})}let E=y(l,"GET"),w=y(h,"POST"),O=y(x,"PUT"),g=y(void 0,"PATCH"),I=y(f,"DELETE"),m=y(void 0,"HEAD"),N=y(void 0,"OPTIONS"),D=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/sessions/route",pathname:"/api/sessions",filename:"route",bundlePath:"app/api/sessions/route"},resolvedPagePath:"/Users/arthurturnbull/Developer/schools-in/src/app/api/sessions/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:v,staticGenerationAsyncStorage:T,serverHooks:U}=D,k="/api/sessions/route";function _(){return(0,n.patchFetch)({serverHooks:U,staticGenerationAsyncStorage:T})}},54232:(e,r,s)=>{"use strict";s.d(r,{Ul:()=>c,OE:()=>d,iH:()=>h,_N:()=>x,Me:()=>p,f9:()=>f,sP:()=>S,gU:()=>l});var t=s(52489),o=s(58221),i=s(46696),n=s(14200);s(14389),s(21699);let a=(0,o.ZF)({apiKey:"AIzaSyB5GTFpkeRk7dIJL0hm1Xr5SBX_RQnqt_A",authDomain:"schools-in-check.firebaseapp.com",projectId:"schools-in-check",storageBucket:"schools-in-check.firebasestorage.app",messagingSenderId:"227078219689",appId:"1:227078219689:web:71408317e8899ed6fe46b8"});(0,i.v0)(a);let u=(0,t.ad)(a);(0,n.cF)(a);let c={USERS:"users",SESSIONS:"sessions",LOCATIONS:"locations"},d=async(e,r)=>(await (0,t.ET)((0,t.hJ)(u,e),r)).id,p=async(e,r)=>{let s=await (0,t.QT)((0,t.JU)(u,e,r));return s.exists()?{id:s.id,...s.data()}:null},l=async(e,r,s)=>{await (0,t.r7)((0,t.JU)(u,e,r),s)},h=async(e,r)=>{await (0,t.oe)((0,t.JU)(u,e,r))},x=async e=>(await (0,t.PL)((0,t.hJ)(u,e))).docs.map(e=>({id:e.id,...e.data()})),f=async e=>{let r=(0,t.IO)((0,t.hJ)(u,c.LOCATIONS),(0,t.ar)("assignedProviders","array-contains",e));return(await (0,t.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))},S=async(e,r=1,s=10,o)=>{let i=[(0,t.ar)("userId","==",e)];o?.schoolId&&i.push((0,t.ar)("schoolId","==",o.schoolId));let n=(0,t.IO)((0,t.hJ)(u,c.SESSIONS),...i),a=(await (0,t.PL)(n)).size,d=(r-1)*s,p=[...i];if(o?.startDate&&p.push((0,t.ar)("checkInTime",">=",t.EK.fromDate(o.startDate))),o?.endDate){let e=new Date(o.endDate);e.setHours(23,59,59,999),p.push((0,t.ar)("checkInTime","<=",t.EK.fromDate(e)))}let l=(0,t.IO)((0,t.hJ)(u,c.SESSIONS),...p,(0,t.Xo)("checkInTime","desc"),(0,t.b9)(s+d+1)),h=(await (0,t.PL)(l)).docs;return{sessions:h.slice(d,d+s).map(e=>({id:e.id,...e.data()})),total:a,hasMore:h.length>d+s}}}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[454,596],()=>s(29393));module.exports=t})();
//# sourceMappingURL=route.js.map