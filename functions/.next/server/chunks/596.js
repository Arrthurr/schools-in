try{!function(){const e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="b0244eb7-3642-4d07-9284-0aa0a4d71c23",e._sentryDebugIdIdentifier="sentry-dbid-b0244eb7-3642-4d07-9284-0aa0a4d71c23")}()}catch(e){}exports.id=596,exports.ids=[596],exports.modules={98154:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addAdminServicesToServer=t.registerAdminService=void 0;const r=[];function n(e,t){r.push({getServiceDefinition:e,getHandlers:t})}function i(e){for(const{getServiceDefinition:t,getHandlers:n}of r)e.addService(t(),n())}t.registerAdminService=n,t.addAdminServicesToServer=i},26383:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackoffTimeout=void 0;const r=1e3,n=1.6,i=12e4,s=.2;function a(e,t){return Math.random()*(t-e)+e}class o{constructor(e,t){this.callback=e,this.initialDelay=r,this.multiplier=n,this.maxDelay=i,this.jitter=s,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){let t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||null===(r=(t=this.timerId).unref)||void 0===r||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);const e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+a(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){const e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){let e,t;this.hasRef=!0,null===(t=(e=this.timerId).ref)||void 0===t||t.call(e)}unref(){let e,t;this.hasRef=!1,null===(t=(e=this.timerId).unref)||void 0===t||t.call(e)}getEndTime(){return this.endTime}}t.BackoffTimeout=o},40080:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallCredentials=void 0;const n=r(57906);function i(e){return"getRequestHeaders"in e&&"function"==typeof e.getRequestHeaders}class s{static createFromMetadataGenerator(e){return new o(e)}static createFromGoogleCredential(e){return s.createFromMetadataGenerator((t,r)=>{let s;(s=i(e)?e.getRequestHeaders(t.service_url):new Promise((r,n)=>{e.getRequestMetadata(t.service_url,(e,t)=>{if(e){n(e);return}if(!t){n(Error("Headers not set by metadata plugin"));return}r(t)})})).then(e=>{const t=new n.Metadata;for(const r of Object.keys(e))t.add(r,e[r]);r(null,t)},e=>{r(e)})})}static createEmpty(){return new l}}t.CallCredentials=s;class a extends s{constructor(e){super(),this.creds=e}async generateMetadata(e){const t=new n.Metadata;for(const r of(await Promise.all(this.creds.map(t=>t.generateMetadata(e)))))t.merge(r);return t}compose(e){return new a(this.creds.concat([e]))}_equals(e){return this===e||e instanceof a&&this.creds.every((t,r)=>t._equals(e.creds[r]))}}class o extends s{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(e,n)=>{void 0!==n?t(n):r(e)})})}compose(e){return new a([this,e])}_equals(e){return this===e||e instanceof o&&this.metadataGenerator===e.metadataGenerator}}class l extends s{generateMetadata(e){return Promise.resolve(new n.Metadata)}compose(e){return e}_equals(e){return e instanceof l}}},18608:(e,t)=>{"use strict";function r(e){return void 0!==e.onReceiveMetadata&&1===e.onReceiveMetadata.length}Object.defineProperty(t,"__esModule",{value:!0}),t.InterceptingListenerImpl=t.isInterceptingListener=void 0,t.isInterceptingListener=r;class n{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,e=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(e),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,e=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=e,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(e),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,e=>{this.processingMetadata||this.processingMessage?this.pendingStatus=e:this.nextListener.onReceiveStatus(e)})}}t.InterceptingListenerImpl=n},12106:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNextCallNumber=void 0;let r=0;function n(){return r++}t.getNextCallNumber=n},72617:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientDuplexStreamImpl=t.ClientWritableStreamImpl=t.ClientReadableStreamImpl=t.ClientUnaryCallImpl=t.callErrorFromStatus=void 0;const n=r(17702),i=r(76162),s=r(57794);function a(e,t){const r=`${e.code} ${s.Status[e.code]}: ${e.details}`,n=Error(r),i=`${n.stack}
for call at
${t}`;return Object.assign(Error(r),e,{stack:i})}t.callErrorFromStatus=a;class o extends n.EventEmitter{constructor(){super()}cancel(){let e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){let e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}}t.ClientUnaryCallImpl=o;class l extends i.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){let e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){let e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_read(e){let t;null===(t=this.call)||void 0===t||t.startRead()}}t.ClientReadableStreamImpl=l;class u extends i.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){let e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){let e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_write(e,t,r){let n;const i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null===(n=this.call)||void 0===n||n.sendMessageWithContext(i,e)}_final(e){let t;null===(t=this.call)||void 0===t||t.halfClose(),e()}}t.ClientWritableStreamImpl=u;class c extends i.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){let e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){let e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_read(e){let t;null===(t=this.call)||void 0===t||t.startRead()}_write(e,t,r){let n;const i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null===(n=this.call)||void 0===n||n.sendMessageWithContext(i,e)}_final(e){let t;null===(t=this.call)||void 0===t||t.halfClose(),e()}}t.ClientDuplexStreamImpl=c},28017:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelCredentials=void 0;const n=r(82452),i=r(40080),s=r(73633);function a(e,t){if(e&&!(e instanceof Buffer))throw TypeError(`${t}, if provided, must be a Buffer.`)}class o{constructor(e){this.callCredentials=e||i.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){let o;if(a(e,"Root certificate"),a(t,"Private key"),a(r,"Certificate chain"),t&&!r)throw Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw Error("Certificate chain must be given with accompanying private key");return new u((0,n.createSecureContext)({ca:null!==(o=null!=e?e:(0,s.getDefaultRootsData)())&&void 0!==o?o:void 0,key:null!=t?t:void 0,cert:null!=r?r:void 0,ciphers:s.CIPHER_SUITES}),null!=i?i:{})}static createFromSecureContext(e,t){return new u(e,null!=t?t:{})}static createInsecure(){return new l}}t.ChannelCredentials=o;class l extends o{constructor(e){super(e)}compose(e){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof l}}class u extends o{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},(null==t?void 0:t.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){return new c(this,this.callCredentials.compose(e))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e||e instanceof u&&this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity}}class c extends o{constructor(e,t){super(t),this.channelCredentials=e}compose(e){const t=this.callCredentials.compose(e);return new c(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e||e instanceof c&&this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials)}}},86734:(e,t)=>{"use strict";function r(e,t){const r=Object.keys(e).sort(),n=Object.keys(t).sort();if(r.length!==n.length)return!1;for(let i=0;i<r.length;i+=1)if(r[i]!==n[i]||e[r[i]]!==t[n[i]])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.channelOptionsEqual=t.recognizedOptions=void 0,t.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},t.channelOptionsEqual=r},49903:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelImplementation=void 0;const n=r(28017),i=r(61336);class s{constructor(e,t,r){if("string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.internalChannel=new i.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,n,i)}}t.ChannelImplementation=s},39871:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.getChannelzServiceDefinition=t.getChannelzHandlers=t.unregisterChannelzRef=t.registerChannelzSocket=t.registerChannelzServer=t.registerChannelzSubchannel=t.registerChannelzChannel=t.ChannelzCallTracker=t.ChannelzChildrenTracker=t.ChannelzTrace=void 0;const n=r(98216),i=r(23466),s=r(57794),a=r(6299),o=r(98154),l=r(31476);function u(e){return{channel_id:e.id,name:e.name}}function c(e){return{subchannel_id:e.id,name:e.name}}function d(e){return{server_id:e.id}}function h(e){return{socket_id:e.id,name:e.name}}const p=32;class f{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){const n=new Date;this.events.push({description:t,severity:e,timestamp:n,childChannel:(null==r?void 0:r.kind)==="channel"?r:void 0,childSubchannel:(null==r?void 0:r.kind)==="subchannel"?r:void 0}),this.events.length>=2*p&&(this.events=this.events.slice(p)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:O(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:O(e.timestamp),channel_ref:e.childChannel?u(e.childChannel):null,subchannel_ref:e.childSubchannel?c(e.childSubchannel):null}))}}}t.ChannelzTrace=f;class m{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){let t,r,n;switch(e.kind){case"channel":{const r=null!==(t=this.channelChildren.get(e.id))&&void 0!==t?t:{ref:e,count:0};r.count+=1,this.channelChildren.set(e.id,r);break}case"subchannel":{const t=null!==(r=this.subchannelChildren.get(e.id))&&void 0!==r?r:{ref:e,count:0};t.count+=1,this.subchannelChildren.set(e.id,t);break}case"socket":{const t=null!==(n=this.socketChildren.get(e.id))&&void 0!==n?n:{ref:e,count:0};t.count+=1,this.socketChildren.set(e.id,t)}}}unrefChild(e){switch(e.kind){case"channel":{const t=this.channelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{const t=this.subchannelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{const t=this.socketChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t))}}}getChildLists(){const e=[];for(const{ref:t}of this.channelChildren.values())e.push(t);const t=[];for(const{ref:e}of this.subchannelChildren.values())t.push(e);const r=[];for(const{ref:e}of this.socketChildren.values())r.push(e);return{channels:e,subchannels:t,sockets:r}}}t.ChannelzChildrenTracker=m;class g{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}t.ChannelzCallTracker=g;let y=1;function v(){return y++}const b=[],T=[],w=[],S=[];function E(e,t,r){const n=v(),i={id:n,name:e,kind:"channel"};return r&&(b[n]={ref:i,getInfo:t}),i}function _(e,t,r){const n=v(),i={id:n,name:e,kind:"subchannel"};return r&&(T[n]={ref:i,getInfo:t}),i}function C(e,t){const r=v(),n={id:r,kind:"server"};return t&&(w[r]={ref:n,getInfo:e}),n}function I(e,t,r){const n=v(),i={id:n,name:e,kind:"socket"};return r&&(S[n]={ref:i,getInfo:t}),i}function R(e){switch(e.kind){case"channel":delete b[e.id];return;case"subchannel":delete T[e.id];return;case"server":delete w[e.id];return;case"socket":delete S[e.id];return}}function k(e){const t=Number.parseInt(e,16);return[t/256|0,t%256]}function A(e){return""===e?[]:[].concat(...e.split(":").map(e=>k(e)))}function N(e){if((0,n.isIPv4)(e))return Buffer.from(Uint8Array.from(e.split(".").map(e=>Number.parseInt(e))));if(!(0,n.isIPv6)(e))return null;{let t,r;const n=e.indexOf("::");-1===n?(t=e,r=""):(t=e.substring(0,n),r=e.substring(n+2));const i=Buffer.from(A(t)),s=Buffer.from(A(r)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}}function D(e){switch(e){case i.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case i.ConnectivityState.IDLE:return{state:"IDLE"};case i.ConnectivityState.READY:return{state:"READY"};case i.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case i.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function O(e){if(!e)return null;const t=e.getTime();return{seconds:t/1e3|0,nanos:t%1e3*1e6}}function x(e){const t=e.getInfo();return{ref:u(e.ref),data:{target:t.target,state:D(t.state),calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:O(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},channel_ref:t.children.channels.map(e=>u(e)),subchannel_ref:t.children.subchannels.map(e=>c(e))}}function P(e,t){const r=Number.parseInt(e.request.channel_id),n=b[r];if(void 0===n){t({code:s.Status.NOT_FOUND,details:"No channel data found for id "+r});return}t(null,{channel:x(n)})}function M(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_channel_id);for(;i<b.length;i++){const e=b[i];if(void 0!==e&&(n.push(x(e)),n.length>=r))break}t(null,{channel:n,end:i>=w.length})}function L(e){const t=e.getInfo();return{ref:d(e.ref),data:{calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:O(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},listen_socket:t.listenerChildren.sockets.map(e=>h(e))}}function F(e,t){const r=Number.parseInt(e.request.server_id),n=w[r];if(void 0===n){t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r});return}t(null,{server:L(n)})}function B(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_server_id);for(;i<w.length;i++){const e=w[i];if(void 0!==e&&(n.push(L(e)),n.length>=r))break}t(null,{server:n,end:i>=w.length})}function U(e,t){const r=Number.parseInt(e.request.subchannel_id),n=T[r];if(void 0===n){t({code:s.Status.NOT_FOUND,details:"No subchannel data found for id "+r});return}const i=n.getInfo();t(null,{subchannel:{ref:c(n.ref),data:{target:i.target,state:D(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:O(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(e=>h(e))}})}function j(e){let t;return(0,a.isTcpSubchannelAddress)(e)?{address:"tcpip_address",tcpip_address:{ip_address:null!==(t=N(e.host))&&void 0!==t?t:void 0,port:e.port}}:{address:"uds_address",uds_address:{filename:e.path}}}function V(e,t){let r,n,i,a,o;const l=Number.parseInt(e.request.socket_id),u=S[l];if(void 0===u){t({code:s.Status.NOT_FOUND,details:"No socket data found for id "+l});return}const c=u.getInfo(),d=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!==(r=c.security.cipherSuiteStandardName)&&void 0!==r?r:void 0,other_name:null!==(n=c.security.cipherSuiteOtherName)&&void 0!==n?n:void 0,local_certificate:null!==(i=c.security.localCertificate)&&void 0!==i?i:void 0,remote_certificate:null!==(a=c.security.remoteCertificate)&&void 0!==a?a:void 0}}:null;t(null,{socket:{ref:h(u.ref),local:c.localAddress?j(c.localAddress):null,remote:c.remoteAddress?j(c.remoteAddress):null,remote_name:null!==(o=c.remoteName)&&void 0!==o?o:void 0,security:d,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:O(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:O(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:O(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:O(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}}})}function z(e,t){const r=Number.parseInt(e.request.server_id),n=w[r];if(void 0===n){t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r});return}let i=Number.parseInt(e.request.start_socket_id),a=Number.parseInt(e.request.max_results),o=n.getInfo().sessionChildren.sockets.sort((e,t)=>e.id-t.id),l=[],u=0;for(;u<o.length&&(!(o[u].id>=i)||(l.push(h(o[u])),!(l.length>=a)));u++);t(null,{socket_ref:l,end:u>=o.length})}function q(){return{GetChannel:P,GetTopChannels:M,GetServer:F,GetServers:B,GetSubchannel:U,GetSocket:V,GetServerSockets:z}}t.registerChannelzChannel=E,t.registerChannelzSubchannel=_,t.registerChannelzServer=C,t.registerChannelzSocket=I,t.unregisterChannelzRef=R,t.getChannelzHandlers=q;let $=null;function G(){if($)return $;const e=(0,r(62622).J_)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return $=(0,l.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service}function K(){(0,o.registerAdminService)(G,q)}t.getChannelzServiceDefinition=G,t.setup=K},92152:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInterceptingCall=t.InterceptingCall=t.RequesterBuilder=t.ListenerBuilder=t.InterceptorConfigurationError=void 0;const n=r(57906),i=r(18608),s=r(57794),a=r(13518);class o extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,o)}}t.InterceptorConfigurationError=o;class l{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}t.ListenerBuilder=l;class u{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}t.RequesterBuilder=u;const c={onReceiveMetadata:(e,t)=>{t(e)},onReceiveMessage:(e,t)=>{t(e)},onReceiveStatus:(e,t)=>{t(e)}},d={start:(e,t,r)=>{r(e,t)},sendMessage:(e,t)=>{t(e)},halfClose:e=>{e()},cancel:e=>{e()}};class h{constructor(e,t){let r,n,i,s;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:null!==(r=t.start)&&void 0!==r?r:d.start,sendMessage:null!==(n=t.sendMessage)&&void 0!==n?n:d.sendMessage,halfClose:null!==(i=t.halfClose)&&void 0!==i?i:d.halfClose,cancel:null!==(s=t.cancel)&&void 0!==s?s:d.cancel}:this.requester=d}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){let r,n,s,a,o,l;const u={onReceiveMetadata:null!==(n=null===(r=null==t?void 0:t.onReceiveMetadata)||void 0===r?void 0:r.bind(t))&&void 0!==n?n:e=>{},onReceiveMessage:null!==(a=null===(s=null==t?void 0:t.onReceiveMessage)||void 0===s?void 0:s.bind(t))&&void 0!==a?a:e=>{},onReceiveStatus:null!==(l=null===(o=null==t?void 0:t.onReceiveStatus)||void 0===o?void 0:o.bind(t))&&void 0!==l?l:e=>{}};this.processingMetadata=!0,this.requester.start(e,u,(e,t)=>{let r,n,s;let a;if(this.processingMetadata=!1,(0,i.isInterceptingListener)(t))a=t;else{const e={onReceiveMetadata:null!==(r=t.onReceiveMetadata)&&void 0!==r?r:c.onReceiveMetadata,onReceiveMessage:null!==(n=t.onReceiveMessage)&&void 0!==n?n:c.onReceiveMessage,onReceiveStatus:null!==(s=t.onReceiveStatus)&&void 0!==s?s:c.onReceiveStatus};a=new i.InterceptingListenerImpl(e,u)}this.nextCall.start(e,a),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function p(e,t,r){let n,i;const s=null!==(n=r.deadline)&&void 0!==n?n:1/0,a=r.host,o=null!==(i=r.parent)&&void 0!==i?i:null,l=r.propagate_flags,u=r.credentials,c=e.createCall(t,s,a,o,l);return u&&c.setCredentials(u),c}t.InterceptingCall=h;class f{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(e){this.call.cancelWithStatus(s.Status.INTERNAL,`Request message serialization failure: ${(0,a.getErrorMessage)(e)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:e=>{let r;null===(r=null==t?void 0:t.onReceiveMetadata)||void 0===r||r.call(t,e)},onReceiveMessage:e=>{let i;let o;try{o=this.methodDefinition.responseDeserialize(e)}catch(e){r={code:s.Status.INTERNAL,details:`Response message parsing error: ${(0,a.getErrorMessage)(e)}`,metadata:new n.Metadata},this.call.cancelWithStatus(r.code,r.details);return}null===(i=null==t?void 0:t.onReceiveMessage)||void 0===i||i.call(t,o)},onReceiveStatus:e=>{let n,i;r?null===(n=null==t?void 0:t.onReceiveStatus)||void 0===n||n.call(t,r):null===(i=null==t?void 0:t.onReceiveStatus)||void 0===i||i.call(t,e)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class m extends f{constructor(e,t){super(e,t)}start(e,t){let r,n;let i=!1,s={onReceiveMetadata:null!==(n=null===(r=null==t?void 0:t.onReceiveMetadata)||void 0===r?void 0:r.bind(t))&&void 0!==n?n:e=>{},onReceiveMessage:e=>{let r;i=!0,null===(r=null==t?void 0:t.onReceiveMessage)||void 0===r||r.call(t,e)},onReceiveStatus:e=>{let r,n;i||null===(r=null==t?void 0:t.onReceiveMessage)||void 0===r||r.call(t,null),null===(n=null==t?void 0:t.onReceiveStatus)||void 0===n||n.call(t,e)}};super.start(e,s),this.call.startRead()}}class g extends f{}function y(e,t,r){const n=p(e,r.path,t);return r.responseStream?new g(n,r):new m(n,r)}function v(e,t,r,n){if(e.clientInterceptors.length>0&&e.clientInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(e.callInterceptors.length>0&&e.callInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];i=e.callInterceptors.length>0||e.callInterceptorProviders.length>0?[].concat(e.callInterceptors,e.callInterceptorProviders.map(e=>e(t))).filter(e=>e):[].concat(e.clientInterceptors,e.clientInterceptorProviders.map(e=>e(t))).filter(e=>e);const s=Object.assign({},r,{method_definition:t});return i.reduceRight((e,t)=>r=>t(r,e),e=>y(n,e,t))(s)}t.getInterceptingCall=v},64217:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const n=r(72617),i=r(49903),s=r(23466),a=r(57794),o=r(57906),l=r(92152),u=Symbol(),c=Symbol(),d=Symbol(),h=Symbol();function p(e){return"function"==typeof e}function f(e){return e.stack.split("\n").slice(1).join("\n")}class m{constructor(e,t,r={}){let n,s;if(r=Object.assign({},r),this[c]=null!==(n=r.interceptors)&&void 0!==n?n:[],delete r.interceptors,this[d]=null!==(s=r.interceptor_providers)&&void 0!==s?s:[],delete r.interceptor_providers,this[c].length>0&&this[d].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[h]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[u]=r.channelOverride;else if(r.channelFactoryOverride){const n=r.channelFactoryOverride;delete r.channelFactoryOverride,this[u]=n(e,t,r)}else this[u]=new i.ChannelImplementation(e,t,r)}close(){this[u].close()}getChannel(){return this[u]}waitForReady(e,t){const r=n=>{let i;if(n){t(Error("Failed to connect before the deadline"));return}try{i=this[u].getConnectivityState(!0)}catch(e){t(Error("The channel has been closed"));return}if(i===s.ConnectivityState.READY)t();else try{this[u].watchConnectivityState(i,e,r)}catch(e){t(Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(p(e))return{metadata:new o.Metadata,options:{},callback:e};if(p(t))return e instanceof o.Metadata?{metadata:e,options:{},callback:t}:{metadata:new o.Metadata,options:e,callback:t};if(!(e instanceof o.Metadata&&t instanceof Object&&p(r)))throw Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,p){let m,g;let y=this.checkOptionalUnaryResponseArguments(s,o,p),v={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},b={argument:i,metadata:y.metadata,call:new n.ClientUnaryCallImpl,channel:this[u],methodDefinition:v,callOptions:y.options,callback:y.callback};this[h]&&(b=this[h](b));const T=b.call,w={clientInterceptors:this[c],clientInterceptorProviders:this[d],callInterceptors:null!==(m=b.callOptions.interceptors)&&void 0!==m?m:[],callInterceptorProviders:null!==(g=b.callOptions.interceptor_providers)&&void 0!==g?g:[]},S=(0,l.getInterceptingCall)(w,b.methodDefinition,b.callOptions,b.channel);T.call=S;let E=null,_=!1,C=Error();return S.start(b.metadata,{onReceiveMetadata:e=>{T.emit("metadata",e)},onReceiveMessage(e){null!==E&&S.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),E=e},onReceiveStatus(e){if(!_){if(_=!0,e.code===a.Status.OK){if(null===E){const t=f(C);b.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else b.callback(null,E)}else{const t=f(C);b.callback((0,n.callErrorFromStatus)(e,t))}C=null,T.emit("status",e)}}}),S.sendMessage(i),S.halfClose(),T}makeClientStreamRequest(e,t,r,i,s,o){let p,m;let g=this.checkOptionalUnaryResponseArguments(i,s,o),y={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},v={metadata:g.metadata,call:new n.ClientWritableStreamImpl(t),channel:this[u],methodDefinition:y,callOptions:g.options,callback:g.callback};this[h]&&(v=this[h](v));const b=v.call,T={clientInterceptors:this[c],clientInterceptorProviders:this[d],callInterceptors:null!==(p=v.callOptions.interceptors)&&void 0!==p?p:[],callInterceptorProviders:null!==(m=v.callOptions.interceptor_providers)&&void 0!==m?m:[]},w=(0,l.getInterceptingCall)(T,v.methodDefinition,v.callOptions,v.channel);b.call=w;let S=null,E=!1,_=Error();return w.start(v.metadata,{onReceiveMetadata:e=>{b.emit("metadata",e)},onReceiveMessage(e){null!==S&&w.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),S=e},onReceiveStatus(e){if(!E){if(E=!0,e.code===a.Status.OK){if(null===S){const t=f(_);v.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else v.callback(null,S)}else{const t=f(_);v.callback((0,n.callErrorFromStatus)(e,t))}_=null,b.emit("status",e)}}}),b}checkMetadataAndOptions(e,t){let r,n;return e instanceof o.Metadata?(r=e,n=t||{}):(n=e||{},r=new o.Metadata),{metadata:r,options:n}}makeServerStreamRequest(e,t,r,i,s,o){let p,m;let g=this.checkMetadataAndOptions(s,o),y={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},v={argument:i,metadata:g.metadata,call:new n.ClientReadableStreamImpl(r),channel:this[u],methodDefinition:y,callOptions:g.options};this[h]&&(v=this[h](v));const b=v.call,T={clientInterceptors:this[c],clientInterceptorProviders:this[d],callInterceptors:null!==(p=v.callOptions.interceptors)&&void 0!==p?p:[],callInterceptorProviders:null!==(m=v.callOptions.interceptor_providers)&&void 0!==m?m:[]},w=(0,l.getInterceptingCall)(T,v.methodDefinition,v.callOptions,v.channel);b.call=w;let S=!1,E=Error();return w.start(v.metadata,{onReceiveMetadata(e){b.emit("metadata",e)},onReceiveMessage(e){b.push(e)},onReceiveStatus(e){if(!S){if(S=!0,b.push(null),e.code!==a.Status.OK){const t=f(E);b.emit("error",(0,n.callErrorFromStatus)(e,t))}E=null,b.emit("status",e)}}}),w.sendMessage(i),w.halfClose(),b}makeBidiStreamRequest(e,t,r,i,s){let o,p;let m=this.checkMetadataAndOptions(i,s),g={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},y={metadata:m.metadata,call:new n.ClientDuplexStreamImpl(t,r),channel:this[u],methodDefinition:g,callOptions:m.options};this[h]&&(y=this[h](y));const v=y.call,b={clientInterceptors:this[c],clientInterceptorProviders:this[d],callInterceptors:null!==(o=y.callOptions.interceptors)&&void 0!==o?o:[],callInterceptorProviders:null!==(p=y.callOptions.interceptor_providers)&&void 0!==p?p:[]},T=(0,l.getInterceptingCall)(b,y.methodDefinition,y.callOptions,y.channel);v.call=T;let w=!1,S=Error();return T.start(y.metadata,{onReceiveMetadata(e){v.emit("metadata",e)},onReceiveMessage(e){v.push(e)},onReceiveStatus(e){if(!w){if(w=!0,v.push(null),e.code!==a.Status.OK){const t=f(S);v.emit("error",(0,n.callErrorFromStatus)(e,t))}S=null,v.emit("status",e)}}}),v}}t.Client=m},31799:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionAlgorithms=void 0,function(e){e[e.identity=0]="identity",e[e.deflate=1]="deflate",e[e.gzip=2]="gzip"}(r||(t.CompressionAlgorithms=r={}))},31888:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionFilterFactory=t.CompressionFilter=void 0;const n=r(71568),i=r(31799),s=r(57794),a=r(29052),o=r(23769),l=e=>"number"==typeof e&&"string"==typeof i.CompressionAlgorithms[e];class u{async writeMessage(e,t){let r=e;t&&(r=await this.compressMessage(r));const n=Buffer.allocUnsafe(r.length+5);return n.writeUInt8(t?1:0,0),n.writeUInt32BE(r.length,1),r.copy(n,5),n}async readMessage(e){let t=1===e.readUInt8(0),r=e.slice(5);return t&&(r=await this.decompressMessage(r)),r}}class c extends u{async compressMessage(e){return e}async writeMessage(e,t){const r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r}decompressMessage(e){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class d extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.deflate(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createInflate();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class h extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.gzip(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createGunzip();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class p extends u{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function f(e,t){switch(e){case"identity":return new c;case"deflate":return new d(t);case"gzip":return new h(t);default:return new p(e)}}class m extends a.BaseFilter{constructor(e,t){let r,n;super(),this.sharedFilterConfig=t,this.sendCompression=new c,this.receiveCompression=new c,this.currentCompressionAlgorithm="identity";const a=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!==(r=e["grpc.max_receive_message_length"])&&void 0!==r?r:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==a){if(l(a)){const e=i.CompressionAlgorithms[a],r=null===(n=t.serverSupportedEncodingHeader)||void 0===n?void 0:n.split(",");(!r||r.includes(e))&&(this.currentCompressionAlgorithm=e,this.sendCompression=f(this.currentCompressionAlgorithm,-1))}else o.log(s.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${a}`)}}async sendMetadata(e){const t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){const t=e.get("grpc-encoding");if(t.length>0){const e=t[0];"string"==typeof e&&(this.receiveCompression=f(e,this.maxReceiveMessageLength))}e.remove("grpc-encoding");const r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new c,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){let t;let r;const n=await e;return r=!(this.sendCompression instanceof c)&&((null!==(t=n.flags)&&void 0!==t?t:0)&2)==0,{message:await this.sendCompression.writeMessage(n.message,r),flags:n.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}}t.CompressionFilter=m;class g{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new m(this.options,this.sharedFilterConfig)}}t.CompressionFilterFactory=g},23466:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectivityState=void 0,function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.READY=2]="READY",e[e.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",e[e.SHUTDOWN=4]="SHUTDOWN"}(r||(t.ConnectivityState=r={}))},57794:(e,t)=>{"use strict";let r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=t.Propagate=t.LogVerbosity=t.Status=void 0,function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(r||(t.Status=r={})),function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.NONE=3]="NONE"}(n||(t.LogVerbosity=n={})),function(e){e[e.DEADLINE=1]="DEADLINE",e[e.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",e[e.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",e[e.CANCELLATION=8]="CANCELLATION",e[e.DEFAULTS=65535]="DEFAULTS"}(i||(t.Propagate=i={})),t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},57568:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.restrictControlPlaneStatusCode=void 0;const n=r(57794),i=[n.Status.OK,n.Status.INVALID_ARGUMENT,n.Status.NOT_FOUND,n.Status.ALREADY_EXISTS,n.Status.FAILED_PRECONDITION,n.Status.ABORTED,n.Status.OUT_OF_RANGE,n.Status.DATA_LOSS];function s(e,t){return i.includes(e)?{code:n.Status.INTERNAL,details:`Invalid status from control plane: ${e} ${n.Status[e]} ${t}`}:{code:e,details:t}}t.restrictControlPlaneStatusCode=s},38601:(e,t)=>{"use strict";function r(...e){let t=1/0;for(const r of e){const e=r instanceof Date?r.getTime():r;e<t&&(t=e)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.deadlineToString=t.getRelativeTimeout=t.getDeadlineTimeoutString=t.minDeadline=void 0,t.minDeadline=r;const n=[["m",1],["S",1e3],["M",6e4],["H",36e5]];function i(e){const t=new Date().getTime();e instanceof Date&&(e=e.getTime());const r=Math.max(e-t,0);for(const[e,t]of n){const n=r/t;if(n<1e8)return String(Math.ceil(n))+e}throw Error("Deadline is too far in the future")}t.getDeadlineTimeoutString=i;const s=2147483647;function a(e){const t=(e instanceof Date?e.getTime():e)-new Date().getTime();return t<0?0:t>s?1/0:t}function o(e){if(e instanceof Date)return e.toISOString();{const t=new Date(e);return Number.isNaN(t.getTime())?""+e:t.toISOString()}}t.getRelativeTimeout=a,t.deadlineToString=o},35831:(e,t)=>{"use strict";function r(e){return{seconds:e/1e3|0,nanos:e%1e3*1e6|0}}function n(e){return 1e3*e.seconds+e.nanos/1e6|0}function i(e){return"number"==typeof e.seconds&&"number"==typeof e.nanos}Object.defineProperty(t,"__esModule",{value:!0}),t.isDuration=t.durationToMs=t.msToDuration=void 0,t.msToDuration=r,t.durationToMs=n,t.isDuration=i},13518:(e,t)=>{"use strict";function r(e){return e instanceof Error?e.message:String(e)}function n(e){return"object"==typeof e&&null!==e&&"code"in e&&"number"==typeof e.code?e.code:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorCode=t.getErrorMessage=void 0,t.getErrorMessage=r,t.getErrorCode=n},49318:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutlierDetectionLoadBalancingConfig=t.BaseSubchannelWrapper=t.registerAdminService=t.FilterStackFactory=t.BaseFilter=t.PickResultType=t.QueuePicker=t.UnavailablePicker=t.ChildLoadBalancerHandler=t.subchannelAddressToString=t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.registerLoadBalancerType=t.createChildChannelControlHelper=t.BackoffTimeout=t.durationToMs=t.uriToString=t.createResolver=t.registerResolver=t.log=t.trace=void 0;const n=r(23769);Object.defineProperty(t,"trace",{enumerable:!0,get:function(){return n.trace}}),Object.defineProperty(t,"log",{enumerable:!0,get:function(){return n.log}});const i=r(250);Object.defineProperty(t,"registerResolver",{enumerable:!0,get:function(){return i.registerResolver}}),Object.defineProperty(t,"createResolver",{enumerable:!0,get:function(){return i.createResolver}});const s=r(97887);Object.defineProperty(t,"uriToString",{enumerable:!0,get:function(){return s.uriToString}});const a=r(35831);Object.defineProperty(t,"durationToMs",{enumerable:!0,get:function(){return a.durationToMs}});const o=r(26383);Object.defineProperty(t,"BackoffTimeout",{enumerable:!0,get:function(){return o.BackoffTimeout}});const l=r(29048);Object.defineProperty(t,"createChildChannelControlHelper",{enumerable:!0,get:function(){return l.createChildChannelControlHelper}}),Object.defineProperty(t,"registerLoadBalancerType",{enumerable:!0,get:function(){return l.registerLoadBalancerType}}),Object.defineProperty(t,"getFirstUsableConfig",{enumerable:!0,get:function(){return l.getFirstUsableConfig}}),Object.defineProperty(t,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return l.validateLoadBalancingConfig}});const u=r(6299);Object.defineProperty(t,"subchannelAddressToString",{enumerable:!0,get:function(){return u.subchannelAddressToString}});const c=r(42095);Object.defineProperty(t,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return c.ChildLoadBalancerHandler}});const d=r(50994);Object.defineProperty(t,"UnavailablePicker",{enumerable:!0,get:function(){return d.UnavailablePicker}}),Object.defineProperty(t,"QueuePicker",{enumerable:!0,get:function(){return d.QueuePicker}}),Object.defineProperty(t,"PickResultType",{enumerable:!0,get:function(){return d.PickResultType}});const h=r(29052);Object.defineProperty(t,"BaseFilter",{enumerable:!0,get:function(){return h.BaseFilter}});const p=r(9013);Object.defineProperty(t,"FilterStackFactory",{enumerable:!0,get:function(){return p.FilterStackFactory}});const f=r(98154);Object.defineProperty(t,"registerAdminService",{enumerable:!0,get:function(){return f.registerAdminService}});const m=r(19460);Object.defineProperty(t,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return m.BaseSubchannelWrapper}});const g=r(64718);Object.defineProperty(t,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return g.OutlierDetectionLoadBalancingConfig}})},9013:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterStackFactory=t.FilterStack=void 0;class r{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMessage(t);return t}receiveMessage(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}}t.FilterStack=r;class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new r(this.factories.map(e=>e.createFilter()))}}t.FilterStackFactory=n},29052:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseFilter=void 0;class r{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}}t.BaseFilter=r},11953:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProxiedConnection=t.mapProxyName=void 0;const n=r(23769),i=r(57794),s=r(250),a=r(32615),o=r(82452),l=r(23769),u=r(6299),c=r(97887),d=r(17360),h=r(3688),p="proxy";function f(e){l.trace(i.LogVerbosity.DEBUG,p,e)}function m(){let e,t="",r="";if(process.env.grpc_proxy)r="grpc_proxy",t=process.env.grpc_proxy;else if(process.env.https_proxy)r="https_proxy",t=process.env.https_proxy;else{if(!process.env.http_proxy)return{};r="http_proxy",t=process.env.http_proxy}try{e=new d.URL(t)}catch(e){return(0,n.log)(i.LogVerbosity.ERROR,`cannot parse value of "${r}" env var`),{}}if("http:"!==e.protocol)return(0,n.log)(i.LogVerbosity.ERROR,`"${e.protocol}" scheme not supported in proxy URI`),{};let s=null;e.username&&(e.password?((0,n.log)(i.LogVerbosity.INFO,"userinfo found in proxy URI"),s=`${e.username}:${e.password}`):s=e.username);let a=e.hostname,o=e.port;""===o&&(o="80");const l={address:`${a}:${o}`};return s&&(l.creds=s),f("Proxy server "+l.address+" set by environment variable "+r),l}function g(){let e=process.env.no_grpc_proxy,t="no_grpc_proxy";return(e||(e=process.env.no_proxy,t="no_proxy"),e)?(f("No proxy server list set by environment variable "+t),e.split(",")):[]}function y(e,t){let r;const n={target:e,extraOptions:{}};if((null!==(r=t["grpc.enable_http_proxy"])&&void 0!==r?r:1)===0||"unix"===e.scheme)return n;const i=m();if(!i.address)return n;const s=(0,c.splitHostPort)(e.path);if(!s)return n;const a=s.host;for(const t of g())if(t===a)return f("Not using proxy for target in no_proxy list: "+(0,c.uriToString)(e)),n;const o={"grpc.http_connect_target":(0,c.uriToString)(e)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}}function v(e,t,r){let l;if(!("grpc.http_connect_target"in t))return Promise.resolve({});const d=t["grpc.http_connect_target"],p=(0,c.parseUri)(d);if(null===p)return Promise.resolve({});const m=(0,c.splitHostPort)(p.path);if(null===m)return Promise.resolve({});const g=`${m.host}:${null!==(l=m.port)&&void 0!==l?l:h.DEFAULT_PORT}`,y={method:"CONNECT",path:g},v={Host:g};(0,u.isTcpSubchannelAddress)(e)?(y.host=e.host,y.port=e.port):y.socketPath=e.path,"grpc.http_connect_creds"in t&&(v["Proxy-Authorization"]="Basic "+Buffer.from(t["grpc.http_connect_creds"]).toString("base64")),y.headers=v;const b=(0,u.subchannelAddressToString)(e);return f("Using proxy "+b+" to connect to "+y.path),new Promise((e,t)=>{const l=a.request(y);l.once("connect",(a,u,d)=>{let h;if(l.removeAllListeners(),u.removeAllListeners(),200===a.statusCode){if(f("Successfully connected to "+y.path+" through proxy "+b),"secureContext"in r){const n=(0,s.getDefaultAuthority)(p),i=(0,c.splitHostPort)(n),a=null!==(h=null==i?void 0:i.host)&&void 0!==h?h:n,l=o.connect(Object.assign({host:a,servername:a,socket:u},r),()=>{f("Successfully established a TLS connection to "+y.path+" through proxy "+b),e({socket:l,realTarget:p})});l.on("error",e=>{f("Failed to establish a TLS connection to "+y.path+" through proxy "+b+" with error "+e.message),t()})}else f("Successfully established a plaintext connection to "+y.path+" through proxy "+b),e({socket:u,realTarget:p})}else(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to "+y.path+" through proxy "+b+" with status "+a.statusCode),t()}),l.once("error",e=>{l.removeAllListeners(),(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to proxy "+b+" with error "+e.message),t()}),l.end()})}t.mapProxyName=y,t.getProxiedConnection=v},3230:(e,t,r)=>{"use strict";g={value:!0},g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=t.Rz=g=g=g=g=g=g=t.SF=t.K9=void 0;const n=r(40080);g={enumerable:!0,get:function(){return n.CallCredentials}};const i=r(49903);g={enumerable:!0,get:function(){return i.ChannelImplementation}};const s=r(31799);g={enumerable:!0,get:function(){return s.CompressionAlgorithms}};const a=r(23466);g={enumerable:!0,get:function(){return a.ConnectivityState}};const o=r(28017);g={enumerable:!0,get:function(){return o.ChannelCredentials}};const l=r(64217);g={enumerable:!0,get:function(){return l.Client}};const u=r(57794);g={enumerable:!0,get:function(){return u.LogVerbosity}},g={enumerable:!0,get:function(){return u.Status}},g={enumerable:!0,get:function(){return u.Propagate}};const c=r(23769),d=r(31476);Object.defineProperty(t,"Rz",{enumerable:!0,get:function(){return d.loadPackageDefinition}}),g={enumerable:!0,get:function(){return d.makeClientConstructor}},g={enumerable:!0,get:function(){return d.makeClientConstructor}};const h=r(57906);Object.defineProperty(t,"SF",{enumerable:!0,get:function(){return h.Metadata}});const p=r(62979);g={enumerable:!0,get:function(){return p.Server}};const f=r(38751);g={enumerable:!0,get:function(){return f.ServerCredentials}};const m=r(77337);g={enumerable:!0,get:function(){return m.StatusBuilder}},t.K9={combineChannelCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),combineCallCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),createInsecure:o.ChannelCredentials.createInsecure,createSsl:o.ChannelCredentials.createSsl,createFromSecureContext:o.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:n.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:n.CallCredentials.createFromGoogleCredential,createEmpty:n.CallCredentials.createEmpty},g=e=>e.close(),g=(e,t,r)=>e.waitForReady(t,r),g=(e,t)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},g=(e,t,r)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},g=e=>{c.setLogger(e)},g=e=>{c.setLoggerVerbosity(e)},g=e=>l.Client.prototype.getChannel.call(e);let g,y=r(92152);g={enumerable:!0,get:function(){return y.ListenerBuilder}},g={enumerable:!0,get:function(){return y.RequesterBuilder}},g={enumerable:!0,get:function(){return y.InterceptingCall}},g={enumerable:!0,get:function(){return y.InterceptorConfigurationError}};const v=r(39871);g={enumerable:!0,get:function(){return v.getChannelzServiceDefinition}},g={enumerable:!0,get:function(){return v.getChannelzHandlers}};const b=r(98154);g={enumerable:!0,get:function(){return b.addAdminServicesToServer}},g=r(49318);const T=r(3688),w=r(28316),S=r(83324),E=r(82126),_=r(21777),C=r(64718),I=r(39871);(()=>{T.setup(),w.setup(),S.setup(),E.setup(),_.setup(),C.setup(),I.setup()})()},61336:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InternalChannel=void 0;const n=r(28017),i=r(29891),s=r(9686),a=r(50994),o=r(57794),l=r(9013),u=r(31888),c=r(250),d=r(23769),h=r(11953),p=r(97887),f=r(23466),m=r(39871),g=r(43125),y=r(38601),v=r(33148),b=r(12106),T=r(57568),w=r(69145),S=r(19460),E=2147483647,_=1e3,C=18e5,I=new Map,R=16777216,k=1048576;class A extends S.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(e,r,n,i)=>{t.throttleKeepalive(i)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class N{constructor(e,t,r){let g,y,v,b,S,N,D,O;if(this.credentials=t,this.options=r,this.connectivityState=f.ConnectivityState.IDLE,this.currentPicker=new a.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new m.ChannelzCallTracker,this.childrenTracker=new m.ChannelzChildrenTracker,"string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.originalTarget=e;const x=(0,p.parseUri)(e);if(null===x)throw Error(`Could not parse target name "${e}"`);const P=(0,c.mapUriDefaultScheme)(x);if(null===P)throw Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},E),null===(y=(g=this.callRefTimer).unref)||void 0===y||y.call(g),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new m.ChannelzTrace,this.channelzRef=(0,m.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,c.getDefaultAuthority)(P);const M=(0,h.mapProxyName)(P,r);this.target=M.target,this.options=Object.assign({},this.options,M.extraOptions),this.subchannelPool=(0,s.getSubchannelPool)((null!==(v=r["grpc.use_local_subchannel_pool"])&&void 0!==v?v:0)===0),this.retryBufferTracker=new w.MessageBufferTracker(null!==(b=r["grpc.retry_buffer_size"])&&void 0!==b?b:R,null!==(S=r["grpc.per_rpc_retry_buffer_size"])&&void 0!==S?S:k),this.keepaliveTime=null!==(N=r["grpc.keepalive_time_ms"])&&void 0!==N?N:-1,this.idleTimeoutMs=Math.max(null!==(D=r["grpc.client_idle_timeout_ms"])&&void 0!==D?D:C,_);const L={createSubchannel:(e,t)=>{const r=this.subchannelPool.getOrCreateSubchannel(this.target,e,Object.assign({},this.options,t),this.credentials);r.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",r.getChannelzRef());const n=new A(r,this);return this.wrappedSubchannels.add(n),n},updateState:(e,t)=>{this.currentPicker=t;const r=this.pickQueue.slice();for(const e of(this.pickQueue=[],r.length>0&&this.callRefTimerUnref(),r))e.doPick();this.updateState(e)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.refChild(e)},removeChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.unrefChild(e)}};this.resolvingLoadBalancer=new i.ResolvingLoadBalancer(this.target,L,r,(e,t)=>{e.retryThrottling?I.set(this.getTarget(),new w.RetryThrottler(e.retryThrottling.maxTokens,e.retryThrottling.tokenRatio,I.get(this.getTarget()))):I.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=t,this.currentResolutionError=null,process.nextTick(()=>{const e=this.configSelectionQueue;for(const t of(this.configSelectionQueue=[],e.length>0&&this.callRefTimerUnref(),e))t.getConfig()})},e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+e.code+' and details "'+e.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,T.restrictControlPlaneStatusCode)(e.code,e.details)),{metadata:e.metadata}));const t=this.configSelectionQueue;for(const r of(this.configSelectionQueue=[],t.length>0&&this.callRefTimerUnref(),t))r.reportResolverError(e)}),this.filterStackFactory=new l.FilterStackFactory([new u.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));const F=Error();(0,d.trace)(o.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null===(O=F.stack)||void 0===O?void 0:O.substring(F.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,d.trace)(null!=t?t:o.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,p.uriToString)(this.target)+" "+e)}callRefTimerRef(){let e,t,r,n;(null===(t=(e=this.callRefTimer).hasRef)||void 0===t?void 0:t.call(e))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(n=(r=this.callRefTimer).ref)||void 0===n||n.call(r))}callRefTimerUnref(){let e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(t=(e=this.callRefTimer).unref)||void 0===t||t.call(e))}removeConnectivityStateWatcher(e){const t=this.connectivityStateWatchers.findIndex(t=>t===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){for(const t of((0,d.trace)(o.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,p.uriToString)(this.target)+" "+f.ConnectivityState[this.connectivityState]+" -> "+f.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+f.ConnectivityState[e]),this.connectivityState=e,this.connectivityStateWatchers.slice()))e!==t.currentState&&(t.timer&&clearTimeout(t.timer),this.removeConnectivityStateWatcher(t),t.callback());e!==f.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime)for(const t of(this.keepaliveTime=e,this.wrappedSubchannels))t.throttleKeepalive(e)}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(f.ConnectivityState.IDLE),this.currentPicker=new a.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){let t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}const e=new Date().valueOf()-this.lastActivityTimestamp.valueOf();e>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-e)},e),null===(r=(t=this.idleTimer).unref)||void 0===r||r.call(t)}maybeStartIdleTimer(){this.connectivityState===f.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,n,i){const s=(0,b.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+s+'] method="'+t+'"'),new g.LoadBalancingCall(this,e,t,r,n,i,s)}createRetryingCall(e,t,r,n,i){const s=(0,b.getNextCallNumber)();return this.trace("createRetryingCall ["+s+'] method="'+t+'"'),new w.RetryingCall(this,e,t,r,n,i,s,this.retryBufferTracker,I.get(this.getTarget()))}createInnerCall(e,t,r,n,i){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(e,t,r,n,i):this.createRetryingCall(e,t,r,n,i)}createResolvingCall(e,t,r,n,i){const s=(0,b.getNextCallNumber)();this.trace("createResolvingCall ["+s+'] method="'+e+'", deadline='+(0,y.deadlineToString)(t));const a={deadline:t,flags:null!=i?i:o.Propagate.DEFAULTS,host:null!=r?r:this.defaultAuthority,parentCall:n},l=new v.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),s);return this.onCallStart(),l.addStatusWatcher(e=>{this.onCallEnd(e)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(f.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,m.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,p.uriToString)(this.target)}getConnectivityState(e){const t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===f.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let n=null;if(t!==1/0){const e=t instanceof Date?t:new Date(t),s=new Date;if(t===-1/0||e<=s){process.nextTick(r,Error("Deadline passed without connectivity state change"));return}n=setTimeout(()=>{this.removeConnectivityStateWatcher(i),r(Error("Deadline passed without connectivity state change"))},e.getTime()-s.getTime())}const i={currentState:e,callback:r,timer:n};this.connectivityStateWatchers.push(i)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===f.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(e,t,r,n,i)}}t.InternalChannel=N},42095:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChildLoadBalancerHandler=void 0;const n=r(29048),i=r(23466),s="child_load_balancer_helper";class a{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(e){this.parent=e,this.child=null}createSubchannel(e,t){return this.parent.channelControlHelper.createSubchannel(e,t)}updateState(e,t){let r;if(this.calledByPendingChild()){if(e===i.ConnectivityState.CONNECTING)return;null===(r=this.parent.currentChild)||void 0===r||r.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(e,t)}requestReresolution(){let e;const t=null!==(e=this.parent.pendingChild)&&void 0!==e?e:this.parent.currentChild;this.child===t&&this.parent.channelControlHelper.requestReresolution()}setChild(e){this.child=e}addChannelzChild(e){this.parent.channelControlHelper.addChannelzChild(e)}removeChannelzChild(e){this.parent.channelControlHelper.removeChannelzChild(e)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){const e=new this.ChildPolicyHelper(this),r=(0,n.createLoadBalancer)(t,e);e.setChild(r),null===this.currentChild?(this.currentChild=r,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=r,i=this.pendingChild)}else i=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return s}}t.ChildLoadBalancerHandler=a},64718:(e,t,r)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.OutlierDetectionLoadBalancer=t.OutlierDetectionLoadBalancingConfig=void 0;const i=r(23466),s=r(57794),a=r(35831),o=r(49318),l=r(29048),u=r(42095),c=r(50994),d=r(6299),h=r(19460),p=r(23769),f="outlier_detection";function m(e){p.trace(s.LogVerbosity.DEBUG,f,e)}const g="outlier_detection",y=(null!==(n=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)&&void 0!==n?n:"true")==="true",v={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},b={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function T(e,t,r,n){if(t in e&&typeof e[t]!==r){const i=n?`${n}.${t}`:t;throw Error(`outlier detection config ${i} parse error: expected ${r}, got ${typeof e[t]}`)}}function w(e,t,r){const n=r?`${r}.${t}`:t;if(t in e){if(!(0,a.isDuration)(e[t]))throw Error(`outlier detection config ${n} parse error: expected Duration, got ${typeof e[t]}`);if(!(e[t].seconds>=0&&e[t].seconds<=315576e6&&e[t].nanos>=0&&e[t].nanos<=999999999))throw Error(`outlier detection config ${n} parse error: values out of range for non-negative Duaration`)}}function S(e,t,r){const n=r?`${r}.${t}`:t;if(T(e,t,"number",r),t in e&&!(e[t]>=0&&e[t]<=100))throw Error(`outlier detection config ${n} parse error: value out of range for percentage (0-100)`)}class E{constructor(e,t,r,n,i,s,a){if(this.childPolicy=a,a.length>0&&"pick_first"===a[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=e?e:1e4,this.baseEjectionTimeMs=null!=t?t:3e4,this.maxEjectionTimeMs=null!=r?r:3e5,this.maxEjectionPercent=null!=n?n:10,this.successRateEjection=i?Object.assign(Object.assign({},v),i):null,this.failurePercentageEjection=s?Object.assign(Object.assign({},b),s):null}getLoadBalancerName(){return g}toJsonObject(){return{interval:(0,a.msToDuration)(this.intervalMs),base_ejection_time:(0,a.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,a.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new E(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){let t;if(w(e,"interval"),w(e,"base_ejection_time"),w(e,"max_ejection_time"),S(e,"max_ejection_percent"),"success_rate_ejection"in e){if("object"!=typeof e.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");T(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),S(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),T(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),T(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if("object"!=typeof e.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");S(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),S(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),T(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),T(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new E(e.interval?(0,a.durationToMs)(e.interval):null,e.base_ejection_time?(0,a.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,a.durationToMs)(e.max_ejection_time):null,null!==(t=e.max_ejection_percent)&&void 0!==t?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(l.validateLoadBalancingConfig))}}t.OutlierDetectionLoadBalancingConfig=E;class _ extends h.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((e,t,r,n)=>{if(this.childSubchannelState=r,!this.ejected)for(const e of this.stateListeners)e(this,t,r,n)})}getConnectivityState(){return this.ejected?i.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){const t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){const e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){for(const e of(this.ejected=!0,this.stateListeners))e(this,this.childSubchannelState,i.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(const e of(this.ejected=!1,this.stateListeners))e(this,i.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function C(){return{success:0,failure:0}}class I{constructor(){this.activeBucket=C(),this.inactiveBucket=C()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=C()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class R{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){const t=this.wrappedPicker.pick(e);if(t.pickResultType!==c.PickResultType.COMPLETE)return t;{const e=t.subchannel,r=e.getMapEntry();if(!r)return Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel()});{let n=t.onCallEnded;return this.countCalls&&(n=e=>{let n;e===s.Status.OK?r.counter.addSuccess():r.counter.addFailure(),null===(n=t.onCallEnded)||void 0===n||n.call(t,e)}),Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel(),onCallEnded:n})}}}}class k{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new u.ChildLoadBalancerHandler((0,o.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{const n=e.createSubchannel(t,r),i=this.addressMap.get((0,d.subchannelAddressToString)(t)),s=new _(n,i);return(null==i?void 0:i.currentEjectionTimestamp)!==null&&s.eject(),null==i||i.subchannelWrappers.push(s),s},updateState:(t,r)=>{t===i.ConnectivityState.READY?e.updateState(t,new R(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let e=0;for(const t of this.addressMap.values())null!==t.currentEjectionTimestamp&&(e+=1);return 100*e/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;const t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;m("Running success rate check");let r=t.request_volume,n=0,i=[];for(const[e,t]of this.addressMap){const s=t.counter.getLastSuccesses(),a=t.counter.getLastFailures();m("Stats for "+e+": successes="+s+" failures="+a+" targetRequestVolume="+r),s+a>=r&&(n+=1,i.push(s/(s+a)))}if(m("Found "+n+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+i+"]"),n<t.minimum_hosts)return;let s=i.reduce((e,t)=>e+t)/i.length,a=0;for(const e of i){const t=e-s;a+=t*t}const o=Math.sqrt(a/i.length),l=s-t.stdev_factor/1e3*o;for(const[n,i]of(m("stdev="+o+" ejectionThreshold="+l),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;const s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();if(s+a<r)continue;const o=s/(s+a);if(m("Checking candidate "+n+" successRate="+o),o<l){const r=100*Math.random();m("Candidate "+n+" randomNumber="+r+" enforcement_percentage="+t.enforcement_percentage),r<t.enforcement_percentage&&(m("Ejecting candidate "+n),this.eject(i,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;const t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;m("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(const e of this.addressMap.values())e.counter.getLastSuccesses()+e.counter.getLastFailures()>=t.request_volume&&(r+=1);if(!(r<t.minimum_hosts))for(const[r,n]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;const i=n.counter.getLastSuccesses(),s=n.counter.getLastFailures();if(m("Candidate successes="+i+" failures="+s),!(i+s<t.request_volume)&&100*s/(s+i)>t.threshold){const i=100*Math.random();m("Candidate "+r+" randomNumber="+i+" enforcement_percentage="+t.enforcement_percentage),i<t.enforcement_percentage&&(m("Ejecting candidate "+r),this.eject(n,e))}}}eject(e,t){for(const t of(e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1,e.subchannelWrappers))t.eject()}uneject(e){for(const t of(e.currentEjectionTimestamp=null,e.subchannelWrappers))t.uneject()}switchAllBuckets(){for(const e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){let t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),null===(r=(t=this.ejectionTimer).unref)||void 0===r||r.call(t)}runChecks(){const e=new Date;if(m("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(const[t,r]of(this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e),this.addressMap.entries()))if(null===r.currentEjectionTimestamp)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{const e=this.latestConfig.getBaseEjectionTimeMs(),n=this.latestConfig.getMaxEjectionTimeMs(),i=new Date(r.currentEjectionTimestamp.getTime());i.setMilliseconds(i.getMilliseconds()+Math.min(e*r.ejectionTimeMultiplier,Math.max(e,n))),i<new Date&&(m("Unejecting "+t),this.uneject(r))}}updateAddressList(e,t,r){if(!(t instanceof E))return;const n=new Set;for(const t of e)n.add((0,d.subchannelAddressToString)(t));for(const e of n)this.addressMap.has(e)||(m("Adding map entry for "+e),this.addressMap.set(e,{counter:new I,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(const e of this.addressMap.keys())n.has(e)||(m("Removing map entry for "+e),this.addressMap.delete(e));const i=(0,l.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,i,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig()){if(this.timerStartTime){m("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);const e=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(e)}else m("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets()}else for(const e of(m("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(e),e.ejectionTimeMultiplier=0;this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return g}}function A(){y&&(0,o.registerLoadBalancerType)(g,k,E)}t.OutlierDetectionLoadBalancer=k,t.setup=A},82126:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.PickFirstLoadBalancer=t.shuffled=t.PickFirstLoadBalancingConfig=void 0;const n=r(29048),i=r(23466),s=r(50994),a=r(23769),o=r(57794),l="pick_first";function u(e){a.trace(o.LogVerbosity.DEBUG,l,e)}const c="pick_first",d=250;class h{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return c}toJsonObject(){return{[c]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&"boolean"!=typeof e.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new h(!0===e.shuffleAddressList)}}t.PickFirstLoadBalancingConfig=h;class p{constructor(e){this.subchannel=e}pick(e){return{pickResultType:s.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function f(e){const t=e.slice();for(let e=t.length-1;e>1;e--){const r=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[r],t[r]=n}return t}t.shuffled=f;class m{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=i.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(e,t,r,n,i)=>{this.onSubchannelStateUpdate(e,t,r,i)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(i.ConnectivityState.READY,new p(this.currentPick)):0===this.children.length?this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(const{subchannel:e}of(this.stickyTransientFailureMode=!0,this.children))e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){const e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,n){let s;if(null===(s=this.currentPick)||void 0===s?void 0:s.realSubchannelEquals(e)){r!==i.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(const[t,s]of this.children.entries())if(e.realSubchannelEquals(s.subchannel)){r===i.ConnectivityState.READY&&this.pickSubchannel(s.subchannel),r===i.ConnectivityState.TRANSIENT_FAILURE&&(s.hasReportedTransientFailure=!0,n&&(this.lastError=n),this.maybeEnterStickyTransientFailureMode(),t===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(t+1)),s.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(const[t,r]of this.children.entries())if(t>=e){const e=r.subchannel.getConnectivityState();if(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){let t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===i.ConnectivityState.IDLE&&(u("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{let t;null===(t=this.children[e])||void 0===t||t.subchannel.startConnecting()})),this.connectionDelayTimeout=null===(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},d)).unref)||void 0===r?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(u("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){u(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(const e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){const t=e.map(e=>({subchannel:this.channelControlHelper.createSubchannel(e,{}),hasReportedTransientFailure:!1}));for(const{subchannel:e}of t)e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef());for(const{subchannel:e}of(this.resetSubchannelList(),this.children=t,this.children))if(e.addConnectivityStateListener(this.subchannelStateListener),e.getConnectivityState()===i.ConnectivityState.READY){this.pickSubchannel(e);return}for(const e of this.children)e.subchannel.getConnectivityState()===i.ConnectivityState.TRANSIENT_FAILURE&&(e.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof h&&(t.getShuffleAddressList()&&(e=f(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===i.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return c}}function g(){(0,n.registerLoadBalancerType)(c,m,h),(0,n.registerDefaultLoadBalancerType)(c)}t.PickFirstLoadBalancer=m,t.setup=g},21777:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.RoundRobinLoadBalancer=void 0;const n=r(29048),i=r(23466),s=r(50994),a=r(6299),o=r(23769),l=r(57794),u="round_robin";function c(e){o.trace(l.LogVerbosity.DEBUG,u,e)}const d="round_robin";class h{getLoadBalancerName(){return d}constructor(){}toJsonObject(){return{[d]:{}}}static createFromJson(e){return new h}}class p{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){const t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class f{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(e,t,r,n,s)=>{this.calculateAndUpdateState(),(r===i.ConnectivityState.TRANSIENT_FAILURE||r===i.ConnectivityState.IDLE)&&(s&&(this.lastError=s),this.channelControlHelper.requestReresolution(),e.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(i.ConnectivityState.READY)>0){let e=this.subchannels.filter(e=>e.getConnectivityState()===i.ConnectivityState.READY),t=0;null!==this.currentReadyPicker&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(t=0),this.updateState(i.ConnectivityState.READY,new p(e,t))}else this.countSubchannelsWithState(i.ConnectivityState.CONNECTING)>0?this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.countSubchannelsWithState(i.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),e===i.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(const e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){for(const t of(this.resetSubchannelList(),c("Connect to address list "+e.map(e=>(0,a.subchannelAddressToString)(e))),this.subchannels=e.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels)){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());const e=t.getConnectivityState();(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.TRANSIENT_FAILURE)&&t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(const e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return d}}function m(){(0,n.registerLoadBalancerType)(d,f,h)}t.RoundRobinLoadBalancer=f,t.setup=m},29048:(e,t)=>{"use strict";function r(e,t){let r,n,i,s,a,o,l,u,c,d;return{createSubchannel:null!==(n=null===(r=t.createSubchannel)||void 0===r?void 0:r.bind(t))&&void 0!==n?n:e.createSubchannel.bind(e),updateState:null!==(s=null===(i=t.updateState)||void 0===i?void 0:i.bind(t))&&void 0!==s?s:e.updateState.bind(e),requestReresolution:null!==(o=null===(a=t.requestReresolution)||void 0===a?void 0:a.bind(t))&&void 0!==o?o:e.requestReresolution.bind(e),addChannelzChild:null!==(u=null===(l=t.addChannelzChild)||void 0===l?void 0:l.bind(t))&&void 0!==u?u:e.addChannelzChild.bind(e),removeChannelzChild:null!==(d=null===(c=t.removeChannelzChild)||void 0===c?void 0:c.bind(t))&&void 0!==d?d:e.removeChannelzChild.bind(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.isLoadBalancerNameRegistered=t.createLoadBalancer=t.registerDefaultLoadBalancerType=t.registerLoadBalancerType=t.createChildChannelControlHelper=void 0,t.createChildChannelControlHelper=r;let n={},i=null;function s(e,t,r){n[e]={LoadBalancer:t,LoadBalancingConfig:r}}function a(e){i=e}function o(e,t){const r=e.getLoadBalancerName();return r in n?new n[r].LoadBalancer(t):null}function l(e){return e in n}function u(e,t=!1){for(const t of e)if(t.getLoadBalancerName() in n)return t;return t&&i?new n[i].LoadBalancingConfig:null}function c(e){if(!(null!==e&&"object"==typeof e))throw Error("Load balancing config must be an object");const t=Object.keys(e);if(1!==t.length)throw Error("Provided load balancing config has multiple conflicting entries");const r=t[0];if(r in n)return n[r].LoadBalancingConfig.createFromJson(e[r]);throw Error(`Unrecognized load balancing config name ${r}`)}t.registerLoadBalancerType=s,t.registerDefaultLoadBalancerType=a,t.createLoadBalancer=o,t.isLoadBalancerNameRegistered=l,t.getFirstUsableConfig=u,t.validateLoadBalancingConfig=c},43125:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadBalancingCall=void 0;const n=r(23466),i=r(57794),s=r(38601),a=r(57906),o=r(50994),l=r(97887),u=r(23769),c=r(57568),d=r(32694),h="load_balancing_call";class p{constructor(e,t,r,n,i,s,a){let o,u;this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let c=this.methodName.split("/"),d="";c.length>=2&&(d=c[1]);const h=null!==(u=null===(o=(0,l.splitHostPort)(this.host))||void 0===o?void 0:o.host)&&void 0!==u?u:"localhost";this.serviceUrl=`https://${h}/${d}`}trace(e){u.trace(i.LogVerbosity.DEBUG,h,"["+this.callNumber+"] "+e)}outputStatus(e,t){let r,n;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');const i=Object.assign(Object.assign({},e),{progress:t});null===(r=this.listener)||void 0===r||r.onReceiveStatus(i),null===(n=this.onCallEnded)||void 0===n||n.call(this,i.code)}}doPick(){let e,t;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");const r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),l=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+o.PickResultType[r.pickResultType]+" subchannel: "+l+" status: "+(null===(e=r.status)||void 0===e?void 0:e.code)+" "+(null===(t=r.status)||void 0===t?void 0:t.details)),r.pickResultType){case o.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(e=>{let t,o,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}const c=this.metadata.clone();if(c.merge(e),c.get("authorization").length>1&&this.outputStatus({code:i.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new a.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==n.ConnectivityState.READY){this.trace("Picked subchannel "+l+" has state "+n.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&c.set("grpc-timeout",(0,s.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(c,this.host,this.methodName,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(e)},onReceiveMessage:e=>{this.trace("Received message"),this.listener.onReceiveMessage(e)},onReceiveStatus:e=>{this.trace("Received status"),e.rstCode===d.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(e,"REFUSED"):this.outputStatus(e,"PROCESSED")}})}catch(e){this.trace("Failed to start call on picked subchannel "+l+" with error "+e.message),this.outputStatus({code:i.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+e.message,metadata:new a.Metadata},"NOT_STARTED");return}null===(o=(t=this.callConfig).onCommitted)||void 0===o||o.call(t),null===(u=r.onCallStarted)||void 0===u||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},e=>{const{code:t,details:r}=(0,c.restrictControlPlaneStatusCode)("number"==typeof e.code?e.code:i.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${e.message}`);this.outputStatus({code:t,details:r,metadata:new a.Metadata},"PROCESSED")});break;case o.PickResultType.DROP:const{code:u,details:h}=(0,c.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:u,details:h,metadata:r.status.metadata},"DROP")});break;case o.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{const{code:e,details:t}=(0,c.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:e,details:t,metadata:r.status.metadata},"PROCESSED")})}break;case o.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){let r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null===(r=this.child)||void 0===r||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new a.Metadata},"PROCESSED")}getPeer(){let e,t;return null!==(t=null===(e=this.child)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}t.LoadBalancingCall=p},23769:(e,t,r)=>{"use strict";let n,i,s,a;Object.defineProperty(t,"__esModule",{value:!0}),t.isTracerEnabled=t.trace=t.log=t.setLoggerVerbosity=t.setLogger=t.getLogger=void 0;let o=r(57794),l=r(35816),u=r(37645).i8,c={error:(e,...t)=>{console.error("E "+e,...t)},info:(e,...t)=>{console.error("I "+e,...t)},debug:(e,...t)=>{console.error("D "+e,...t)}},d=o.LogVerbosity.ERROR;switch((null!==(i=null!==(n=process.env.GRPC_NODE_VERBOSITY)&&void 0!==n?n:process.env.GRPC_VERBOSITY)&&void 0!==i?i:"").toUpperCase()){case"DEBUG":d=o.LogVerbosity.DEBUG;break;case"INFO":d=o.LogVerbosity.INFO;break;case"ERROR":d=o.LogVerbosity.ERROR;break;case"NONE":d=o.LogVerbosity.NONE}const h=()=>c;t.getLogger=h;const p=e=>{c=e};t.setLogger=p;const f=e=>{d=e};t.setLoggerVerbosity=f;const m=(e,...t)=>{let r;if(e>=d){switch(e){case o.LogVerbosity.DEBUG:r=c.debug;break;case o.LogVerbosity.INFO:r=c.info;break;case o.LogVerbosity.ERROR:r=c.error}r||(r=c.error),r&&r.bind(c)(...t)}};t.log=m;const g=null!==(a=null!==(s=process.env.GRPC_NODE_TRACE)&&void 0!==s?s:process.env.GRPC_TRACE)&&void 0!==a?a:"",y=new Set,v=new Set;for(const e of g.split(","))e.startsWith("-")?v.add(e.substring(1)):y.add(e);const b=y.has("all");function T(e,r,n){w(r)&&(0,t.log)(e,new Date().toISOString()+" | v"+u+" "+l.pid+" | "+r+" | "+n)}function w(e){return!v.has(e)&&(b||y.has(e))}t.trace=T,t.isTracerEnabled=w},31476:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadPackageDefinition=t.makeClientConstructor=void 0;const n=r(64217),i={unary:n.Client.prototype.makeUnaryRequest,server_stream:n.Client.prototype.makeServerStreamRequest,client_stream:n.Client.prototype.makeClientStreamRequest,bidi:n.Client.prototype.makeBidiStreamRequest};function s(e){return["__proto__","prototype","constructor"].includes(e)}function a(e,t,r){r||(r={});class a extends n.Client{}return Object.keys(e).forEach(t=>{let r;if(s(t))return;const n=e[t];if("string"==typeof t&&"$"===t.charAt(0))throw Error("Method names cannot start with $");r=n.requestStream?n.responseStream?"bidi":"client_stream":n.responseStream?"server_stream":"unary";const l=n.requestSerialize,u=n.responseDeserialize,c=o(i[r],n.path,l,u);a.prototype[t]=c,Object.assign(a.prototype[t],n),n.originalName&&!s(n.originalName)&&(a.prototype[n.originalName]=a.prototype[t])}),a.service=e,a.serviceName=t,a}function o(e,t,r,n){return function(...i){return e.call(this,t,r,n,...i)}}function l(e){return"format"in e}function u(e){const t={};for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){const n=e[r],i=r.split(".");if(i.some(e=>s(e)))continue;let o=i[i.length-1],u=t;for(const e of i.slice(0,-1))u[e]||(u[e]={}),u=u[e];l(n)?u[o]=n:u[o]=a(n,o,{})}return t}t.makeClientConstructor=a,t.loadPackageDefinition=u},57906:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;const n=r(23769),i=r(57794),s=r(13518),a=/^[0-9a-z_.-]+$/,o=/^[ -~]*$/;function l(e){return a.test(e)}function u(e){return o.test(e)}function c(e){return e.endsWith("-bin")}function d(e){return!e.startsWith("grpc-")}function h(e){return e.toLowerCase()}function p(e,t){if(!l(e))throw Error('Metadata key "'+e+'" contains illegal characters');if(null!=t){if(c(e)){if(!Buffer.isBuffer(t))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(t))throw Error("keys that don't end with '-bin' must have String values");if(!u(t))throw Error('Metadata string value "'+t+'" contains illegal characters')}}}class f{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){p(e=h(e),t),this.internalRepr.set(e,[t])}add(e,t){p(e=h(e),t);const r=this.internalRepr.get(e);void 0===r?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=h(e),this.internalRepr.delete(e)}get(e){return e=h(e),this.internalRepr.get(e)||[]}getMap(){const e={};for(const[t,r]of this.internalRepr)if(r.length>0){const n=r[0];e[t]=Buffer.isBuffer(n)?Buffer.from(n):n}return e}clone(){const e=new f(this.options),t=e.internalRepr;for(const[e,r]of this.internalRepr){const n=r.map(e=>Buffer.isBuffer(e)?Buffer.from(e):e);t.set(e,n)}return e}merge(e){for(const[t,r]of e.internalRepr){const e=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,e)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){const e={};for(const[t,r]of this.internalRepr)e[t]=r.map(m);return e}toJSON(){const e={};for(const[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){const t=new f;for(const r of Object.keys(e)){if(":"===r.charAt(0))continue;const a=e[r];try{c(r)?Array.isArray(a)?a.forEach(e=>{t.add(r,Buffer.from(e,"base64"))}):void 0!==a&&(d(r)?a.split(",").forEach(e=>{t.add(r,Buffer.from(e.trim(),"base64"))}):t.add(r,Buffer.from(a,"base64"))):Array.isArray(a)?a.forEach(e=>{t.add(r,e)}):void 0!==a&&t.add(r,a)}catch(t){const e=`Failed to add metadata entry ${r}: ${a}. ${(0,s.getErrorMessage)(t)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,n.log)(i.LogVerbosity.ERROR,e)}}return t}}t.Metadata=f;const m=e=>Buffer.isBuffer(e)?e.toString("base64"):e},50994:(e,t,r)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.QueuePicker=t.UnavailablePicker=t.PickResultType=void 0;const i=r(57906),s=r(57794);!function(e){e[e.COMPLETE=0]="COMPLETE",e[e.QUEUE=1]="QUEUE",e[e.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",e[e.DROP=3]="DROP"}(n||(t.PickResultType=n={}));class a{constructor(e){this.status=Object.assign({code:s.Status.UNAVAILABLE,details:"No connection established",metadata:new i.Metadata},e)}pick(e){return{pickResultType:n.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}t.UnavailablePicker=a;class o{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:n.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}t.QueuePicker=o},3688:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.DEFAULT_PORT=void 0;const n=r(250),i=r(80665),s=r(21764),a=r(39645),o=r(57794),l=r(57906),u=r(23769),c=r(57794),d=r(97887),h=r(98216),p=r(26383),f="dns_resolver";function m(e){u.trace(c.LogVerbosity.DEBUG,f,e)}t.DEFAULT_PORT=443;const g=3e4,y=s.promisify(i.resolveTxt),v=s.promisify(i.lookup);function b(...e){const t=[];for(let r=0;r<Math.max.apply(null,e.map(e=>e.length));r++)for(const n of e)r<n.length&&t.push(n[r]);return t}class T{constructor(e,r,n){let i,s,a;this.target=e,this.listener=r,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,m("Resolver constructed for target "+(0,d.uriToString)(e));const u=(0,d.splitHostPort)(e.path);null===u?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,h.isIPv4)(u.host)||(0,h.isIPv6)(u.host)?(this.ipResult=[{host:u.host,port:null!==(i=u.port)&&void 0!==i?i:t.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=u.host,this.port=null!==(s=u.port)&&void 0!==s?s:t.DEFAULT_PORT),this.percentage=100*Math.random(),1===n["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:o.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,d.uriToString)(this.target)}`,metadata:new l.Metadata};const c={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoff=new p.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},c),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!==(a=n["grpc.dns_min_time_between_resolutions_ms"])&&void 0!==a?a:g,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(m("Returning IP address for target "+(0,d.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)m("Failed to parse DNS address "+(0,d.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:o.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,d.uriToString)(this.target)}`,metadata:new l.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;m("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;const e=this.dnsHostname;this.pendingLookupPromise=v(e,{all:!0}),this.pendingLookupPromise.then(e=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();const t=e.filter(e=>4===e.family),r=e.filter(e=>6===e.family);this.latestLookupResult=b(r,t).map(e=>({host:e.address,port:+this.port}));const n="["+this.latestLookupResult.map(e=>e.host+":"+e.port).join(",")+"]";if(m("Resolved addresses for target "+(0,d.uriToString)(this.target)+": "+n),0===this.latestLookupResult.length){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{null!==this.pendingLookupPromise&&(m("Resolution error for target "+(0,d.uriToString)(this.target)+": "+e.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=y(e),this.pendingTxtPromise.then(e=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,a.extractAndSelectServiceConfig)(e,this.percentage)}catch(e){this.latestServiceConfigError={code:o.Status.UNAVAILABLE,details:`Parsing service config failed with error ${e.message}`,metadata:new l.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},e=>{}))}}startNextResolutionTimer(){let e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null===(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)||void 0===t?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?m('resolution update delayed by "min time between resolutions" rate limit'):m("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}}function w(){(0,n.registerResolver)("dns",T),(0,n.registerDefaultScheme)("dns")}t.setup=w},83324:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;const n=r(98216),i=r(57794),s=r(57906),a=r(250),o=r(97887),l=r(23769),u="ip_resolver";function c(e){l.trace(i.LogVerbosity.DEBUG,u,e)}const d="ipv4",h="ipv6",p=443;class f{constructor(e,t,r){let a;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,c("Resolver constructed for target "+(0,o.uriToString)(e));const l=[];if(!(e.scheme===d||e.scheme===h)){this.error={code:i.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new s.Metadata};return}for(const t of e.path.split(",")){const r=(0,o.splitHostPort)(t);if(null===r||e.scheme===d&&!(0,n.isIPv4)(r.host)||e.scheme===h&&!(0,n.isIPv6)(r.host)){this.error={code:i.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${t}`,metadata:new s.Metadata};return}l.push({host:r.host,port:null!==(a=r.port)&&void 0!==a?a:p})}this.addresses=l,c("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}}function m(){(0,a.registerResolver)(d,f),(0,a.registerResolver)(h,f)}t.setup=m},28316:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;const n=r(250);class i{constructor(e,t,r){let n;this.listener=t,this.addresses=[],this.hasReturnedResult=!1,n=""===e.authority?"/"+e.path:e.path,this.addresses=[{path:n}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}}function s(){(0,n.registerResolver)("unix",i)}t.setup=s},250:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapUriDefaultScheme=t.getDefaultAuthority=t.createResolver=t.registerDefaultScheme=t.registerResolver=void 0;let n=r(97887),i={},s=null;function a(e,t){i[e]=t}function o(e){s=e}function l(e,t,r){if(void 0!==e.scheme&&e.scheme in i)return new i[e.scheme](e,t,r);throw Error(`No resolver could be created for target ${(0,n.uriToString)(e)}`)}function u(e){if(void 0!==e.scheme&&e.scheme in i)return i[e.scheme].getDefaultAuthority(e);throw Error(`Invalid target ${(0,n.uriToString)(e)}`)}function c(e){return void 0!==e.scheme&&e.scheme in i?e:null!==s?{scheme:s,authority:void 0,path:(0,n.uriToString)(e)}:null}t.registerResolver=a,t.registerDefaultScheme=o,t.createResolver=l,t.getDefaultAuthority=u,t.mapUriDefaultScheme=c},33148:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingCall=void 0;const n=r(57794),i=r(38601),s=r(57906),a=r(23769),o=r(57568),l="resolving_call";class u{constructor(e,t,r,s,a,o){this.channel=e,this.method=t,this.filterStackFactory=s,this.credentials=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&n.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(n.Status.CANCELLED,"Cancelled by parent call")}),r.flags&n.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,i.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){a.trace(n.LogVerbosity.DEBUG,l,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,i.deadlineToString)(this.deadline));const e=(0,i.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");const t=()=>{this.cancelWithStatus(n.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);const t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(e=>e(t)),process.nextTick(()=>{let e;null===(e=this.listener)||void 0===e||e.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw Error("sendMessageonChild called with child not populated");const r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(t=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,t.message),this.pendingHalfClose&&r.halfClose()},e=>{this.cancelWithStatus(e.code,e.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");const e=this.channel.getConfig(this.method,this.metadata);if("NONE"===e.type){this.channel.queueCallForConfig(this);return}if("ERROR"===e.type){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}const t=e.config;if(t.status!==n.Status.OK){const{code:e,details:r}=(0,o.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:e,details:r,metadata:new s.Metadata});return}if(t.methodConfig.timeout){const e=new Date;e.setSeconds(e.getSeconds()+t.methodConfig.timeout.seconds),e.setMilliseconds(e.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,i.minDeadline)(this.deadline,e),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(e=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(e,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(e))},onReceiveMessage:e=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(e).then(e=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(e),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},e=>{this.cancelWithStatus(e.code,e.details)})},onReceiveStatus:e=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=e:this.outputStatus(e)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},e=>{this.outputStatus(e)})}reportResolverError(e){let t;(null===(t=this.metadata)||void 0===t?void 0:t.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){let r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null===(r=this.child)||void 0===r||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new s.Metadata})}getPeer(){let e,t;return null!==(t=null===(e=this.child)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}}t.ResolvingCall=u},29891:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingLoadBalancer=void 0;const n=r(29048),i=r(39645),s=r(23466),a=r(250),o=r(50994),l=r(26383),u=r(57794),c=r(57906),d=r(23769),h=r(57794),p=r(97887),f=r(42095),m="resolving_load_balancer";function g(e){d.trace(h.LogVerbosity.DEBUG,m,e)}const y=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function v(e,t,r,n){for(const i of r.name)switch(n){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===e&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===e&&i.method===t)return!0}return!1}function b(e,t,r,n){for(const i of r)if(v(e,t,i,n))return i;return null}function T(e){return function(t,r){let n,i;const s=t.split("/").filter(e=>e.length>0),a=null!==(n=s[0])&&void 0!==n?n:"",o=null!==(i=s[1])&&void 0!==i?i:"";if(e&&e.methodConfig)for(const t of y){const r=b(a,o,e.methodConfig,t);if(r)return{methodConfig:r,pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}}class w{constructor(e,t,r,d,h){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=d,this.onFailedResolution=h,this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,i.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(s.ConnectivityState.IDLE,new o.QueuePicker(this)),this.childLoadBalancer=new f.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(g("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(e,t)=>{this.latestChildState=e,this.latestChildPicker=t,this.updateState(e,t)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,a.createResolver)(e,{onSuccessfulResolution:(e,t,r,i,s)=>{let a;this.backoffTimeout.stop(),this.backoffTimeout.reset();let o=null;null===t?null===r?(this.previousServiceConfig=null,o=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(r):o=this.previousServiceConfig:(o=t,this.previousServiceConfig=t);const l=null!==(a=null==o?void 0:o.loadBalancingConfig)&&void 0!==a?a:[],d=(0,n.getFirstUsableConfig)(l,!0);if(null===d){this.handleResolutionFailure({code:u.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new c.Metadata});return}this.childLoadBalancer.updateAddressList(e,d,s);const h=null!=o?o:this.defaultServiceConfig;this.onSuccessfulResolution(h,null!=i?i:T(h))},onError:e=>{this.handleResolutionFailure(e)}},r);const p={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new l.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},p),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===s.ConnectivityState.IDLE&&this.updateState(s.ConnectivityState.CONNECTING,new o.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){g((0,p.uriToString)(this.target)+" "+s.ConnectivityState[this.currentState]+" -> "+s.ConnectivityState[e]),e===s.ConnectivityState.IDLE&&(t=new o.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===s.ConnectivityState.IDLE&&(this.updateState(s.ConnectivityState.TRANSIENT_FAILURE,new o.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===s.ConnectivityState.IDLE||this.currentState===s.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}t.ResolvingLoadBalancer=w},69145:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryingCall=t.MessageBufferTracker=t.RetryThrottler=void 0;const n=r(57794),i=r(57906),s=r(23769),a="retrying_call";class o{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}t.RetryThrottler=o;class l{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){let r;const n=null!==(r=this.allocatedPerCall.get(t))&&void 0!==r?r:0;return!(this.limitPerCall-n<e)&&!(this.totalLimit-this.totalAllocated<e)&&(this.allocatedPerCall.set(t,n+e),this.totalAllocated+=e,!0)}free(e,t){let r;if(this.totalAllocated<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;const n=null!==(r=this.allocatedPerCall.get(t))&&void 0!==r?r:0;if(n<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${n}`);this.allocatedPerCall.set(t,n-e)}freeAll(e){let t;const r=null!==(t=this.allocatedPerCall.get(e))&&void 0!==t?t:0;if(this.totalAllocated<r)throw Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}}t.MessageBufferTracker=l;const u="grpc-previous-rpc-attempts";class c{constructor(e,t,r,n,i,s,a,o,l){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.bufferTracker=o,this.retryThrottler=l,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";const e=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(e.initialBackoff.substring(0,e.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){s.trace(n.LogVerbosity.DEBUG,a,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{let t;null===(t=this.listener)||void 0===t||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){for(const{call:r}of(this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new i.Metadata}),this.underlyingCalls))r.cancelWithStatus(e,t)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){let t;return null!==(t=this.writeBuffer[e-this.writeBufferOffset])&&void 0!==t?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;const e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){const e=this.getBufferEntry(t);e.allocated&&this.bufferTracker.free(e.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[e].state){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&"COMPLETED"!==this.underlyingCalls[t].state&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(n.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let e=-1,t=-1;for(const[r,n]of this.underlyingCalls.entries())"ACTIVE"===n.state&&n.nextMessageToSend>e&&(e=n.nextMessageToSend,t=r);-1===t?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(e=>e===t||e.toString().toLowerCase()===n.Status[t].toLowerCase())}getNextRetryBackoffMs(){let e;const t=null===(e=this.callConfig)||void 0===e?void 0:e.methodConfig.retryPolicy;if(!t)return 0;const r=Math.random()*this.nextRetryBackoffSec*1e3,n=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,n),r}maybeRetryCall(e,t){let r;if("RETRY"!==this.state){t(!1);return}const n=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(n.maxAttempts,5)){t(!1);return}if(null===e)r=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else r=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{let e,r;if("RETRY"!==this.state){t(!1);return}(null===(r=null===(e=this.retryThrottler)||void 0===e?void 0:e.canRetryCall())||void 0===r||r)&&(t(!0),this.attempts+=1,this.startNewAttempt())},r)}countActiveCalls(){let e=0;for(const t of this.underlyingCalls)(null==t?void 0:t.state)==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){let n,i,s;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList(null!==(n=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)&&void 0!==n?n:[],e.code)){let n;if(null===(i=this.retryThrottler)||void 0===i||i.addCallFailed(),null===r)n=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else n=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(t),this.reportStatus(e))},n)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?(null===(s=this.retryThrottler)||void 0===s||s.addCallFailed(),this.maybeRetryCall(r,r=>{r||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e))}}getPushback(e){const t=e.get("grpc-retry-pushback-ms");if(0===t.length)return null;try{return parseInt(t[0])}catch(e){return -1}}handleChildStatus(e,t){let r;if("COMPLETED"===this.underlyingCalls[t].state)return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===n.Status.OK){null===(r=this.retryThrottler)||void 0===r||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if("COMMITTED"===this.state){this.reportStatus(e);return}const i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;const e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){let e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;const n=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return;const i=null!==(e=n.hedgingDelay)&&void 0!==e?e:"0s",s=Number(i.substring(0,i.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*s),null===(r=(t=this.hedgingTimer).unref)||void 0===r||r.call(t)}startNewAttempt(){const e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);const t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});const r=this.attempts-1,n=this.initialMetadata.clone();r>0&&n.set(u,`${r}`);let i=!1;e.start(n,{onReceiveMetadata:n=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),i=!0,r>0&&n.set(u,`${r}`),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMetadata(n)},onReceiveMessage:r=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMessage(r)},onReceiveStatus:n=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!i&&r>0&&n.metadata.set(u,`${r}`),this.handleChildStatus(n,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){let t,r;const n=this.underlyingCalls[e],i=n.nextMessageToSend;null===(r=(t=this.getBufferEntry(i)).callback)||void 0===r||r.call(t),this.clearSentMessages(),n.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){const t=this.underlyingCalls[e];if("COMPLETED"!==t.state&&this.getBufferEntry(t.nextMessageToSend)){const r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:t=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose()}}}sendMessageWithContext(e,t){let r;this.trace("write() called with message of length "+t.length);const n={message:t,flags:e.flags},i=this.getNextBufferIndex(),s={entryType:"MESSAGE",message:n,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(s),s.allocated)for(const[n,s]of(null===(r=e.callback)||void 0===r||r.call(e),this.underlyingCalls.entries()))"ACTIVE"===s.state&&s.nextMessageToSend===i&&s.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(n)}},t);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;const r=this.underlyingCalls[this.committedCallIndex];s.callback=e.callback,"ACTIVE"===r.state&&r.nextMessageToSend===i&&r.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){for(const e of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==e?void 0:e.state)==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");const e=this.getNextBufferIndex();for(const t of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==t?void 0:t.state)==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}t.RetryingCall=c},37121:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2ServerCallStream=t.ServerDuplexStreamImpl=t.ServerWritableStreamImpl=t.ServerReadableStreamImpl=t.ServerUnaryCallImpl=void 0;const n=r(17702),i=r(32694),s=r(76162),a=r(71568),o=r(57794),l=r(57906),u=r(69072),c=r(23769),d=r(13518),h="server_call";function p(e){c.trace(o.LogVerbosity.DEBUG,h,e)}const f="grpc-message",m="grpc-status",g="grpc-timeout",y=/(\d{1,8})\s*([HMSmun])/,v={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},b={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},T={[i.constants.HTTP2_HEADER_STATUS]:i.constants.HTTP_STATUS_OK,[i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},w={waitForTrailers:!0};class S extends n.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerUnaryCallImpl=S;class E extends s.Readable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,n)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerReadableStreamImpl=E;class _ extends s.Writable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{const t=this.call.serializeMessage(e);if(!this.call.write(t)){this.call.once("drain",r);return}}catch(e){this.emit("error",{details:(0,d.getErrorMessage)(e),code:o.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:o.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerWritableStreamImpl=_;class C extends s.Duplex{constructor(e,t,r,n,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerDuplexStreamImpl=C,C.prototype._read=E.prototype._read,C.prototype._write=_.prototype._write,C.prototype._final=_.prototype._final;class I extends n.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=o.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=o.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",e=>{}),this.stream.once("close",()=>{let e;p("Request to method "+(null===(e=this.handler)||void 0===e?void 0:e.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:o.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){const r=e.subarray(5);if("identity"===t)return r;if("deflate"!==t&&"gzip"!==t)return Promise.reject({code:o.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`});{let e;return e="deflate"===t?a.createInflate():a.createGunzip(),new Promise((t,n)=>{let i=0,s=[];e.on("data",t=>{s.push(t),i+=t.byteLength,-1!==this.maxReceiveMessageSize&&i>this.maxReceiveMessageSize&&(e.destroy(),n({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),e.on("end",()=>{t(Buffer.concat(s))}),e.write(r),e.end()})}}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;const t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},T),b),t);this.stream.respond(r,w)}receiveMetadata(e){const t=l.Metadata.fromHttp2Headers(e);c.isTracerEnabled(h)&&p("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));const r=t.get(g);if(r.length>0){const e=r[0].toString().match(y);if(null===e){const e=Error("Invalid deadline");return e.code=o.Status.OUT_OF_RANGE,this.sendError(e),t}const n=+e[1]*v[e[2]]|0,i=new Date;this.deadline=i.setMilliseconds(i.getMilliseconds()+n),this.deadlineTimer=setTimeout(R,n,this),t.remove(g)}return t.remove(i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(i.constants.HTTP2_HEADER_TE),t.remove(i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:n}=this,i=0,s=this,a=[],l=this.maxReceiveMessageSize;function u(e){if(i+=e.byteLength,-1!==l&&i>l){n.removeListener("data",u),n.removeListener("end",c),n.removeListener("error",c),r({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${i} vs. ${l})`});return}a.push(e)}function c(l){if(n.removeListener("data",u),n.removeListener("end",c),n.removeListener("error",c),void 0!==l){r({code:o.Status.INTERNAL,details:l.message});return}if(0===i){r({code:o.Status.INTERNAL,details:"received empty unary message"});return}s.emit("receiveMessage");const d=Buffer.concat(a,i),h=1===d.readUInt8(0)?e:"identity",p=s.getDecompressedMessage(d,h);if(Buffer.isBuffer(p)){t(s.deserializeMessageWithInternalError(p));return}p.then(e=>t(s.deserializeMessageWithInternalError(e)),t=>r(t.code?t:{code:o.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}this.stream.on("data",u),this.stream.on("end",c),this.stream.on("error",c)})}async deserializeMessageWithInternalError(e){try{return this.deserializeMessage(e)}catch(e){throw{details:(0,d.getErrorMessage)(e),code:o.Status.INTERNAL}}}serializeMessage(e){const t=this.handler.serialize(e),r=t.byteLength,n=Buffer.allocUnsafe(r+5);return n.writeUInt8(0,0),n.writeUInt32BE(r,1),t.copy(n,5),n}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,r,n){if(!this.checkCancelled()){if(void 0===r&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{const e=this.serializeMessage(t);this.write(e),this.sendStatus({code:o.Status.OK,details:"OK",metadata:r})}catch(e){this.sendError({details:(0,d.getErrorMessage)(e),code:o.Status.INTERNAL})}}}sendStatus(e){let t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===o.Status.OK),!this.checkCancelled()){if(p("Request to method "+(null===(t=this.handler)||void 0===t?void 0:t.path)+" ended with status code: "+o.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{let t;const r=Object.assign({[m]:e.code,[f]:encodeURI(e.details)},null===(t=e.metadata)||void 0===t?void 0:t.toHttp2Headers());this.stream.sendTrailers(r),this.statusSent=!0}),this.stream.end());else{const t=Object.assign(Object.assign({[m]:e.code,[f]:encodeURI(e.details)},T),null===(r=e.metadata)||void 0===r?void 0:r.toHttp2Headers());this.stream.respond(t,{endStream:!0}),this.statusSent=!0}}}sendError(e){const t={code:o.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&void 0!==e.metadata?e.metadata:null};"code"in e&&"number"==typeof e.code&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&"string"==typeof e.details&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(-1!==this.maxSendMessageSize&&e.length>this.maxSendMessageSize){this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new u.StreamDecoder(this.maxReceiveMessageSize),n=!1,i=!1,s=!1,a=async()=>{s||!n||i||(s=!0,await this.pushOrBufferMessage(e,null))};this.stream.on("data",async n=>{let s;try{s=r.write(n)}catch(e){this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:e.message});return}for(const r of(i=!0,this.stream.pause(),s)){let n;this.emit("receiveMessage");const i=1===r.readUInt8(0)?t:"identity";try{n=await this.getDecompressedMessage(r,i)}catch(e){this.sendError(e);return}if(!n)return;await this.pushOrBufferMessage(e,n)}i=!1,this.stream.resume(),await a()}),this.stream.once("end",async()=>{n=!0,await a()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){const t=this.messagesToPush.shift(),r=e.push(t);if(null===t||!1===r){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):await this.pushMessage(e,t)}async pushMessage(e,t){if(null===t){p("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}p("Received message of length "+t.length),this.isPushPending=!0;try{const r=await this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let t=(0,d.getErrorCode)(r);(null===t||t<o.Status.OK||t>o.Status.UNAUTHENTICATED)&&(t=o.Status.INTERNAL),e.emit("error",{details:(0,d.getErrorMessage)(r),code:t})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){let e;const t=null===(e=this.stream.session)||void 0===e?void 0:e.socket;return null!=t&&t.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function R(e){const t=Error("Deadline exceeded");t.code=o.Status.DEADLINE_EXCEEDED,e.sendError(t),e.cancelled=!0,e.emit("cancelled","deadline")}t.Http2ServerCallStream=I},38751:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerCredentials=void 0;const n=r(73633);class i{static createInsecure(){return new s}static createSsl(e,t,r=!1){if(null!==e&&!Buffer.isBuffer(e))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof r)throw TypeError("checkClientCertificate must be a boolean");const i=[],s=[];for(let e=0;e<t.length;e++){const r=t[e];if(null===r||"object"!=typeof r)throw TypeError(`keyCertPair[${e}] must be an object`);if(!Buffer.isBuffer(r.private_key))throw TypeError(`keyCertPair[${e}].private_key must be a Buffer`);if(!Buffer.isBuffer(r.cert_chain))throw TypeError(`keyCertPair[${e}].cert_chain must be a Buffer`);i.push(r.cert_chain),s.push(r.private_key)}return new a({ca:e||(0,n.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:n.CIPHER_SUITES})}}t.ServerCredentials=i;class s extends i{_isSecure(){return!1}_getSettings(){return null}}class a extends i{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}},62979:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Server=void 0;const n=r(32694),i=r(57794),s=r(37121),a=r(38751),o=r(250),l=r(23769),u=r(6299),c=r(97887),d=r(39871),h=2147483647,p=2147483647,f=2e4,{HTTP2_HEADER_PATH:m}=n.constants,g="server";function y(){}function v(e){return{code:i.Status.UNIMPLEMENTED,details:`The server does not implement the method ${e}`}}function b(e,t){const r=v(t);switch(e){case"unary":return(e,t)=>{t(r,null)};case"clientStream":return(e,t)=>{t(r,null)};case"serverStream":return e=>{e.emit("error",r)};case"bidi":return e=>{e.emit("error",r)};default:throw Error(`Invalid handlerType ${e}`)}}class T{constructor(e){let t,r,n,i;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new d.ChannelzTrace,this.callTracker=new d.ChannelzCallTracker,this.listenerChildrenTracker=new d.ChannelzChildrenTracker,this.sessionChildrenTracker=new d.ChannelzChildrenTracker,this.options=null!=e?e:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,d.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!==(t=this.options["grpc.max_connection_age_ms"])&&void 0!==t?t:h,this.maxConnectionAgeGraceMs=null!==(r=this.options["grpc.max_connection_age_grace_ms"])&&void 0!==r?r:h,this.keepaliveTimeMs=null!==(n=this.options["grpc.keepalive_time_ms"])&&void 0!==n?n:p,this.keepaliveTimeoutMs=null!==(i=this.options["grpc.keepalive_timeout_ms"])&&void 0!==i?i:f,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{let t,r,n;let i;const s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,u.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,u.stringToSubchannelAddress)(a.localAddress,a.localPort):null;if(e.encrypted){const e=a,r=e.getCipher(),n=e.getCertificate(),s=e.getPeerCertificate();i={cipherSuiteStandardName:null!==(t=r.standardName)&&void 0!==t?t:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:n&&"raw"in n?n.raw:null,remoteCertificate:s&&"raw"in s?s.raw:null}}else i=null;return{remoteAddress:o,localAddress:l,security:i,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(r=e.state.localWindowSize)&&void 0!==r?r:null,remoteFlowControlWindow:null!==(n=e.state.remoteWindowSize)&&void 0!==n?n:null}}}trace(e){l.trace(i.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+e)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(e,t){if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)throw Error("addService() requires two objects as arguments");const r=Object.keys(e);if(0===r.length)throw Error("Cannot add an empty service to a server");r.forEach(r=>{let n,i;const s=e[r];n=s.requestStream?s.responseStream?"bidi":"clientStream":s.responseStream?"serverStream":"unary";let a=t[r];if(void 0===a&&"string"==typeof s.originalName&&(a=t[s.originalName]),i=void 0!==a?a.bind(t):b(n,r),!1===this.register(s.path,i,s.responseSerialize,s.requestDeserialize,n))throw Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(null===e||"object"!=typeof e)throw Error("removeService() requires object as argument");Object.keys(e).forEach(t=>{const r=e[t];this.unregister(r.path)})}bind(e,t){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof e)throw TypeError("port must be a string");if(null===t||!(t instanceof a.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof r)throw TypeError("callback must be a function");const s=(0,c.parseUri)(e);if(null===s)throw Error(`Could not parse port "${e}"`);const h=(0,o.mapUriDefaultScheme)(s);if(null===h)throw Error(`Could not get a default scheme for port "${e}"`);const p={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?p.maxSessionMemory=this.options["grpc-node.max_session_memory"]:p.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(p.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});const f=(e,t)=>{process.nextTick(()=>r(e,t))},m=()=>{let e;if(t._isSecure()){const r=Object.assign(p,t._getSettings());r.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(e=n.createSecureServer(r)).on("secureConnection",e=>{e.on("error",e=>{this.trace("An incoming TLS connection closed with error: "+e.message)})})}else e=n.createServer(p);return e.setTimeout(0,y),this._setupHandlers(e),e},g=(e,t,r)=>0===e.length?Promise.resolve({port:t,count:r}):Promise.all(e.map(e=>{let r;this.trace("Attempting to bind "+(0,u.subchannelAddressToString)(e)),r=(0,u.isTcpSubchannelAddress)(e)?{host:e.host,port:t}:e;const n=m();return new Promise((i,s)=>{const a=t=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(e)+" with error "+t.message),i(t)};n.once("error",a),n.listen(r,()=>{let e;if(this.shutdown){n.close(),i(Error("bindAsync failed because server is shutdown"));return}const r=n.address();e="string"==typeof r?{path:r}:{host:r.address,port:r.port};const s=(0,d.registerChannelzSocket)((0,u.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(s),this.http2ServerList.push({server:n,channelzRef:s}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(e)),i("port"in e?e.port:t),n.removeListener("error",a)})})})).then(e=>{let n=0;for(const r of e)if("number"==typeof r&&(n+=1,r!==t))throw Error("Invalid state: multiple port numbers added from single address");return{port:t,count:n+r}}),v=e=>{if(0===e.length)return Promise.resolve({port:0,count:0});const t=e[0],r=m();return new Promise((n,i)=>{const s=r=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(t)+" with error "+r.message),n(v(e.slice(1)))};r.once("error",s),r.listen(t,()=>{if(this.shutdown){r.close(),n({port:0,count:0});return}const t=r.address(),i={host:t.address,port:t.port},a=(0,d.registerChannelzSocket)((0,u.subchannelAddressToString)(i),()=>({localAddress:i,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(a),this.http2ServerList.push({server:r,channelzRef:a}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(i)),n(g(e.slice(1),t.port,1)),r.removeListener("error",s)})})},b={onSuccessfulResolution:(t,r,n)=>{let s;if(b.onSuccessfulResolution=()=>{},this.shutdown&&f(Error("bindAsync failed because server is shutdown"),0),0===t.length){f(Error(`No addresses resolved for port ${e}`),0);return}(s=(0,u.isTcpSubchannelAddress)(t[0])?0===t[0].port?v(t):g(t,t[0].port,0):g(t,1,0)).then(e=>{if(0===e.count){const e=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,e),f(Error(e),0)}else e.count<t.length&&l.log(i.LogVerbosity.INFO,`WARNING Only ${e.count} addresses added out of total ${t.length} resolved`),f(null,e.port)},e=>{const r=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,r),f(Error(r),0)})},onError:e=>{f(Error(e.details),0)}};(0,o.createResolver)(h,b,this.options).updateResolution()}forceShutdown(){for(const{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,d.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(n.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,d.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,n,i){return!this.handlers.has(e)&&(this.handlers.set(e,{func:t,serialize:r,deserialize:n,type:i,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:e})=>!0!==e.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=t=>{this.channelzEnabled&&(0,d.unregisterChannelzRef)(this.channelzRef),e(t)},r=0;function n(){0==--r&&t()}for(const{server:e,channelzRef:t}of(this.started=!1,this.shutdown=!0,this.http2ServerList))e.listening&&(r++,e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,d.unregisterChannelzRef)(t)),n()}));this.sessions.forEach((e,t)=>{t.closed||(r+=1,t.close(n))}),0===r&&t()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){const r=t[n.constants.HTTP2_HEADER_CONTENT_TYPE];return!!("string"==typeof r&&r.startsWith("application/grpc"))||(e.respond({[n.constants.HTTP2_HEADER_STATUS]:n.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);const t=this.handlers.get(e);return void 0===t?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){const n=new s.Http2ServerCallStream(t,null,this.options);void 0===e.code&&(e.code=i.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed()),n.sendError(e)}_channelzHandler(e,t){const r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),null==r||r.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed();return}const n=t[m],a=this._retrieveHandler(n);if(!a){this._respondWithError(v(n),e,r);return}const o=new s.Http2ServerCallStream(e,a,this.options);o.once("callEnd",e=>{e===i.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",e=>{e?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,a,t)||(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed(),o.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${a.type}`}))}_streamHandler(e,t){if(!0!==this._verifyContentType(e,t))return;const r=t[m],n=this._retrieveHandler(r);if(!n){this._respondWithError(v(r),e,null);return}const a=new s.Http2ServerCallStream(e,n,this.options);this._runHandlerForCall(a,n,t)||a.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${n.type}`})}_runHandlerForCall(e,t,r){let n;const i=e.receiveMetadata(r),s=null!==(n=i.get("grpc-encoding")[0])&&void 0!==n?n:"identity";i.remove("grpc-encoding");const{type:a}=t;if("unary"===a)w(e,t,i,s);else if("clientStream"===a)S(e,t,i,s);else if("serverStream"===a)E(e,t,i,s);else{if("bidi"!==a)return!1;_(e,t,i,s)}return!0}_setupHandlers(e){if(null===e)return;let t=e.address(),r="null";t&&(r="string"==typeof t?t:t.address+":"+t.port),this.serverAddressString=r;const i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",e=>{let t,r,i,s,a;if(!this.started){e.destroy();return}const o=(0,d.registerChannelzSocket)(null!==(t=e.socket.remoteAddress)&&void 0!==t?t:"unknown",this.getChannelzSessionInfoGetter(e),this.channelzEnabled),l={ref:o,streamTracker:new d.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(e,l);const u=e.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+u),this.sessionChildrenTracker.refChild(o));let c=null,p=null,f=!1;if(this.maxConnectionAgeMs!==h){const t=this.maxConnectionAgeMs/10,s=Math.random()*t*2-t;c=null===(i=(r=setTimeout(()=>{let t,r;f=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+u);try{e.goaway(n.constants.NGHTTP2_NO_ERROR,2147483647,Buffer.from("max_age"))}catch(t){e.destroy();return}e.close(),this.maxConnectionAgeGraceMs!==h&&(p=null===(r=(t=setTimeout(()=>{e.destroy()},this.maxConnectionAgeGraceMs)).unref)||void 0===r?void 0:r.call(t))},this.maxConnectionAgeMs+s)).unref)||void 0===i?void 0:i.call(r)}const m=null===(a=(s=setInterval(()=>{let t,r;const n=null===(r=(t=setTimeout(()=>{f=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+u),e.close()},this.keepaliveTimeoutMs)).unref)||void 0===r?void 0:r.call(t);try{e.ping((e,t,r)=>{clearTimeout(n)})}catch(t){e.destroy()}},this.keepaliveTimeMs)).unref)||void 0===a?void 0:a.call(s);e.on("close",()=>{this.channelzEnabled&&(f||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+u),this.sessionChildrenTracker.unrefChild(o),(0,d.unregisterChannelzRef)(o)),c&&clearTimeout(c),p&&clearTimeout(p),m&&clearTimeout(m),this.sessions.delete(e)})})}}async function w(e,t,r,n){try{const i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;const a=new s.ServerUnaryCallImpl(e,r,i);t.func(a,(t,r,n,i)=>{e.sendUnaryMessage(t,r,n,i)})}catch(t){e.sendError(t)}}function S(e,t,r,n){const i=new s.ServerReadableStreamImpl(e,r,t.deserialize,n);function a(t,r,n,s){i.destroy(),e.sendUnaryMessage(t,r,n,s)}e.cancelled||(i.on("error",a),t.func(i,a))}async function E(e,t,r,n){try{const i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;const a=new s.ServerWritableStreamImpl(e,r,t.serialize,i);t.func(a)}catch(t){e.sendError(t)}}function _(e,t,r,n){const i=new s.ServerDuplexStreamImpl(e,r,t.serialize,t.deserialize,n);e.cancelled||t.func(i)}t.Server=T},39645:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractAndSelectServiceConfig=t.validateServiceConfig=t.validateRetryThrottling=void 0;const n=r(19801),i=r(57794),s=r(29048),a=/^\d+(\.\d{1,9})?s$/,o="node";function l(e){if("service"in e&&""!==e.service){if("string"!=typeof e.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof e.service}`);if(!("method"in e)||""===e.method)return{service:e.service};if("string"!=typeof e.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof e.service}`);return{service:e.service,method:e.method}}if("method"in e&&void 0!==e.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function u(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in e)||"string"!=typeof e.initialBackoff||!a.test(e.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in e)||"string"!=typeof e.maxBackoff||!a.test(e.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in e)||"number"!=typeof e.backoffMultiplier||e.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in e&&Array.isArray(e.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===e.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(const t of e.retryableStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:e.maxAttempts,initialBackoff:e.initialBackoff,maxBackoff:e.maxBackoff,backoffMultiplier:e.backoffMultiplier,retryableStatusCodes:e.retryableStatusCodes}}function c(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in e&&("string"!=typeof e.hedgingDelay||!a.test(e.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in e&&Array.isArray(e.nonFatalStatusCodes))for(const t of e.nonFatalStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");const t={maxAttempts:e.maxAttempts};return e.hedgingDelay&&(t.hedgingDelay=e.hedgingDelay),e.nonFatalStatusCodes&&(t.nonFatalStatusCodes=e.nonFatalStatusCodes),t}function d(e){let t;const r={name:[]};if(!("name"in e)||!Array.isArray(e.name))throw Error("Invalid method config: invalid name array");for(const t of e.name)r.name.push(l(t));if("waitForReady"in e){if("boolean"!=typeof e.waitForReady)throw Error("Invalid method config: invalid waitForReady");r.waitForReady=e.waitForReady}if("timeout"in e){if("object"==typeof e.timeout){if(!("seconds"in e.timeout)||"number"!=typeof e.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in e.timeout)||"number"!=typeof e.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");r.timeout=e.timeout}else if("string"==typeof e.timeout&&a.test(e.timeout)){const n=e.timeout.substring(0,e.timeout.length-1).split(".");r.timeout={seconds:0|n[0],nanos:(null!==(t=n[1])&&void 0!==t?t:0)|0}}else throw Error("Invalid method config: invalid timeout")}if("maxRequestBytes"in e){if("number"!=typeof e.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxRequestBytes=e.maxRequestBytes}if("maxResponseBytes"in e){if("number"!=typeof e.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxResponseBytes=e.maxResponseBytes}if("retryPolicy"in e){if("hedgingPolicy"in e)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");r.retryPolicy=u(e.retryPolicy)}else"hedgingPolicy"in e&&(r.hedgingPolicy=c(e.hedgingPolicy));return r}function h(e){if(!("maxTokens"in e)||"number"!=typeof e.maxTokens||e.maxTokens<=0||e.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in e)||"number"!=typeof e.tokenRatio||e.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+e.maxTokens.toFixed(3),tokenRatio:+e.tokenRatio.toFixed(3)}}function p(e){const t={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in e){if("string"==typeof e.loadBalancingPolicy)t.loadBalancingPolicy=e.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy")}if("loadBalancingConfig"in e){if(Array.isArray(e.loadBalancingConfig))for(const r of e.loadBalancingConfig)t.loadBalancingConfig.push((0,s.validateLoadBalancingConfig)(r));else throw Error("Invalid service config: invalid loadBalancingConfig")}if("methodConfig"in e&&Array.isArray(e.methodConfig))for(const r of e.methodConfig)t.methodConfig.push(d(r));"retryThrottling"in e&&(t.retryThrottling=h(e.retryThrottling));const r=[];for(const e of t.methodConfig)for(const t of e.name){for(const e of r)if(t.service===e.service&&t.method===e.method)throw Error(`Invalid service config: duplicate name ${t.service}/${t.method}`);r.push(t)}return t}function f(e){if(!("serviceConfig"in e))throw Error("Invalid service config choice: missing service config");const t={serviceConfig:p(e.serviceConfig)};if("clientLanguage"in e){if(Array.isArray(e.clientLanguage))for(const r of(t.clientLanguage=[],e.clientLanguage))if("string"==typeof r)t.clientLanguage.push(r);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage")}if("clientHostname"in e){if(Array.isArray(e.clientHostname))for(const r of(t.clientHostname=[],e.clientHostname))if("string"==typeof r)t.clientHostname.push(r);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname")}if("percentage"in e){if("number"==typeof e.percentage&&0<=e.percentage&&e.percentage<=100)t.percentage=e.percentage;else throw Error("Invalid service config choice: invalid percentage")}const r=["clientLanguage","percentage","clientHostname","serviceConfig"];for(const t in e)if(!r.includes(t))throw Error(`Invalid service config choice: unexpected field ${t}`);return t}function m(e,t){if(!Array.isArray(e))throw Error("Invalid service config list");for(const r of e){const e=f(r);if("number"!=typeof e.percentage||!(t>e.percentage)){if(Array.isArray(e.clientHostname)){let t=!1;for(const r of e.clientHostname)r===n.hostname()&&(t=!0);if(!t)continue}if(Array.isArray(e.clientLanguage)){let t=!1;for(const r of e.clientLanguage)r===o&&(t=!0);if(!t)continue}return e.serviceConfig}}throw Error("No matching service config found")}function g(e,t){for(const r of e)if(r.length>0&&r[0].startsWith("grpc_config="))return m(JSON.parse(r.join("").substring(12)),t);return null}t.validateRetryThrottling=h,t.validateServiceConfig=p,t.extractAndSelectServiceConfig=g},77337:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusBuilder=void 0;class r{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){const e={};return null!==this.code&&(e.code=this.code),null!==this.details&&(e.details=this.details),null!==this.metadata&&(e.metadata=this.metadata),e}}t.StatusBuilder=r},69072:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.StreamDecoder=void 0,function(e){e[e.NO_DATA=0]="NO_DATA",e[e.READING_SIZE=1]="READING_SIZE",e[e.READING_MESSAGE=2]="READING_MESSAGE"}(r||(r={}));class n{constructor(e){this.maxReadMessageLength=e,this.readState=r.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t,n=0,i=[];for(;n<e.length;)switch(this.readState){case r.NO_DATA:this.readCompressFlag=e.slice(n,n+1),n+=1,this.readState=r.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case r.READING_SIZE:if(t=Math.min(e.length-n,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,n,n+t),this.readSizeRemaining-=t,n+=t,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=r.READING_MESSAGE;else{const e=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=r.NO_DATA,i.push(e)}}break;case r.READING_MESSAGE:if(t=Math.min(e.length-n,this.readMessageRemaining),this.readPartialMessage.push(e.slice(n,n+t)),this.readMessageRemaining-=t,n+=t,0===this.readMessageRemaining){const e=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),t=Buffer.concat(e,this.readMessageSize+5);this.readState=r.NO_DATA,i.push(t)}break;default:throw Error("Unexpected read state")}return i}}t.StreamDecoder=n},6299:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringToSubchannelAddress=t.subchannelAddressToString=t.subchannelAddressEqual=t.isTcpSubchannelAddress=void 0;const n=r(98216);function i(e){return"port"in e}function s(e,t){return!e&&!t||!!e&&!!t&&(i(e)?i(t)&&e.host===t.host&&e.port===t.port:!i(t)&&e.path===t.path)}function a(e){return i(e)?e.host+":"+e.port:e.path}t.isTcpSubchannelAddress=i,t.subchannelAddressEqual=s,t.subchannelAddressToString=a;const o=443;function l(e,t){return(0,n.isIP)(e)?{host:e,port:null!=t?t:o}:{path:e}}t.stringToSubchannelAddress=l},27989:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelCall=void 0;const n=r(32694),i=r(19801),s=r(57794),a=r(57906),o=r(69072),l=r(23769),u=r(57794),c="subchannel_call";function d(e){for(const[t,r]of Object.entries(i.constants.errno))if(r===e)return t;return"Unknown system error "+e}class h{constructor(e,t,r,i,l){let u;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=l,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=s.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;const c=null!==(u=i.getOptions()["grpc.max_receive_message_length"])&&void 0!==u?u:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new o.StreamDecoder(c),e.on("response",(e,t)=>{let r="";for(const t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";switch(this.trace("Received server headers:\n"+r),e[":status"]){case 400:this.mappedStatusCode=s.Status.INTERNAL;break;case 401:this.mappedStatusCode=s.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=s.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=s.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=s.Status.UNAVAILABLE;break;default:this.mappedStatusCode=s.Status.UNKNOWN}if(t&n.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(e);else{let t;try{t=a.Metadata.fromHttp2Headers(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new a.Metadata});return}this.listener.onReceiveMetadata(t)}}),e.on("trailers",e=>{this.handleTrailers(e)}),e.on("data",e=>{let t;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+e.length);try{t=this.decoder.write(e)}catch(e){this.cancelWithStatus(s.Status.RESOURCE_EXHAUSTED,e.message);return}for(const e of t)this.trace("parsed message of length "+e.length),this.callEventTracker.addMessageReceived(),this.tryPush(e)}}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{let t;let r;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),(null===(t=this.finalStatus)||void 0===t?void 0:t.code)===s.Status.OK)return;let i="";switch(e.rstCode){case n.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`;break;case n.constants.NGHTTP2_REFUSED_STREAM:r=s.Status.UNAVAILABLE,i="Stream refused by server";break;case n.constants.NGHTTP2_CANCEL:r=s.Status.CANCELLED,i="Call cancelled";break;case n.constants.NGHTTP2_ENHANCE_YOUR_CALM:r=s.Status.RESOURCE_EXHAUSTED,i="Bandwidth exhausted or memory limit exceeded";break;case n.constants.NGHTTP2_INADEQUATE_SECURITY:r=s.Status.PERMISSION_DENIED,i="Protocol not secure enough";break;case n.constants.NGHTTP2_INTERNAL_ERROR:r=s.Status.INTERNAL,null===this.internalError?i=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(r=s.Status.UNAVAILABLE,i=this.internalError.message):i=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:r,details:i,metadata:new a.Metadata,rstCode:e.rstCode})})}),e.on("error",e=>{"ERR_HTTP2_STREAM_ERROR"!==e.code&&(this.trace("Node error event: message="+e.message+" code="+e.code+" errno="+d(e.errno)+" syscall="+e.syscall),this.internalError=e),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:s.Status.UNAVAILABLE,details:"Connection dropped",metadata:new a.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){l.trace(u.LogVerbosity.DEBUG,c,"["+this.callId+"] "+e)}endCall(e){(null===this.finalStatus||this.finalStatus.code===s.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===s.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){let t;this.callEventTracker.onStreamEnd(!0);let r="";for(const t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";this.trace("Received server trailers:\n"+r);try{t=a.Metadata.fromHttp2Headers(e)}catch(e){t=new a.Metadata}let n=t.getMap(),i=this.mappedStatusCode;if(i===s.Status.UNKNOWN&&"string"==typeof n["grpc-status"]){const e=Number(n["grpc-status"]);e in s.Status&&(i=e,this.trace("received status code "+e+" from server")),t.remove("grpc-status")}let o="";if("string"==typeof n["grpc-message"]){try{o=decodeURI(n["grpc-message"])}catch(e){o=n["grpc-message"]}t.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}const l={code:i,details:o,metadata:t};this.endCall(l)}destroyHttp2Stream(){let e;if(!this.http2Stream.destroyed){let t;t=(null===(e=this.finalStatus)||void 0===e?void 0:e.code)===s.Status.OK?n.constants.NGHTTP2_NO_ERROR:n.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new a.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){const e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);const r=t=>{process.nextTick(()=>{let r;let n=s.Status.UNAVAILABLE;(null==t?void 0:t.code)==="ERR_STREAM_WRITE_AFTER_END"&&(n=s.Status.INTERNAL),t&&this.cancelWithStatus(n,`Write error: ${t.message}`),null===(r=e.callback)||void 0===r||r.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new a.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}t.Http2SubchannelCall=h},19460:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseSubchannelWrapper=void 0;class r{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}}t.BaseSubchannelWrapper=r},9686:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSubchannelPool=t.SubchannelPool=void 0;const n=r(86734),i=r(27266),s=r(6299),a=r(97887),o=r(85474),l=1e4;class u{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(const t in this.pool){const r=this.pool[t].filter(e=>!e.subchannel.unrefIfOneRef());r.length>0&&(e=!1),this.pool[t]=r}e&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){let e,t;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},l),null===(t=(e=this.cleanupTimer).unref)||void 0===t||t.call(e))}getOrCreateSubchannel(e,t,r,l){this.ensureCleanupTask();const u=(0,a.uriToString)(e);if(u in this.pool){for(const e of this.pool[u])if((0,s.subchannelAddressEqual)(t,e.subchannelAddress)&&(0,n.channelOptionsEqual)(r,e.channelArguments)&&l._equals(e.channelCredentials))return e.subchannel}const c=new i.Subchannel(e,t,r,l,new o.Http2SubchannelConnector(e));return u in this.pool||(this.pool[u]=[]),this.pool[u].push({subchannelAddress:t,channelArguments:r,channelCredentials:l,subchannel:c}),c.ref(),c}}t.SubchannelPool=u;const c=new u;function d(e){return e?c:new u}t.getSubchannelPool=d},27266:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Subchannel=void 0;const n=r(23466),i=r(26383),s=r(23769),a=r(57794),o=r(97887),l=r(6299),u=r(39871),c="subchannel",d=2147483647;class h{constructor(e,t,r,s,a){let o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=s,this.connector=a,this.connectivityState=n.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new u.ChannelzCallTracker,this.childrenTracker=new u.ChannelzChildrenTracker,this.streamTracker=new u.ChannelzCallTracker;const c={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.handleBackoffTimer()},c),this.backoffTimeout.unref(),this.subchannelAddressString=(0,l.subchannelAddressToString)(t),this.keepaliveTime=null!==(o=r["grpc.keepalive_time_ms"])&&void 0!==o?o:-1,0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new u.ChannelzTrace,this.channelzRef=(0,u.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){s.trace(a.LogVerbosity.DEBUG,c,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){s.trace(a.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING):this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){const t=Math.min(this.keepaliveTime,d);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.READY)?(this.transport=e,this.channelzEnabled&&this.childrenTracker.refChild(e.getChannelzRef()),e.addDisconnectListener(e=>{this.transitionToState([n.ConnectivityState.READY],n.ConnectivityState.IDLE),e&&this.keepaliveTime>0&&(this.keepaliveTime*=2,s.log(a.LogVerbosity.ERROR,`Connection to ${(0,o.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):e.shutdown()},e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.TRANSIENT_FAILURE,`${e}`)})}transitionToState(e,t,r){let i,s;if(-1===e.indexOf(this.connectivityState))return!1;this.trace(n.ConnectivityState[this.connectivityState]+" -> "+n.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+n.ConnectivityState[t]);const a=this.connectivityState;switch(this.connectivityState=t,t){case n.ConnectivityState.READY:this.stopBackoff();break;case n.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case n.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(i=this.transport)||void 0===i||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case n.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(s=this.transport)||void 0===s||s.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${t}`)}for(const e of this.stateListeners)e(this,a,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,u.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([n.ConnectivityState.CONNECTING,n.ConnectivityState.READY],n.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(e,t,r,n){let i;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),i={onCallEnd:e=>{e.code===a.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):i={},this.transport.createCall(e,t,r,n,i)}startConnecting(){process.nextTick(()=>{this.transitionToState([n.ConnectivityState.IDLE],n.ConnectivityState.CONNECTING)||this.connectivityState!==n.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}}t.Subchannel=h},73633:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultRootsData=t.CIPHER_SUITES=void 0;const n=r(92048);t.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let i=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,s=null;function a(){return i?(null===s&&(s=n.readFileSync(i)),s):null}t.getDefaultRootsData=a},85474:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelConnector=void 0;const n=r(32694),i=r(82452),s=r(39871),a=r(57794),o=r(11953),l=r(23769),u=r(250),c=r(6299),d=r(97887),h=r(98216),p=r(27989),f=r(12106),m="transport",g="transport_flowctrl",y=r(37645).i8,{HTTP2_HEADER_AUTHORITY:v,HTTP2_HEADER_CONTENT_TYPE:b,HTTP2_HEADER_METHOD:T,HTTP2_HEADER_PATH:w,HTTP2_HEADER_TE:S,HTTP2_HEADER_USER_AGENT:E}=n.constants,_=2e4,C=Buffer.from("too_many_pings","ascii");class I{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=_,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new s.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,c.subchannelAddressToString)(t),0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,s.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${y}`,r["grpc.secondary_user_agent"]].filter(e=>e).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=1===r["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(e,t,r)=>{let i=!1;e===n.constants.NGHTTP2_ENHANCE_YOUR_CALM&&r&&r.equals(C)&&(i=!0),this.trace("connection closed by GOAWAY with code "+e+" and data "+(null==r?void 0:r.toString())),this.reportDisconnectToOwner(i)}),e.once("error",e=>{this.trace("connection closed with error "+e.message)}),l.isTracerEnabled(m)&&(e.on("remoteSettings",t=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))}),e.on("localSettings",t=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){let e,t,r;let n;const i=this.session.socket,s=i.remoteAddress?(0,c.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,c.stringToSubchannelAddress)(i.localAddress,i.localPort):null;if(this.session.encrypted){const t=i,r=t.getCipher(),s=t.getCertificate(),a=t.getPeerCertificate();n={cipherSuiteStandardName:null!==(e=r.standardName)&&void 0!==e?e:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:s&&"raw"in s?s.raw:null,remoteCertificate:a&&"raw"in a?a.raw:null}}else n=null;return{remoteAddress:s,localAddress:a,security:n,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(t=this.session.state.localWindowSize)&&void 0!==t?t:null,remoteFlowControlWindow:null!==(r=this.session.state.remoteWindowSize)&&void 0!==r?r:null}}trace(e){l.trace(a.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){l.trace(a.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){l.trace(a.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){l.trace(a.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(const e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){let e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null===(t=(e=this.keepaliveTimeoutId).unref)||void 0===t||t.call(e));try{this.session.ping((e,t,r)=>{e&&(this.keepaliveTrace("Ping failed with error "+e.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(e){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){let e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null===(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)||void 0===t?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),0===this.activeCalls.size&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),1!==this.activeCalls.size||(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,n,i){let s,a,o;const l=e.toHttp2Headers();l[v]=t,l[E]=this.userAgent,l[b]="application/grpc",l[T]="POST",l[w]=r,l[S]="trailers";try{s=this.session.request(l)}catch(e){throw this.handleDisconnect(),e}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),a={addMessageSent:()=>{let e;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null===(e=i.addMessageSent)||void 0===e||e.call(i)},addMessageReceived:()=>{let e;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null===(e=i.addMessageReceived)||void 0===e||e.call(i)},onCallEnd:e=>{let t;null===(t=i.onCallEnd)||void 0===t||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{let t;e?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null===(t=i.onStreamEnd)||void 0===t||t.call(i,e)}}):a={addMessageSent:()=>{let e;null===(e=i.addMessageSent)||void 0===e||e.call(i)},addMessageReceived:()=>{let e;null===(e=i.addMessageReceived)||void 0===e||e.call(i)},onCallEnd:e=>{let t;null===(t=i.onCallEnd)||void 0===t||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{let t;null===(t=i.onStreamEnd)||void 0===t||t.call(i,e)}},o=new p.Http2SubchannelCall(s,a,n,this,(0,f.getNextCallNumber)()),this.addActiveCall(o),o}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,s.unregisterChannelzRef)(this.channelzRef)}}class R{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){l.trace(a.LogVerbosity.DEBUG,m,(0,d.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,s){return this.isShutdown?Promise.reject():new Promise((a,o)=>{let l,p,f;let m;s.realTarget?(m=(0,d.uriToString)(s.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,d.uriToString)(s.realTarget))):(m=null,this.trace("creating HTTP/2 session to "+(0,c.subchannelAddressToString)(e)));let g=(0,u.getDefaultAuthority)(null!==(l=s.realTarget)&&void 0!==l?l:this.channelTarget),y=t._getConnectionOptions()||{};y.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?y.maxSessionMemory=r["grpc-node.max_session_memory"]:y.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in y){if(v="https://",r["grpc.ssl_target_name_override"]){const e=r["grpc.ssl_target_name_override"];y.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),y.servername=e}else{const e=null!==(f=null===(p=(0,d.splitHostPort)(g))||void 0===p?void 0:p.host)&&void 0!==f?f:"localhost";y.servername=e}s.socket&&(y.createConnection=(e,t)=>s.socket)}else y.createConnection=(t,r)=>s.socket?s.socket:h.connect(e);y=Object.assign(Object.assign(Object.assign({},y),e),{enableTrace:1===r["grpc-node.tls_enable_trace"]});const b=n.connect(v+g,y);this.session=b;let T="Failed to connect";b.unref(),b.once("connect",()=>{b.removeAllListeners(),a(new I(b,e,r,m)),this.session=null}),b.once("close",()=>{this.session=null,setImmediate(()=>{o(`${T} (${new Date().toISOString()})`)})}),b.once("error",e=>{T=e.message,this.trace("connection failed with error "+T)})})}connect(e,t,r){let n,s;if(this.isShutdown)return Promise.reject();const a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){const e=r["grpc.ssl_target_name_override"];a.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),a.servername=e}else if("grpc.http_connect_target"in r){const e=(0,u.getDefaultAuthority)(null!==(n=(0,d.parseUri)(r["grpc.http_connect_target"]))&&void 0!==n?n:{path:"localhost"}),t=(0,d.splitHostPort)(e);a.servername=null!==(s=null==t?void 0:t.host)&&void 0!==s?s:e}r["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,o.getProxiedConnection)(e,r,a).then(n=>this.createSession(e,t,r,n))}shutdown(){let e;this.isShutdown=!0,null===(e=this.session)||void 0===e||e.close(),this.session=null}}t.Http2SubchannelConnector=R},97887:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uriToString=t.splitHostPort=t.parseUri=void 0;const r=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function n(e){const t=r.exec(e);return null===t?null:{scheme:t[1],authority:t[2],path:t[3]}}t.parseUri=n;const i=/^\d+$/;function s(e){if(e.startsWith("[")){const t=e.indexOf("]");if(-1===t)return null;const r=e.substring(1,t);if(-1===r.indexOf(":"))return null;if(!(e.length>t+1))return{host:r};if(":"!==e[t+1])return null;{const n=e.substring(t+2);return i.test(n)?{host:r,port:+n}:null}}{const t=e.split(":");return 2!==t.length?{host:e}:i.test(t[1])?{host:t[0],port:+t[1]}:null}}function a(e){let t="";return void 0!==e.scheme&&(t+=e.scheme+":"),void 0!==e.authority&&(t+="//"+e.authority+"/"),t+=e.path}t.splitHostPort=s,t.uriToString=a},62622:(e,t,r)=>{"use strict";let n,i;n={value:!0},n=n=t.im=t.J_=n=t.Cp=n=n=void 0;const s=r(41473),a=r(967),o=r(32433),l=r(17376);n=r(20710),n=function(e){return"@type"in e&&"string"==typeof e["@type"]},function(e){e.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",e.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",e.IDEMPOTENT="IDEMPOTENT"}(i=t.Cp||(t.Cp={}));const u={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function c(e,t){return""===e?t:e+"."+t}function d(e){return e instanceof a.Service||e instanceof a.Type||e instanceof a.Enum}function h(e){return e instanceof a.Namespace||e instanceof a.Root}function p(e,t){const r=c(t,e.name);return d(e)?[[r,e]]:h(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>p(e.nested[t],r)).reduce((e,t)=>e.concat(t),[]):[]}function f(e,t){return function(r){return e.toObject(e.decode(r),t)}}function m(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);const r=e.fromObject(t);return e.encode(r).finish()}}function g(e){return(e||[]).reduce((e,t)=>{for(const[r,n]of Object.entries(t))"uninterpreted_option"===r?e.uninterpreted_option.push(t.uninterpreted_option):e[r]=n;return e},{deprecated:!1,idempotency_level:i.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function y(e,t,r,n){const i=e.resolvedRequestType,a=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:m(i),requestDeserialize:f(i,r),responseSerialize:m(a),responseDeserialize:f(a,r),originalName:s(e.name),requestType:b(i,n),responseType:b(a,n),options:g(e.parsedOptions)}}function v(e,t,r,n){const i={};for(const s of e.methodsArray)i[s.name]=y(s,t,r,n);return i}function b(e,t){const r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:r.$type.toObject(r,u),fileDescriptorProtos:t}}function T(e,t){const r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:r.$type.toObject(r,u),fileDescriptorProtos:t}}function w(e,t,r,n){if(e instanceof a.Service)return v(e,t,r,n);if(e instanceof a.Type)return b(e,n);if(e instanceof a.Enum)return T(e,n);throw Error("Type mismatch in reflection object handling")}function S(e,t){const r={};e.resolveAll();const n=e.toDescriptor("proto3").file.map(e=>Buffer.from(o.FileDescriptorProto.encode(e).finish()));for(const[i,s]of p(e,""))r[i]=w(s,i,t,n);return r}function E(e,t){t=t||{};const r=a.Root.fromDescriptor(e);return r.resolveAll(),S(r,t)}function _(e,t){return S((0,l.loadProtosWithOptionsSync)(e,t),t)}function C(e,t){t=t||{};const r=a.Root.fromJSON(e);return r.resolveAll(),S(r,t)}n=function(e,t){return(0,l.loadProtosWithOptions)(e,t).then(e=>S(e,t))},t.J_=_,t.im=C,n=function(e,t){return E(o.FileDescriptorSet.decode(e),t)},n=function(e,t){return E(o.FileDescriptorSet.fromObject(e),t)},(0,l.addCommonProtos)()},17376:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addCommonProtos=t.loadProtosWithOptionsSync=t.loadProtosWithOptions=void 0;const n=r(92048),i=r(55315),s=r(967);function a(e,t){const r=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(const e of t){const t=i.join(e,s);try{return n.accessSync(t,n.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),r(e,s)}}async function o(e,t){const r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));a(r,t.includeDirs)}const n=await r.load(e,t);return n.resolveAll(),n}function l(e,t){const r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");a(r,t.includeDirs)}const n=r.loadSync(e,t);return n.resolveAll(),n}function u(){const e=r(522),t=r(24552),n=r(97105),i=r(8730);s.common("api",e.nested.google.nested.protobuf.nested),s.common("descriptor",t.nested.google.nested.protobuf.nested),s.common("source_context",n.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}t.loadProtosWithOptions=o,t.loadProtosWithOptionsSync=l,t.addCommonProtos=u},97063:e=>{"use strict";function t(e,t){for(var r=Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(i,a){r[n]=function(e){if(s){if(s=!1,e)a(e);else{for(var t=Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}}};try{e.apply(t||null,r)}catch(e){s&&(s=!1,a(e))}})}e.exports=t},54253:(e,t)=>{"use strict";const r=t;r.length=function(e){let t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var n=Array(64),i=Array(123),s=0;s<64;)i[n[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;r.encode=function(e,t,r){for(var i,s=null,a=[],o=0,l=0;t<r;){const u=e[t++];switch(l){case 0:a[o++]=n[u>>2],i=(3&u)<<4,l=1;break;case 1:a[o++]=n[i|u>>4],i=(15&u)<<2,l=2;break;case 2:a[o++]=n[i|u>>6],a[o++]=n[63&u],l=0}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0)}return(l&&(a[o++]=n[i],a[o++]=61,1===l&&(a[o++]=61)),s)?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};const a="invalid encoding";r.decode=function(e,t,r){for(var n,s=r,o=0,l=0;l<e.length;){let u=e.charCodeAt(l++);if(61===u&&o>1)break;if(void 0===(u=i[u]))throw Error(a);switch(o){case 0:n=u,o=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,o=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,o=3;break;case 3:t[r++]=(3&n)<<6|u,o=0}}if(1===o)throw Error(a);return r-s},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},96410:e=>{"use strict";function t(e,r){"string"==typeof e&&(r=e,e=void 0);const n=[];function i(e){if("string"!=typeof e){let r=s();if(t.verbose&&console.log("codegen: "+r),r="return "+r,e){for(var a=Object.keys(e),o=Array(a.length+1),l=Array(a.length),u=0;u<a.length;)o[u]=a[u],l[u]=e[a[u++]];return o[u]=r,Function.apply(null,o).apply(null,l)}return Function(r)()}for(var c=Array(arguments.length-1),d=0;d<c.length;)c[d]=arguments[++d];if(d=0,e=e.replace(/%([%dfijs])/g,function(e,t){const r=c[d++];switch(t){case"d":case"f":return String(Number(r));case"i":return String(Math.floor(r));case"j":return JSON.stringify(r);case"s":return String(r)}return"%"}),d!==c.length)throw Error("parameter count mismatch");return n.push(e),i}function s(t){return"function "+(t||r||"")+"("+(e&&e.join(",")||"")+"){\n  "+n.join("\n  ")+"\n}"}return i.toString=s,i}e.exports=t,t.verbose=!1},26127:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(let r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},t.prototype.emit=function(e){const t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},73368:(e,t,r)=>{"use strict";e.exports=s;const n=r(97063),i=r(18047)("fs");function s(e,t,r){return("function"==typeof t?(r=t,t={}):t||(t={}),r)?!t.xhr&&i&&i.readFile?i.readFile(e,function(n,i){return n&&"undefined"!=typeof XMLHttpRequest?s.xhr(e,t,r):n?r(n):r(null,t.binary?i:i.toString("utf8"))}):s.xhr(e,t,r):n(s,this,e,t)}s.xhr=function(e,t,r){const n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(0!==n.status&&200!==n.status)return r(Error("status "+n.status));if(t.binary){let e=n.response;if(!e){e=[];for(let i=0;i<n.responseText.length;++i)e.push(255&n.responseText.charCodeAt(i))}return r(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return r(null,n.responseText)}},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}},63689:e=>{"use strict";function t(e){return"undefined"!=typeof Float32Array?function(){const t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function s(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function o(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:s,e.writeFloatBE=n?s:i,e.readFloatLE=n?a:o,e.readFloatBE=n?o:a}():function(){function t(e,t,r,n){const i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{const s=Math.floor(Math.log(t)/Math.LN2),a=8388607&Math.round(t*Math.pow(2,-s)*8388608);e((i<<31|s+127<<23|a)>>>0,r,n)}}function a(e,t,r){const n=e(t,r),i=(n>>31)*2+1,s=n>>>23&255,a=8388607&n;return 255===s?a?NaN:1/0*i:0===s?1401298464324817e-60*i*a:i*Math.pow(2,s-150)*(a+8388608)}e.writeFloatLE=t.bind(null,r),e.writeFloatBE=t.bind(null,n),e.readFloatLE=a.bind(null,i),e.readFloatBE=a.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){const t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function s(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function o(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:s,e.writeDoubleBE=n?s:i,e.readDoubleLE=n?a:o,e.readDoubleBE=n?o:a}():function(){function t(e,t,r,n,i,s){let a,o=n<0?1:0;if(o&&(n=-n),0===n)e(0,i,s+t),e(1/n>0?0:2147483648,i,s+r);else if(isNaN(n))e(0,i,s+t),e(2146959360,i,s+r);else if(n>17976931348623157e292)e(0,i,s+t),e((o<<31|2146435072)>>>0,i,s+r);else if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,s+t),e((o<<31|a/4294967296)>>>0,i,s+r);else{let l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(a=n*Math.pow(2,-l))>>>0,i,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,i,s+r)}}function a(e,t,r,n,i){const s=e(n,i+t),a=e(n,i+r),o=(a>>31)*2+1,l=a>>>20&2047,u=4294967296*(1048575&a)+s;return 2047===l?u?NaN:1/0*o:0===l?5e-324*o*u:o*Math.pow(2,l-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,r,0,4),e.writeDoubleBE=t.bind(null,n,4,0),e.readDoubleLE=a.bind(null,i,0,4),e.readDoubleBE=a.bind(null,s,4,0)}(),e}function r(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function n(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},18047:module=>{"use strict";function inquire(moduleName){try{const mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},14740:(e,t)=>{"use strict";const r=t,n=r.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},i=r.normalize=function(e){let t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=n(e),i="";r&&(i=t.shift()+"/");for(let s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):r?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return i+t.join("/")};r.resolve=function(e,t,r){return(r||(t=i(t)),n(t))?t:(r||(e=i(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?i(e+"/"+t):t)}},89172:e=>{"use strict";function t(e,t,r){let n=r||8192,i=n>>>1,s=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(s=e(n),a=0);const o=t.call(s,a,a+=r);return 7&a&&(a=(7|a)+1),o}}e.exports=t},95235:(e,t)=>{"use strict";const r=t;r.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:(64512&r)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t},r.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,s=[],a=0;t<r;)(n=e[t++])<128?s[a++]=n:n>191&&n<224?s[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(n>>10),s[a++]=56320+(1023&n)):s[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))},r.write=function(e,t,r){for(var n,i,s=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&(64512&(i=e.charCodeAt(a+1)))==56320?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128);return r-s}},41473:e=>{const t=1/0,r="[object Symbol]",n=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,i=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,s="\ud800-\udfff",a="\\u0300-\\u036f\\ufe20-\\ufe23",o="\\u20d0-\\u20f0",l="\\u2700-\\u27bf",u="a-z\\xdf-\\xf6\\xf8-\\xff",c="A-Z\\xc0-\\xd6\\xd8-\\xde",d="\\ufe0e\\ufe0f",h="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",p="['’]",f="["+s+"]",m="["+h+"]",g="["+a+o+"]",y="\\d+",v="["+l+"]",b="["+u+"]",T="[^"+s+h+y+l+u+c+"]",w="\ud83c[\udffb-\udfff]",S="[^"+s+"]",E="(?:\ud83c[\udde6-\uddff]){2}",_="[\ud800-\udbff][\udc00-\udfff]",C="["+c+"]",I="\\u200d",R="(?:"+b+"|"+T+")",k="(?:"+C+"|"+T+")",A="(?:"+p+"(?:d|ll|m|re|s|t|ve))?",N="(?:"+p+"(?:D|LL|M|RE|S|T|VE))?",D="(?:"+g+"|"+w+")?",O="["+d+"]?",x="(?:"+I+"(?:"+[S,E,_].join("|")+")"+O+D+")*",P=O+D+x,M="(?:"+[v,E,_].join("|")+")"+P,L="(?:"+[S+g+"?",g,E,_,f].join("|")+")",F=RegExp(p,"g"),B=RegExp(g,"g"),U=RegExp(w+"(?="+w+")|"+L+P,"g"),j=RegExp([C+"?"+b+"+"+A+"(?="+[m,C,"$"].join("|")+")",k+"+"+N+"(?="+[m,C+R,"$"].join("|")+")",C+"?"+R+"+"+A,C+"+"+N,y,M].join("|"),"g"),V=RegExp("["+I+s+a+o+d+"]"),z=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,q={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"ss"},$="object"==typeof global&&global&&global.Object===Object&&global,G="object"==typeof self&&self&&self.Object===Object&&self,K=$||G||Function("return this")();function H(e,t,r,n){let i=-1,s=e?e.length:0;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function W(e){return e.split("")}function Q(e){return e.match(n)||[]}const Y=function(e){return function(t){return null==e?void 0:e[t]}}(q);function J(e){return V.test(e)}function X(e){return z.test(e)}function Z(e){return J(e)?ee(e):W(e)}function ee(e){return e.match(U)||[]}function et(e){return e.match(j)||[]}const er=Object.prototype.toString,en=K.Symbol,ei=en?en.prototype:void 0,es=ei?ei.toString:void 0;function ea(e,t,r){let n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function eo(e){if("string"==typeof e)return e;if(ed(e))return es?es.call(e):"";const r=e+"";return"0"==r&&1/e==-t?"-0":r}function el(e,t,r){const n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:ea(e,t,r)}function eu(e){return function(t){const r=J(t=eh(t))?Z(t):void 0,n=r?r[0]:t.charAt(0),i=r?el(r,1).join(""):t.slice(1);return n[e]()+i}}function ec(e){return!!e&&"object"==typeof e}function ed(e){return"symbol"==typeof e||ec(e)&&er.call(e)==r}function eh(e){return null==e?"":eo(e)}const ep=function(e){return function(t){return H(ey(em(t).replace(F,"")),e,"")}}(function(e,t,r){return t=t.toLowerCase(),e+(r?ef(t):t)});function ef(e){return eg(eh(e).toLowerCase())}function em(e){return(e=eh(e))&&e.replace(i,Y).replace(B,"")}var eg=eu("toUpperCase");function ey(e,t,r){return(e=eh(e),void 0===(t=r?void 0:t))?X(e)?et(e):Q(e):e.match(t)||[]}e.exports=ep},46485:(e,t,r)=>{"use strict";const n=r(95439);r.o(n,"NextResponse")&&r.d(t,{NextResponse:function(){return n.NextResponse}})},10676:e=>{"use strict";const t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,s=(e,s,a,o)=>{if(s&&"object"==typeof s||"function"==typeof s)for(const l of n(s))i.call(e,l)||l===a||t(e,l,{get:()=>s[l],enumerable:!(o=r(s,l))||o.enumerable});return e},a=e=>s(t({},"__esModule",{value:!0}),e),o={};function l(e){let t;const r=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"partitioned"in e&&e.partitioned&&"Partitioned","priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean),n=`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}`;return 0===r.length?n:`${n}; ${r.join("; ")}`}function u(e){const t=new Map;for(const r of e.split(/; */)){if(!r)continue;const e=r.indexOf("=");if(-1===e){t.set(r,"true");continue}const[n,i]=[r.slice(0,e),r.slice(e+1)];try{t.set(n,decodeURIComponent(null!=i?i:"true"))}catch{}}return t}function c(e){if(!e)return;let[[t,r],...n]=u(e),{domain:i,expires:s,httponly:a,maxage:o,path:l,samesite:c,secure:h,partitioned:f,priority:g}=Object.fromEntries(n.map(([e,t])=>[e.toLowerCase(),t]));return d({name:t,value:decodeURIComponent(r),domain:i,...s&&{expires:new Date(s)},...a&&{httpOnly:!0},..."string"==typeof o&&{maxAge:Number(o)},path:l,...c&&{sameSite:p(c)},...h&&{secure:!0},...g&&{priority:m(g)},...f&&{partitioned:!0}})}function d(e){const t={};for(const r in e)e[r]&&(t[r]=e[r]);return t}((e,r)=>{for(const n in r)t(e,n,{get:r[n],enumerable:!0})})(o,{RequestCookies:()=>y,ResponseCookies:()=>v,parseCookie:()=>u,parseSetCookie:()=>c,stringifyCookie:()=>l}),e.exports=a(o);const h=["strict","lax","none"];function p(e){return e=e.toLowerCase(),h.includes(e)?e:void 0}const f=["low","medium","high"];function m(e){return e=e.toLowerCase(),f.includes(e)?e:void 0}function g(e){if(!e)return[];let t,r,n,i,s,a=[],o=0;function l(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}function u(){return"="!==(r=e.charAt(o))&&";"!==r&&","!==r}for(;o<e.length;){for(t=o,s=!1;l();)if(","===(r=e.charAt(o))){for(n=o,o+=1,l(),i=o;o<e.length&&u();)o+=1;o<e.length&&"="===e.charAt(o)?(s=!0,o=i,a.push(e.substring(t,n)),t=o):o=n+1}else o+=1;(!s||o>=e.length)&&a.push(e.substring(t,e.length))}return a}var y=class{constructor(e){this._parsed=new Map,this._headers=e;const t=e.get("cookie");if(t)for(const[e,r]of u(t))this._parsed.set(e,{name:e,value:r})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){const t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){let t;const r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);const n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===n).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){const[t,r]=1===e.length?[e[0].name,e[0].value]:e,n=this._parsed;return n.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(n).map(([e,t])=>l(t)).join("; ")),this}delete(e){const t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>l(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},v=class{constructor(e){let t,r,n;this._parsed=new Map,this._headers=e;const i=null!=(n=null!=(r=null==(t=e.getSetCookie)?void 0:t.call(e))?r:e.get("set-cookie"))?n:[];for(const e of Array.isArray(i)?i:g(i)){const t=c(e);t&&this._parsed.set(t.name,t)}}get(...e){const t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){let t;const r=Array.from(this._parsed.values());if(!e.length)return r;const n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===n)}has(e){return this._parsed.has(e)}set(...e){const[t,r,n]=1===e.length?[e[0].name,e[0].value,e[0]]:e,i=this._parsed;return i.set(t,T({name:t,value:r,...n})),b(i,this._headers),this}delete(...e){const[t,r,n]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0].path,e[0].domain];return this.set({name:t,path:r,domain:n,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(l).join("; ")}};function b(e,t){for(const[,r]of(t.delete("set-cookie"),e)){const e=l(r);t.append("set-cookie",e)}}function T(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}},74155:(e,t,r)=>{let n;(()=>{const i={226:function(i,s){!function(a,o){"use strict";var l="1.0.35",u="",c="?",d="function",h="undefined",p="object",f="string",m="major",g="model",y="name",v="type",b="vendor",T="version",w="architecture",S="console",E="mobile",_="tablet",C="smarttv",I="wearable",R="embedded",k=350,A="Amazon",N="Apple",D="ASUS",O="BlackBerry",x="Browser",P="Chrome",M="Firefox",L="Google",F="Huawei",B="LG",U="Microsoft",j="Motorola",V="Opera",z="Samsung",q="Sharp",$="Sony",G="Xiaomi",K="Zebra",H="Facebook",W="Chromium OS",Q="Mac OS",Y=function(e,t){const r={};for(const n in e)t[n]&&t[n].length%2==0?r[n]=t[n].concat(e[n]):r[n]=e[n];return r},J=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},X=function(e,t){return typeof e===f&&-1!==Z(t).indexOf(Z(e))},Z=function(e){return e.toLowerCase()},ee=function(e){return typeof e===f?e.replace(/[^\d\.]/g,u).split(".")[0]:void 0},et=function(e,t){if(typeof e===f)return e=e.replace(/^\s\s*/,u),typeof t===h?e:e.substring(0,k)},er=function(e,t){for(var r,n,i,s,a,l,u=0;u<t.length&&!a;){const c=t[u],h=t[u+1];for(r=n=0;r<c.length&&!a&&c[r];)if(a=c[r++].exec(e))for(i=0;i<h.length;i++)l=a[++n],typeof(s=h[i])===p&&s.length>0?2===s.length?typeof s[1]==d?this[s[0]]=s[1].call(this,l):this[s[0]]=s[1]:3===s.length?typeof s[1]!==d||s[1].exec&&s[1].test?this[s[0]]=l?l.replace(s[1],s[2]):void 0:this[s[0]]=l?s[1].call(this,l,s[2]):void 0:4===s.length&&(this[s[0]]=l?s[3].call(this,l.replace(s[1],s[2])):o):this[s]=l||o;u+=2}},en=function(e,t){for(const r in t)if(typeof t[r]===p&&t[r].length>0){for(let n=0;n<t[r].length;n++)if(X(t[r][n],e))return r===c?o:r}else if(X(t[r],e))return r===c?o:r;return e},ei={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},es={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[y,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[y,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[y,T],[/opios[\/ ]+([\w\.]+)/i],[T,[y,V+" Mini"]],[/\bopr\/([\w\.]+)/i],[T,[y,V]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[y,T],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[y,"UC"+x]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[T,[y,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[T,[y,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[y,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[y,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[T,[y,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[y,/(.+)/,"$1 Secure "+x],T],[/\bfocus\/([\w\.]+)/i],[T,[y,M+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[y,V+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[y,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[y,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[y,V+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[y,"MIUI "+x]],[/fxios\/([-\w\.]+)/i],[T,[y,M]],[/\bqihu|(qi?ho?o?|360)browser/i],[[y,"360 "+x]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[y,/(.+)/,"$1 "+x],T],[/(comodo_dragon)\/([\w\.]+)/i],[[y,/_/g," "],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[y,T],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[y],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[y,H],T],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[y,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[y,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[T,[y,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[y,P+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[y,P+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[y,"Android "+x]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[y,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[y,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,y],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[y,[T,en,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[y,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[y,"Netscape"],T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[y,M+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[y,T],[/(cobalt)\/([\w\.]+)/i],[y,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[w,"amd64"]],[/(ia32(?=;))/i],[[w,Z]],[/((?:i[346]|x)86)[;\)]/i],[[w,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[w,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[w,"armhf"]],[/windows (ce|mobile); ppc;/i],[[w,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[w,/ower/,u,Z]],[/(sun4\w)[;\)]/i],[[w,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[w,Z]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[b,z],[v,_]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[g,[b,z],[v,E]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[g,[b,N],[v,E]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[b,N],[v,_]],[/(macintosh);/i],[g,[b,N]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[b,q],[v,E]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[g,[b,F],[v,_]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[b,F],[v,E]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[g,/_/g," "],[b,G],[v,E]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[g,/_/g," "],[b,G],[v,_]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[b,"OPPO"],[v,E]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[b,"Vivo"],[v,E]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[g,[b,"Realme"],[v,E]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[b,j],[v,E]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[b,j],[v,_]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[b,B],[v,_]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[b,B],[v,E]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[g,[b,"Lenovo"],[v,_]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[g,/_/g," "],[b,"Nokia"],[v,E]],[/(pixel c)\b/i],[g,[b,L],[v,_]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[b,L],[v,E]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[b,$],[v,E]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[b,$],[v,_]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[b,"OnePlus"],[v,E]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[b,A],[v,_]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[b,A],[v,E]],[/(playbook);[-\w\),; ]+(rim)/i],[g,b,[v,_]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[b,O],[v,E]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[b,D],[v,_]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[b,D],[v,E]],[/(nexus 9)/i],[g,[b,"HTC"],[v,_]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[b,[g,/_/g," "],[v,E]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[b,"Acer"],[v,_]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[b,"Meizu"],[v,E]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[b,g,[v,E]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[b,g,[v,_]],[/(surface duo)/i],[g,[b,U],[v,_]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[b,"Fairphone"],[v,E]],[/(u304aa)/i],[g,[b,"AT&T"],[v,E]],[/\bsie-(\w*)/i],[g,[b,"Siemens"],[v,E]],[/\b(rct\w+) b/i],[g,[b,"RCA"],[v,_]],[/\b(venue[\d ]{2,7}) b/i],[g,[b,"Dell"],[v,_]],[/\b(q(?:mv|ta)\w+) b/i],[g,[b,"Verizon"],[v,_]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[b,"Barnes & Noble"],[v,_]],[/\b(tm\d{3}\w+) b/i],[g,[b,"NuVision"],[v,_]],[/\b(k88) b/i],[g,[b,"ZTE"],[v,_]],[/\b(nx\d{3}j) b/i],[g,[b,"ZTE"],[v,E]],[/\b(gen\d{3}) b.+49h/i],[g,[b,"Swiss"],[v,E]],[/\b(zur\d{3}) b/i],[g,[b,"Swiss"],[v,_]],[/\b((zeki)?tb.*\b) b/i],[g,[b,"Zeki"],[v,_]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[b,"Dragon Touch"],g,[v,_]],[/\b(ns-?\w{0,9}) b/i],[g,[b,"Insignia"],[v,_]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[b,"NextBook"],[v,_]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[b,"Voice"],g,[v,E]],[/\b(lvtel\-)?(v1[12]) b/i],[[b,"LvTel"],g,[v,E]],[/\b(ph-1) /i],[g,[b,"Essential"],[v,E]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[b,"Envizen"],[v,_]],[/\b(trio[-\w\. ]+) b/i],[g,[b,"MachSpeed"],[v,_]],[/\btu_(1491) b/i],[g,[b,"Rotor"],[v,_]],[/(shield[\w ]+) b/i],[g,[b,"Nvidia"],[v,_]],[/(sprint) (\w+)/i],[b,g,[v,E]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[b,U],[v,E]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[b,K],[v,_]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[b,K],[v,E]],[/smart-tv.+(samsung)/i],[b,[v,C]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[b,z],[v,C]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[b,B],[v,C]],[/(apple) ?tv/i],[b,[g,N+" TV"],[v,C]],[/crkey/i],[[g,P+"cast"],[b,L],[v,C]],[/droid.+aft(\w)( bui|\))/i],[g,[b,A],[v,C]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[b,q],[v,C]],[/(bravia[\w ]+)( bui|\))/i],[g,[b,$],[v,C]],[/(mitv-\w{5}) bui/i],[g,[b,G],[v,C]],[/Hbbtv.*(technisat) (.*);/i],[b,g,[v,C]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[b,et],[g,et],[v,C]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[v,C]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[b,g,[v,S]],[/droid.+; (shield) bui/i],[g,[b,"Nvidia"],[v,S]],[/(playstation [345portablevi]+)/i],[g,[b,$],[v,S]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[b,U],[v,S]],[/((pebble))app/i],[b,g,[v,I]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[b,N],[v,I]],[/droid.+; (glass) \d/i],[g,[b,L],[v,I]],[/droid.+; (wt63?0{2,3})\)/i],[g,[b,K],[v,I]],[/(quest( 2| pro)?)/i],[g,[b,H],[v,I]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[b,[v,R]],[/(aeobc)\b/i],[g,[b,A],[v,R]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[g,[v,E]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[v,_]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[v,_]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[v,E]],[/(android[-\w\. ]{0,9});.+buil/i],[g,[b,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[y,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[y,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[y,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,y]],os:[[/microsoft (windows) (vista|xp)/i],[y,T],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[y,[T,en,ei]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,"Windows"],[T,en,ei]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[y,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[y,Q],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,y],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[y,T],[/\(bb(10);/i],[T,[y,O]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[y,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[y,M+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[y,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[y,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[y,P+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[y,W],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[y,T],[/(sunos) ?([\w\.\d]*)/i],[[y,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[y,T]]},ea=function(e,t){if(typeof e===p&&(t=e,e=o),!(this instanceof ea))return new ea(e,t).getResult();let r=typeof a!==h&&a.navigator?a.navigator:o,n=e||(r&&r.userAgent?r.userAgent:u),i=r&&r.userAgentData?r.userAgentData:o,s=t?Y(es,t):es,l=r&&r.userAgent==n;return this.getBrowser=function(){const e={};return e[y]=o,e[T]=o,er.call(e,n,s.browser),e[m]=ee(e[T]),l&&r&&r.brave&&typeof r.brave.isBrave==d&&(e[y]="Brave"),e},this.getCPU=function(){const e={};return e[w]=o,er.call(e,n,s.cpu),e},this.getDevice=function(){const e={};return e[b]=o,e[g]=o,e[v]=o,er.call(e,n,s.device),l&&!e[v]&&i&&i.mobile&&(e[v]=E),l&&"Macintosh"==e[g]&&r&&typeof r.standalone!==h&&r.maxTouchPoints&&r.maxTouchPoints>2&&(e[g]="iPad",e[v]=_),e},this.getEngine=function(){const e={};return e[y]=o,e[T]=o,er.call(e,n,s.engine),e},this.getOS=function(){const e={};return e[y]=o,e[T]=o,er.call(e,n,s.os),l&&!e[y]&&i&&"Unknown"!=i.platform&&(e[y]=i.platform.replace(/chrome os/i,W).replace(/macos/i,Q)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=typeof e===f&&e.length>k?et(e,k):e,this},this.setUA(n),this};ea.VERSION=l,ea.BROWSER=J([y,T,m]),ea.CPU=J([w]),ea.DEVICE=J([g,b,v,S,E,C,_,I,R]),ea.ENGINE=ea.OS=J([y,T]),typeof s!==h?("object"!==h&&i.exports&&(s=i.exports=ea),s.UAParser=ea):"function"===d&&r.amdO?void 0!==(n=(function(){return ea}).call(t,r,t,e))&&(e.exports=n):typeof a!==h&&(a.UAParser=ea);const eo=typeof a!==h&&(a.jQuery||a.Zepto);if(eo&&!eo.ua){const el=new ea;eo.ua=el.getResult(),eo.ua.get=function(){return el.getUA()},eo.ua.set=function(e){el.setUA(e);const t=el.getResult();for(const r in t)eo.ua[r]=t[r]}}}("object"==typeof window?window:this)}},s={};function a(e){const t=s[e];if(void 0!==t)return t.exports;let r=s[e]={exports:{}},n=!0;try{i[e].call(r.exports,r,r.exports,a),n=!1}finally{n&&delete s[e]}return r.exports}a.ab=__dirname+"/";const o=a(226);e.exports=o})()},32829:(e,t,r)=>{"use strict";e.exports=r(30517)},75589:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(const r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{PageSignatureError:function(){return r},RemovedPageError:function(){return n},RemovedUAError:function(){return i}});class r extends Error{constructor({page:e}){super(`The middleware "${e}" accepts an async API directly with the form:
  
  export function middleware(request, event) {
    return NextResponse.redirect('/new-location')
  }
  
  Read more: https://nextjs.org/docs/messages/middleware-new-signature
  `)}}class n extends Error{constructor(){super(`The request.page has been deprecated in favour of \`URLPattern\`.
  Read more: https://nextjs.org/docs/messages/middleware-request-page
  `)}}class i extends Error{constructor(){super(`The request.ua has been removed in favour of \`userAgent\` function.
  Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent
  `)}}},95439:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(const r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ImageResponse:function(){return n.ImageResponse},NextRequest:function(){return i.NextRequest},NextResponse:function(){return s.NextResponse},URLPattern:function(){return o.URLPattern},userAgent:function(){return a.userAgent},userAgentFromString:function(){return a.userAgentFromString}});const n=r(16853),i=r(46699),s=r(20801),a=r(57619),o=r(22933)},64066:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NextURL",{enumerable:!0,get:function(){return c}});const n=r(36441),i=r(93223),s=r(84841),a=r(65113),o=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\[::1\]|localhost)/;function l(e,t){return new URL(String(e).replace(o,"localhost"),t&&String(t).replace(o,"localhost"))}const u=Symbol("NextURLInternal");class c{constructor(e,t,r){let n,i;"object"==typeof t&&"pathname"in t||"string"==typeof t?(n=t,i=r||{}):i=r||t||{},this[u]={url:l(e,n??i.base),options:i,basePath:""},this.analyze()}analyze(){let e,t,r,i,o;const l=(0,a.getNextPathnameInfo)(this[u].url.pathname,{nextConfig:this[u].options.nextConfig,parseData:!0,i18nProvider:this[u].options.i18nProvider}),c=(0,s.getHostname)(this[u].url,this[u].options.headers);this[u].domainLocale=this[u].options.i18nProvider?this[u].options.i18nProvider.detectDomainLocale(c):(0,n.detectDomainLocale)(null==(t=this[u].options.nextConfig)?void 0:null==(e=t.i18n)?void 0:e.domains,c);const d=(null==(r=this[u].domainLocale)?void 0:r.defaultLocale)||(null==(o=this[u].options.nextConfig)?void 0:null==(i=o.i18n)?void 0:i.defaultLocale);this[u].url.pathname=l.pathname,this[u].defaultLocale=d,this[u].basePath=l.basePath??"",this[u].buildId=l.buildId,this[u].locale=l.locale??d,this[u].trailingSlash=l.trailingSlash}formatPathname(){return(0,i.formatNextPathnameInfo)({basePath:this[u].basePath,buildId:this[u].buildId,defaultLocale:this[u].options.forceLocale?void 0:this[u].defaultLocale,locale:this[u].locale,pathname:this[u].url.pathname,trailingSlash:this[u].trailingSlash})}formatSearch(){return this[u].url.search}get buildId(){return this[u].buildId}set buildId(e){this[u].buildId=e}get locale(){return this[u].locale??""}set locale(e){let t,r;if(!this[u].locale||!(null==(r=this[u].options.nextConfig)?void 0:null==(t=r.i18n)?void 0:t.locales.includes(e)))throw TypeError(`The NextURL configuration includes no locale "${e}"`);this[u].locale=e}get defaultLocale(){return this[u].defaultLocale}get domainLocale(){return this[u].domainLocale}get searchParams(){return this[u].url.searchParams}get host(){return this[u].url.host}set host(e){this[u].url.host=e}get hostname(){return this[u].url.hostname}set hostname(e){this[u].url.hostname=e}get port(){return this[u].url.port}set port(e){this[u].url.port=e}get protocol(){return this[u].url.protocol}set protocol(e){this[u].url.protocol=e}get href(){const e=this.formatPathname(),t=this.formatSearch();return`${this.protocol}//${this.host}${e}${t}${this.hash}`}set href(e){this[u].url=l(e),this.analyze()}get origin(){return this[u].url.origin}get pathname(){return this[u].url.pathname}set pathname(e){this[u].url.pathname=e}get hash(){return this[u].url.hash}set hash(e){this[u].url.hash=e}get search(){return this[u].url.search}set search(e){this[u].url.search=e}get password(){return this[u].url.password}set password(e){this[u].url.password=e}get username(){return this[u].url.username}set username(e){this[u].url.username=e}get basePath(){return this[u].basePath}set basePath(e){this[u].basePath=e.startsWith("/")?e:`/${e}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new c(String(this),this[u].options)}}},38711:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(const r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RequestCookies:function(){return n.RequestCookies},ResponseCookies:function(){return n.ResponseCookies},stringifyCookie:function(){return n.stringifyCookie}});const n=r(10676)},16853:(e,t)=>{"use strict";function r(){throw Error('ImageResponse moved from "next/server" to "next/og" since Next.js 14, please import from "next/og" instead')}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ImageResponse",{enumerable:!0,get:function(){return r}})},46699:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(const r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{INTERNALS:function(){return o},NextRequest:function(){return l}});const n=r(64066),i=r(66168),s=r(75589),a=r(38711),o=Symbol("internal request");class l extends Request{constructor(e,t={}){const r="string"!=typeof e&&"url"in e?e.url:String(e);(0,i.validateURL)(r),e instanceof Request?super(e,t):super(r,t);const s=new n.NextURL(r,{headers:(0,i.toNodeOutgoingHttpHeaders)(this.headers),nextConfig:t.nextConfig});this[o]={cookies:new a.RequestCookies(this.headers),geo:t.geo||{},ip:t.ip,nextUrl:s,url:s.toString()}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,geo:this.geo,ip:this.ip,nextUrl:this.nextUrl,url:this.url,bodyUsed:this.bodyUsed,cache:this.cache,credentials:this.credentials,destination:this.destination,headers:Object.fromEntries(this.headers),integrity:this.integrity,keepalive:this.keepalive,method:this.method,mode:this.mode,redirect:this.redirect,referrer:this.referrer,referrerPolicy:this.referrerPolicy,signal:this.signal}}get cookies(){return this[o].cookies}get geo(){return this[o].geo}get ip(){return this[o].ip}get nextUrl(){return this[o].nextUrl}get page(){throw new s.RemovedPageError}get ua(){throw new s.RemovedUAError}get url(){return this[o].url}}},20801:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NextResponse",{enumerable:!0,get:function(){return d}});const n=r(38711),i=r(64066),s=r(66168),a=r(19184),o=r(38711),l=Symbol("internal response"),u=new Set([301,302,303,307,308]);function c(e,t){let r;if(null==e?void 0:null==(r=e.request)?void 0:r.headers){if(!(e.request.headers instanceof Headers))throw Error("request.headers must be an instance of Headers");const r=[];for(const[n,i]of e.request.headers)t.set("x-middleware-request-"+n,i),r.push(n);t.set("x-middleware-override-headers",r.join(","))}}class d extends Response{constructor(e,t={}){super(e,t);const r=this.headers,u=new Proxy(new o.ResponseCookies(r),{get(e,i,s){switch(i){case"delete":case"set":return(...s)=>{const a=Reflect.apply(e[i],e,s),l=new Headers(r);return a instanceof o.ResponseCookies&&r.set("x-middleware-set-cookie",a.getAll().map(e=>(0,n.stringifyCookie)(e)).join(",")),c(t,l),a};default:return a.ReflectAdapter.get(e,i,s)}}});this[l]={cookies:u,url:t.url?new i.NextURL(t.url,{headers:(0,s.toNodeOutgoingHttpHeaders)(r),nextConfig:t.nextConfig}):void 0}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,url:this.url,body:this.body,bodyUsed:this.bodyUsed,headers:Object.fromEntries(this.headers),ok:this.ok,redirected:this.redirected,status:this.status,statusText:this.statusText,type:this.type}}get cookies(){return this[l].cookies}static json(e,t){const r=Response.json(e,t);return new d(r.body,r)}static redirect(e,t){const r="number"==typeof t?t:(null==t?void 0:t.status)??307;if(!u.has(r))throw RangeError('Failed to execute "redirect" on "response": Invalid status code');const n="object"==typeof t?t:{},i=new Headers(null==n?void 0:n.headers);return i.set("Location",(0,s.validateURL)(e)),new d(null,{...n,headers:i,status:r})}static rewrite(e,t){const r=new Headers(null==t?void 0:t.headers);return r.set("x-middleware-rewrite",(0,s.validateURL)(e)),c(t,r),new d(null,{...t,headers:r})}static next(e){const t=new Headers(null==e?void 0:e.headers);return t.set("x-middleware-next","1"),c(e,t),new d(null,{...e,headers:t})}}},22933:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"URLPattern",{enumerable:!0,get:function(){return r}});const r="undefined"==typeof URLPattern?void 0:URLPattern},57619:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(const r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{isBot:function(){return s},userAgent:function(){return o},userAgentFromString:function(){return a}});const n=i(r(74155));function i(e){return e&&e.__esModule?e:{default:e}}function s(e){return/Googlebot|Mediapartners-Google|AdsBot-Google|googleweblight|Storebot-Google|Google-PageRenderer|Google-InspectionTool|Bingbot|BingPreview|Slurp|DuckDuckBot|baiduspider|yandex|sogou|LinkedInBot|bitlybot|tumblr|vkShare|quora link preview|facebookexternalhit|facebookcatalog|Twitterbot|applebot|redditbot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|ia_archiver/i.test(e)}function a(e){return{...(0,n.default)(e),isBot:void 0!==e&&s(e)}}function o({headers:e}){return a(e.get("user-agent")||void 0)}},66168:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(const r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{fromNodeOutgoingHttpHeaders:function(){return i},normalizeNextQueryParam:function(){return l},splitCookiesString:function(){return s},toNodeOutgoingHttpHeaders:function(){return a},validateURL:function(){return o}});const n=r(49406);function i(e){const t=new Headers;for(const[r,n]of Object.entries(e))for(let e of Array.isArray(n)?n:[n])void 0!==e&&("number"==typeof e&&(e=e.toString()),t.append(r,e));return t}function s(e){let t,r,n,i,s,a=[],o=0;function l(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}function u(){return"="!==(r=e.charAt(o))&&";"!==r&&","!==r}for(;o<e.length;){for(t=o,s=!1;l();)if(","===(r=e.charAt(o))){for(n=o,o+=1,l(),i=o;o<e.length&&u();)o+=1;o<e.length&&"="===e.charAt(o)?(s=!0,o=i,a.push(e.substring(t,n)),t=o):o=n+1}else o+=1;(!s||o>=e.length)&&a.push(e.substring(t,e.length))}return a}function a(e){const t={},r=[];if(e)for(const[n,i]of e.entries())"set-cookie"===n.toLowerCase()?(r.push(...s(i)),t[n]=1===r.length?r[0]:r):t[n]=i;return t}function o(e){try{return String(new URL(String(e)))}catch(t){throw Error(`URL is malformed "${String(e)}". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`,{cause:t})}}function l(e,t){for(const r of[n.NEXT_QUERY_PARAM_PREFIX,n.NEXT_INTERCEPTION_MARKER_PREFIX])e!==r&&e.startsWith(r)&&t(e.substring(r.length))}},84841:(e,t)=>{"use strict";function r(e,t){let r;if((null==t?void 0:t.host)&&!Array.isArray(t.host))r=t.host.toString().split(":",1)[0];else{if(!e.hostname)return;r=e.hostname}return r.toLowerCase()}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getHostname",{enumerable:!0,get:function(){return r}})},36441:(e,t)=>{"use strict";function r(e,t,r){if(e)for(const s of(r&&(r=r.toLowerCase()),e)){var n,i;if(t===(null==(n=s.domain)?void 0:n.split(":",1)[0].toLowerCase())||r===s.defaultLocale.toLowerCase()||(null==(i=s.locales)?void 0:i.some(e=>e.toLowerCase()===r)))return s}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"detectDomainLocale",{enumerable:!0,get:function(){return r}})},8847:(e,t)=>{"use strict";function r(e,t){let r;const n=e.split("/");return(t||[]).some(t=>!!n[1]&&n[1].toLowerCase()===t.toLowerCase()&&(r=t,n.splice(1,1),e=n.join("/")||"/",!0)),{pathname:e,detectedLocale:r}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"normalizeLocalePath",{enumerable:!0,get:function(){return r}})},6066:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addLocale",{enumerable:!0,get:function(){return s}});const n=r(3358),i=r(60763);function s(e,t,r,s){if(!t||t===r)return e;const a=e.toLowerCase();return!s&&((0,i.pathHasPrefix)(a,"/api")||(0,i.pathHasPrefix)(a,"/"+t.toLowerCase()))?e:(0,n.addPathPrefix)(e,"/"+t)}},3358:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addPathPrefix",{enumerable:!0,get:function(){return i}});const n=r(32791);function i(e,t){if(!e.startsWith("/")||!t)return e;const{pathname:r,query:i,hash:s}=(0,n.parsePath)(e);return""+t+r+i+s}},87398:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addPathSuffix",{enumerable:!0,get:function(){return i}});const n=r(32791);function i(e,t){if(!e.startsWith("/")||!t)return e;const{pathname:r,query:i,hash:s}=(0,n.parsePath)(e);return""+r+t+i+s}},93223:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"formatNextPathnameInfo",{enumerable:!0,get:function(){return o}});const n=r(25487),i=r(3358),s=r(87398),a=r(6066);function o(e){let t=(0,a.addLocale)(e.pathname,e.locale,e.buildId?void 0:e.defaultLocale,e.ignorePrefix);return(e.buildId||!e.trailingSlash)&&(t=(0,n.removeTrailingSlash)(t)),e.buildId&&(t=(0,s.addPathSuffix)((0,i.addPathPrefix)(t,"/_next/data/"+e.buildId),"/"===e.pathname?"index.json":".json")),t=(0,i.addPathPrefix)(t,e.basePath),!e.buildId&&e.trailingSlash?t.endsWith("/")?t:(0,s.addPathSuffix)(t,"/"):(0,n.removeTrailingSlash)(t)}},65113:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getNextPathnameInfo",{enumerable:!0,get:function(){return a}});const n=r(8847),i=r(60902),s=r(60763);function a(e,t){let r,a;const{basePath:o,i18n:l,trailingSlash:u}=null!=(r=t.nextConfig)?r:{},c={pathname:e,trailingSlash:"/"!==e?e.endsWith("/"):u};o&&(0,s.pathHasPrefix)(c.pathname,o)&&(c.pathname=(0,i.removePathPrefix)(c.pathname,o),c.basePath=o);let d=c.pathname;if(c.pathname.startsWith("/_next/data/")&&c.pathname.endsWith(".json")){const e=c.pathname.replace(/^\/_next\/data\//,"").replace(/\.json$/,"").split("/"),r=e[0];c.buildId=r,d="index"!==e[1]?"/"+e.slice(1).join("/"):"/",!0===t.parseData&&(c.pathname=d)}if(l){let e=t.i18nProvider?t.i18nProvider.analyze(c.pathname):(0,n.normalizeLocalePath)(c.pathname,l.locales);c.locale=e.detectedLocale,c.pathname=null!=(a=e.pathname)?a:c.pathname,!e.detectedLocale&&c.buildId&&(e=t.i18nProvider?t.i18nProvider.analyze(d):(0,n.normalizeLocalePath)(d,l.locales)).detectedLocale&&(c.locale=e.detectedLocale)}return c}},32791:(e,t)=>{"use strict";function r(e){const t=e.indexOf("#"),r=e.indexOf("?"),n=r>-1&&(t<0||r<t);return n||t>-1?{pathname:e.substring(0,n?r:t),query:n?e.substring(r,t>-1?t:void 0):"",hash:t>-1?e.slice(t):""}:{pathname:e,query:"",hash:""}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"parsePath",{enumerable:!0,get:function(){return r}})},60763:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"pathHasPrefix",{enumerable:!0,get:function(){return i}});const n=r(32791);function i(e,t){if("string"!=typeof e)return!1;const{pathname:r}=(0,n.parsePath)(e);return r===t||r.startsWith(t+"/")}},60902:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"removePathPrefix",{enumerable:!0,get:function(){return i}});const n=r(60763);function i(e,t){if(!(0,n.pathHasPrefix)(e,t))return e;const r=e.slice(t.length);return r.startsWith("/")?r:"/"+r}},25487:(e,t)=>{"use strict";function r(e){return e.replace(/\/$/,"")||"/"}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"removeTrailingSlash",{enumerable:!0,get:function(){return r}})},32433:(e,t,r)=>{"use strict";const n=r(967);e.exports=t=n.descriptor=n.Root.fromJSON(r(24552)).lookup(".google.protobuf");const i=n.Namespace,s=n.Root,a=n.Enum,o=n.Type,l=n.Field,u=n.MapField,c=n.OneOf,d=n.Service,h=n.Method;function p(e,r,n){const u=t.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});N(n,u),e instanceof s||(u.package=e.fullName.substring(1));for(var c,h=0;h<e.nestedArray.length;++h)(c=e._nestedArray[h])instanceof o?u.messageType.push(c.toDescriptor(n)):c instanceof a?u.enumType.push(c.toDescriptor()):c instanceof l?u.extension.push(c.toDescriptor(n)):c instanceof d?u.service.push(c.toDescriptor()):c instanceof i&&p(c,r,n);u.options=I(e.options,t.FileOptions),u.messageType.length+u.enumType.length+u.extension.length+u.service.length&&r.push(u)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.FileDescriptorSet.decode(e));const r=new s;if(e.file)for(var n,i,u,c=0;c<e.file.length;++c){i=r,(n=e.file[c]).package&&n.package.length&&(i=r.define(n.package));const h=A(n);if(n.name&&n.name.length&&r.files.push(i.filename=n.name),n.messageType)for(u=0;u<n.messageType.length;++u)i.add(o.fromDescriptor(n.messageType[u],h));if(n.enumType)for(u=0;u<n.enumType.length;++u)i.add(a.fromDescriptor(n.enumType[u],h));if(n.extension)for(u=0;u<n.extension.length;++u)i.add(l.fromDescriptor(n.extension[u],h));if(n.service)for(u=0;u<n.service.length;++u)i.add(d.fromDescriptor(n.service[u],h));const p=_(n.options,t.FileOptions);if(p){const f=Object.keys(p);for(u=0;u<f.length;++u)i.setOption(f[u],p[f[u]])}}return r.resolveAll()},s.prototype.toDescriptor=function(e){const r=t.FileDescriptorSet.create();return p(this,r.file,e),r};let f=0;o.fromDescriptor=function(e,r,n){"number"==typeof e.length&&(e=t.DescriptorProto.decode(e));let i,s=new o(e.name.length?e.name:"Type"+f++,_(e.options,t.MessageOptions));if(n||(s._edition=r),e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)s.add(c.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){const u=l.fromDescriptor(e.field[i],r,!0);s.add(u),e.field[i].hasOwnProperty("oneofIndex")&&s.oneofsArray[e.field[i].oneofIndex].add(u)}if(e.extension)for(i=0;i<e.extension.length;++i)s.add(l.fromDescriptor(e.extension[i],r,!0));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)s.add(o.fromDescriptor(e.nestedType[i],r,!0)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&s.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)s.add(a.fromDescriptor(e.enumType[i],r,!0));if(e.extensionRange&&e.extensionRange.length)for(i=0,s.extensions=[];i<e.extensionRange.length;++i)s.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(s.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)s.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)s.reserved.push(e.reservedName[i])}return s},o.prototype.toDescriptor=function(e){let r,n,i=t.DescriptorProto.create({name:this.name});for(n=0;n<this.fieldsArray.length;++n)if(i.field.push(r=this._fieldsArray[n].toDescriptor(e)),this._fieldsArray[n]instanceof u){const s=S(this._fieldsArray[n].keyType,this._fieldsArray[n].resolvedKeyType,!1),c=S(this._fieldsArray[n].type,this._fieldsArray[n].resolvedType,!1),d=11===c||14===c?this._fieldsArray[n].resolvedType&&R(this.parent,this._fieldsArray[n].resolvedType)||this._fieldsArray[n].type:void 0;i.nestedType.push(t.DescriptorProto.create({name:r.typeName,field:[t.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),t.FieldDescriptorProto.create({name:"value",number:2,label:1,type:c,typeName:d})],options:t.MessageOptions.create({mapEntry:!0})}))}for(n=0;n<this.oneofsArray.length;++n)i.oneofDecl.push(this._oneofsArray[n].toDescriptor());for(n=0;n<this.nestedArray.length;++n)this._nestedArray[n]instanceof l?i.field.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof o?i.nestedType.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof a&&i.enumType.push(this._nestedArray[n].toDescriptor());if(this.extensions)for(n=0;n<this.extensions.length;++n)i.extensionRange.push(t.DescriptorProto.ExtensionRange.create({start:this.extensions[n][0],end:this.extensions[n][1]}));if(this.reserved)for(n=0;n<this.reserved.length;++n)"string"==typeof this.reserved[n]?i.reservedName.push(this.reserved[n]):i.reservedRange.push(t.DescriptorProto.ReservedRange.create({start:this.reserved[n][0],end:this.reserved[n][1]}));return i.options=I(this.options,t.MessageOptions),i};const m=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,r,n){if("number"==typeof e.length&&(e=t.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(i=e.typeName&&e.typeName.length?e.typeName:T(e.type),e.label){case 1:s=void 0;break;case 2:s="required";break;case 3:s="repeated";break;default:throw Error("illegal label: "+e.label)}let i,s,a=e.extendee;void 0!==e.extendee&&(a=a.length?a:void 0);const o=new l(e.name.length?e.name:"field"+e.number,e.number,i,s,a);if(n||(o._edition=r),o.options=_(e.options,t.FieldOptions),e.proto3_optional&&(o.options.proto3_optional=!0),e.defaultValue&&e.defaultValue.length){let u=e.defaultValue;switch(u){case"true":case"TRUE":u=!0;break;case"false":case"FALSE":u=!1;break;default:m.exec(u)&&(u=parseInt(u))}o.setOption("default",u)}return w(e.type)&&("proto3"===r?e.options&&!e.options.packed&&o.setOption("packed",!1):(!r||"proto2"===r)&&e.options&&e.options.packed&&o.setOption("packed",!0)),o},l.prototype.toDescriptor=function(e){const r=t.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)r.type=11,r.typeName=n.util.ucFirst(this.name),r.label=3;else{switch(r.type=S(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:r.typeName=this.resolvedType?R(this.parent,this.resolvedType):this.type}"repeated"===this.rule?r.label=3:this.required&&"proto2"===e?r.label=2:r.label=1}if(r.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(r.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(r.options=I(this.options,t.FieldOptions),null!=this.options.default&&(r.defaultValue=String(this.options.default)),this.options.proto3_optional&&(r.proto3_optional=!0)),"proto3"===e?this.packed||((r.options||(r.options=t.FieldOptions.create())).packed=!1):(!e||"proto2"===e)&&this.packed&&((r.options||(r.options=t.FieldOptions.create())).packed=!0),r};let g=0;a.fromDescriptor=function(e,r,n){"number"==typeof e.length&&(e=t.EnumDescriptorProto.decode(e));const i={};if(e.value)for(let s=0;s<e.value.length;++s){const o=e.value[s].name,l=e.value[s].number||0;i[o&&o.length?o:"NAME"+l]=l}const u=new a(e.name&&e.name.length?e.name:"Enum"+g++,i,_(e.options,t.EnumOptions));return n||(u._edition=r),u},a.prototype.toDescriptor=function(){for(var e=[],r=0,n=Object.keys(this.values);r<n.length;++r)e.push(t.EnumValueDescriptorProto.create({name:n[r],number:this.values[n[r]]}));return t.EnumDescriptorProto.create({name:this.name,value:e,options:I(this.options,t.EnumOptions)})};let y=0;c.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.OneofDescriptorProto.decode(e)),new c(e.name&&e.name.length?e.name:"oneof"+y++)},c.prototype.toDescriptor=function(){return t.OneofDescriptorProto.create({name:this.name})};let v=0;d.fromDescriptor=function(e,r,n){"number"==typeof e.length&&(e=t.ServiceDescriptorProto.decode(e));const i=new d(e.name&&e.name.length?e.name:"Service"+v++,_(e.options,t.ServiceOptions));if(n||(i._edition=r),e.method)for(let s=0;s<e.method.length;++s)i.add(h.fromDescriptor(e.method[s]));return i},d.prototype.toDescriptor=function(){for(var e=[],r=0;r<this.methodsArray.length;++r)e.push(this._methodsArray[r].toDescriptor());return t.ServiceDescriptorProto.create({name:this.name,method:e,options:I(this.options,t.ServiceOptions)})};let b=0;function T(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function w(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function S(e,t,r){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof a)return 14;if(t instanceof o)return r?10:11;throw Error("illegal type: "+e)}function E(e,t){for(var r,n,i={},s=0;s<t.fieldsArray.length;++s)if("uninterpretedOption"!==(n=(r=t._fieldsArray[s]).name)&&Object.prototype.hasOwnProperty.call(e,n)){const l=k(n);r.resolvedType instanceof o?i[l]=E(e[n],r.resolvedType):r.resolvedType instanceof a?i[l]=r.resolvedType.valuesById[e[n]]:i[l]=e[n]}return i}function _(e,t){if(e)return E(t.toObject(e),t)}function C(e,t){for(var r={},i=Object.keys(e),s=0;s<i.length;++s){const a=i[s],l=n.util.camelCase(a);if(Object.prototype.hasOwnProperty.call(t.fields,l)){const u=t.fields[l];u.resolvedType instanceof o?r[l]=C(e[a],u.resolvedType):r[l]=e[a],u.repeated&&!Array.isArray(r[l])&&(r[l]=[r[l]])}}return r}function I(e,t){if(e)return t.fromObject(C(e,t))}function R(e,t){let r=e.fullName.split("."),n=t.fullName.split("."),a=0,o=0,l=n.length-1;if(!(e instanceof s)&&t instanceof i)for(;a<r.length&&o<l&&r[a]===n[o];){const u=t.lookup(r[a++],!0);if(null!==u&&u!==t)break;++o}else for(;a<r.length&&o<l&&r[a]===n[o];++a,++o);return n.slice(o).join(".")}function k(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}function A(e){if("editions"===e.syntax){if(e.edition===t.Edition.EDITION_2023)return"2023";throw Error("Unsupported edition "+e.edition)}return"proto3"===e.syntax?"proto3":"proto2"}function N(e,r){if(e){if("proto2"===e||"proto3"===e)r.syntax=e;else if(r.syntax="editions","2023"===e)r.edition=t.Edition.EDITION_2023;else throw Error("Unsupported edition "+e)}}h.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.MethodDescriptorProto.decode(e)),new h(e.name&&e.name.length?e.name:"Method"+b++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,_(e.options,t.MethodOptions))},h.prototype.toDescriptor=function(){return t.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:I(this.options,t.MethodOptions)})}},967:(e,t,r)=>{"use strict";e.exports=r(33526)},97230:e=>{"use strict";e.exports=n;let t,r=/\/|\./;function n(e,t){r.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),n[e]=t}n("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),n("duration",{Duration:t={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),n("timestamp",{Timestamp:t}),n("empty",{Empty:{fields:{}}}),n("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),n("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),n("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),n.get=function(e){return n[e]||null}},5893:(e,t,r)=>{"use strict";const n=t,i=r(79562),s=r(42175);function a(e,t,r,n){let s=!1;if(t.resolvedType){if(t.resolvedType instanceof i){e("switch(d%s){",n);for(let a=t.resolvedType.values,o=Object.keys(a),l=0;l<o.length;++l)a[o[l]]!==t.typeDefault||s||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',n,n,n),t.repeated||e("break"),s=!0),e("case%j:",o[l])("case %i:",a[o[l]])("m%s=%j",n,a[o[l]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",n,r,n)}else{let u=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":u=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,u)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,u?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length >= 0)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n)}}return e}function o(e,t,r,n){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",n,r,n,n,r,n,n):e("d%s=types[%i].toObject(m%s,o)",n,r,n);else{let s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,s?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n)}}return e}n.fromObject=function(e){const t=e.fieldsArray,r=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(let n=0;n<t.length;++n){const o=t[n].resolve(),l=s.safeProp(o.name);o.map?(r("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),a(r,o,n,l+"[ks[i]]")("}")("}")):o.repeated?(r("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),a(r,o,n,l+"[i]")("}")("}")):(o.resolvedType instanceof i||r("if(d%s!=null){",l),a(r,o,n,l),o.resolvedType instanceof i||r("}"))}return r("return m")},n.toObject=function(e){const t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var r=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],a=[],l=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?n:t[u].map?a:l).push(t[u]);if(n.length){for(r("if(o.arrays||o.defaults){"),u=0;u<n.length;++u)r("d%s=[]",s.safeProp(n[u].name));r("}")}if(a.length){for(r("if(o.objects||o.defaults){"),u=0;u<a.length;++u)r("d%s={}",s.safeProp(a[u].name));r("}")}if(l.length){for(r("if(o.defaults){"),u=0;u<l.length;++u){var c=l[u],d=s.safeProp(c.name);if(c.resolvedType instanceof i)r("d%s=o.enums===String?%j:%j",d,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",d)("}else")("d%s=o.longs===String?%j:%i",d,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){const h="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",d,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",d,h)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",d,d)("}")}else r("d%s=%j",d,c.typeDefault)}r("}")}let p=!1;for(u=0;u<t.length;++u){var c=t[u],f=e._fieldsArray.indexOf(c),d=s.safeProp(c.name);c.map?(p||(p=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",d,d)("d%s={}",d)("for(var j=0;j<ks2.length;++j){"),o(r,c,f,d+"[ks2[j]]")("}")):c.repeated?(r("if(m%s&&m%s.length){",d,d)("d%s=[]",d)("for(var j=0;j<m%s.length;++j){",d),o(r,c,f,d+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",d,c.name),o(r,c,f,d),c.partOf&&r("if(o.oneofs)")("d%s=%j",s.safeProp(c.partOf.name),c.name)),r("}")}return r("return d")}},48601:(e,t,r)=>{"use strict";e.exports=o;const n=r(79562),i=r(39219),s=r(42175);function a(e){return"missing required '"+e.name+"'"}function o(e){for(var t=s.codegen(["r","l","e"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),r=0;r<e.fieldsArray.length;++r){const o=e._fieldsArray[r].resolve(),l=o.resolvedType instanceof n?"int32":o.type,u="m"+s.safeProp(o.name);t("case %i: {",o.id),o.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[o.keyType]?t("k=%j",i.defaults[o.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",o.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",r):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),t(void 0!==i.long[o.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",u)):o.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,l)("}else"),void 0===i.basic[l]?t(o.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",u,r):t("%s.push(r.%s())",u,l)):void 0===i.basic[l]?t(o.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",u,r):t("%s=r.%s()",u,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){const c=e._fieldsArray[r];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",a(c))}return t("return m")}},87981:(e,t,r)=>{"use strict";e.exports=o;const n=r(79562),i=r(39219),s=r(42175);function a(e,t,r,n){return t.delimited?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,n,(t.id<<3|2)>>>0)}function o(e){for(var t,r,o=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){const u=l[t].resolve(),c=e._fieldsArray.indexOf(u),d=u.resolvedType instanceof n?"int32":u.type,h=i.basic[d];r="m"+s.safeProp(u.name),u.map?(o("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===h?o("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,r):o(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|h,d,r),o("}")("}")):u.repeated?(o("if(%s!=null&&%s.length){",r,r),u.packed&&void 0!==i.packed[d]?o("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",d,r)("w.ldelim()"):(o("for(var i=0;i<%s.length;++i)",r),void 0===h?a(o,u,c,r+"[i]"):o("w.uint32(%i).%s(%s[i])",(u.id<<3|h)>>>0,d,r)),o("}")):(u.optional&&o("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,u.name),void 0===h?a(o,u,c,r):o("w.uint32(%i).%s(%s)",(u.id<<3|h)>>>0,d,r))}return o("return w")}},79562:(e,t,r)=>{"use strict";e.exports=a;const n=r(94104);((a.prototype=Object.create(n.prototype)).constructor=a).className="Enum";const i=r(27106),s=r(42175);function a(e,t,r,i,s,a){if(n.call(this,e,r),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.valuesOptions=a,this._valuesFeatures={},this.reserved=void 0,t)for(let o=Object.keys(t),l=0;l<o.length;++l)"number"==typeof t[o[l]]&&(this.valuesById[this.values[o[l]]=t[o[l]]]=o[l])}a.prototype._resolveFeatures=function(e){return e=this._edition||e,n.prototype._resolveFeatures.call(this,e),Object.keys(this.values).forEach(e=>{const t=Object.assign({},this._features);this._valuesFeatures[e]=Object.assign(t,this.valuesOptions&&this.valuesOptions[e]&&this.valuesOptions[e].features)}),this},a.fromJSON=function(e,t){const r=new a(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},a.prototype.toJSON=function(e){const t=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,r,n){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return n&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=n||null),this.comments[e]=r||null,this},a.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");const t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},7586:(e,t,r)=>{"use strict";e.exports=u;let n,i=r(94104);((u.prototype=Object.create(i.prototype)).constructor=u).className="Field";const s=r(79562),a=r(39219),o=r(42175),l=/^required|optional|repeated$/;function u(e,t,r,n,s,u,c){if(o.isObject(n)?(c=s,u=n,n=s=void 0):o.isObject(s)&&(c=u,u=s,s=void 0),i.call(this,e,u),!o.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!o.isString(r))throw TypeError("type must be a string");if(void 0!==n&&!l.test(n=n.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!o.isString(s))throw TypeError("extend must be a string");"proto3_optional"===n&&(n="optional"),this.rule=n&&"optional"!==n?n:void 0,this.type=r,this.id=t,this.extend=s||void 0,this.repeated="repeated"===n,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!o.Long&&void 0!==a.long[r],this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=c}u.fromJSON=function(e,t){const r=new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},Object.defineProperty(u.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(u.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(u.prototype,"delimited",{get:function(){return this.resolvedType instanceof n&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(u.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(u.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),u.prototype.setOption=function(e,t,r){return i.prototype.setOption.call(this,e,t,r)},u.prototype.toJSON=function(e){const t=!!e&&!!e.keepComments;return o.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof n?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=o.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){let e;o.base64.test(this.typeDefault)?o.base64.decode(this.typeDefault,e=o.newBuffer(o.base64.length(this.typeDefault)),0):o.utf8.write(this.typeDefault,e=o.newBuffer(o.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=o.emptyObject:this.repeated?this.defaultValue=o.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof n&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},u.prototype._inferLegacyProtoFeatures=function(e){if("proto2"!==e&&"proto3"!==e)return{};const t={};if("required"===this.rule&&(t.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===a.defaults[this.type]){const r=this.parent.get(this.type.split(".").pop());r&&r instanceof n&&r.group&&(t.message_encoding="DELIMITED")}return!0===this.getOption("packed")?t.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(t.repeated_field_encoding="EXPANDED"),t},u.prototype._resolveFeatures=function(e){return i.prototype._resolveFeatures.call(this,this._edition||e)},u.d=function(e,t,r,n){return"function"==typeof t?t=o.decorateType(t).name:t&&"object"==typeof t&&(t=o.decorateEnum(t).name),function(i,s){o.decorateType(i.constructor).add(new u(s,e,t,r,{default:n}))}},u._configure=function(e){n=e}},33159:(e,t,r)=>{"use strict";const n=e.exports=r(24109);function i(e,t,r){return"function"==typeof t?(r=t,t=new n.Root):t||(t=new n.Root),t.load(e,r)}function s(e,t){return t||(t=new n.Root),t.loadSync(e)}n.build="light",n.load=i,n.loadSync=s,n.encoder=r(87981),n.decoder=r(48601),n.verifier=r(38841),n.converter=r(5893),n.ReflectionObject=r(94104),n.Namespace=r(27106),n.Root=r(89286),n.Enum=r(79562),n.Type=r(81494),n.Field=r(7586),n.OneOf=r(23264),n.MapField=r(35103),n.Service=r(90269),n.Method=r(14141),n.Message=r(1433),n.wrappers=r(8366),n.types=r(39219),n.util=r(42175),n.ReflectionObject._configure(n.Root),n.Namespace._configure(n.Type,n.Service,n.Enum),n.Root._configure(n.Type),n.Field._configure(n.Type)},24109:(e,t,r)=>{"use strict";const n=t;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(30609),n.BufferWriter=r(64437),n.Reader=r(97010),n.BufferReader=r(34146),n.util=r(92182),n.rpc=r(81996),n.roots=r(83722),n.configure=i,i()},33526:(e,t,r)=>{"use strict";const n=e.exports=r(33159);n.build="full",n.tokenize=r(73547),n.parse=r(75079),n.common=r(97230),n.Root._configure(n.Type,n.parse,n.common)},35103:(e,t,r)=>{"use strict";e.exports=a;const n=r(7586);((a.prototype=Object.create(n.prototype)).constructor=a).className="MapField";const i=r(39219),s=r(42175);function a(e,t,r,i,a,o){if(n.call(this,e,t,i,void 0,void 0,a,o),!s.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){const t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return n.prototype.resolve.call(this)},a.d=function(e,t,r){return"function"==typeof r?r=s.decorateType(r).name:r&&"object"==typeof r&&(r=s.decorateEnum(r).name),function(n,i){s.decorateType(n.constructor).add(new a(i,e,t,r))}}},1433:(e,t,r)=>{"use strict";e.exports=i;const n=r(92182);function i(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,n.toJSONOptions)}},14141:(e,t,r)=>{"use strict";e.exports=s;const n=r(94104);((s.prototype=Object.create(n.prototype)).constructor=s).className="Method";const i=r(42175);function s(e,t,r,s,a,o,l,u,c){if(i.isObject(a)?(l=a,a=o=void 0):i.isObject(o)&&(l=o,o=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(r))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");n.call(this,e,l),this.type=t||"rpc",this.requestType=r,this.requestStream=!!a||void 0,this.responseType=s,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=c}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){const t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),n.prototype.resolve.call(this))}},27106:(e,t,r)=>{"use strict";e.exports=d;let n,i,s,a=r(94104);((d.prototype=Object.create(a.prototype)).constructor=d).className="Namespace";const o=r(7586),l=r(42175),u=r(23264);function c(e,t){if(e&&e.length){for(var r={},n=0;n<e.length;++n)r[e[n].name]=e[n].toJSON(t);return r}}function d(e,t){a.call(this,e,t),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function h(e){e._nestedArray=null,e._lookupCache={};for(let t=e;t=t.parent;)t._lookupCache={};return e}d.fromJSON=function(e,t){return new d(e,t.options).addJSON(t.nested)},d.arrayToJSON=c,d.isReservedId=function(e,t){if(e){for(let r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>t)return!0}return!1},d.isReservedName=function(e,t){if(e){for(let r=0;r<e.length;++r)if(e[r]===t)return!0}return!1},Object.defineProperty(d.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),d.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",c(this.nestedArray,e)])},d.prototype.addJSON=function(e){const t=this;if(e)for(var r,a=Object.keys(e),l=0;l<a.length;++l)r=e[a[l]],t.add((void 0!==r.fields?n.fromJSON:void 0!==r.values?s.fromJSON:void 0!==r.methods?i.fromJSON:void 0!==r.id?o.fromJSON:d.fromJSON)(a[l],r));return this},d.prototype.get=function(e){return this.nested&&this.nested[e]||null},d.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},d.prototype.add=function(e){if(!(e instanceof o&&void 0!==e.extend||e instanceof n||e instanceof u||e instanceof s||e instanceof i||e instanceof d))throw TypeError("object must be a valid nested object");if(this.nested){const t=this.get(e.name);if(t){if(t instanceof d&&e instanceof d&&!(t instanceof n||t instanceof i)){for(let r=t.nestedArray,a=0;a<r.length;++a)e.add(r[a]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}}else this.nested={};this.nested[e.name]=e,this instanceof n||this instanceof i||this instanceof s||this instanceof o||e._edition||(e._edition=e._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(let l=this;l=l.parent;)l._needsRecursiveFeatureResolution=!0,l._needsRecursiveResolve=!0;return e.onAdd(this),h(this)},d.prototype.remove=function(e){if(!(e instanceof a))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),h(this)},d.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;e.length>0;){const n=e.shift();if(r.nested&&r.nested[n]){if(!((r=r.nested[n])instanceof d))throw Error("path conflicts with non-namespace objects")}else r.add(r=new d(n))}return t&&r.addJSON(t),r},d.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);let e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof d?e[t++].resolveAll():e[t++].resolve();return this._needsRecursiveResolve=!1,this},d.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,e=this._edition||e,a.prototype._resolveFeaturesRecursive.call(this,e),this.nestedArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},d.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;const n=e.join(".");if(""===e[0])return this.root.lookup(e.slice(1),t);let i=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+n];if(i&&(!t||t.indexOf(i.constructor)>-1)||(i=this._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;if(r)return null;for(let s=this;s.parent;){if((i=s.parent._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;s=s.parent}return null},d.prototype._lookupImpl=function(e,t){if(Object.prototype.hasOwnProperty.call(this._lookupCache,t))return this._lookupCache[t];let r=this.get(e[0]),n=null;if(r)1===e.length?n=r:r instanceof d&&(e=e.slice(1),n=r._lookupImpl(e,e.join(".")));else for(let i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof d&&(r=this._nestedArray[i]._lookupImpl(e,t))&&(n=r);return this._lookupCache[t]=n,n},d.prototype.lookupType=function(e){const t=this.lookup(e,[n]);if(!t)throw Error("no such type: "+e);return t},d.prototype.lookupEnum=function(e){const t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},d.prototype.lookupTypeOrEnum=function(e){const t=this.lookup(e,[n,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},d.prototype.lookupService=function(e){const t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},d._configure=function(e,t,r){n=e,i=t,s=r}},94104:(e,t,r)=>{"use strict";e.exports=u,u.className="ReflectionObject";const n=r(23264);let i,s=r(42175),a={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},o={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},l={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function u(e,t){if(!s.isString(e))throw TypeError("name must be a string");if(t&&!s.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(u.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),u.prototype.toJSON=function(){throw Error()},u.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;const t=e.root;t instanceof i&&t._handleAdd(this)},u.prototype.onRemove=function(e){const t=e.root;t instanceof i&&t._handleRemove(this),this.parent=null,this.resolved=!1},u.prototype.resolve=function(){return this.resolved||this.root instanceof i&&(this.resolved=!0),this},u.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)},u.prototype._resolveFeatures=function(e){if(!this._featuresResolved){let t={};if(!e)throw Error("Unknown edition for "+this.fullName);const r=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(e));if(this._edition){if("proto2"===e)t=Object.assign({},o);else if("proto3"===e)t=Object.assign({},l);else if("2023"===e)t=Object.assign({},a);else throw Error("Unknown edition: "+e);this._features=Object.assign(t,r||{}),this._featuresResolved=!0;return}if(this.partOf instanceof n){const i=Object.assign({},this.partOf._features);this._features=Object.assign(i,r||{})}else if(this.declaringField);else if(this.parent){const s=Object.assign({},this.parent._features);this._features=Object.assign(s,r||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},u.prototype._inferLegacyProtoFeatures=function(){return{}},u.prototype.getOption=function(e){if(this.options)return this.options[e]},u.prototype.setOption=function(e,t,r){return this.options||(this.options={}),/^features\./.test(e)?s.setProperty(this.options,e,t,r):r&&void 0!==this.options[e]||(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this},u.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);const n=this.parsedOptions;if(r){let i=n.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(i){const a=i[e];s.setProperty(a,r,t)}else(i={})[e]=s.setProperty({},r,t),n.push(i)}else{const o={};o[e]=t,n.push(o)}return this},u.prototype.setOptions=function(e,t){if(e)for(let r=Object.keys(e),n=0;n<r.length;++n)this.setOption(r[n],e[r[n]],t);return this},u.prototype.toString=function(){const e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},u.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},u._configure=function(e){i=e}},23264:(e,t,r)=>{"use strict";e.exports=a;const n=r(94104);((a.prototype=Object.create(n.prototype)).constructor=a).className="OneOf";const i=r(7586),s=r(42175);function a(e,t,r,i){if(Array.isArray(t)||(r=t,t=void 0),n.call(this,e,r),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function o(e){if(e.parent)for(let t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){const t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,o(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");let t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){n.prototype.onAdd.call(this,e);for(let t=this,r=0;r<this.oneof.length;++r){const i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}o(this)},a.prototype.onRemove=function(e){for(var t,r=0;r<this.fieldsArray.length;++r)(t=this.fieldsArray[r]).parent&&t.parent.remove(t);n.prototype.onRemove.call(this,e)},Object.defineProperty(a.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;const e=this.fieldsArray[0];return null!=e.options&&!0===e.options.proto3_optional}}),a.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){s.decorateType(t.constructor).add(new a(r,e)),Object.defineProperty(t,r,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},75079:(e,t,r)=>{"use strict";e.exports=_,_.filename=null,_.defaults={keepCase:!1};const n=r(73547),i=r(89286),s=r(81494),a=r(7586),o=r(35103),l=r(23264),u=r(79562),c=r(90269),d=r(14141),h=r(94104),p=r(39219),f=r(42175),m=/^[1-9][0-9]*$/,g=/^-?[1-9][0-9]*$/,y=/^0[x][0-9a-fA-F]+$/,v=/^-?0[x][0-9a-fA-F]+$/,b=/^0[0-7]+$/,T=/^-?0[0-7]+$/,w=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,S=/^[a-zA-Z_][a-zA-Z_0-9]*$/,E=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function _(e,t,r){t instanceof i||(r=t,t=new i),r||(r=_.defaults);let C,I,R,k,A=r.preferTrailingComment||!1,N=n(e,r.alternateCommentMode||!1),D=N.next,O=N.push,x=N.peek,P=N.skip,M=N.cmnt,L=!0,F="proto2",B=t,U=[],j={},V=r.keepCase?function(e){return e}:f.camelCase;function z(){U.forEach(e=>{e._edition=F,Object.keys(j).forEach(t=>{void 0===e.getOption(t)&&e.setOption(t,j[t],!0)})})}function q(e,t,r){const n=_.filename;return r||(_.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(n?n+", ":"")+"line "+N.line+")")}function $(){let e,t=[];do{if('"'!==(e=D())&&"'"!==e)throw q(e);t.push(D()),P(e),e=x()}while('"'===e||"'"===e);return t.join("")}function G(e){const t=D();switch(t){case"'":case'"':return O(t),$();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return H(t,!0)}catch(r){if(e&&E.test(t))return t;throw q(t,"value")}}function K(e,t){do if(t&&('"'===(r=x())||"'"===r)){var r,n,i=$();if(e.push(i),F>=2023)throw q(i,"id")}else try{e.push([n=W(D()),P("to",!0)?W(D()):n])}catch(n){if(t&&E.test(r)&&F>=2023)e.push(r);else throw n}while(P(",",!0));const s={options:void 0};s.setOption=function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t},ee(s,function(e){if("option"===e)el(s,e),P(";");else throw q(e)},function(){eh(s)})}function H(e,t){let r=1;switch("-"===e.charAt(0)&&(r=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*r;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(m.test(e))return r*parseInt(e,10);if(y.test(e))return r*parseInt(e,16);if(b.test(e))return r*parseInt(e,8);if(w.test(e))return r*parseFloat(e);throw q(e,"number",t)}function W(e,t){switch(e){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!t&&"-"===e.charAt(0))throw q(e,"id");if(g.test(e))return parseInt(e,10);if(v.test(e))return parseInt(e,16);if(T.test(e))return parseInt(e,8);throw q(e,"id")}function Q(){if(void 0!==I)throw q("package");if(I=D(),!E.test(I))throw q(I,"name");B=B.define(I),P(";")}function Y(){let e,t=x();switch(t){case"weak":e=k||(k=[]),D();break;case"public":D();default:e=R||(R=[])}t=$(),P(";"),e.push(t)}function J(){if(P("="),(F=$())<2023)throw q(F,"syntax");P(";")}function X(){if(P("="),!["2023"].includes(F=$()))throw q(F,"edition");P(";")}function Z(e,t){switch(t){case"option":return el(e,t),P(";"),!0;case"message":return et(e,t),!0;case"enum":return ea(e,t),!0;case"service":return ep(e,t),!0;case"extend":return em(e,t),!0}return!1}function ee(e,t,r){let n,i=N.line;if(e&&("string"!=typeof e.comment&&(e.comment=M()),e.filename=_.filename),P("{",!0)){for(;"}"!==(n=D());)t(n);P(";",!0)}else r&&r(),P(";"),e&&("string"!=typeof e.comment||A)&&(e.comment=M(i)||e.comment)}function et(e,t){if(!S.test(t=D()))throw q(t,"type name");const r=new s(t);ee(r,function(e){if(!Z(r,e))switch(e){case"map":ei(r,e);break;case"required":if("proto2"!==F)throw q(e);case"repeated":er(r,e);break;case"optional":if("proto3"===F)er(r,"proto3_optional");else if("proto2"!==F)throw q(e);else er(r,"optional");break;case"oneof":es(r,e);break;case"extensions":K(r.extensions||(r.extensions=[]));break;case"reserved":K(r.reserved||(r.reserved=[]),!0);break;default:if("proto2"===F||!E.test(e))throw q(e);O(e),er(r,"optional")}}),e.add(r),e===B&&U.push(r)}function er(e,t,r){let n=D();if("group"===n){en(e,t);return}for(;n.endsWith(".")||x().startsWith(".");)n+=D();if(!E.test(n))throw q(n,"type");let i=D();if(!S.test(i))throw q(i,"name");i=V(i),P("=");const s=new a(i,W(D()),n,t,r);if(ee(s,function(e){if("option"===e)el(s,e),P(";");else throw q(e)},function(){eh(s)}),"proto3_optional"===t){const o=new l("_"+i);s.setOption("proto3_optional",!0),o.add(s),e.add(o)}else e.add(s);e===B&&U.push(s)}function en(e,t){if(F>=2023)throw q("group");let r=D();if(!S.test(r))throw q(r,"name");const n=f.lcFirst(r);r===n&&(r=f.ucFirst(r)),P("=");const i=W(D()),o=new s(r);o.group=!0;const l=new a(n,i,r,t);l.filename=_.filename,ee(o,function(e){switch(e){case"option":el(o,e),P(";");break;case"required":case"repeated":er(o,e);break;case"optional":"proto3"===F?er(o,"proto3_optional"):er(o,"optional");break;case"message":et(o,e);break;case"enum":ea(o,e);break;case"reserved":K(o.reserved||(o.reserved=[]),!0);break;default:throw q(e)}}),e.add(o).add(l)}function ei(e){P("<");const t=D();if(void 0===p.mapKey[t])throw q(t,"type");P(",");const r=D();if(!E.test(r))throw q(r,"type");P(">");const n=D();if(!S.test(n))throw q(n,"name");P("=");const i=new o(V(n),W(D()),t,r);ee(i,function(e){if("option"===e)el(i,e),P(";");else throw q(e)},function(){eh(i)}),e.add(i)}function es(e,t){if(!S.test(t=D()))throw q(t,"name");const r=new l(V(t));ee(r,function(e){"option"===e?(el(r,e),P(";")):(O(e),er(r,"optional"))}),e.add(r)}function ea(e,t){if(!S.test(t=D()))throw q(t,"name");const r=new u(t);ee(r,function(e){switch(e){case"option":el(r,e),P(";");break;case"reserved":K(r.reserved||(r.reserved=[]),!0),void 0===r.reserved&&(r.reserved=[]);break;default:eo(r,e)}}),e.add(r),e===B&&U.push(r)}function eo(e,t){if(!S.test(t))throw q(t,"name");P("=");const r=W(D(),!0),n={options:void 0};n.getOption=function(e){return this.options[e]},n.setOption=function(e,t){h.prototype.setOption.call(n,e,t)},n.setParsedOption=function(){},ee(n,function(e){if("option"===e)el(n,e),P(";");else throw q(e)},function(){eh(n)}),e.add(t,r,n.comment,n.parsedOptions||n.options)}function el(e,t){let r,n,i=!0;for("option"===t&&(t=D());"="!==t;){if("("===t){const s=D();P(")"),t="("+s+")"}if(i){if(i=!1,t.includes(".")&&!t.includes("(")){const a=t.split(".");r=a[0]+".",t=a[1];continue}r=t}else n=n?n+=t:t;t=D()}const o=eu(e,n?r.concat(n):r);n=n&&"."===n[0]?n.slice(1):n,ed(e,r=r&&"."===r[r.length-1]?r.slice(0,-1):r,o,n)}function eu(e,t){if(P("{",!0)){for(var r={};!P("}",!0);){if(!S.test(C=D()))throw q(C,"name");if(null===C)throw q(C,"end of input");var n,i,s=C;if(P(":",!0),"{"===x())n=eu(e,t+"."+C);else if("["===x()){if(n=[],P("[",!0)){do i=G(!0),n.push(i);while(P(",",!0));P("]"),void 0!==i&&ec(e,t+"."+C,i)}}else n=G(!0),ec(e,t+"."+C,n);const a=r[s];a&&(n=[].concat(a).concat(n)),r[s]=n,P(",",!0),P(";",!0)}return r}const o=G(!0);return ec(e,t,o),o}function ec(e,t,r){if(B===e&&/^features\./.test(t)){j[t]=r;return}e.setOption&&e.setOption(t,r)}function ed(e,t,r,n){e.setParsedOption&&e.setParsedOption(t,r,n)}function eh(e){if(P("[",!0)){do el(e,"option");while(P(",",!0));P("]")}return e}function ep(e,t){if(!S.test(t=D()))throw q(t,"service name");const r=new c(t);ee(r,function(e){if(!Z(r,e)){if("rpc"===e)ef(r,e);else throw q(e)}}),e.add(r),e===B&&U.push(r)}function ef(e,t){const r=M(),n=t;if(!S.test(t=D()))throw q(t,"name");let i,s,a,o,l=t;if(P("("),P("stream",!0)&&(s=!0),!E.test(t=D())||(i=t,P(")"),P("returns"),P("("),P("stream",!0)&&(o=!0),!E.test(t=D())))throw q(t);a=t,P(")");const u=new d(l,n,i,a,s,o);u.comment=r,ee(u,function(e){if("option"===e)el(u,e),P(";");else throw q(e)}),e.add(u)}function em(e,t){if(!E.test(t=D()))throw q(t,"reference");const r=t;ee(null,function(t){switch(t){case"required":case"repeated":er(e,t,r);break;case"optional":"proto3"===F?er(e,"proto3_optional",r):er(e,"optional",r);break;default:if("proto2"===F||!E.test(t))throw q(t);O(t),er(e,"optional",r)}})}for(;null!==(C=D());)switch(C){case"package":if(!L)throw q(C);Q();break;case"import":if(!L)throw q(C);Y();break;case"syntax":if(!L)throw q(C);J();break;case"edition":if(!L)throw q(C);X();break;case"option":el(B,C),P(";",!0);break;default:if(Z(B,C)){L=!1;continue}throw q(C)}return z(),_.filename=null,{package:I,imports:R,weakImports:k,root:t}}},97010:(e,t,r)=>{"use strict";e.exports=l;let n,i=r(92182),s=i.LongBits,a=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}const u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},c=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new n(e):u(e)})(e)}:u};function d(){let e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function h(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw o(this,8);return new s(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}l.create=c(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){let e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){const e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return h(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|h(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);const e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);const e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){const e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw o(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){const n=i.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)},l.prototype.string=function(){const e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw o(this);while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){n=e,l.create=c(),n._configure();const t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},34146:(e,t,r)=>{"use strict";e.exports=s;const n=r(97010);(s.prototype=Object.create(n.prototype)).constructor=s;const i=r(92182);function s(e){n.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){const e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},89286:(e,t,r)=>{"use strict";e.exports=d;let n,i,s,a=r(27106);((d.prototype=Object.create(a.prototype)).constructor=d).className="Root";const o=r(7586),l=r(79562),u=r(23264),c=r(42175);function d(e){a.call(this,"",e),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function h(){}d.fromJSON=function(e,t){return t||(t=new d),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()},d.prototype.resolvePath=c.path.resolve,d.prototype.fetch=c.fetch,d.prototype.load=function e(t,r,n){"function"==typeof r&&(n=r,r=void 0);const a=this;if(!n)return c.asPromise(e,a,t,r);const o=n===h;function l(e,t){if(n){if(o)throw e;t&&t.resolveAll();const r=n;n=null,r(e,t)}}function u(e){const t=e.lastIndexOf("google/protobuf/");if(t>-1){const r=e.substring(t);if(r in s)return r}return null}function d(e,t){try{if(c.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),c.isString(t)){i.filename=e;let n,s=i(t,a,r),d=0;if(s.imports)for(;d<s.imports.length;++d)(n=u(s.imports[d])||a.resolvePath(e,s.imports[d]))&&p(n);if(s.weakImports)for(d=0;d<s.weakImports.length;++d)(n=u(s.weakImports[d])||a.resolvePath(e,s.weakImports[d]))&&p(n,!0)}else a.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}o||f||l(null,a)}function p(e,t){if(e=u(e)||e,!(a.files.indexOf(e)>-1)){if(a.files.push(e),e in s){o?d(e,s[e]):(++f,setTimeout(function(){--f,d(e,s[e])}));return}if(o){let r;try{r=c.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}d(e,r)}else++f,a.fetch(e,function(r,i){if(--f,n){if(r){t?f||l(null,a):l(r);return}d(e,i)}})}}var f=0;c.isString(t)&&(t=[t]);for(var m,g=0;g<t.length;++g)(m=a.resolvePath("",t[g]))&&p(m);return o?a.resolveAll():f||l(null,a),a},d.prototype.loadSync=function(e,t){if(!c.isNode)throw Error("not supported");return this.load(e,t,h)},d.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return a.prototype.resolveAll.call(this)};const p=/^[A-Z]/;function f(e,t){const r=t.parent.lookup(t.extend);if(r){const n=new o(t.fullName,t.id,t.type,t.rule,void 0,t.options);return!!r.get(n.name)||(n.declaringField=t,t.extensionField=n,r.add(n),!0)}return!1}d.prototype._handleAdd=function(e){if(e instanceof o)void 0===e.extend||e.extensionField||f(this,e)||this.deferred.push(e);else if(e instanceof l)p.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof n)for(let t=0;t<this.deferred.length;)f(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(let r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);p.test(e.name)&&(e.parent[e.name]=e)}(e instanceof n||e instanceof l||e instanceof o)&&(this._fullyQualifiedObjects[e.fullName]=e)},d.prototype._handleRemove=function(e){if(e instanceof o){if(void 0!==e.extend){if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{const t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}}else if(e instanceof l)p.test(e.name)&&delete e.parent[e.name];else if(e instanceof a){for(let r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);p.test(e.name)&&delete e.parent[e.name]}delete this._fullyQualifiedObjects[e.fullName]},d._configure=function(e,t,r){n=e,i=t,s=r}},83722:e=>{"use strict";e.exports={}},81996:(e,t,r)=>{"use strict";t.Service=r(85144)},85144:(e,t,r)=>{"use strict";e.exports=i;const n=r(92182);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,s,a){if(!s)throw TypeError("request must be specified");const o=this;if(!a)return n.asPromise(e,o,t,r,i,s);if(!o.rpcImpl){setTimeout(function(){a(Error("already ended"))},0);return}try{return o.rpcImpl(t,r[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,r){if(e)return o.emit("error",e,t),a(e);if(null===r){o.end(!0);return}if(!(r instanceof i))try{r=i[o.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",r,t),a(null,r)})}catch(e){o.emit("error",e,t),setTimeout(function(){a(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},90269:(e,t,r)=>{"use strict";e.exports=o;const n=r(27106);((o.prototype=Object.create(n.prototype)).constructor=o).className="Service";const i=r(14141),s=r(42175),a=r(81996);function o(e,t){n.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}o.fromJSON=function(e,t){const r=new o(e,t.options);if(t.methods)for(let n=Object.keys(t.methods),s=0;s<n.length;++s)r.add(i.fromJSON(n[s],t.methods[n[s]]));return t.nested&&r.addJSON(t.nested),t.edition&&(r._edition=t.edition),r.comment=t.comment,r._defaultEdition="proto3",r},o.prototype.toJSON=function(e){const t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"methods",n.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),o.prototype.get=function(e){return this.methods[e]||n.prototype.get.call(this,e)},o.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolve.call(this);for(let e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return this},o.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.methodsArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},o.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):n.prototype.add.call(this,e)},o.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return n.prototype.remove.call(this,e)},o.prototype.create=function(e,t,r){for(var n,i=new a.Service(e,t,r),o=0;o<this.methodsArray.length;++o){const l=s.lcFirst((n=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:n,q:n.resolvedRequestType.ctor,s:n.resolvedResponseType.ctor})}return i}},73547:e=>{"use strict";e.exports=d;const t=/[\s{}=;:[\],'"()<>]/g,r=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,n=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,i=/^ *[*/]+ */,s=/^\s*\*?\/*/,a=/\n/g,o=/\s/,l=/\\(.?)/g,u={0:"\0",r:"\r",n:"\n",t:"	"};function c(e){return e.replace(l,function(e,t){switch(t){case"\\":case"":return t;default:return u[t]||""}})}function d(e,l){e=e.toString();let u=0,d=e.length,h=1,p=0,f={},m=[],g=null;function y(e){return Error("illegal "+e+" (line "+h+")")}function v(){const t="'"===g?n:r;t.lastIndex=u-1;const i=t.exec(e);if(!i)throw y("string");return u=t.lastIndex,_(g),g=null,c(i[1])}function b(t){return e.charAt(t)}function T(t,r,n){let o,u,c={type:e.charAt(t++),lineEmpty:!1,leading:n},d=t-(o=l?2:3);do if(--d<0||"\n"===(u=e.charAt(d))){c.lineEmpty=!0;break}while(" "===u||"	"===u);for(var m=e.substring(t,r).split(a),g=0;g<m.length;++g)m[g]=m[g].replace(l?s:i,"").trim();c.text=m.join("\n").trim(),f[h]=c,p=h}function w(t){const r=S(t),n=e.substring(t,r);return/^\s*\/\//.test(n)}function S(e){for(var t=e;t<d&&"\n"!==b(t);)t++;return t}function E(){if(m.length>0)return m.shift();if(g)return v();let r,n,i,s,a,c=0===u;do{if(u===d)return null;for(r=!1;o.test(i=b(u));)if("\n"===i&&(c=!0,++h),++u===d)return null;if("/"===b(u)){if(++u===d)throw y("comment");if("/"===b(u)){if(l){if(s=u,a=!1,w(u-1)){a=!0;do if((u=S(u))===d||(u++,!c))break;while(w(u))}else u=Math.min(d,S(u)+1);a&&(T(s,u,c),c=!0),h++,r=!0}else{for(a="/"===b(s=u+1);"\n"!==b(++u);)if(u===d)return null;++u,a&&(T(s,u-1,c),c=!0),++h,r=!0}}else{if("*"!==(i=b(u)))return"/";s=u+1,a=l||"*"===b(s);do{if("\n"===i&&++h,++u===d)throw y("comment");n=i,i=b(u)}while("*"!==n||"/"!==i);++u,a&&(T(s,u-2,c),c=!0),r=!0}}}while(r);let p=u;if(t.lastIndex=0,!t.test(b(p++)))for(;p<d&&!t.test(b(p));)++p;const f=e.substring(u,u=p);return('"'===f||"'"===f)&&(g=f),f}function _(e){m.push(e)}function C(){if(!m.length){const e=E();if(null===e)return null;_(e)}return m[0]}function I(e,t){const r=C();if(r===e)return E(),!0;if(!t)throw y("token '"+r+"', '"+e+"' expected");return!1}function R(e){let t,r=null;return void 0===e?(t=f[h-1],delete f[h-1],t&&(l||"*"===t.type||t.lineEmpty)&&(r=t.leading?t.text:null)):(p<e&&C(),t=f[e],delete f[e],t&&!t.lineEmpty&&(l||"/"===t.type)&&(r=t.leading?null:t.text)),r}return Object.defineProperty({next:E,peek:C,push:_,skip:I,cmnt:R},"line",{get:function(){return h}})}d.unescape=c},81494:(e,t,r)=>{"use strict";e.exports=v;const n=r(27106);((v.prototype=Object.create(n.prototype)).constructor=v).className="Type";const i=r(79562),s=r(23264),a=r(7586),o=r(35103),l=r(90269),u=r(1433),c=r(97010),d=r(30609),h=r(42175),p=r(87981),f=r(48601),m=r(38841),g=r(5893),y=r(8366);function v(e,t){n.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function b(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(let e=Object.keys(this.fields),t=0;t<e.length;++t){const r=this.fields[e[t]],n=r.id;if(this._fieldsById[n])throw Error("duplicate id "+n+" in "+this);this._fieldsById[n]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=h.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=h.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){const t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,h.merge(e.prototype,t)),e.$type=e.prototype.$type=this,h.merge(e,u,!0),this._ctor=e;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();const n={};for(r=0;r<this.oneofsArray.length;++r)n[this._oneofsArray[r].resolve().name]={get:h.oneOfGetter(this._oneofsArray[r].oneof),set:h.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,n)}}}),v.generateConstructor=function(e){for(var t,r=h.codegen(["p"],e.name),n=0;n<e.fieldsArray.length;++n)(t=e._fieldsArray[n]).map?r("this%s={}",h.safeProp(t.name)):t.repeated&&r("this%s=[]",h.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){const r=new v(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var u=Object.keys(t.fields),c=0;c<u.length;++c)r.add((void 0!==t.fields[u[c]].keyType?o.fromJSON:a.fromJSON)(u[c],t.fields[u[c]]));if(t.oneofs)for(u=Object.keys(t.oneofs),c=0;c<u.length;++c)r.add(s.fromJSON(u[c],t.oneofs[u[c]]));if(t.nested)for(u=Object.keys(t.nested),c=0;c<u.length;++c){const d=t.nested[u[c]];r.add((void 0!==d.id?a.fromJSON:void 0!==d.fields?v.fromJSON:void 0!==d.values?i.fromJSON:void 0!==d.methods?l.fromJSON:n.fromJSON)(u[c],d))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},v.prototype.toJSON=function(e){const t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return h.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"oneofs",n.arrayToJSON(this.oneofsArray,e),"fields",n.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},v.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolveAll.call(this);const e=this.oneofsArray;for(r=0;r<e.length;)e[r++].resolve();for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();return this},v.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.oneofsArray.forEach(t=>{t._resolveFeatures(e)}),this.fieldsArray.forEach(t=>{t._resolveFeatures(e)})),this},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),b(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),b(this)):n.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),b(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),b(this)}return n.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return n.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return n.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=p(this)({Writer:d,types:t,util:h}),this.decode=f(this)({Reader:c,types:t,util:h}),this.verify=m(this)({types:t,util:h}),this.fromObject=g.fromObject(this)({types:t,util:h}),this.toObject=g.toObject(this)({types:t,util:h});const n=y[e];if(n){const i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=n.fromObject.bind(i),i.toObject=this.toObject,this.toObject=n.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof c||(e=c.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){h.decorateType(t,e)}}},39219:(e,t,r)=>{"use strict";const n=t,i=r(42175),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){let r=0,n={};for(t|=0;r<e.length;)n[s[r+t]]=e[r++];return n}n.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),n.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),n.long=a([0,0,0,1,1],7),n.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),n.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},42175:(e,t,r)=>{"use strict";let n,i,s=e.exports=r(92182),a=r(83722);s.codegen=r(96410),s.fetch=r(73368),s.path=r(14740),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),r=Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},s.toObject=function(e){for(var t={},r=0;r<e.length;){const n=e[r++],i=e[r++];void 0!==i&&(t[n]=i)}return t};const o=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(o,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};const u=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(s.decorateRoot.remove(e.$type),e.$type.name=t,s.decorateRoot.add(e.$type)),e.$type;n||(n=r(81494));const i=new n(t||e.name);return s.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};let c=0;s.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=r(79562));const t=new i("Enum"+c++,e);return s.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},s.setProperty=function(e,t,r,n){function i(e,t,r){const s=t.shift();if("__proto__"===s||"prototype"===s)return e;if(t.length>0)e[s]=i(e[s]||{},t,r);else{const a=e[s];if(a&&n)return e;a&&(r=[].concat(a).concat(r)),e[s]=r}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return i(e,t=t.split("."),r)},Object.defineProperty(s,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(r(89286)))}})},49918:(e,t,r)=>{"use strict";e.exports=i;const n=r(92182);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}const s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};const a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;const t=e<0;t&&(e=-e);let r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){let t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};const o=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?s:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){const e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},92182:function(e,t,r){"use strict";const n=t;function i(e,t,r){for(let n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function s(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&i(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=r(97063),n.base64=r(54253),n.EventEmitter=r(26127),n.float=r(63689),n.inquire=r(18047),n.utf8=r(95235),n.pool=r(89172),n.LongBits=r(49918),n.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),n.global=n.isNode&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){const r=e[t];return!!(null!=r&&e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{const e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){const r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(let e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(let r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){const e=n.Buffer;if(!e){n._Buffer_from=n._Buffer_allocUnsafe=null;return}n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},38841:(e,t,r)=>{"use strict";e.exports=l;const n=r(79562),i=r(42175);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,r,i){if(t.resolvedType){if(t.resolvedType instanceof n){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(let a=Object.keys(t.resolvedType.values),o=0;o<a.length;++o)e("case %i:",t.resolvedType.values[a[o]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,i)("if(e)")("return%j+e",t.name+".")("}")}else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function o(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",s(t,"boolean key"))}return e}function l(e){const t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r=e.oneofsArray,n={};r.length&&t("var p={}");for(let l=0;l<e.fieldsArray.length;++l){const u=e._fieldsArray[l].resolve(),c="m"+i.safeProp(u.name);if(u.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",c,u.name),u.map)t("if(!util.isObject(%s))",c)("return%j",s(u,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),o(t,u,"k[i]"),a(t,u,l,c+"[k[i]]")("}");else if(u.repeated)t("if(!Array.isArray(%s))",c)("return%j",s(u,"array"))("for(var i=0;i<%s.length;++i){",c),a(t,u,l,c+"[i]")("}");else{if(u.partOf){const d=i.safeProp(u.partOf.name);1===n[u.partOf.name]&&t("if(p%s===1)",d)("return%j",u.partOf.name+": multiple values"),n[u.partOf.name]=1,t("p%s=1",d)}a(t,u,l,c)}u.optional&&t("}")}return t("return null")}},8366:(e,t,r)=>{"use strict";const n=t,i=r(1433);n[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){const t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),r=this.lookup(t);if(r){let n="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return -1===n.indexOf("/")&&(n="/"+n),this.create({type_url:n,value:r.encode(r.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){let r="type.googleapis.com/",n="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),n=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);const a=this.lookup(s);a&&(e=a.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){const o=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName;return""===n&&(n=r),s=n+l,o["@type"]=s,o}return this.toObject(e,t)}}},30609:(e,t,r)=>{"use strict";e.exports=d;let n,i=r(92182),s=i.LongBits,a=i.base64,o=i.utf8;function l(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function d(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}const h=function(){return i.Buffer?function(){return(d.create=function(){return new n})()}:function(){return new d}};function p(e,t,r){t[r]=255&e}function f(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function m(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function y(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}d.create=h(),d.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(d.alloc=i.pool(d.alloc,i.Array.prototype.subarray)),d.prototype._push=function(e,t,r){return this.tail=this.tail.next=new l(e,t,r),this.len+=t,this},m.prototype=Object.create(l.prototype),m.prototype.fn=f,d.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new m((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},d.prototype.int32=function(e){return e<0?this._push(g,10,s.fromNumber(e)):this.uint32(e)},d.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},d.prototype.uint64=function(e){const t=s.from(e);return this._push(g,t.length(),t)},d.prototype.int64=d.prototype.uint64,d.prototype.sint64=function(e){const t=s.from(e).zzEncode();return this._push(g,t.length(),t)},d.prototype.bool=function(e){return this._push(p,1,e?1:0)},d.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},d.prototype.sfixed32=d.prototype.fixed32,d.prototype.fixed64=function(e){const t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},d.prototype.sfixed64=d.prototype.fixed64,d.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},d.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};const v=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(let n=0;n<e.length;++n)t[r+n]=e[n]};d.prototype.bytes=function(e){let t=e.length>>>0;if(!t)return this._push(p,1,0);if(i.isString(e)){const r=d.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(v,t,e)},d.prototype.string=function(e){const t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(p,1,0)},d.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},d.prototype.ldelim=function(){const e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},d.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},d._configure=function(e){n=e,d.create=h(),n._configure()}},64437:(e,t,r)=>{"use strict";e.exports=s;const n=r(30609);(s.prototype=Object.create(n.prototype)).constructor=s;const i=r(92182);function s(){n.call(this)}function a(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(let n=0;n<e.length;)t[r++]=e[n++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));const t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){const t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},s._configure()},20710:function(e,t){let r;!function(n,i){function s(e){return e.default||e}void 0!==(r=(function(){const e={};return i(e),s(e)}).apply(t,[]))&&(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;let t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function r(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function n(e){return!0===(e&&e.__isLong__)}function i(e){const t=Math.clz32(e&-e);return e?31-t:t}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=n;const s={},a={};function o(e,t){let r,n,i;return t?(e>>>=0,(i=0<=e&&e<256)&&(n=a[e]))?n:(r=u(e,0,!0),i&&(a[e]=r),r):(e|=0,(i=-128<=e&&e<128)&&(n=s[e]))?n:(r=u(e,e<0?-1:0,!1),i&&(s[e]=r),r)}function l(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=f)return E}else{if(e<=-m)return _;if(e+1>=m)return S}return e<0?l(-e,t).neg():u(e%p|0,e/p|0,t)}function u(e,t,n){return new r(e,t,n)}r.fromInt=o,r.fromNumber=l,r.fromBits=u;const c=Math.pow;function d(e,t,r){if(0===e.length)throw Error("empty string");if("number"==typeof t?(r=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:y;if((r=r||10)<2||36<r)throw RangeError("radix");if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return d(e.substring(1),t,r).neg();for(var n,i=l(c(r,8)),s=y,a=0;a<e.length;a+=8){const o=Math.min(8,e.length-a),u=parseInt(e.substring(a,a+o),r);if(o<8){const h=l(c(r,o));s=s.mul(h).add(l(u))}else s=(s=s.mul(i)).add(l(u))}return s.unsigned=t,s}function h(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?d(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=d,r.fromValue=h;var p=4294967296,f=18446744073709552e3,m=0x7fffffffffffffff,g=o(16777216),y=o(0);r.ZERO=y;var v=o(0,!0);r.UZERO=v;const b=o(1);r.ONE=b;const T=o(1,!0);r.UONE=T;const w=o(-1);r.NEG_ONE=w;var S=u(-1,2147483647,!1);r.MAX_VALUE=S;var E=u(-1,-1,!0);r.MAX_UNSIGNED_VALUE=E;var _=u(0,-2147483648,!1);r.MIN_VALUE=_;const C=r.prototype;C.toInt=function(){return this.unsigned?this.low>>>0:this.low},C.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},C.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(_))return"-"+this.neg().toString(e);const t=l(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}for(let i=l(c(e,6),this.unsigned),s=this,a="";;){let o=s.div(i),u=(s.sub(o.mul(i)).toInt()>>>0).toString(e);if((s=o).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},C.getHighBits=function(){return this.high},C.getHighBitsUnsigned=function(){return this.high>>>0},C.getLowBits=function(){return this.low},C.getLowBitsUnsigned=function(){return this.low>>>0},C.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},C.isSafeInteger=function(){const e=this.high>>21;return!e||!this.unsigned&&-1===e&&!(0===this.low&&-2097152===this.high)},C.isZero=function(){return 0===this.high&&0===this.low},C.eqz=C.isZero,C.isNegative=function(){return!this.unsigned&&this.high<0},C.isPositive=function(){return this.unsigned||this.high>=0},C.isOdd=function(){return(1&this.low)==1},C.isEven=function(){return(1&this.low)==0},C.equals=function(e){return n(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},C.eq=C.equals,C.notEquals=function(e){return!this.eq(e)},C.neq=C.notEquals,C.ne=C.notEquals,C.lessThan=function(e){return 0>this.comp(e)},C.lt=C.lessThan,C.lessThanOrEqual=function(e){return 0>=this.comp(e)},C.lte=C.lessThanOrEqual,C.le=C.lessThanOrEqual,C.greaterThan=function(e){return this.comp(e)>0},C.gt=C.greaterThan,C.greaterThanOrEqual=function(e){return this.comp(e)>=0},C.gte=C.greaterThanOrEqual,C.ge=C.greaterThanOrEqual,C.compare=function(e){if(n(e)||(e=h(e)),this.eq(e))return 0;const t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},C.comp=C.compare,C.negate=function(){return!this.unsigned&&this.eq(_)?_:this.not().add(b)},C.neg=C.negate,C.add=function(e){n(e)||(e=h(e));let t,r,i=this.high>>>16,s=65535&this.high,a=this.low>>>16,o=65535&this.low,l=e.high>>>16,c=65535&e.high,d=e.low>>>16,p=65535&e.low,f=0,m=0;return t=0+((r=0+(o+p))>>>16),r&=65535,t+=a+d,m+=t>>>16,t&=65535,m+=s+c,f+=m>>>16,m&=65535,f+=i+l,u(t<<16|r,(f&=65535)<<16|m,this.unsigned)},C.subtract=function(e){return n(e)||(e=h(e)),this.add(e.neg())},C.sub=C.subtract,C.multiply=function(e){if(this.isZero())return this;if(n(e)||(e=h(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:y;if(this.eq(_))return e.isOdd()?_:y;if(e.eq(_))return this.isOdd()?_:y;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);let r,i,s=this.high>>>16,a=65535&this.high,o=this.low>>>16,c=65535&this.low,d=e.high>>>16,p=65535&e.high,f=e.low>>>16,m=65535&e.low,b=0,T=0;return r=0+((i=0+c*m)>>>16),i&=65535,r+=o*m,T+=r>>>16,r&=65535,r+=c*f,T+=r>>>16,r&=65535,T+=a*m,b+=T>>>16,T&=65535,T+=o*f,b+=T>>>16,T&=65535,T+=c*p,b+=T>>>16,T&=65535,b+=s*m+a*f+o*p+c*d,u(r<<16|i,(b&=65535)<<16|T,this.unsigned)},C.mul=C.multiply,C.divide=function(e){if(n(e)||(e=h(e)),e.isZero())throw Error("division by zero");if(t){var r,i,s;return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return T;s=v}else{if(this.eq(_))return e.eq(b)||e.eq(w)?_:e.eq(_)?b:(r=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?b:w:(i=this.sub(e.mul(r)),s=r.add(i.div(e)));if(e.eq(_))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=y}for(i=this;i.gte(e);){for(var a=Math.ceil(Math.log(r=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),o=a<=48?1:c(2,a-48),d=l(r),p=d.mul(e);p.isNegative()||p.gt(i);)r-=o,p=(d=l(r,this.unsigned)).mul(e);d.isZero()&&(d=b),s=s.add(d),i=i.sub(p)}return s},C.div=C.divide,C.modulo=function(e){return(n(e)||(e=h(e)),t)?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},C.mod=C.modulo,C.rem=C.modulo,C.not=function(){return u(~this.low,~this.high,this.unsigned)},C.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},C.clz=C.countLeadingZeros,C.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},C.ctz=C.countTrailingZeros,C.and=function(e){return n(e)||(e=h(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},C.or=function(e){return n(e)||(e=h(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},C.xor=function(e){return n(e)||(e=h(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},C.shiftLeft=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},C.shl=C.shiftLeft,C.shiftRight=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},C.shr=C.shiftRight,C.shiftRightUnsigned=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?u(this.high,0,this.unsigned):u(this.high>>>e-32,0,this.unsigned)},C.shru=C.shiftRightUnsigned,C.shr_u=C.shiftRightUnsigned,C.rotateLeft=function(e){let t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,u(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},C.rotl=C.rotateLeft,C.rotateRight=function(e){let t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,u(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},C.rotr=C.rotateRight,C.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},C.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},C.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},C.toBytesLE=function(){const e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},C.toBytesBE=function(){const e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},"function"==typeof BigInt&&(r.fromBigInt=function(e,t){return u(Number(BigInt.asIntN(32,e)),Number(BigInt.asIntN(32,e>>BigInt(32))),t)},r.fromValue=function(e,t){return"bigint"==typeof e?r.fromBigInt(e,t):h(e,t)},C.toBigInt=function(){const e=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|e}),e.default=r})},28660:(e,t,r)=>{"use strict";let n,i;r.d(t,{Jn:()=>H,qX:()=>z,rh:()=>q,Xd:()=>V,Mq:()=>Q,ZF:()=>W,KN:()=>Y});const s=r(68702),a=r(78549),o=r(32181);const l=(e,t)=>t.some(t=>e instanceof t);function u(){return n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function c(){return i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const d=new WeakMap,h=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap;function g(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(S(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&d.set(t,e)}).catch(()=>{}),m.set(t,e),t}function y(e){if(h.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});h.set(e,t)}let v={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return h.get(e);if("objectStoreNames"===t)return e.objectStoreNames||p.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return S(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function b(e){v=e(v)}function T(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?c().includes(e)?function(...t){return e.apply(E(this),t),S(d.get(this))}:function(...t){return S(e.apply(E(this),t))}:function(t,...r){const n=e.call(E(this),t,...r);return p.set(n,t.sort?t.sort():[t]),S(n)}}function w(e){return"function"==typeof e?T(e):(e instanceof IDBTransaction&&y(e),l(e,u()))?new Proxy(e,v):e}function S(e){if(e instanceof IDBRequest)return g(e);if(f.has(e))return f.get(e);const t=w(e);return t!==e&&(f.set(e,t),m.set(t,e)),t}const E=e=>m.get(e);function _(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){const a=indexedDB.open(e,t),o=S(a);return n&&a.addEventListener("upgradeneeded",e=>{n(S(a.result),e.oldVersion,e.newVersion,S(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}const C=["get","getKey","getAll","getAllKeys","count"],I=["put","add","delete","clear"],R=new Map;function k(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(R.get(t))return R.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=I.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||C.includes(r)))return;const s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return R.set(t,s),s}b(e=>({...e,get:(t,r,n)=>k(t,r)||e.get(t,r,n),has:(t,r)=>!!k(t,r)||e.has(t,r)}));class A{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!N(e))return null;{const t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}function N(e){const t=e.getComponent();return t?.type==="VERSION"}const D="@firebase/app",O="0.14.2",x=new a.Yd("@firebase/app"),P="12.2.0",M="[DEFAULT]",L={[D]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},F=new Map,B=new Map,U=new Map;function j(e,t){try{e.container.addComponent(t)}catch(r){x.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function V(e){const t=e.name;if(U.has(t))return x.debug(`There were multiple attempts to register component ${t}.`),!1;for(const r of(U.set(t,e),F.values()))j(r,e);for(const t of B.values())j(t,e);return!0}function z(e,t){const r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function q(e){return null!=e&&void 0!==e.settings}const $={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},G=new o.LL("app","Firebase",$);class K{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new s.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw G.create("app-deleted",{appName:this._name})}}const H=P;function W(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});const n={name:M,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw G.create("bad-app-name",{appName:String(i)});if(r||(r=(0,o.aH)()),!r)throw G.create("no-options");const a=F.get(i);if(a){if((0,o.vZ)(r,a.options)&&(0,o.vZ)(n,a.config))return a;throw G.create("duplicate-app",{appName:i})}const l=new s.H0(i);for(const e of U.values())l.addComponent(e);const u=new K(r,n,l);return F.set(i,u),u}function Q(e=M){const t=F.get(e);if(!t&&e===M&&(0,o.aH)())return W();if(!t)throw G.create("no-app",{appName:e});return t}function Y(e,t,r){let n=L[e]??e;r&&(n+=`-${r}`);const i=n.match(/\s|\//),a=t.match(/\s|\//);if(i||a){const e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),x.warn(e.join(" "));return}V(new s.wA(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}let J="firebase-heartbeat-database",X=1,Z="firebase-heartbeat-store",ee=null;function et(){return ee||(ee=_(J,X,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Z)}catch(e){console.warn(e)}}}).catch(e=>{throw G.create("idb-open",{originalErrorMessage:e.message})})),ee}async function er(e){try{const t=(await et()).transaction(Z),r=await t.objectStore(Z).get(ei(e));return await t.done,r}catch(e){if(e instanceof o.ZR)x.warn(e.message);else{const t=G.create("idb-get",{originalErrorMessage:e?.message});x.warn(t.message)}}}async function en(e,t){try{const r=(await et()).transaction(Z,"readwrite"),n=r.objectStore(Z);await n.put(t,ei(e)),await r.done}catch(e){if(e instanceof o.ZR)x.warn(e.message);else{const t=G.create("idb-set",{originalErrorMessage:e?.message});x.warn(t.message)}}}function ei(e){return`${e.name}!${e.options.appId}`}const es=1024,ea=30;class eo{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ec(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=el();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>ea){const e=eh(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){x.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";const e=el(),{heartbeatsToSend:t,unsentEntries:r}=eu(this._heartbeatsCache.heartbeats),n=(0,o.L)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return x.warn(e),""}}}function el(){return new Date().toISOString().substring(0,10)}function eu(e,t=es){let r=[],n=e.slice();for(const i of e){const e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),ed(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),ed(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class ec{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,o.hl)()&&(0,o.eu)().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{const e=await er(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return en(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return en(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function ed(e){return(0,o.L)(JSON.stringify({version:2,heartbeats:e})).length}function eh(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(function(e){V(new s.wA("platform-logger",e=>new A(e),"PRIVATE")),V(new s.wA("heartbeat",e=>new eo(e),"PRIVATE")),Y(D,O,""),Y(D,O,"esm2020"),Y("fire-js","")})(0)},68702:(e,t,r)=>{"use strict";r.d(t,{H0:()=>u,wA:()=>i});const n=r(32181);class i{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const s="[DEFAULT]";class a{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new n.BH;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(l(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);const i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:o(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function o(e){return e===s?void 0:e}function l(e){return"EAGER"===e.instantiationMode}class u{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},53062:(e,t,r)=>{"use strict";let n,i;const s=r(28660),a=r(68702),o=r(32181);const l=(e,t)=>t.some(t=>e instanceof t);function u(){return n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function c(){return i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const d=new WeakMap,h=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap;function g(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(S(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&d.set(t,e)}).catch(()=>{}),m.set(t,e),t}function y(e){if(h.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});h.set(e,t)}let v={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return h.get(e);if("objectStoreNames"===t)return e.objectStoreNames||p.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return S(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function b(e){v=e(v)}function T(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?c().includes(e)?function(...t){return e.apply(E(this),t),S(d.get(this))}:function(...t){return S(e.apply(E(this),t))}:function(t,...r){const n=e.call(E(this),t,...r);return p.set(n,t.sort?t.sort():[t]),S(n)}}function w(e){return"function"==typeof e?T(e):(e instanceof IDBTransaction&&y(e),l(e,u()))?new Proxy(e,v):e}function S(e){if(e instanceof IDBRequest)return g(e);if(f.has(e))return f.get(e);const t=w(e);return t!==e&&(f.set(e,t),m.set(t,e)),t}const E=e=>m.get(e);function _(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){const a=indexedDB.open(e,t),o=S(a);return n&&a.addEventListener("upgradeneeded",e=>{n(S(a.result),e.oldVersion,e.newVersion,S(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}const C=["get","getKey","getAll","getAllKeys","count"],I=["put","add","delete","clear"],R=new Map;function k(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(R.get(t))return R.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=I.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||C.includes(r)))return;const s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return R.set(t,s),s}b(e=>({...e,get:(t,r,n)=>k(t,r)||e.get(t,r,n),has:(t,r)=>!!k(t,r)||e.has(t,r)}));const A="@firebase/installations",N="0.6.19",D=1e4,O=`w:${N}`,x="FIS_v2",P="https://firebaseinstallations.googleapis.com/v1",M=36e5,L="installations",F="Installations",B={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},U=new o.LL(L,F,B);function j(e){return e instanceof o.ZR&&e.code.includes("request-failed")}function V({projectId:e}){return`${P}/projects/${e}/installations`}function z(e){return{token:e.token,requestStatus:2,expiresIn:H(e.expiresIn),creationTime:Date.now()}}async function q(e,t){const r=(await t.json()).error;return U.create("request-failed",{requestName:e,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function $({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function G(e,{refreshToken:t}){const r=$(e);return r.append("Authorization",W(t)),r}async function K(e){const t=await e();return t.status>=500&&t.status<600?e():t}function H(e){return Number(e.replace("s","000"))}function W(e){return`${x} ${e}`}async function Q({appConfig:e,heartbeatServiceProvider:t},{fid:r}){const n=V(e),i=$(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const a={method:"POST",headers:i,body:JSON.stringify({fid:r,authVersion:x,appId:e.appId,sdkVersion:O})},o=await K(()=>fetch(n,a));if(o.ok){const e=await o.json();return{fid:e.fid||r,registrationStatus:2,refreshToken:e.refreshToken,authToken:z(e.authToken)}}throw await q("Create Installation",o)}function Y(e){return new Promise(t=>{setTimeout(t,e)})}function J(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")}const X=/^[cdef][\w-]{21}$/,Z="";function ee(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=et(e);return X.test(t)?t:Z}catch{return Z}}function et(e){return J(e).substr(0,22)}function er(e){return`${e.appName}!${e.appId}`}const en=new Map;function ei(e,t){const r=er(e);es(r,t),ea(r,t)}function es(e,t){const r=en.get(e);if(r)for(const e of r)e(t)}function ea(e,t){const r=el();r&&r.postMessage({key:e,fid:t}),eu()}let eo=null;function el(){return!eo&&"BroadcastChannel"in self&&((eo=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{es(e.data.key,e.data.fid)}),eo}function eu(){0===en.size&&eo&&(eo.close(),eo=null)}let ec="firebase-installations-database",ed=1,eh="firebase-installations-store",ep=null;function ef(){return ep||(ep=_(ec,ed,{upgrade:(e,t)=>{0===t&&e.createObjectStore(eh)}})),ep}async function em(e,t){const r=er(e),n=(await ef()).transaction(eh,"readwrite"),i=n.objectStore(eh),s=await i.get(r);return await i.put(t,r),await n.done,s&&s.fid===t.fid||ei(e,t.fid),t}async function eg(e){const t=er(e),r=(await ef()).transaction(eh,"readwrite");await r.objectStore(eh).delete(t),await r.done}async function ey(e,t){const r=er(e),n=(await ef()).transaction(eh,"readwrite"),i=n.objectStore(eh),s=await i.get(r),a=t(s);return void 0===a?await i.delete(r):await i.put(a,r),await n.done,a&&(!s||s.fid!==a.fid)&&ei(e,a.fid),a}async function ev(e){let t;const r=await ey(e.appConfig,r=>{const n=eT(e,eb(r));return t=n.registrationPromise,n.installationEntry});return r.fid===Z?{installationEntry:await t}:{installationEntry:r,registrationPromise:t}}function eb(e){return e_(e||{fid:ee(),registrationStatus:0})}function eT(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(U.create("app-offline"))};const r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=ew(e,r);return{installationEntry:r,registrationPromise:n}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:eS(e)}:{installationEntry:t}}async function ew(e,t){try{const r=await Q(e,t);return em(e.appConfig,r)}catch(r){throw j(r)&&409===r.customData.serverCode?await eg(e.appConfig):await em(e.appConfig,{fid:t.fid,registrationStatus:0}),r}}async function eS(e){let t=await eE(e.appConfig);for(;1===t.registrationStatus;)await Y(100),t=await eE(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:r}=await ev(e);return r||t}return t}function eE(e){return ey(e,e=>{if(!e)throw U.create("installation-not-found");return e_(e)})}function e_(e){return eC(e)?{fid:e.fid,registrationStatus:0}:e}function eC(e){return 1===e.registrationStatus&&e.registrationTime+D<Date.now()}async function eI({appConfig:e,heartbeatServiceProvider:t},r){const n=eR(e,r),i=G(e,r),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const a={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:O,appId:e.appId}})},o=await K(()=>fetch(n,a));if(o.ok)return z(await o.json());throw await q("Generate Auth Token",o)}function eR(e,{fid:t}){return`${V(e)}/${t}/authTokens:generate`}async function ek(e,t=!1){let r;const n=await ey(e.appConfig,n=>{if(!eO(n))throw U.create("not-registered");const i=n.authToken;if(!t&&ex(i))return n;if(1===i.requestStatus)return r=eA(e,t),n;{if(!navigator.onLine)throw U.create("app-offline");const t=eM(n);return r=eD(e,t),t}});return r?await r:n.authToken}async function eA(e,t){let r=await eN(e.appConfig);for(;1===r.authToken.requestStatus;)await Y(100),r=await eN(e.appConfig);const n=r.authToken;return 0===n.requestStatus?ek(e,t):n}function eN(e){return ey(e,e=>{if(!eO(e))throw U.create("not-registered");return eL(e.authToken)?{...e,authToken:{requestStatus:0}}:e})}async function eD(e,t){try{const r=await eI(e,t),n={...t,authToken:r};return await em(e.appConfig,n),r}catch(r){if(j(r)&&(401===r.customData.serverCode||404===r.customData.serverCode))await eg(e.appConfig);else{const r={...t,authToken:{requestStatus:0}};await em(e.appConfig,r)}throw r}}function eO(e){return void 0!==e&&2===e.registrationStatus}function ex(e){return 2===e.requestStatus&&!eP(e)}function eP(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+M}function eM(e){const t={requestStatus:1,requestTime:Date.now()};return{...e,authToken:t}}function eL(e){return 1===e.requestStatus&&e.requestTime+D<Date.now()}async function eF(e){const t=e,{installationEntry:r,registrationPromise:n}=await ev(t);return n?n.catch(console.error):ek(t).catch(console.error),r.fid}async function eB(e,t=!1){const r=e;return await eU(r),(await ek(r,t)).token}async function eU(e){const{registrationPromise:t}=await ev(e);t&&await t}function ej(e){if(!e||!e.options)throw eV("App Configuration");if(!e.name)throw eV("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw eV(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}function eV(e){return U.create("missing-app-config-values",{valueName:e})}const ez="installations",eq="installations-internal",e$=e=>{const t=e.getProvider("app").getImmediate(),r=ej(t),n=(0,s.qX)(t,"heartbeat");return{app:t,appConfig:r,heartbeatServiceProvider:n,_delete:()=>Promise.resolve()}},eG=e=>{const t=e.getProvider("app").getImmediate(),r=(0,s.qX)(t,ez).getImmediate();return{getId:()=>eF(r),getToken:e=>eB(r,e)}};(function(){(0,s.Xd)(new a.wA(ez,e$,"PUBLIC")),(0,s.Xd)(new a.wA(eq,eG,"PRIVATE"))})(),(0,s.KN)(A,N),(0,s.KN)(A,N,"esm2020")},78549:(e,t,r)=>{"use strict";let n;r.d(t,{Yd:()=>u,in:()=>n});const i=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(n||(n={}));const s={debug:n.DEBUG,verbose:n.VERBOSE,info:n.INFO,warn:n.WARN,error:n.ERROR,silent:n.SILENT},a=n.INFO,o={[n.DEBUG]:"log",[n.VERBOSE]:"log",[n.INFO]:"info",[n.WARN]:"warn",[n.ERROR]:"error"},l=(e,t,...r)=>{if(t<e.logLevel)return;const n=new Date().toISOString(),i=o[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class u{constructor(e){this.name=e,this._logLevel=a,this._logHandler=l,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in n))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,n.DEBUG,...e),this._logHandler(this,n.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,n.VERBOSE,...e),this._logHandler(this,n.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,n.INFO,...e),this._logHandler(this,n.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,n.WARN,...e),this._logHandler(this,n.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,n.ERROR,...e),this._logHandler(this,n.ERROR,...e)}}},32181:(e,t,r)=>{"use strict";r.d(t,{BH:()=>T,LL:()=>z,ZR:()=>V,zI:()=>U,tV:()=>d,L:()=>c,$s:()=>ei,Sg:()=>E,ne:()=>Y,vZ:()=>G,pd:()=>Q,aH:()=>b,q4:()=>y,P0:()=>v,Rd:()=>h,m9:()=>es,z$:()=>A,ru:()=>x,Xx:()=>w,L_:()=>O,hl:()=>F,uI:()=>N,b$:()=>P,G6:()=>M,WO:()=>L,Uo:()=>S,xO:()=>H,zd:()=>W,dp:()=>k,eu:()=>B});const n=()=>void 0,i={NODE_CLIENT:!1},s=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},a=function(e){let t=[],r=0,n=0;for(;r<e.length;){const i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{const s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,c=(3&i)<<4|a>>4,d=(15&a)<<2|l>>6,h=63&l;o||(h=64,s||(d=64)),n.push(r[u],r[c],r[d],r[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):a(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){const i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new l;const u=i<<2|s>>4;if(n.push(u),64!==a){const e=s<<4&240|a>>2;if(n.push(e),64!==o){const e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const u=function(e){const t=s(e);return o.encodeByteArray(t,!0)},c=function(e){return u(e).replace(/\./g,"")},d=function(e){try{return o.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function h(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")}const p=()=>h().__FIREBASE_DEFAULTS__,f=()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},m=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&d(e[1]);return t&&JSON.parse(t)},g=()=>{try{return n()||p()||f()||m()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},y=e=>g()?.emulatorHosts?.[e],v=e=>{const t=y(e);if(!t)return;const r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},b=()=>g()?.config;class T{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function w(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function S(e){return(await fetch(e,{credentials:"include"})).ok}function E(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...e},o="";return[c(JSON.stringify(r)),c(JSON.stringify(a)),o].join(".")}const _={};function C(){const e={prod:[],emulator:[]};for(const t of Object.keys(_))_[t]?e.emulator.push(t):e.prod.push(t);return e}function I(e){let t=document.getElementById(e),r=!1;return t||((t=document.createElement("div")).setAttribute("id",e),r=!0),{created:r,element:t}}let R=!1;function k(e,t){if("undefined"==typeof window||"undefined"==typeof document||!w(window.location.host)||_[e]===t||_[e]||R)return;function r(e){return`__firebase__banner__${e}`}_[e]=t;const n="__firebase__banner",i=C().prod.length>0;function s(){const e=document.getElementById(n);e&&e.remove()}function a(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}function o(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}function l(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{R=!0,s()},e}function u(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}function c(){const e=I(n),t=r("text"),s=document.getElementById(t)||document.createElement("span"),c=r("learnmore"),d=document.getElementById(c)||document.createElement("a"),h=r("preprendIcon"),p=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;a(t),u(d,c);const r=l();o(p,h),t.append(p,s,d,r),document.body.appendChild(t)}i?(s.innerText="Preview backend disconnected.",p.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(p.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,s.innerText="Preview backend running in this workspace."),s.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",c):c()}function A(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function N(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(A())}function D(){const e=g()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function O(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function x(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function P(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function M(){return!D()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function L(){return!D()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function F(){try{return"object"==typeof indexedDB}catch(e){return!1}}function B(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}})}function U(){return"undefined"!=typeof navigator&&!!navigator.cookieEnabled}const j="FirebaseError";class V extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=j,Object.setPrototypeOf(this,V.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,z.prototype.create)}}class z{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?q(i,r):"Error",a=`${this.serviceName}: ${s} (${n}).`;return new V(n,a,r)}}function q(e,t){return e.replace($,(e,r)=>{const n=t[r];return null!=n?String(n):`<${r}?>`})}const $=/\{\$([^}]+)}/g;function G(e,t){if(e===t)return!0;const r=Object.keys(e),n=Object.keys(t);for(const i of r){if(!n.includes(i))return!1;const r=e[i],s=t[i];if(K(r)&&K(s)){if(!G(r,s))return!1}else if(r!==s)return!1}for(const e of n)if(!r.includes(e))return!1;return!0}function K(e){return null!==e&&"object"==typeof e}function H(e){const t=[];for(const[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function W(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function Q(e){const t=e.indexOf("?");if(!t)return"";const r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function Y(e,t){const r=new J(e,t);return r.subscribe.bind(r)}class J{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=X(e,["next","error","complete"])?e:{next:e,error:t,complete:r}).next&&(n.next=Z),void 0===n.error&&(n.error=Z),void 0===n.complete&&(n.complete=Z);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function X(e,t){if("object"!=typeof e||null===e)return!1;for(const r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}function Z(){}const ee=1e3,et=2,er=144e5,en=.5;function ei(e,t=ee,r=et){const n=t*Math.pow(r,e),i=Math.round(en*n*(Math.random()-.5)*2);return Math.min(er,n+i)}function es(e){return e&&e._delegate?e._delegate:e}i.NODE_CLIENT=!0},21699:(e,t,r)=>{"use strict";let n,i,s,a;const o=r(28660),l=r(78549),u=r(32181),c=r(68702);r(53062);const d="analytics",h="firebase_id",p="origin",f=6e4,m="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",g="https://www.googletagmanager.com/gtag/js",y=new l.Yd("@firebase/analytics"),v={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},b=new u.LL("analytics","Analytics",v);function T(e){if(!e.startsWith(g)){const t=b.create("invalid-gtag-resource",{gtagURL:e});return y.warn(t.message),""}return e}function w(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function S(e,t){let r;return window.trustedTypes&&(r=window.trustedTypes.createPolicy(e,t)),r}function E(e,t){const r=S("firebase-js-sdk-policy",{createScriptURL:T}),n=document.createElement("script"),i=`${g}?l=${e}&id=${t}`;n.src=r?r?.createScriptURL(i):i,n.async=!0,document.head.appendChild(n)}function _(e){let t=[];return Array.isArray(window[e])?t=window[e]:window[e]=t,t}async function C(e,t,r,n,i,s){const a=n[i];try{if(a)await t[a];else{const e=(await w(r)).find(e=>e.measurementId===i);e&&await t[e.appId]}}catch(e){y.error(e)}e("config",i,s)}async function I(e,t,r,n,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const n=await w(r);for(const r of e){const e=n.find(e=>e.measurementId===r),i=e&&t[e.appId];if(i)s.push(i);else{s=[];break}}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",n,i||{})}catch(e){y.error(e)}}function R(e,t,r,n){return async function(i,...s){try{if("event"===i){const[n,i]=s;await I(e,t,r,n,i)}else if("config"===i){const[i,a]=s;await C(e,t,r,n,i,a)}else if("consent"===i){const[t,r]=s;e("consent",t,r)}else if("get"===i){const[t,r,n]=s;e("get",t,r,n)}else if("set"===i){const[t]=s;e("set",t)}else e(i,...s)}catch(e){y.error(e)}}}function k(e,t,r,n,i){let s=function(...e){window[n].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=R(s,e,t,r),{gtagCore:s,wrappedGtag:window[i]}}function A(e){for(const t of Object.values(window.document.getElementsByTagName("script")))if(t.src&&t.src.includes(g)&&t.src.includes(e))return t;return null}const N=30,D=1e3;class O{constructor(e={},t=D){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const x=new O;function P(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function M(e){let{appId:t,apiKey:r}=e,n={method:"GET",headers:P(r)},i=m.replace("{app-id}",t),s=await fetch(i,n);if(200!==s.status&&304!==s.status){let e="";try{const t=await s.json();t.error?.message&&(e=t.error.message)}catch(e){}throw b.create("config-fetch-failed",{httpStatus:s.status,responseMessage:e})}return s.json()}async function L(e,t=x,r){const{appId:n,apiKey:i,measurementId:s}=e.options;if(!n)throw b.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:n};throw b.create("no-api-key")}const a=t.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new j;return setTimeout(async()=>{o.abort()},void 0!==r?r:f),F({appId:n,apiKey:i,measurementId:s},a,o,t)}async function F(e,{throttleEndTimeMillis:t,backoffCount:r},n,i=x){const{appId:s,measurementId:a}=e;try{await B(n,t)}catch(e){if(a)return y.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${e?.message}]`),{appId:s,measurementId:a};throw e}try{const t=await M(e);return i.deleteThrottleMetadata(s),t}catch(c){const t=c;if(!U(t)){if(i.deleteThrottleMetadata(s),a)return y.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${t?.message}]`),{appId:s,measurementId:a};throw c}const o=503===Number(t?.customData?.httpStatus)?(0,u.$s)(r,i.intervalMillis,N):(0,u.$s)(r,i.intervalMillis),l={throttleEndTimeMillis:Date.now()+o,backoffCount:r+1};return i.setThrottleMetadata(s,l),y.debug(`Calling attemptFetch again in ${o} millis`),F(e,l,n,i)}}function B(e,t){return new Promise((r,n)=>{const i=setTimeout(r,Math.max(t-Date.now(),0));e.addEventListener(()=>{clearTimeout(i),n(b.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function U(e){if(!(e instanceof u.ZR)||!e.customData)return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class j{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function V(e,t,r,n,i){if(i&&i.global){e("event",r,n);return}{const i=await t;e("event",r,{...n,send_to:i})}}function z(e){i=e}function q(e){n=e}async function $(){if(!(0,u.hl)())return y.warn(b.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await (0,u.eu)()}catch(e){return y.warn(b.create("indexeddb-unavailable",{errorInfo:e?.toString()}).message),!1}return!0}async function G(e,t,r,s,a,o,l){const u=L(e);u.then(t=>{r[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&y.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>y.error(e)),t.push(u);const c=$().then(e=>e?s.getId():void 0),[d,f]=await Promise.all([u,c]);A(o)||E(o,d.measurementId),i&&(a("consent","default",i),z(void 0)),a("js",new Date);const m=l?.config??{};return m[p]="firebase",m.update=!0,null!=f&&(m[h]=f),a("config",d.measurementId,m),n&&(a("set",n),q(void 0)),d.measurementId}class K{constructor(e){this.app=e}_delete(){return delete H[this.app.options.appId],Promise.resolve()}}let H={},W=[],Q={},Y="dataLayer",J="gtag",X=!1;function Z(){const e=[];if((0,u.ru)()&&e.push("This is a browser extension environment."),(0,u.zI)()||e.push("Cookies are not available."),e.length>0){const t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),r=b.create("invalid-analytics-context",{errorInfo:t});y.warn(r.message)}}function ee(e,t,r){Z();const n=e.options.appId;if(!n)throw b.create("no-app-id");if(!e.options.apiKey){if(e.options.measurementId)y.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw b.create("no-api-key")}if(null!=H[n])throw b.create("already-exists",{id:n});if(!X){_(Y);const{wrappedGtag:e,gtagCore:t}=k(H,W,Q,Y,J);a=e,s=t,X=!0}return H[n]=G(e,W,Q,t,s,Y,r),new K(e)}function et(e,t,r,n){e=(0,u.m9)(e),V(a,H[e.app.options.appId],t,r,n).catch(e=>y.error(e))}const er="@firebase/analytics",en="0.10.18";(function(){function e(e){try{const t=e.getProvider(d).getImmediate();return{logEvent:(e,r,n)=>et(t,e,r,n)}}catch(e){throw b.create("interop-component-reg-failed",{reason:e})}}(0,o.Xd)(new c.wA(d,(e,{options:t})=>ee(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),(0,o.Xd)(new c.wA("analytics-internal",e,"PRIVATE")),(0,o.KN)(er,en),(0,o.KN)(er,en,"esm2020")})()},58221:(e,t,r)=>{"use strict";r.d(t,{ZF:()=>n.ZF});var n=r(28660),i="firebase",s="12.2.1";(0,n.KN)(i,s,"app")},46696:(e,t,r)=>{"use strict";r.d(t,{v0:()=>tS});const n=r(28660),i=r(32181),s=r(68702),a=r(78549);function o(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const l=o,u=new i.LL("auth","Firebase",o()),c=new a.Yd("@firebase/auth");function d(e,...t){c.logLevel<=a.in.WARN&&c.warn(`Auth (${n.Jn}): ${e}`,...t)}function h(e,...t){c.logLevel<=a.in.ERROR&&c.error(`Auth (${n.Jn}): ${e}`,...t)}function p(e,...t){throw y(e,...t)}function f(e,...t){return y(e,...t)}function m(e,t,r){const n={...l(),[t]:r};return new i.LL("auth","Firebase",n).create(t,{appName:e.name})}function g(e){return m(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function y(e,...t){if("string"!=typeof e){const r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return u.create(e,...t)}function v(e,t,...r){if(!e)throw y(t,...r)}function b(e){const t="INTERNAL ASSERTION FAILED: "+e;throw h(t),Error(t)}function T(e,t){e||b(t)}function w(){return"http:"===S()||"https:"===S()}function S(){return"undefined"!=typeof self&&self.location?.protocol||null}function E(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(w()||(0,i.ru)()||"connection"in navigator))||navigator.onLine}function _(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}class C{constructor(e,t){this.shortDelay=e,this.longDelay=t,T(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.uI)()||(0,i.b$)()}get(){return E()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function I(e,t){T(e.emulator,"Emulator should always be set here");const{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class R{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void b("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void b("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void b("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const k={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},A=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],N=new C(3e4,6e4);function D(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function O(e,t,r,n,s={}){return x(e,s,async()=>{let s={},a={};n&&("GET"===t?a=n:s={body:JSON.stringify(n)});const o=(0,i.xO)({key:e.config.apiKey,...a}).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);const u={method:t,headers:l,...s};return(0,i.L_)()||(u.referrerPolicy="no-referrer"),e.emulatorConfig&&(0,i.Xx)(e.emulatorConfig.host)&&(u.credentials="include"),R.fetch()(await M(e,e.config.apiHost,r,o),u)})}async function x(e,t,r){e._canInitEmulator=!1;const n={...k,...t};try{const t=new F(e),i=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw B(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const[t,r]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw B(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw B(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw B(e,"user-disabled",s);const a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw m(e,a,r);p(e,a)}}catch(t){if(t instanceof i.ZR)throw t;p(e,"network-request-failed",{message:String(t)})}}async function P(e,t,r,n,i={}){const s=await O(e,t,r,n,i);return"mfaPendingCredential"in s&&p(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function M(e,t,r,n){const i=`${t}${r}?${n}`,s=e,a=s.config.emulator?I(e.config,i):`${e.config.apiScheme}://${i}`;return A.includes(r)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())?s._getPersistence()._getFinalTarget(a).toString():a}function L(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class F{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(f(this.auth,"network-request-failed")),N.get())})}}function B(e,t,r){const n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);const i=f(e,t,n);return i.customData._tokenResponse=r,i}function U(e){return void 0!==e&&void 0!==e.enterprise}class j{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return L(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function V(e,t){return O(e,"GET","/v2/recaptchaConfig",D(e,t))}async function z(e,t){return O(e,"POST","/v1/accounts:delete",t)}async function q(e,t){return O(e,"POST","/v1/accounts:lookup",t)}function $(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function G(e,t=!1){const r=(0,i.m9)(e),n=await r.getIdToken(t),s=H(n);v(s&&s.exp&&s.auth_time&&s.iat,r.auth,"internal-error");const a="object"==typeof s.firebase?s.firebase:void 0,o=a?.sign_in_provider;return{claims:s,token:n,authTime:$(K(s.auth_time)),issuedAtTime:$(K(s.iat)),expirationTime:$(K(s.exp)),signInProvider:o||null,signInSecondFactor:a?.sign_in_second_factor||null}}function K(e){return 1e3*Number(e)}function H(e){const[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return h("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,i.tV)(r);if(!e)return h("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return h("Caught error parsing JWT payload as JSON",e?.toString()),null}}function W(e){const t=H(e);return v(t,"internal-error"),v(void 0!==t.exp,"internal-error"),v(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Q(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof i.ZR&&Y(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}function Y({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class J{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class X{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=$(this.lastLoginAt),this.creationTime=$(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Z(e){const t=e.auth,r=await e.getIdToken(),n=await Q(e,q(t,{idToken:r}));v(n?.users.length,t,"internal-error");const i=n.users[0];e._notifyReloadListener(i);const s=i.providerUserInfo?.length?er(i.providerUserInfo):[],a=et(e.providerData,s),o=e.isAnonymous,l=!(e.email&&i.passwordHash)&&!a?.length,u=!!o&&l;Object.assign(e,{uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new X(i.createdAt,i.lastLoginAt),isAnonymous:u})}async function ee(e){const t=(0,i.m9)(e);await Z(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function et(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function er(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function en(e,t){const r=await x(e,{},async()=>{const r=(0,i.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:s}=e.config,a=await M(e,n,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:r};return e.emulatorConfig&&(0,i.Xx)(e.emulatorConfig.host)&&(l.credentials="include"),R.fetch()(a,l)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function ei(e,t){return O(e,"POST","/v2/accounts:revokeToken",D(e,t))}class es{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){v(e.idToken,"internal-error"),v(void 0!==e.idToken,"internal-error"),v(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):W(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){v(0!==e.length,"internal-error");const t=W(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(v(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:n,expiresIn:i}=await en(e,t);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new es;return r&&(v("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(v("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(v("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new es,this.toJSON())}_performRefresh(){return b("not implemented")}}function ea(e,t){v("string"==typeof e||void 0===e,"internal-error",{appName:t})}class eo{constructor({uid:e,auth:t,stsTokenManager:r,...n}){this.providerId="firebase",this.proactiveRefresh=new J(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new X(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(e){const t=await Q(this,this.stsTokenManager.getToken(this.auth,e));return v(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return G(this,e)}reload(){return ee(this)}_assign(e){this!==e&&(v(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new eo({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){v(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Z(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,n.rh)(this.auth.app))return Promise.reject(g(this.auth));const e=await this.getIdToken();return await Q(this,z(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,n=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,l=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:c,emailVerified:d,isAnonymous:h,providerData:p,stsTokenManager:f}=t;v(c&&f,e,"internal-error");const m=es.fromJSON(this.name,f);v("string"==typeof c,e,"internal-error"),ea(r,e.name),ea(n,e.name),v("boolean"==typeof d,e,"internal-error"),v("boolean"==typeof h,e,"internal-error"),ea(i,e.name),ea(s,e.name),ea(a,e.name),ea(o,e.name),ea(l,e.name),ea(u,e.name);const g=new eo({uid:c,auth:e,email:n,emailVerified:d,displayName:r,isAnonymous:h,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:m,createdAt:l,lastLoginAt:u});return p&&Array.isArray(p)&&(g.providerData=p.map(e=>({...e}))),o&&(g._redirectEventId=o),g}static async _fromIdTokenResponse(e,t,r=!1){const n=new es;n.updateFromServerResponse(t);const i=new eo({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await Z(i),i}static async _fromGetAccountInfoResponse(e,t,r){const n=t.users[0];v(void 0!==n.localId,"internal-error");const i=void 0!==n.providerUserInfo?er(n.providerUserInfo):[],s=!(n.email&&n.passwordHash)&&!i?.length,a=new es;a.updateFromIdToken(r);const o=new eo({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new X(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!i?.length}),o}}const el=new Map;function eu(e){T(e instanceof Function,"Expected a class definition");let t=el.get(e);return t?T(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,el.set(e,t)),t}class ec{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ec.type="NONE";const ed=ec;function eh(e,t,r){return`firebase:${e}:${t}:${r}`}class ep{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:n,name:i}=this.auth;this.fullUserKey=eh(this.userKey,n.apiKey,i),this.fullPersistenceKey=eh("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await q(this.auth,{idToken:e}).catch(()=>void 0);return t?eo._fromGetAccountInfoResponse(this.auth,t,e):null}return eo._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new ep(eu(ed),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=n[0]||eu(ed),s=eh(r,e.config.apiKey,e.name),a=null;for(const r of t)try{const t=await r._get(s);if(t){let n;if("string"==typeof t){const r=await q(e,{idToken:t}).catch(()=>void 0);if(!r)break;n=await eo._fromGetAccountInfoResponse(e,r,t)}else n=eo._fromJSON(e,t);r!==i&&(a=n),i=r;break}}catch{}const o=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}}))),new ep(i,e,r)}}function ef(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ev(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";{if(t.includes("edge/"))return"Edge";if(em(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(eT(t))return"Blackberry";if(ew(t))return"Webos";if(eg(t))return"Safari";if((t.includes("chrome/")||ey(t))&&!t.includes("edge/"))return"Chrome";if(eb(t))return"Android";const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(r);if(n?.length===2)return n[1]}return"Other"}function em(e=(0,i.z$)()){return/firefox\//i.test(e)}function eg(e=(0,i.z$)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ey(e=(0,i.z$)()){return/crios\//i.test(e)}function ev(e=(0,i.z$)()){return/iemobile/i.test(e)}function eb(e=(0,i.z$)()){return/android/i.test(e)}function eT(e=(0,i.z$)()){return/blackberry/i.test(e)}function ew(e=(0,i.z$)()){return/webos/i.test(e)}function eS(e,t=[]){let r;switch(e){case"Browser":r=ef((0,i.z$)());break;case"Worker":r=`${ef((0,i.z$)())}-${e}`;break;default:r=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${n.Jn}/${s}`}class eE{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=t=>new Promise((r,n)=>{try{const n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(const e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function e_(e,t={}){return O(e,"GET","/v2/passwordPolicy",D(e,t))}const eC=6;class eI{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??eC,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class eR{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new eA(this),this.idTokenSubscription=new eA(this),this.beforeStateQueue=new eE(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=u,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=eu(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await ep.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await q(this,{idToken:e}),r=await eo._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if((0,n.rh)(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const t=this.redirectUser?._redirectEventId,n=r?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===n)&&s?.user&&(r=s.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(v(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Z(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=_()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,n.rh)(this.app))return Promise.reject(g(this));const t=e?(0,i.m9)(e):null;return t&&v(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&v(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(0,n.rh)(this.app)?Promise.reject(g(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,n.rh)(this.app)?Promise.reject(g(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(eu(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=new eI(await e_(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new i.LL("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await ei(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&eu(e)||this._popupRedirectResolver;v(t,this,"argument-error"),this.redirectPersistenceManager=await ep.create(this,[eu(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(v(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){const i=e.addObserver(t,r,n);return()=>{s=!0,i()}}{const r=e.addObserver(t);return()=>{s=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return v(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=eS(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if((0,n.rh)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&d(`Error while retrieving App Check token: ${e.error}`),e?.token}}function ek(e){return(0,i.m9)(e)}class eA{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.ne)(e=>this.observer=e)}get next(){return v(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}const eN={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function eD(e){return eN.loadJS(e)}function eO(){return eN.recaptchaEnterpriseScript}class ex{constructor(){this.enterprise=new eP}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class eP{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const eM="recaptcha-enterprise",eL="NO_RECAPTCHA";class eF{constructor(e){this.type=eM,this.auth=ek(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{V(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{const r=new j(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){const i=window.grecaptcha;U(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(eL)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ex().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{r(this.auth).then(r=>{if(!t&&U(window.grecaptcha))n(r,e,i);else{if("undefined"==typeof window){i(Error("RecaptchaVerifier is only supported in browser"));return}let t=eO();0!==t.length&&(t+=r),eD(t).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function eB(e,t,r,n=!1,i=!1){let s;const a=new eF(e);if(i)s=eL;else try{s=await a.verify(r)}catch(e){s=await a.verify(r,!0)}const o={...t};if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){const e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function eU(e,t,r,n,i){if("EMAIL_PASSWORD_PROVIDER"===i){if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await eB(e,t,r,"getOobCode"===r);return n(e,i)}});{const i=await eB(e,t,r,"getOobCode"===r);return n(e,i)}}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){const i=await eB(e,t,r);return n(e,i).catch(async i=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);const i=await eB(e,t,r,!1,!0);return n(e,i)}return Promise.reject(i)})}{const i=await eB(e,t,r,!1,!0);return n(e,i)}}function ej(e,t){const r=(0,n.qX)(e,"auth");if(r.isInitialized()){const e=r.getImmediate(),n=r.getOptions();if((0,i.vZ)(n,t??{}))return e;p(e,"already-initialized")}return r.initialize({options:t})}function eV(e,t){const r=t?.persistence||[],n=(Array.isArray(r)?r:[r]).map(eu);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,t?.popupRedirectResolver)}function ez(e,t,r){const n=ek(e);v(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const s=!!r?.disableWarnings,a=eq(t),{host:o,port:l}=e$(t),u=null===l?"":`:${l}`,c={url:`${a}//${o}${u}/`},d=Object.freeze({host:o,port:l,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!n._canInitEmulator){v(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),v((0,i.vZ)(c,n.config.emulator)&&(0,i.vZ)(d,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=c,n.emulatorConfig=d,n.settings.appVerificationDisabledForTesting=!0,(0,i.Xx)(o)?((0,i.Uo)(`${a}//${o}${u}`),(0,i.dp)("Auth",!0)):s||eK()}function eq(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function e$(e){const t=eq(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};const n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const e=i[1];return{host:e,port:eG(n.substr(e.length+1))}}{const[e,t]=n.split(":");return{host:e,port:eG(t)}}}function eG(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function eK(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}class eH{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return b("not implemented")}_getIdTokenResponse(e){return b("not implemented")}_linkToIdToken(e,t){return b("not implemented")}_getReauthenticationResolver(e){return b("not implemented")}}async function eW(e,t){return O(e,"POST","/v1/accounts:signUp",t)}async function eQ(e,t){return P(e,"POST","/v1/accounts:signInWithPassword",D(e,t))}async function eY(e,t){return P(e,"POST","/v1/accounts:signInWithEmailLink",D(e,t))}async function eJ(e,t){return P(e,"POST","/v1/accounts:signInWithEmailLink",D(e,t))}class eX extends eH{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new eX(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new eX(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return eU(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",eQ,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return eY(e,{email:this._email,oobCode:this._password});default:p(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return eU(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",eW,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return eJ(e,{idToken:t,email:this._email,oobCode:this._password});default:p(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function eZ(e,t){return P(e,"POST","/v1/accounts:signInWithIdp",D(e,t))}const e0="http://localhost";class e1 extends eH{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new e1(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):p("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const{providerId:t,signInMethod:r,...n}="string"==typeof e?JSON.parse(e):e;if(!t||!r)return null;const i=new e1(t,r);return i.idToken=n.idToken||void 0,i.accessToken=n.accessToken||void 0,i.secret=n.secret,i.nonce=n.nonce,i.pendingToken=n.pendingToken||null,i}_getIdTokenResponse(e){return eZ(e,this.buildRequest())}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,eZ(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,eZ(e,t)}buildRequest(){const e={requestUri:e0,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.xO)(t)}return e}}function e2(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function e3(e){const t=(0,i.zd)((0,i.pd)(e)).link,r=t?(0,i.zd)((0,i.pd)(t)).deep_link_id:null,n=(0,i.zd)((0,i.pd)(e)).deep_link_id;return(n?(0,i.zd)((0,i.pd)(n)).link:null)||n||r||t||e}class e4{constructor(e){const t=(0,i.zd)((0,i.pd)(e)),r=t.apiKey??null,n=t.oobCode??null,s=e2(t.mode??null);v(r&&n&&s,"argument-error"),this.apiKey=r,this.operation=s,this.code=n,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=e3(e);try{return new e4(t)}catch{return null}}}class e6{constructor(){this.providerId=e6.PROVIDER_ID}static credential(e,t){return eX._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=e4.parseLink(t);return v(r,"argument-error"),eX._fromEmailAndCode(e,r.code,r.tenantId)}}e6.PROVIDER_ID="password",e6.EMAIL_PASSWORD_SIGN_IN_METHOD="password",e6.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class e9{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class e5 extends e9{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class e7 extends e5{constructor(){super("facebook.com")}static credential(e){return e1._fromParams({providerId:e7.PROVIDER_ID,signInMethod:e7.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return e7.credentialFromTaggedObject(e)}static credentialFromError(e){return e7.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return e7.credential(e.oauthAccessToken)}catch{return null}}}e7.FACEBOOK_SIGN_IN_METHOD="facebook.com",e7.PROVIDER_ID="facebook.com";class e8 extends e5{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return e1._fromParams({providerId:e8.PROVIDER_ID,signInMethod:e8.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return e8.credentialFromTaggedObject(e)}static credentialFromError(e){return e8.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return e8.credential(t,r)}catch{return null}}}e8.GOOGLE_SIGN_IN_METHOD="google.com",e8.PROVIDER_ID="google.com";class te extends e5{constructor(){super("github.com")}static credential(e){return e1._fromParams({providerId:te.PROVIDER_ID,signInMethod:te.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return te.credentialFromTaggedObject(e)}static credentialFromError(e){return te.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return te.credential(e.oauthAccessToken)}catch{return null}}}te.GITHUB_SIGN_IN_METHOD="github.com",te.PROVIDER_ID="github.com";class tt extends e5{constructor(){super("twitter.com")}static credential(e,t){return e1._fromParams({providerId:tt.PROVIDER_ID,signInMethod:tt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return tt.credentialFromTaggedObject(e)}static credentialFromError(e){return tt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return tt.credential(t,r)}catch{return null}}}tt.TWITTER_SIGN_IN_METHOD="twitter.com",tt.PROVIDER_ID="twitter.com";class tr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){return new tr({user:await eo._fromIdTokenResponse(e,r,n),providerId:tn(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new tr({user:e,providerId:tn(r),_tokenResponse:r,operationType:t})}}function tn(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class ti extends i.ZR{constructor(e,t,r,n){super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,ti.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new ti(e,t,r,n)}}function ts(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw ti._fromErrorAndOperation(e,r,t,n);throw r})}class ta{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?to._fromServerResponse(e,t):"totpInfo"in t?tl._fromServerResponse(e,t):p(e,"internal-error")}}class to extends ta{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new to(t)}}class tl extends ta{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new tl(t)}}class tu{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class tc extends tu{constructor(e,t,r,n){super(e,t,r),this.username=n}}class td{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new td("enroll",e,t)}static _fromMfaPendingCredential(e){return new td("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){if(e?.multiFactorSession){if(e.multiFactorSession?.pendingCredential)return td._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(e.multiFactorSession?.idToken)return td._fromIdtoken(e.multiFactorSession.idToken)}return null}}class th{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=ek(e),n=t.customData._serverResponse,i=(n.mfaInfo||[]).map(e=>ta._fromServerResponse(r,e));v(n.mfaPendingCredential,r,"internal-error");const s=td._fromMfaPendingCredential(n.mfaPendingCredential);return new th(s,i,async e=>{const i=await e._process(r,s);delete n.mfaInfo,delete n.mfaPendingCredential;const a={...n,idToken:i.idToken,refreshToken:i.refreshToken};switch(t.operationType){case"signIn":const o=await tr._fromIdTokenResponse(r,t.operationType,a);return await r._updateCurrentUser(o.user),o;case"reauthenticate":return v(t.user,r,"internal-error"),tr._forOperation(t.user,t.operationType,a);default:p(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function tp(e,t){return O(e,"POST","/v2/accounts/mfaEnrollment:start",D(e,t))}function tf(e,t){return O(e,"POST","/v2/accounts/mfaEnrollment:finalize",D(e,t))}function tm(e,t){return O(e,"POST","/v2/accounts/mfaEnrollment:withdraw",D(e,t))}class tg{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>ta._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new tg(e)}async getSession(){return td._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,n=await this.getSession(),i=await Q(this.user,r._process(this.user.auth,n,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,r=await this.user.getIdToken();try{const e=await Q(this.user,tm(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}new WeakMap;const ty="@firebase/auth",tv="1.11.0";class tb{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){v(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function tT(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function tw(e){(0,n.Xd)(new s.wA("auth",(t,{options:r})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=n.options;v(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const l=new eR(n,i,s,{apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:eS(e)});return eV(l,r),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),(0,n.Xd)(new s.wA("auth-internal",e=>new tb(ek(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,n.KN)(ty,tv,tT(e)),(0,n.KN)(ty,tv,"esm2020")}function tS(e=(0,n.Mq)()){const t=(0,n.qX)(e,"auth");if(t.isInitialized())return t.getImmediate();const r=ej(e),s=(0,i.q4)("auth");return s&&ez(r,`http://${s}`),r}function tE(e,t){return O(e,"POST","/v2/accounts/mfaSignIn:finalize",D(e,t))}R.initialize(fetch,Headers,Response),tw("Node"),f("operation-not-supported-in-this-environment"),eR.prototype.setPersistence=async()=>{};class t_{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return b("unexpected MultiFactorSessionType")}}}class tC{static assertionForEnrollment(e,t){return tI._fromSecret(e,t)}static assertionForSignIn(e,t){return tI._fromEnrollmentId(e,t)}static async generateSecret(e){const t=e;v(void 0!==t.user?.auth,"internal-error");const r=await tp(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return tR._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}tC.FACTOR_ID="totp";class tI extends t_{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new tI(t,void 0,e)}static _fromEnrollmentId(e,t){return new tI(t,e)}async _finalizeEnroll(e,t,r){return v(void 0!==this.secret,e,"argument-error"),tf(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){v(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");const r={verificationCode:this.otp};return tE(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class tR{constructor(e,t,r,n,i,s,a){this.sessionInfo=s,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=n,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new tR(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){let r=!1;return(tk(e)||tk(t))&&(r=!0),r&&(tk(e)&&(e=this.auth.currentUser?.email||"unknownuser"),tk(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function tk(e){return void 0===e||e?.length===0}},52489:(e,t,r)=>{"use strict";r.d(t,{EK:()=>eb,ET:()=>gr,hJ:()=>fD,oe:()=>gt,JU:()=>fO,QT:()=>m5,PL:()=>m8,ad:()=>fB,b9:()=>mk,Xo:()=>mI,IO:()=>mw,r7:()=>ge,ar:()=>mE});let n,i,s,a,o=r(28660),l=r(68702),u=r(78549),c=r(21764),d=r(32181),h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},p={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function t(e,t,r){r||(r=0);const n=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;16>i;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a=t+(s^r&(i^s))+n[0]+3614090360&4294967295;a=s+(i^(t=r+(a<<7&4294967295|a>>>25))&(r^i))+n[1]+3905402710&4294967295,a=i+(r^(s=t+(a<<12&4294967295|a>>>20))&(t^r))+n[2]+606105819&4294967295,a=r+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+n[3]+3250441966&4294967295,a=t+(s^(r=i+(a<<22&4294967295|a>>>10))&(i^s))+n[4]+4118548399&4294967295,a=s+(i^(t=r+(a<<7&4294967295|a>>>25))&(r^i))+n[5]+1200080426&4294967295,a=i+(r^(s=t+(a<<12&4294967295|a>>>20))&(t^r))+n[6]+2821735955&4294967295,a=r+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+n[7]+4249261313&4294967295,a=t+(s^(r=i+(a<<22&4294967295|a>>>10))&(i^s))+n[8]+1770035416&4294967295,a=s+(i^(t=r+(a<<7&4294967295|a>>>25))&(r^i))+n[9]+2336552879&4294967295,a=i+(r^(s=t+(a<<12&4294967295|a>>>20))&(t^r))+n[10]+4294925233&4294967295,a=r+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+n[11]+2304563134&4294967295,a=t+(s^(r=i+(a<<22&4294967295|a>>>10))&(i^s))+n[12]+1804603682&4294967295,a=s+(i^(t=r+(a<<7&4294967295|a>>>25))&(r^i))+n[13]+4254626195&4294967295,a=i+(r^(s=t+(a<<12&4294967295|a>>>20))&(t^r))+n[14]+2792965006&4294967295,a=r+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+n[15]+1236535329&4294967295,r=i+(a<<22&4294967295|a>>>10),a=t+(i^s&(r^i))+n[1]+4129170786&4294967295,t=r+(a<<5&4294967295|a>>>27),a=s+(r^i&(t^r))+n[6]+3225465664&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^r&(s^t))+n[11]+643717713&4294967295,i=s+(a<<14&4294967295|a>>>18),a=r+(s^t&(i^s))+n[0]+3921069994&4294967295,r=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(r^i))+n[5]+3593408605&4294967295,t=r+(a<<5&4294967295|a>>>27),a=s+(r^i&(t^r))+n[10]+38016083&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^r&(s^t))+n[15]+3634488961&4294967295,i=s+(a<<14&4294967295|a>>>18),a=r+(s^t&(i^s))+n[4]+3889429448&4294967295,r=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(r^i))+n[9]+568446438&4294967295,t=r+(a<<5&4294967295|a>>>27),a=s+(r^i&(t^r))+n[14]+3275163606&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^r&(s^t))+n[3]+4107603335&4294967295,i=s+(a<<14&4294967295|a>>>18),a=r+(s^t&(i^s))+n[8]+1163531501&4294967295,r=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(r^i))+n[13]+2850285829&4294967295,t=r+(a<<5&4294967295|a>>>27),a=s+(r^i&(t^r))+n[2]+4243563512&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^r&(s^t))+n[7]+1735328473&4294967295,i=s+(a<<14&4294967295|a>>>18),a=r+(s^t&(i^s))+n[12]+2368359562&4294967295,a=t+((r=i+(a<<20&4294967295|a>>>12))^i^s)+n[5]+4294588738&4294967295,a=s+((t=r+(a<<4&4294967295|a>>>28))^r^i)+n[8]+2272392833&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^r)+n[11]+1839030562&4294967295,a=r+((i=s+(a<<16&4294967295|a>>>16))^s^t)+n[14]+4259657740&4294967295,a=t+((r=i+(a<<23&4294967295|a>>>9))^i^s)+n[1]+2763975236&4294967295,a=s+((t=r+(a<<4&4294967295|a>>>28))^r^i)+n[4]+1272893353&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^r)+n[7]+4139469664&4294967295,a=r+((i=s+(a<<16&4294967295|a>>>16))^s^t)+n[10]+3200236656&4294967295,a=t+((r=i+(a<<23&4294967295|a>>>9))^i^s)+n[13]+681279174&4294967295,a=s+((t=r+(a<<4&4294967295|a>>>28))^r^i)+n[0]+3936430074&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^r)+n[3]+3572445317&4294967295,a=r+((i=s+(a<<16&4294967295|a>>>16))^s^t)+n[6]+76029189&4294967295,a=t+((r=i+(a<<23&4294967295|a>>>9))^i^s)+n[9]+3654602809&4294967295,a=s+((t=r+(a<<4&4294967295|a>>>28))^r^i)+n[12]+3873151461&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^r)+n[15]+530742520&4294967295,a=r+((i=s+(a<<16&4294967295|a>>>16))^s^t)+n[2]+3299628645&4294967295,r=i+(a<<23&4294967295|a>>>9),a=t+(i^(r|~s))+n[0]+4096336452&4294967295,t=r+(a<<6&4294967295|a>>>26),a=s+(r^(t|~i))+n[7]+1126891415&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~r))+n[14]+2878612391&4294967295,i=s+(a<<15&4294967295|a>>>17),a=r+(s^(i|~t))+n[5]+4237533241&4294967295,r=i+(a<<21&4294967295|a>>>11),a=t+(i^(r|~s))+n[12]+1700485571&4294967295,t=r+(a<<6&4294967295|a>>>26),a=s+(r^(t|~i))+n[3]+2399980690&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~r))+n[10]+4293915773&4294967295,i=s+(a<<15&4294967295|a>>>17),a=r+(s^(i|~t))+n[1]+2240044497&4294967295,r=i+(a<<21&4294967295|a>>>11),a=t+(i^(r|~s))+n[8]+1873313359&4294967295,t=r+(a<<6&4294967295|a>>>26),a=s+(r^(t|~i))+n[15]+4264355552&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~r))+n[6]+2734768916&4294967295,i=s+(a<<15&4294967295|a>>>17),a=r+(s^(i|~t))+n[13]+1309151649&4294967295,r=i+(a<<21&4294967295|a>>>11),a=t+(i^(r|~s))+n[4]+4149444226&4294967295,t=r+(a<<6&4294967295|a>>>26),a=s+(r^(t|~i))+n[11]+3174756917&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~r))+n[2]+718787259&4294967295,i=s+(a<<15&4294967295|a>>>17),a=r+(s^(i|~t))+n[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function r(e,t){const r=o;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=t(e)}function s(e,t){this.h=t;for(var r=[],n=!0,i=e.length-1;0<=i;i--){const s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}(function(e,t){function r(){}r.prototype=t.prototype,e.D=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.C=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}})(e,function(){this.blockSize=-1}),e.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.u=function(e,r){void 0===r&&(r=e.length);for(var n=r-this.blockSize,i=this.B,s=this.h,a=0;a<r;){if(0==s)for(;a<=n;)t(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<r;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){t(this,i),s=0;break}}else for(;a<r;)if(i[s++]=e[a++],s==this.blockSize){t(this,i),s=0;break}}this.h=s,this.o+=r},e.prototype.v=function(){let e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;let r=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&r,r/=256;for(this.u(e),e=Array(16),t=r=0;4>t;++t)for(let n=0;32>n;n+=8)e[r++]=this.g[t]>>>n&255;return e};var a,o={};function l(e){return -128<=e&&128>e?r(e,function(e){return new s([0|e],0>e?-1:0)}):new s([0|e],0>e?-1:0)}function u(e){if(isNaN(e)||!isFinite(e))return d;if(0>e)return y(u(-e));for(var t=[],r=1,n=0;e>=r;n++)t[n]=e/r|0,r*=4294967296;return new s(t,0)}function c(e,t){if(0==e.length)throw Error("number format error: empty string");if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return y(c(e.substring(1),t));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=u(Math.pow(t,8)),n=d,i=0;i<e.length;i+=8){let s=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+s),t);8>s?(s=u(Math.pow(t,s)),n=n.j(s).add(u(a))):n=(n=n.j(r)).add(u(a))}return n}var d=l(0),h=l(1),f=l(16777216);function m(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function y(e){for(var t=e.g.length,r=[],n=0;n<t;n++)r[n]=~e.g[n];return new s(r,~e.h).add(h)}function v(e,t){return e.add(y(t))}function b(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function T(e,t){this.g=e,this.h=t}function w(e,t){if(m(t))throw Error("division by zero");if(m(e))return new T(d,d);if(g(e))return t=w(y(e),t),new T(y(t.g),y(t.h));if(g(t))return t=w(e,y(t)),new T(y(t.g),t.h);if(30<e.g.length){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var r=h,n=t;0>=n.l(e);)r=S(r),n=S(n);var i=E(r,1),s=E(n,1);for(n=E(n,2),r=E(r,2);!m(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=E(n,1),r=E(r,1)}return t=v(e,i.j(t)),new T(i,t)}for(i=d;0<=e.l(t);){for(n=48>=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,n-48),a=(s=u(r)).j(t);g(a)||0<a.l(e);)r-=n,a=(s=u(r)).j(t);m(s)&&(s=h),i=i.add(s),e=v(e,a)}return new T(i,e)}function S(e){for(var t=e.g.length+1,r=[],n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new s(r,e.h)}function E(e,t){const r=t>>5;t%=32;for(var n=e.g.length-r,i=[],a=0;a<n;a++)i[a]=0<t?e.i(a+r)>>>t|e.i(a+r+1)<<32-t:e.i(a+r);return new s(i,e.h)}(a=s.prototype).m=function(){if(g(this))return-y(this).m();for(var e=0,t=1,r=0;r<this.g.length;r++){const n=this.i(r);e+=(0<=n?n:4294967296+n)*t,t*=4294967296}return e},a.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(m(this))return"0";if(g(this))return"-"+y(this).toString(e);for(let t=u(Math.pow(e,6)),r=this,n="";;){let i=w(r,t).g,s=((0<(r=v(r,i.j(t))).g.length?r.g[0]:r.h)>>>0).toString(e);if(m(r=i))return s+n;for(;6>s.length;)s="0"+s;n=s+n}},a.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},a.l=function(e){return g(e=v(this,e))?-1:m(e)?0:1},a.abs=function(){return g(this)?y(this):this},a.add=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0,i=0;i<=t;i++){let a=n+(65535&this.i(i))+(65535&e.i(i)),o=(a>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=o>>>16,a&=65535,o&=65535,r[i]=o<<16|a}return new s(r,-2147483648&r[r.length-1]?-1:0)},a.j=function(e){if(m(this)||m(e))return d;if(g(this))return g(e)?y(this).j(y(e)):y(y(this).j(e));if(g(e))return y(this.j(y(e)));if(0>this.l(f)&&0>e.l(f))return u(this.m()*e.m());for(var t=this.g.length+e.g.length,r=[],n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let i=0;i<e.g.length;i++){const a=this.i(n)>>>16,o=65535&this.i(n),l=e.i(i)>>>16,c=65535&e.i(i);r[2*n+2*i]+=o*c,b(r,2*n+2*i),r[2*n+2*i+1]+=a*c,b(r,2*n+2*i+1),r[2*n+2*i+1]+=o*l,b(r,2*n+2*i+1),r[2*n+2*i+2]+=a*l,b(r,2*n+2*i+2)}for(n=0;n<t;n++)r[n]=r[2*n+1]<<16|r[2*n];for(n=t;n<2*t;n++)r[n]=0;return new s(r,0)},a.A=function(e){return w(this,e).h},a.and=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new s(r,this.h&e.h)},a.or=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new s(r,this.h|e.h)},a.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new s(r,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,i=p.Md5=e,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=u,s.fromString=c,n=p.Integer=s}).apply(void 0!==h?h:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const f=r(84770),m=r(3230),g=r(62622);const y="@firebase/firestore",v="4.9.1";class b{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}b.UNAUTHENTICATED=new b(null),b.GOOGLE_CREDENTIALS=new b("google-credentials-uid"),b.FIRST_PARTY=new b("first-party-uid"),b.MOCK_USER=new b("mock-user");let T="12.2.0";function w(e){T=e}function S(e){return(0,c.inspect)(e,{depth:100})}const E=new u.Yd("@firebase/firestore");function _(){return E.logLevel}function C(e,...t){if(E.logLevel<=u.in.DEBUG){const r=t.map(k);E.debug(`Firestore (${T}): ${e}`,...r)}}function I(e,...t){if(E.logLevel<=u.in.ERROR){const r=t.map(k);E.error(`Firestore (${T}): ${e}`,...r)}}function R(e,...t){if(E.logLevel<=u.in.WARN){const r=t.map(k);E.warn(`Firestore (${T}): ${e}`,...r)}}function k(e){if("string"==typeof e)return e;try{return S(e)}catch(t){return e}}function A(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,N(e,n,r)}function N(e,t,r){let n=`FIRESTORE (${T}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{const e=JSON.stringify(r);n+=" CONTEXT: "+e}catch(e){n+=" CONTEXT: "+r}throw I(n),Error(n)}function D(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||N(t,i,n)}function O(e,t){return e}const x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class P extends d.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class M{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class L{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class F{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(b.UNAUTHENTICATED))}shutdown(){}}class B{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class U{constructor(e){this.authProvider=e,this.currentUser=b.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){D(void 0===this.tokenListener,42304);let r=this.tokenCounter,n=e=>this.tokenCounter!==r?(r=this.tokenCounter,t(e)):Promise.resolve(),i=new M;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),i.resolve(),i=new M,e.enqueueRetryable(()=>n(this.currentUser))};const s=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{C("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),s())};this.authProvider.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.authProvider.getImmediate({optional:!0});e?a(e):(C("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new M)}},0),s()}getToken(){const e=this.tokenCounter,t=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(t).then(t=>this.tokenCounter!==e?(C("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(D("string"==typeof t.accessToken,31837,{tokenData:t}),new L(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){const e=this.auth&&this.auth.getUid();return D(null===e||"string"==typeof e,2055,{currentUid:e}),new b(e)}}class j{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=b.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);const e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class V{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new j(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(b.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class z{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class q{constructor(e,t){this.appCheckProvider=t,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,(0,o.rh)(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken)}start(e,t){D(void 0===this.tokenListener,3512);const r=e=>{null!=e.error&&C("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const r=e.token!==this.latestAppCheckToken;return this.latestAppCheckToken=e.token,C("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.tokenListener=t=>{e.enqueueRetryable(()=>r(t))};const n=e=>{C("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){const e=this.appCheckProvider.getImmediate({optional:!0});e?n(e):C("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new z(this.serverAppAppCheckToken));const e=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(e).then(e=>e?(D("string"==typeof e.token,44558,{tokenResult:e}),this.latestAppCheckToken=e.token,new z(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function $(e){if(!e)return new F;switch(e.type){case"firstParty":return new V(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new P(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function G(e){return(0,f.randomBytes)(e)}class K{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",n=20;for(;r.length<n;){const i=G(40);for(let s=0;s<i.length;++s)r.length<n&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function H(e,t){return e<t?-1:e>t?1:0}function W(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;n++){const r=e.charAt(n),i=t.charAt(n);if(r!==i)return J(r)===J(i)?H(r,i):J(r)?1:-1}return H(e.length,t.length)}const Q=55296,Y=57343;function J(e){const t=e.charCodeAt(0);return t>=Q&&t<=Y}function X(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}function Z(e){return e+"\0"}const ee="__name__";class et{constructor(e,t,r){void 0===t?t=0:t>e.length&&A(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&A(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===et.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof et?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;n++){const r=et.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return H(e.length,t.length)}static compareSegments(e,t){const r=et.isNumericId(e),n=et.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?et.extractNumericId(e).compare(et.extractNumericId(t)):W(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return n.fromString(e.substring(4,e.length-2))}}class er extends et{construct(e,t,r){return new er(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new P(x.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new er(t)}static emptyPath(){return new er([])}}const en=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ei extends et{construct(e,t,r){return new ei(e,t,r)}static isValidIdentifier(e){return en.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ei.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ee}static keyField(){return new ei([ee])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new P(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){const t=e[n];if("\\"===t){if(n+1===e.length)throw new P(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[n+1];if(!("\\"===t||"."===t||"`"===t))throw new P(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new P(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ei(t)}static emptyPath(){return new ei([])}}class es{constructor(e){this.path=e}static fromPath(e){return new es(er.fromString(e))}static fromName(e){return new es(er.fromString(e).popFirst(5))}static empty(){return new es(er.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===er.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return er.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new es(new er(e.slice()))}}function ea(e,t,r){if(!r)throw new P(x.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function eo(e,t,r,n){if(!0===t&&!0===n)throw new P(x.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)}function el(e){if(!es.isDocumentKey(e))throw new P(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function eu(e){if(es.isDocumentKey(e))throw new P(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function ec(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ed(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=eh(e);return t?`a custom ${t} object`:"an object"}}if("function"==typeof e)return"a function";return A(12329,{type:typeof e})}function eh(e){return e.constructor?e.constructor.name:null}function ep(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new P(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=ed(e);throw new P(x.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function ef(e,t){if(t<=0)throw new P(x.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function em(e,t){const r={typeString:e};return t&&(r.value=t),r}function eg(e,t){let r;if(!ec(e))throw new P(x.INVALID_ARGUMENT,"JSON must be an object");for(const n in t)if(t[n]){const i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}const a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new P(x.INVALID_ARGUMENT,r);return!0}const ey=-62135596800,ev=1e6;class eb{static now(){return eb.fromMillis(Date.now())}static fromDate(e){return eb.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*ev);return new eb(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new P(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ey||e>=253402300800)throw new P(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ev}_compareTo(e){return this.seconds===e.seconds?H(this.nanoseconds,e.nanoseconds):H(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:eb._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(eg(e,eb._jsonSchema))return new eb(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds-ey).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}eb._jsonSchemaVersion="firestore/timestamp/1.0",eb._jsonSchema={type:em("string",eb._jsonSchemaVersion),seconds:em("number"),nanoseconds:em("number")};class eT{static fromTimestamp(e){return new eT(e)}static min(){return new eT(new eb(0,0))}static max(){return new eT(new eb(253402300799,1e9-1))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ew=-1,eS=0;class eE{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function e_(e){return e.fields.find(e=>2===e.kind)}function eC(e){return e.fields.filter(e=>2!==e.kind)}function eI(e){const t=eC(e);return 0===t.length?0:t[t.length-1].kind}function eR(e,t){let r=H(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=eN(e.fields[n],t.fields[n])))return r;return H(e.fields.length,t.fields.length)}function ek(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}eE.UNKNOWN_ID=-1;class eA{constructor(e,t){this.fieldPath=e,this.kind=t}}function eN(e,t){const r=ei.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:H(e.kind,t.kind)}class eD{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new eD(eS,eP.min())}}function eO(e,t){const r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new eP(eT.fromTimestamp(1e9===n?new eb(r+1,0):new eb(r,n)),es.empty(),t)}function ex(e){return new eP(e.readTime,e.key,ew)}class eP{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new eP(eT.min(),es.empty(),ew)}static max(){return new eP(eT.max(),es.empty(),ew)}}function eM(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=es.comparator(e.documentKey,t.documentKey))?r:H(e.largestBatchId,t.largestBatchId)}const eL="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class eF{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function eB(e){if(e.code===x.FAILED_PRECONDITION&&e.message===eL)C("LocalStore","Unexpectedly lost primary lease");else throw e}class eU{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return(this.callbackAttached&&A(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new eU((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();if(t instanceof eU)return t;return eU.resolve(t)}catch(e){return eU.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):eU.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):eU.reject(t)}static resolve(e){return new eU((t,r)=>{t(e)})}static reject(e){return new eU((t,r)=>{r(e)})}static waitFor(e){return new eU((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=eU.resolve(!1);for(const r of e)t=t.next(e=>e?eU.resolve(e):r());return t}static forEach(e,t){const r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new eU((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){const l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new eU((r,n)=>{const i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}const ej="SimpleDb",eV=3;class ez{static open(e,t,r,n){try{return new ez(t,e.transaction(n,r))}catch(e){throw new eK(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new M,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new eK(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=t=>{const r=eJ(t.target.error);this.completionDeferred.reject(new eK(e,r))}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(C(ej,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new eW(this.transaction.objectStore(e))}}class eq{static delete(e){return C(ej,"Removing database:",e),eQ((0,d.Rd)().indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!(0,d.hl)())return!1;if(eq.isMockPersistence())return!0;const e=(0,d.z$)(),t=eq.getIOSVersion(e),r=0<t&&t<10,n=e$(e),i=0<n&&n<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)&&!r&&!i}static isMockPersistence(){return"undefined"!=typeof process&&process.env?.USE_MOCK_PERSISTENCE==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,this.lastClosedDbVersion=null,12.2===eq.getIOSVersion((0,d.z$)())&&I("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(e){return this.db||(C(ej,"Opening database:",this.name),this.db=await new Promise((t,r)=>{const n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new eK(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{const n=t.target.error;"VersionError"===n.name?r(new P(x.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new P(x.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new eK(e,n))},n.onupgradeneeded=e=>{C(ej,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.schemaConverter.createOrUpgrade(t,n.transaction,e.oldVersion,this.version).next(()=>{C(ej,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=e=>this.versionchangelistener(e)),this.db}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.ensureDb(e);const t=ez.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.maybeCommit(),e)).catch(e=>(t.abort(e),eU.reject(e))).toPromise();return s.catch(()=>{}),await t.completionPromise,s}catch(r){const e=r,t="FirebaseError"!==e.name&&s<eV;if(C(ej,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function e$(e){const t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class eG{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return eQ(this.dbCursor.delete())}}class eK extends P{constructor(e,t){super(x.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function eH(e){return"IndexedDbTransactionError"===e.name}class eW{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(C(ej,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(C(ej,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),eQ(r)}add(e){return C(ej,"ADD",this.store.name,e,e),eQ(this.store.add(e))}get(e){return eQ(this.store.get(e)).next(t=>(void 0===t&&(t=null),C(ej,"GET",this.store.name,e,t),t))}delete(e){return C(ej,"DELETE",this.store.name,e),eQ(this.store.delete(e))}count(){return C(ej,"COUNT",this.store.name),eQ(this.store.count())}loadAll(e,t){const r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){const e=n.getAll(r.range);return new eU((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{const e=this.cursor(r),t=[];return this.iterateCursor(e,(e,r)=>{t.push(r)}).next(()=>t)}}loadFirst(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new eU((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}deleteAll(e,t){C(ej,"DELETE ALL",this.store.name);const r=this.options(e,t);r.keysOnly=!1;const n=this.cursor(r);return this.iterateCursor(n,(e,t,r)=>r.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);const n=this.cursor(r);return this.iterateCursor(n,t)}iterateSerial(e){const t=this.cursor({});return new eU((r,n)=>{t.onerror=e=>{n(eJ(e.target.error))},t.onsuccess=t=>{const n=t.target.result;if(!n){r();return}e(n.primaryKey,n.value).next(e=>{e?n.continue():r()})}})}iterateCursor(e,t){const r=[];return new eU((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i){n();return}const s=new eG(i),a=t(i.primaryKey,i.value,s);if(a instanceof eU){const e=a.catch(e=>(s.done(),eU.reject(e)));r.push(e)}s.isDone?n():null===s.skipToKey?i.continue():i.continue(s.skipToKey)}}).next(()=>eU.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),!e.index)return this.store.openCursor(e.range,t);{const r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}}}function eQ(e){return new eU((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(eJ(e.target.error))}})}let eY=!1;function eJ(e){const t=eq.getIOSVersion((0,d.z$)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new P("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return eY||(eY=!0,setTimeout(()=>{throw e},0)),e}}return e}const eX="IndexBackfiller",eZ=15e3,e0=6e4,e1=50;class e2{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(eZ)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(e){C(eX,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const e=await this.backfiller.backfill();C(eX,`Documents written: ${e}`)}catch(e){eH(e)?C(eX,"Ignoring IndexedDB error during index backfill: ",e):await eB(e)}await this.schedule(e0)})}}class e3{constructor(e,t){this.localStore=e,this.persistence=t}async backfill(e=e1){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))}writeIndexEntries(e,t){let r=new Set,n=t,i=!0;return eU.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(!(null===t||r.has(t)))return C(eX,`Processing collection: ${t}`),this.writeEntriesForCollectionGroup(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{const i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.getNewOffset(n,r)).next(r=>(C(eX,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((e,t)=>{const n=ex(t);eM(n,r)>0&&(r=n)}),new eP(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class e4{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.setPreviousValue(e),this.writeNewSequenceNumber=e=>t.writeSequenceNumber(e))}setPreviousValue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e}}e4.INVALID=-1;const e6="\x01",e9="\x01",e5="\x10",e7="\x11";function e8(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t=tt(t)),t=te(e.get(r),t);return tt(t)}function te(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){const n=e.charAt(t);switch(n){case"\0":r+=e6+e5;break;case e6:r+=e6+e7;break;default:r+=n}}return r}function tt(e){return e+e6+e9}function tr(e){const t=e.length;if(D(t>=2,64408,{path:e}),2===t)return D(e.charAt(0)===e6&&e.charAt(1)===e9,56145,{path:e}),er.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){const t=e.indexOf(e6,s);switch((t<0||t>r)&&A(50515,{path:e}),e.charAt(t+1)){case e9:let a;const o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case e5:i+=e.substring(s,t)+"\0";break;case e7:i+=e.substring(s,t+1);break;default:A(61167,{path:e})}s=t+2}return new er(n)}const tn="remoteDocuments",ti="owner",ts="owner",ta="mutationQueues",to="userId",tl="mutations",tu="batchId",tc="userMutationsIndex",td=["userId","batchId"];function th(e){return[e]}function tp(e,t){return[e,e8(t)]}function tf(e,t,r){return[e,e8(t),r]}const tm={},tg="documentMutations",ty="remoteDocumentsV14",tv=["prefixPath","collectionGroup","readTime","documentId"],tb="documentKeyIndex",tT=["prefixPath","collectionGroup","documentId"],tw="collectionGroupIndex",tS=["collectionGroup","readTime","prefixPath","documentId"],tE="remoteDocumentGlobal",t_="remoteDocumentGlobalKey",tC="targets",tI="targetId",tR="queryTargetsIndex",tk=["canonicalId","targetId"],tA="targetDocuments",tN=["targetId","path"],tD="documentTargetsIndex",tO=["path","targetId"],tx="targetGlobalKey",tP="targetGlobal",tM="collectionParents",tL=["collectionId","parent"],tF="clientMetadata",tB="clientId",tU="bundles",tj="bundleId",tV="namedQueries",tz="name",tq="indexConfiguration",t$="indexId",tG="collectionGroupIndex",tK="collectionGroup",tH="indexState",tW=["indexId","uid"],tQ="sequenceNumberIndex",tY=["uid","sequenceNumber"],tJ="indexEntries",tX=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],tZ="documentKeyIndex",t0=["indexId","uid","orderedDocumentKey"],t1="documentOverlays",t2=["userId","collectionPath","documentId"],t3="collectionPathOverlayIndex",t4=["userId","collectionPath","largestBatchId"],t6="collectionGroupOverlayIndex",t9=["userId","collectionGroup","largestBatchId"],t5="globals",t7="name",t8=[ta,tl,tg,tn,tC,ti,tP,tA,tF,tE,tM,tU,tV],re=[...t8,t1],rt=[ta,tl,tg,ty,tC,ti,tP,tA,tF,tE,tM,tU,tV,t1],rr=rt,rn=[...rr,tq,tH,tJ],ri=rn,rs=[...rn,t5],ra=rs;function ro(e){return 18===e?ra:17===e?rs:16===e?ri:15===e?rn:14===e?rr:13===e?rt:12===e?re:11===e?t8:void A(60245)}class rl extends eF{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}}function ru(e,t){const r=O(e);return eq.getStore(r.simpleDbTransaction,t)}function rc(e){let t=0;for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function rd(e,t){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function rh(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class rp{constructor(e,t){this.comparator=e,this.root=t||rm.EMPTY}insert(e,t){return new rp(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,rm.BLACK,null,null))}remove(e){return new rp(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rm.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new rf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new rf(this.root,e,this.comparator,!1)}getReverseIterator(){return new rf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new rf(this.root,e,this.comparator,!0)}}class rf{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else if(0===i){this.nodeStack.push(e);break}else this.nodeStack.push(e),e=this.isReverse?e.right:e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class rm{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:rm.RED,this.left=null!=n?n:rm.EMPTY,this.right=null!=i?i:rm.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new rm(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return rm.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r;let n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return rm.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){const e=this.copy(null,null,rm.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,rm.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw A(43730,{key:this.key,value:this.value});if(this.right.isRed())throw A(14113,{key:this.key,value:this.value});const e=this.left.check();if(e===this.right.check())return e+(this.isRed()?0:1);throw A(27949)}}rm.EMPTY=null,rm.RED=!0,rm.BLACK=!1;class rg{constructor(){this.size=0}get key(){throw A(57766)}get value(){throw A(16141)}get color(){throw A(16727)}get left(){throw A(29726)}get right(){throw A(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new rm(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}rm.EMPTY=new rg;class ry{constructor(e){this.comparator=e,this.data=new rp(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new rv(this.data.getIterator())}getIteratorFrom(e){return new rv(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof ry)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ry(this.comparator);return t.data=e,t}}class rv{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function rb(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=rT(s),l=rT(a);for(;o||l;){let e=!1,t=!1;if(o&&l){const n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=rT(a)):t?(i(o),o=rT(s)):(o=rT(s),l=rT(a))}}function rT(e){return e.hasNext()?e.getNext():void 0}class rw{constructor(e){this.fields=e,e.sort(ei.comparator)}static empty(){return new rw([])}unionWith(e){let t=new ry(ei.comparator);for(const e of this.fields)t=t.add(e);for(const r of e)t=t.add(r);return new rw(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return X(this.fields,e.fields,(e,t)=>e.isEqual(t))}}function rS(e){return Buffer.from(e,"base64").toString("binary")}function rE(e){return Buffer.from(e,"binary").toString("base64")}class r_{constructor(e){this.binaryString=e}static fromBase64String(e){return new r_(rS(e))}static fromUint8Array(e){return new r_(rC(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return rE(this.binaryString)}toUint8Array(){return rI(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return H(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function rC(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}function rI(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}r_.EMPTY_BYTE_STRING=new r_("");const rR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function rk(e){if(D(!!e,39018),"string"==typeof e){let t=0,r=rR.exec(e);if(D(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:rA(e.seconds),nanos:rA(e.nanos)}}function rA(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function rN(e){return"string"==typeof e?r_.fromBase64String(e):r_.fromUint8Array(e)}const rD="server_timestamp",rO="__type__",rx="__previous_value__",rP="__local_write_time__";function rM(e){return(e?.mapValue?.fields||{})[rO]?.stringValue===rD}function rL(e,t){const r={fields:{[rO]:{stringValue:rD},[rP]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&rM(t)&&(t=rF(t)),t&&(r.fields[rx]=t),{mapValue:r}}function rF(e){const t=e.mapValue.fields[rx];return rM(t)?rF(t):t}function rB(e){const t=rk(e.mapValue.fields[rP].timestampValue);return new eb(t.seconds,t.nanos)}class rU{constructor(e,t,r,n,i,s,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u}}const rj="(default)";class rV{constructor(e,t){this.projectId=e,this.database=t||rj}static empty(){return new rV("","")}get isDefaultDatabase(){return this.database===rj}isEqual(e){return e instanceof rV&&e.projectId===this.projectId&&e.database===this.database}}function rz(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new P(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rV(e.options.projectId,t)}const rq=-1;function r$(e){return null==e}function rG(e){return 0===e&&1/e==-1/0}function rK(e){return"number"==typeof e&&Number.isInteger(e)&&!rG(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const rH="__type__",rW="__max__",rQ={mapValue:{fields:{__type__:{stringValue:rW}}}},rY="__vector__",rJ="value",rX={nullValue:"NULL_VALUE"};function rZ(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?rM(e)?4:nR(e)?9007199254740991:nC(e)?10:11:A(28295,{value:e})}function r0(e,t){if(e===t)return!0;const r=rZ(e);if(r!==rZ(t))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return rB(e).isEqual(rB(t));case 3:return r1(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r3(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return r2(e,t);case 2:return r4(e,t);case 9:return X(e.arrayValue.values||[],t.arrayValue.values||[],r0);case 10:case 11:return r6(e,t);default:return A(52216,{left:e})}}function r1(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const r=rk(e.timestampValue),n=rk(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}function r2(e,t){return rA(e.geoPointValue.latitude)===rA(t.geoPointValue.latitude)&&rA(e.geoPointValue.longitude)===rA(t.geoPointValue.longitude)}function r3(e,t){return rN(e.bytesValue).isEqual(rN(t.bytesValue))}function r4(e,t){if("integerValue"in e&&"integerValue"in t)return rA(e.integerValue)===rA(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const r=rA(e.doubleValue),n=rA(t.doubleValue);return r===n?rG(r)===rG(n):isNaN(r)&&isNaN(n)}return!1}function r6(e,t){const r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(rc(r)!==rc(n))return!1;for(const e in r)if(r.hasOwnProperty(e)&&(void 0===n[e]||!r0(r[e],n[e])))return!1;return!0}function r9(e,t){return void 0!==(e.values||[]).find(e=>r0(e,t))}function r5(e,t){if(e===t)return 0;const r=rZ(e),n=rZ(t);if(r!==n)return H(r,n);switch(r){case 0:case 9007199254740991:return 0;case 1:return H(e.booleanValue,t.booleanValue);case 2:return r7(e,t);case 3:return r8(e.timestampValue,t.timestampValue);case 4:return r8(rB(e),rB(t));case 5:return W(e.stringValue,t.stringValue);case 6:return nr(e.bytesValue,t.bytesValue);case 7:return ne(e.referenceValue,t.referenceValue);case 8:return nt(e.geoPointValue,t.geoPointValue);case 9:return nn(e.arrayValue,t.arrayValue);case 10:return ni(e.mapValue,t.mapValue);case 11:return ns(e.mapValue,t.mapValue);default:throw A(23264,{leftType:r})}}function r7(e,t){const r=rA(e.integerValue||e.doubleValue),n=rA(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}function r8(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return H(e,t);const r=rk(e),n=rk(t),i=H(r.seconds,n.seconds);return 0!==i?i:H(r.nanos,n.nanos)}function ne(e,t){const r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){const t=H(r[e],n[e]);if(0!==t)return t}return H(r.length,n.length)}function nt(e,t){const r=H(rA(e.latitude),rA(t.latitude));return 0!==r?r:H(rA(e.longitude),rA(t.longitude))}function nr(e,t){const r=rN(e),n=rN(t);return r.compareTo(n)}function nn(e,t){const r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){const t=r5(r[e],n[e]);if(t)return t}return H(r.length,n.length)}function ni(e,t){const r=e.fields||{},n=t.fields||{},i=r[rJ]?.arrayValue,s=n[rJ]?.arrayValue,a=H(i?.values?.length||0,s?.values?.length||0);return 0!==a?a:nn(i,s)}function ns(e,t){if(e===rQ.mapValue&&t===rQ.mapValue)return 0;if(e===rQ.mapValue)return 1;if(t===rQ.mapValue)return -1;const r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){const t=W(n[e],s[e]);if(0!==t)return t;const a=r5(r[n[e]],i[s[e]]);if(0!==a)return a}return H(n.length,s.length)}function na(e){return no(e)}function no(e){if("nullValue"in e)return"null";if("booleanValue"in e)return""+e.booleanValue;if("integerValue"in e)return""+e.integerValue;if("doubleValue"in e)return""+e.doubleValue;if("timestampValue"in e)return nu(e.timestampValue);if("stringValue"in e)return e.stringValue;if("bytesValue"in e)return nl(e.bytesValue);else if("referenceValue"in e)return nd(e.referenceValue);else if("geoPointValue"in e)return nc(e.geoPointValue);else if("arrayValue"in e)return np(e.arrayValue);else if("mapValue"in e)return nh(e.mapValue);else return A(61005,{value:e})}function nl(e){return rN(e).toBase64()}function nu(e){const t=rk(e);return`time(${t.seconds},${t.nanos})`}function nc(e){return`geo(${e.latitude},${e.longitude})`}function nd(e){return es.fromName(e).toString()}function nh(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(const i of t)n?n=!1:r+=",",r+=`${i}:${no(e.fields[i])}`;return r+"}"}function np(e){let t="[",r=!0;for(const n of e.values||[])r?r=!1:t+=",",t+=no(n);return t+"]"}function nf(e){switch(rZ(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=rF(e);return t?16+nf(t):16;case 5:return 2*e.stringValue.length;case 6:return rN(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return ng(e.arrayValue);case 10:case 11:return nm(e.mapValue);default:throw A(13486,{value:e})}}function nm(e){let t=0;return rd(e.fields,(e,r)=>{t+=e.length+nf(r)}),t}function ng(e){return(e.values||[]).reduce((e,t)=>e+nf(t),0)}function ny(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function nv(e){return!!e&&"integerValue"in e}function nb(e){return!!e&&"doubleValue"in e}function nT(e){return nv(e)||nb(e)}function nw(e){return!!e&&"arrayValue"in e}function nS(e){return!!e&&"nullValue"in e}function nE(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function n_(e){return!!e&&"mapValue"in e}function nC(e){return(e?.mapValue?.fields||{})[rH]?.stringValue===rY}function nI(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){const t={mapValue:{fields:{}}};return rd(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=nI(r)),t}{if(!e.arrayValue)return{...e};const t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=nI(e.arrayValue.values[r]);return t}}function nR(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===rW}const nk={mapValue:{fields:{[rH]:{stringValue:rY},[rJ]:{arrayValue:{}}}}};function nA(e){if("nullValue"in e)return rX;if("booleanValue"in e)return{booleanValue:!1};if("integerValue"in e||"doubleValue"in e)return{doubleValue:NaN};if("timestampValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in e)return{stringValue:""};if("bytesValue"in e)return{bytesValue:""};if("referenceValue"in e)return ny(rV.empty(),es.empty());else if("geoPointValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in e)return{arrayValue:{}};else if(!("mapValue"in e))return A(35942,{value:e});else return nC(e)?nk:{mapValue:{}}}function nN(e){if("nullValue"in e)return{booleanValue:!1};if("booleanValue"in e)return{doubleValue:NaN};if("integerValue"in e||"doubleValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in e)return{stringValue:""};if("stringValue"in e)return{bytesValue:""};if("bytesValue"in e)return ny(rV.empty(),es.empty());if("referenceValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in e)return{arrayValue:{}};else if("arrayValue"in e)return nk;else if(!("mapValue"in e))return A(61959,{value:e});else return nC(e)?{mapValue:{}}:rQ}function nD(e,t){const r=r5(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function nO(e,t){const r=r5(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class nx{constructor(e){this.value=e}static empty(){return new nx({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!n_(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=nI(t)}setAll(e){let t=ei.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=nI(e):n.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){const t=this.field(e.popLast());n_(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return r0(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];n_(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(const n of(rd(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new nx(nI(this.value))}}function nP(e){const t=[];return rd(e.fields,(e,r)=>{const n=new ei([e]);if(n_(r)){const e=nP(r.mapValue).fields;if(0===e.length)t.push(n);else for(const r of e)t.push(n.child(r))}else t.push(n)}),new rw(t)}class nM{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new nM(e,0,eT.min(),eT.min(),eT.min(),nx.empty(),0)}static newFoundDocument(e,t,r,n){return new nM(e,1,t,eT.min(),r,n,0)}static newNoDocument(e,t){return new nM(e,2,t,eT.min(),eT.min(),nx.empty(),0)}static newUnknownDocument(e,t){return new nM(e,3,t,eT.min(),eT.min(),nx.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(eT.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nx.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nx.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=eT.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof nM&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new nM(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function nL(e,t,r){const n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?r5(n,i):A(42886)}class nF{constructor(e,t){this.position=e,this.inclusive=t}}function nB(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){const s=t[i],a=e.position[i];if(n=s.field.isKeyField()?es.comparator(es.fromName(a.referenceValue),r.key):r5(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function nU(e,t,r){const n=nB(e,t,r);return e.inclusive?n>=0:n>0}function nj(e,t,r){const n=nB(e,t,r);return e.inclusive?n<=0:n<0}function nV(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!r0(e.position[r],t.position[r]))return!1;return!0}class nz{constructor(e,t="asc"){this.field=e,this.dir=t}}function nq(e){return e.field.canonicalString()+e.dir}function n$(e){return`${e.field.canonicalString()} (${e.dir})`}function nG(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class nK{}class nH extends nK{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new n5(e,t,r):"array-contains"===t?new it(e,r):"in"===t?new ir(e,r):"not-in"===t?new ii(e,r):"array-contains-any"===t?new is(e,r):new nH(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new n7(e,r):new n8(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(r5(t,this.value)):null!==t&&rZ(this.value)===rZ(t)&&this.matchesComparison(r5(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return A(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class nW extends nK{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new nW(e,t)}matches(e){return nQ(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function nQ(e){return"and"===e.op}function nY(e){return"or"===e.op}function nJ(e){return nX(e)&&nQ(e)}function nX(e){for(const t of e.filters)if(t instanceof nW)return!1;return!0}function nZ(e){if(e instanceof nH)return e.field.canonicalString()+e.op.toString()+na(e.value);if(nJ(e))return e.filters.map(e=>nZ(e)).join(",");{const t=e.filters.map(e=>nZ(e)).join(",");return`${e.op}(${t})`}}function n0(e,t){return e instanceof nH?n1(e,t):e instanceof nW?n2(e,t):void A(19439)}function n1(e,t){return t instanceof nH&&e.op===t.op&&e.field.isEqual(t.field)&&r0(e.value,t.value)}function n2(e,t){return t instanceof nW&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,r,n)=>e&&n0(r,t.filters[n]),!0)}function n3(e,t){const r=e.filters.concat(t);return nW.create(r,e.op)}function n4(e){return e instanceof nH?n9(e):e instanceof nW?n6(e):"Filter"}function n6(e){return e.op.toString()+" {"+e.getFilters().map(n4).join(" ,")+"}"}function n9(e){return`${e.field.canonicalString()} ${e.op} ${na(e.value)}`}class n5 extends nH{constructor(e,t,r){super(e,t,r),this.key=es.fromName(r.referenceValue)}matches(e){const t=es.comparator(e.key,this.key);return this.matchesComparison(t)}}class n7 extends nH{constructor(e,t){super(e,"in",t),this.keys=ie("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class n8 extends nH{constructor(e,t){super(e,"not-in",t),this.keys=ie("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ie(e,t){return(t.arrayValue?.values||[]).map(e=>es.fromName(e.referenceValue))}class it extends nH{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return nw(t)&&r9(t.arrayValue,this.value)}}class ir extends nH{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&r9(this.value.arrayValue,t)}}class ii extends nH{constructor(e,t){super(e,"not-in",t)}matches(e){if(r9(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!r9(this.value.arrayValue,t)}}class is extends nH{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!!nw(t)&&!!t.arrayValue.values&&t.arrayValue.values.some(e=>r9(this.value.arrayValue,e))}}class ia{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.memoizedCanonicalId=null}}function io(e,t=null,r=[],n=[],i=null,s=null,a=null){return new ia(e,t,r,n,i,s,a)}function il(e){const t=O(e);if(null===t.memoizedCanonicalId){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:"+t.filters.map(e=>nZ(e)).join(",")+"|ob:"+t.orderBy.map(e=>nq(e)).join(","),r$(t.limit)||(e+="|l:"+t.limit),t.startAt&&(e+="|lb:"+(t.startAt.inclusive?"b:":"a:")+t.startAt.position.map(e=>na(e)).join(",")),t.endAt&&(e+="|ub:"+(t.endAt.inclusive?"a:":"b:")+t.endAt.position.map(e=>na(e)).join(",")),t.memoizedCanonicalId=e}return t.memoizedCanonicalId}function iu(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>n4(e)).join(", ")}]`),r$(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>n$(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+(e.startAt.inclusive?"b:":"a:")+e.startAt.position.map(e=>na(e)).join(",")),e.endAt&&(t+=", endAt: "+(e.endAt.inclusive?"a:":"b:")+e.endAt.position.map(e=>na(e)).join(",")),`Target(${t})`}function ic(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!nG(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!n0(e.filters[r],t.filters[r]))return!1;return!!(e.collectionGroup===t.collectionGroup&&e.path.isEqual(t.path)&&nV(e.startAt,t.startAt))&&nV(e.endAt,t.endAt)}function id(e){return es.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function ih(e,t){return e.filters.filter(e=>e instanceof nH&&e.field.isEqual(t))}function ip(e,t){const r=e_(t);if(void 0===r)return null;for(const t of ih(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}function im(e,t){const r=new Map;for(const n of eC(t))for(const t of ih(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}function ig(e,t){let r=[],n=!0;for(const i of eC(t)){const t=0===i.kind?iv(e,i.fieldPath,e.startAt):ib(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new nF(r,n)}function iy(e,t){let r=[],n=!0;for(const i of eC(t)){const t=0===i.kind?ib(e,i.fieldPath,e.endAt):iv(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new nF(r,n)}function iv(e,t,r){let n=rX,i=!0;for(const r of ih(e,t)){let e=rX,t=!0;switch(r.op){case"<":case"<=":e=nA(r.value);break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=rX}0>nD({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=r.position[s];0>nD({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function ib(e,t,r){let n=rQ,i=!0;for(const r of ih(e,t)){let e=rQ,t=!0;switch(r.op){case">=":case">":e=nN(r.value),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=rQ}nO({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=r.position[s];nO({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function iT(e){let t=new ry(ei.comparator),r=!1;for(const n of e.filters)for(const e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(const r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+(r?1:0)}function iw(e){return null!==e.limit}class iS{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function iE(e,t,r,n,i,s,a,o){return new iS(e,t,r,n,i,s,a,o)}function i_(e){return new iS(e)}function iC(e,t){return new iS(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function iI(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function iR(e){let t=new ry(ei.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}function ik(e){return es.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function iA(e){return null!==e.collectionGroup}function iN(e){const t=O(e);if(null===t.memoizedNormalizedOrderBy){t.memoizedNormalizedOrderBy=[];const e=new Set;for(const r of t.explicitOrderBy)t.memoizedNormalizedOrderBy.push(r),e.add(r.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";iR(t).forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.memoizedNormalizedOrderBy.push(new nz(n,r))}),e.has(ei.keyField().canonicalString())||t.memoizedNormalizedOrderBy.push(new nz(ei.keyField(),r))}return t.memoizedNormalizedOrderBy}function iD(e){const t=O(e);return t.memoizedTarget||(t.memoizedTarget=ix(t,iN(e))),t.memoizedTarget}function iO(e){const t=O(e);return t.memoizedAggregateTarget||(t.memoizedAggregateTarget=ix(t,e.explicitOrderBy)),t.memoizedAggregateTarget}function ix(e,t){if("F"===e.limitType)return io(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new nz(e.field,t)});const r=e.endAt?new nF(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new nF(e.startAt.position,e.startAt.inclusive):null;return io(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function iP(e,t){const r=e.filters.concat([t]);return new iS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function iM(e,t){const r=e.explicitOrderBy.concat([t]);return new iS(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function iL(e,t,r){return new iS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function iF(e,t){return new iS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}function iB(e,t){return new iS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}function iU(e,t){return ic(iD(e),iD(t))&&e.limitType===t.limitType}function ij(e){return`${il(iD(e))}|lt:${e.limitType}`}function iV(e){return`Query(target=${iu(iD(e))}; limitType=${e.limitType})`}function iz(e,t){return t.isFoundDocument()&&iq(e,t)&&i$(e,t)&&iG(e,t)&&iK(e,t)}function iq(e,t){const r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):es.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}function i$(e,t){for(const r of iN(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}function iG(e,t){for(const r of e.filters)if(!r.matches(t))return!1;return!0}function iK(e,t){return(!e.startAt||!!nj(e.startAt,iN(e),t))&&(!e.endAt||!!nU(e.endAt,iN(e),t))}function iH(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function iW(e){return(t,r)=>{let n=!1;for(const i of iN(e)){const e=iQ(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}function iQ(e,t,r){const n=e.field.isKeyField()?es.comparator(t.key,r.key):nL(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return -1*n;default:return A(19790,{direction:e.dir})}}class iY{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(const[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n){this.inner[r]=[[e,t]],this.innerSize++;return}for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e)){n[r]=[e,t];return}n.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){rd(this.inner,(t,r)=>{for(const[t,n]of r)e(t,n)})}isEmpty(){return rh(this.inner)}size(){return this.innerSize}}const iJ=new rp(es.comparator);function iX(){return iJ}const iZ=new rp(es.comparator);function i0(...e){let t=iZ;for(const r of e)t=t.insert(r.key,r);return t}function i1(){return i6()}function i2(e){let t=iZ;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function i3(){return i6()}function i4(){return i6()}function i6(){return new iY(e=>e.toString(),(e,t)=>e.isEqual(t))}const i9=new rp(es.comparator);function i5(){return i9}const i7=new ry(es.comparator);function i8(...e){let t=i7;for(const r of e)t=t.add(r);return t}const se=new ry(H);function st(){return se}function sr(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rG(t)?"-0":t}}function sn(e){return{integerValue:""+e}}function si(e,t){return rK(t)?sn(t):sr(e,t)}class ss{constructor(){this._=void 0}}function sa(e,t,r){return e instanceof sc?rL(r,t):e instanceof sd?sh(e,t):e instanceof sp?sf(e,t):sg(e,t)}function so(e,t,r){return e instanceof sd?sh(e,t):e instanceof sp?sf(e,t):r}function sl(e,t){return e instanceof sm?nT(t)?t:{integerValue:0}:null}function su(e,t){return e instanceof sd&&t instanceof sd||e instanceof sp&&t instanceof sp?X(e.elements,t.elements,r0):e instanceof sm&&t instanceof sm?r0(e.operand,t.operand):e instanceof sc&&t instanceof sc}class sc extends ss{}class sd extends ss{constructor(e){super(),this.elements=e}}function sh(e,t){const r=sv(t);for(const t of e.elements)r.some(e=>r0(e,t))||r.push(t);return{arrayValue:{values:r}}}class sp extends ss{constructor(e){super(),this.elements=e}}function sf(e,t){let r=sv(t);for(const t of e.elements)r=r.filter(e=>!r0(e,t));return{arrayValue:{values:r}}}class sm extends ss{constructor(e,t){super(),this.serializer=e,this.operand=t}}function sg(e,t){const r=sl(e,t),n=sy(r)+sy(e.operand);return nv(r)&&nv(e.operand)?sn(n):sr(e.serializer,n)}function sy(e){return rA(e.integerValue||e.doubleValue)}function sv(e){return nw(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class sb{constructor(e,t){this.field=e,this.transform=t}}function sT(e,t){return e.field.isEqual(t.field)&&su(e.transform,t.transform)}function sw(e,t){return void 0===e&&void 0===t||!!e&&!!t&&X(e,t,(e,t)=>sT(e,t))}class sS{constructor(e,t){this.version=e,this.transformResults=t}}class sE{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new sE}static exists(e){return new sE(void 0,e)}static updateTime(e){return new sE(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function s_(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class sC{}function sI(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new sj(e.key,sE.none()):new sD(e.key,e.data,sE.none());{let r=e.data,n=nx.empty(),i=new ry(ei.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new sP(e.key,n,new rw(i.toArray()),sE.none())}}function sR(e,t,r){e instanceof sD?sO(e,t,r):e instanceof sP?sM(e,t,r):sV(e,t,r)}function sk(e,t,r,n){return e instanceof sD?sx(e,t,r,n):e instanceof sP?sL(e,t,r,n):sz(e,t,r)}function sA(e,t){let r=null;for(const n of e.fieldTransforms){const e=t.data.field(n.field),i=sl(n.transform,e||null);null!=i&&(null===r&&(r=nx.empty()),r.set(n.field,i))}return r||null}function sN(e,t){return!!(e.type===t.type&&e.key.isEqual(t.key)&&e.precondition.isEqual(t.precondition)&&sw(e.fieldTransforms,t.fieldTransforms))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class sD extends sC{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}function sO(e,t,r){const n=e.value.clone(),i=sB(e.fieldTransforms,t,r.transformResults);n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}function sx(e,t,r,n){if(!s_(e.precondition,t))return r;const i=e.value.clone(),s=sU(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}class sP extends sC{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function sM(e,t,r){if(!s_(e.precondition,t)){t.convertToUnknownDocument(r.version);return}const n=sB(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(sF(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}function sL(e,t,r,n){if(!s_(e.precondition,t))return r;const i=sU(e.fieldTransforms,n,t),s=t.data;return(s.setAll(sF(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}function sF(e){const t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const n=e.data.field(r);t.set(r,n)}}),t}function sB(e,t,r){const n=new Map;D(e.length===r.length,32656,{serverTransformResultCount:r.length,fieldTransformCount:e.length});for(let i=0;i<r.length;i++){const s=e[i],a=s.transform,o=t.data.field(s.field);n.set(s.field,so(a,o,r[i]))}return n}function sU(e,t,r){const n=new Map;for(const i of e){const e=i.transform,s=r.data.field(i.field);n.set(i.field,sa(e,s,t))}return n}class sj extends sC{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function sV(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}function sz(e,t,r){return s_(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}class sq extends sC{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class s${constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const n=this.mutations[t];n.key.isEqual(e.key)&&sR(n,e,r[t])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=sk(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=sk(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=i4();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=sI(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(eT.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),i8())}isEqual(e){return this.batchId===e.batchId&&X(this.mutations,e.mutations,(e,t)=>sN(e,t))&&X(this.baseMutations,e.baseMutations,(e,t)=>sN(e,t))}}class sG{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){D(e.mutations.length===r.length,58842,{mutationsSent:e.mutations.length,resultsReceived:r.length});let n=i5(),i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new sG(e,t,r,n)}}class sK{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class sH{constructor(e,t){this.count=e,this.unchangedNames=t}}function sW(e){switch(e){case x.OK:return A(64938);case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0;default:return A(15467,{code:e})}}function sQ(e){return sW(e)&&e!==x.ABORTED}function sY(e){if(void 0===e)return I("GRPC error has no .code"),x.UNKNOWN;switch(e){case s.OK:return x.OK;case s.CANCELLED:return x.CANCELLED;case s.UNKNOWN:return x.UNKNOWN;case s.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case s.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case s.INTERNAL:return x.INTERNAL;case s.UNAVAILABLE:return x.UNAVAILABLE;case s.UNAUTHENTICATED:return x.UNAUTHENTICATED;case s.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case s.NOT_FOUND:return x.NOT_FOUND;case s.ALREADY_EXISTS:return x.ALREADY_EXISTS;case s.PERMISSION_DENIED:return x.PERMISSION_DENIED;case s.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case s.ABORTED:return x.ABORTED;case s.OUT_OF_RANGE:return x.OUT_OF_RANGE;case s.UNIMPLEMENTED:return x.UNIMPLEMENTED;case s.DATA_LOSS:return x.DATA_LOSS;default:return A(39323,{code:e})}}!function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS"}(s||(s={}));class sJ extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}const sX=null;function sZ(){return new c.TextEncoder}function s0(){return new TextDecoder("utf-8")}const s1=new n([4294967295,4294967295],0);function s2(e){const t=sZ().encode(e),r=new i;return r.update(t),new Uint8Array(r.digest())}function s3(e){const t=new DataView(e.buffer),r=t.getUint32(0,!0),i=t.getUint32(4,!0),s=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new n([r,i],0),new n([s,a],0)]}class s4{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new s6(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new s6(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new s6(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=8*e.length-t,this.bitCountInInteger=n.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(n.fromNumber(r)));return 1===i.compare(s1)&&(i=new n([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(0===this.bitCount)return!1;const[t,r]=s3(s2(e));for(let e=0;e<this.hashCount;e++){const n=this.getBitIndex(t,r,e);if(!this.isBitSet(n))return!1}return!0}static create(e,t,r){const n=e%8==0?0:8-e%8,i=new s4(new Uint8Array(Math.ceil(e/8)),n,t);return r.forEach(e=>i.insert(e)),i}insert(e){if(0===this.bitCount)return;const[t,r]=s3(s2(e));for(let e=0;e<this.hashCount;e++){const n=this.getBitIndex(t,r,e);this.setBit(n)}}setBit(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class s6 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class s9{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const n=new Map;return n.set(e,s5.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new s9(eT.min(),n,new rp(H),iX(),i8())}}class s5{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new s5(r,t,i8(),i8(),i8())}}class s7{constructor(e,t,r,n){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=n}}class s8{constructor(e,t){this.targetId=e,this.existenceFilter=t}}class ae{constructor(e,t,r=r_.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class at{constructor(){this.pendingResponses=0,this.documentChanges=as(),this._resumeToken=r_.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=i8(),t=i8(),r=i8();return this.documentChanges.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:A(38017,{changeType:i})}}),new s5(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=as()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,D(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}const ar="WatchChangeAggregator";class an{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=iX(),this.pendingDocumentUpdatesByTarget=ai(),this.pendingDocumentTargetMapping=ai(),this.pendingTargetResets=new rp(H)}handleDocumentChange(e){for(const t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(const t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{const r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:A(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((e,r)=>{this.isActiveTarget(r)&&t(r)})}handleExistenceFilter(e){const t=e.targetId,r=e.existenceFilter.count,n=this.targetDataForActiveTarget(t);if(n){const i=n.target;if(id(i)){if(0===r){const e=new es(i.path);this.removeDocumentFromTarget(t,e,nM.newNoDocument(e,eT.min()))}else D(1===r,20013,{expectedCount:r})}else{const n=this.getCurrentDocumentCountForTarget(t);if(n!==r){const r=this.parseBloomFilter(e),i=r?this.applyBloomFilter(r,e,n):1;if(0!==i){this.resetTarget(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,e)}sX?.notifyOnExistenceFilterMismatch(aa(n,e.existenceFilter,this.metadataProvider.getDatabaseId(),r,i))}}}}parseBloomFilter(e){let t,r;const n=e.existenceFilter.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=rN(i).toUint8Array()}catch(e){if(e instanceof sJ)return R("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new s4(t,s,a)}catch(e){return e instanceof s6?R("BloomFilter error: ",e):R("Applying bloom filter failed: ",e),null}return 0===r.bitCount?null:r}applyBloomFilter(e,t,r){return t.existenceFilter.count===r-this.filterRemovedDocuments(e,t.targetId)?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{const i=this.metadataProvider.getDatabaseId(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;!e.mightContain(s)&&(this.removeDocumentFromTarget(t,r,null),n++)}),n}createRemoteEvent(e){const t=new Map;this.targetStates.forEach((r,n)=>{const i=this.targetDataForActiveTarget(n);if(i){if(r.current&&id(i.target)){const t=new es(i.target.path);this.ensureDocumentUpdateByTarget(t).has(n)||this.targetContainsDocument(n,t)||this.removeDocumentFromTarget(n,t,nM.newNoDocument(t,e))}r.hasPendingChanges&&(t.set(n,r.toTargetChange()),r.clearPendingChanges())}});let r=i8();this.pendingDocumentTargetMapping.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{const t=this.targetDataForActiveTarget(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.pendingDocumentUpdates.forEach((t,r)=>r.setReadTime(e));const n=new s9(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=iX(),this.pendingDocumentUpdatesByTarget=ai(),this.pendingDocumentTargetMapping=ai(),this.pendingTargetResets=new rp(H),n}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;const r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(t.key,this.ensureDocumentUpdateByTarget(t.key).add(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;const n=this.ensureTargetState(e);this.targetContainsDocument(e,t)?n.addDocumentChange(t,1):n.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).add(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){const t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new at,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new ry(H),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}ensureDocumentUpdateByTarget(e){let t=this.pendingDocumentUpdatesByTarget.get(e);return t||(t=new ry(H),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(e,t)),t}isActiveTarget(e){const t=null!==this.targetDataForActiveTarget(e);return t||C(ar,"Detected inactive target",e),t}targetDataForActiveTarget(e){const t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new at),this.metadataProvider.getRemoteKeysForTarget(e).forEach(t=>{this.removeDocumentFromTarget(e,t,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}}function ai(){return new rp(es.comparator)}function as(){return new rp(es.comparator)}function aa(e,t,r,n,i){const s={localCacheCount:e,existenceFilterCount:t.count,databaseId:r.database,projectId:r.projectId},a=t.unchangedNames;return a&&(s.bloomFilter={applied:0===i,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>n?.mightContain(e)??!1}),s}const ao=(()=>{const e={};return e.asc="ASCENDING",e.desc="DESCENDING",e})(),al=(()=>{const e={};return e["<"]="LESS_THAN",e["<="]="LESS_THAN_OR_EQUAL",e[">"]="GREATER_THAN",e[">="]="GREATER_THAN_OR_EQUAL",e["=="]="EQUAL",e["!="]="NOT_EQUAL",e["array-contains"]="ARRAY_CONTAINS",e.in="IN",e["not-in"]="NOT_IN",e["array-contains-any"]="ARRAY_CONTAINS_ANY",e})(),au=(()=>{const e={};return e.and="AND",e.or="OR",e})();class ac{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ad(e){return new P(void 0===e.code?x.UNKNOWN:sY(e.code),e.message||"")}function ah(e,t){return e.useProto3Json||r$(t)?t:{value:t}}function ap(e){let t;return r$(t="object"==typeof e?e.value:e)?null:t}function af(e,t){if(!e.useProto3Json)return{seconds:""+t.seconds,nanos:t.nanoseconds};{const e=new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),r=("000000000"+t.nanoseconds).slice(-9);return`${e}.${r}Z`}}function am(e){const t=rk(e);return new eb(t.seconds,t.nanos)}function ag(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function ay(e,t){return e.useProto3Json?(D(void 0===t||"string"==typeof t,58123),r_.fromBase64String(t||"")):(D(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),r_.fromUint8Array(t||new Uint8Array))}function av(e,t){return af(e,t.toTimestamp())}function ab(e){return D(!!e,49232),eT.fromTimestamp(am(e))}function aT(e,t){return aw(e,t).canonicalString()}function aw(e,t){const r=ak(e).child("documents");return void 0===t?r:r.child(t)}function aS(e){const t=er.fromString(e);return D(ob(t),10190,{key:t.toString()}),t}function aE(e,t){return aT(e.databaseId,t.path)}function a_(e,t){const r=aS(t);if(r.get(1)!==e.databaseId.projectId)throw new P(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new P(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new es(aA(r))}function aC(e,t){return aT(e.databaseId,t)}function aI(e){const t=aS(e);return 4===t.length?er.emptyPath():aA(t)}function aR(e){return new er(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ak(e){return new er(["projects",e.projectId,"databases",e.database])}function aA(e){return D(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function aN(e,t,r){return{name:aE(e,t),fields:r.value.mapValue.fields}}function aD(e,t){return{name:aE(e,t.key),fields:t.data.value.mapValue.fields,updateTime:af(e,t.version.toTimestamp()),createTime:af(e,t.createTime.toTimestamp())}}function aO(e,t,r){const n=a_(e,t.name),i=ab(t.updateTime),s=t.createTime?ab(t.createTime):eT.min(),a=new nx({mapValue:{fields:t.fields}}),o=nM.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function ax(e,t){D(!!t.found,43571),t.found.name,t.found.updateTime;const r=a_(e,t.found.name),n=ab(t.found.updateTime),i=t.found.createTime?ab(t.found.createTime):eT.min(),s=new nx({mapValue:{fields:t.found.fields}});return nM.newFoundDocument(r,n,i,s)}function aP(e,t){D(!!t.missing,3894),D(!!t.readTime,22933);const r=a_(e,t.missing),n=ab(t.readTime);return nM.newNoDocument(r,n)}function aM(e,t){return"found"in t?ax(e,t):"missing"in t?aP(e,t):A(7234,{result:t})}function aL(e,t){let r;if("targetChange"in t){t.targetChange;const n=aF(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=ay(e,t.targetChange.resumeToken),a=t.targetChange.cause;r=new ae(n,i,s,a&&ad(a)||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const i=a_(e,n.document.name),s=ab(n.document.updateTime),a=n.document.createTime?ab(n.document.createTime):eT.min(),o=new nx({mapValue:{fields:n.document.fields}}),l=nM.newFoundDocument(i,s,a,o);r=new s7(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const i=a_(e,n.document),s=n.readTime?ab(n.readTime):eT.min(),a=nM.newNoDocument(i,s);r=new s7([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const i=a_(e,n.document);r=new s7([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return A(11601,{change:t});t.filter;const e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new sH(n,i);r=new s8(e.targetId,s)}return r}function aF(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:A(39313,{state:e})}function aB(e){if(!("targetChange"in e))return eT.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?eT.min():ab(t.readTime)}function aU(e,t){let r;if(t instanceof sD)r={update:aN(e,t.key,t.value)};else if(t instanceof sj)r={delete:aE(e,t.key)};else if(t instanceof sP)r={update:aN(e,t.key,t.data),updateMask:oy(t.fieldMask)};else{if(!(t instanceof sq))return A(16599,{mutationType:t.type});r={verify:aE(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(t=>aG(e,t))),t.precondition.isNone||(r.currentDocument=aV(e,t.precondition)),r}function aj(e,t){const r=t.currentDocument?az(t.currentDocument):sE.none(),n=t.updateTransforms?t.updateTransforms.map(t=>aK(e,t)):[];if(t.update){t.update.name;const i=a_(e,t.update.name),s=new nx({mapValue:{fields:t.update.fields}});return t.updateMask?new sP(i,s,ov(t.updateMask),r,n):new sD(i,s,r,n)}return t.delete?new sj(a_(e,t.delete),r):t.verify?new sq(a_(e,t.verify),r):A(1463,{proto:t})}function aV(e,t){return void 0!==t.updateTime?{updateTime:av(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:A(27497)}function az(e){return void 0!==e.updateTime?sE.updateTime(ab(e.updateTime)):void 0!==e.exists?sE.exists(e.exists):sE.none()}function aq(e,t){let r=e.updateTime?ab(e.updateTime):ab(t);return r.isEqual(eT.min())&&(r=ab(t)),new sS(r,e.transformResults||[])}function a$(e,t){return e&&e.length>0?(D(void 0!==t,14353),e.map(e=>aq(e,t))):[]}function aG(e,t){const r=t.transform;if(r instanceof sc)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof sd)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof sp)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof sm)return{fieldPath:t.field.canonicalString(),increment:r.operand};throw A(20930,{transform:t.transform})}function aK(e,t){let r=null;return"setToServerValue"in t?(D("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new sc):"appendMissingElements"in t?r=new sd(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new sp(t.removeAllFromArray.values||[]):"increment"in t?r=new sm(e,t.increment):A(16584,{proto:t}),new sb(ei.fromServerFormat(t.fieldPath),r)}function aH(e,t){return{documents:[aC(e,t.path)]}}function aW(e){const t=e.documents.length;return D(1===t,1966,{count:t}),iD(i_(aI(e.documents[0])))}function aQ(e,t){let r;const n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(r=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=aC(e,r);const s=a2(t.filters);s&&(n.structuredQuery.where=s);const a=a6(t.orderBy);a&&(n.structuredQuery.orderBy=a);const o=ah(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=a5(t.startAt)),t.endAt&&(n.structuredQuery.endAt=a7(t.endAt)),{queryTarget:n,parent:r}}function aY(e,t,r,n){let{queryTarget:i,parent:s}=aQ(e,t),a={},o=[],l=0;return r.forEach(e=>{const t=n?e.alias:`aggregate_${l++}`;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:oo(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:oo(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},aliasMap:a,parent:s}}function aJ(e){let t=aI(e.parent),r=e.structuredQuery,n=r.from?r.from.length:0,i=null;if(n>0){D(1===n,65062);const e=r.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];r.where&&(s=a3(r.where));let a=[];r.orderBy&&(a=a9(r.orderBy));let o=null;r.limit&&(o=ap(r.limit));let l=null;r.startAt&&(l=a8(r.startAt));let u=null;return r.endAt&&(u=oe(r.endAt)),iE(t,i,a,s,o,"F",l,u)}function aX(e){return iD(aJ(e))}function aZ(e,t){const r=a0(t.purpose);return null==r?null:{"goog-listen-tags":r}}function a0(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return A(28987,{purpose:e})}}function a1(e,t){let r;const n=t.target;if((r=id(n)?{documents:aH(e,n)}:{query:aQ(e,n).queryTarget}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=ag(e,t.resumeToken);const n=ah(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(eT.min())>0){r.readTime=af(e,t.snapshotVersion.toTimestamp());const n=ah(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}function a2(e){if(0!==e.length)return od(nW.create(e,"and"))}function a3(e){const t=a4(e);return t instanceof nW&&nJ(t)?t.getFilters():[t]}function a4(e){return void 0!==e.unaryFilter?of(e):void 0!==e.fieldFilter?om(e):void 0!==e.compositeFilter?og(e):A(30097,{filter:e})}function a6(e){if(0!==e.length)return e.map(e=>ou(e))}function a9(e){return e.map(e=>oc(e))}function a5(e){return{before:e.inclusive,values:e.position}}function a7(e){return{before:!e.inclusive,values:e.position}}function a8(e){const t=!!e.before;return new nF(e.values||[],t)}function oe(e){const t=!e.before;return new nF(e.values||[],t)}function ot(e){return ao[e]}function or(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function on(e){return al[e]}function oi(e){return au[e]}function os(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return A(58110);default:return A(50506)}}function oa(e){switch(e){case"AND":return"and";case"OR":return"or";default:return A(1026)}}function oo(e){return{fieldPath:e.canonicalString()}}function ol(e){return ei.fromServerFormat(e.fieldPath)}function ou(e){return{field:oo(e.field),direction:ot(e.dir)}}function oc(e){return new nz(ol(e.field),or(e.direction))}function od(e){return e instanceof nH?op(e):e instanceof nW?oh(e):A(54877,{filter:e})}function oh(e){const t=e.getFilters().map(e=>od(e));return 1===t.length?t[0]:{compositeFilter:{op:oi(e.op),filters:t}}}function op(e){if("=="===e.op){if(nE(e.value))return{unaryFilter:{field:oo(e.field),op:"IS_NAN"}};if(nS(e.value))return{unaryFilter:{field:oo(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(nE(e.value))return{unaryFilter:{field:oo(e.field),op:"IS_NOT_NAN"}};if(nS(e.value))return{unaryFilter:{field:oo(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:oo(e.field),op:on(e.op),value:e.value}}}function of(e){switch(e.unaryFilter.op){case"IS_NAN":const t=ol(e.unaryFilter.field);return nH.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=ol(e.unaryFilter.field);return nH.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const n=ol(e.unaryFilter.field);return nH.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=ol(e.unaryFilter.field);return nH.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return A(61313);default:return A(60726)}}function om(e){return nH.create(ol(e.fieldFilter.field),os(e.fieldFilter.op),e.fieldFilter.value)}function og(e){return nW.create(e.compositeFilter.filters.map(e=>a4(e)),oa(e.compositeFilter.op))}function oy(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function ov(e){return new rw((e.fieldPaths||[]).map(e=>ei.fromServerFormat(e)))}function ob(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class oT{constructor(e,t,r,n,i=eT.min(),s=eT.min(),a=r_.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new oT(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new oT(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new oT(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new oT(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ow{constructor(e){this.remoteSerializer=e}}function oS(e,t){let r;if(t.document)r=aO(e.remoteSerializer,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=es.fromSegments(t.noDocument.path),n=oR(t.noDocument.readTime);r=nM.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return A(56709);const e=es.fromSegments(t.unknownDocument.path),n=oR(t.unknownDocument.version);r=nM.newUnknownDocument(e,n)}return t.readTime&&r.setReadTime(oC(t.readTime)),r}function oE(e,t){const r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:o_(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=aD(e.remoteSerializer,t);else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:oI(t.version)};else{if(!t.isUnknownDocument())return A(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:oI(t.version)}}return n}function o_(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function oC(e){const t=new eb(e[0],e[1]);return eT.fromTimestamp(t)}function oI(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function oR(e){const t=new eb(e.seconds,e.nanoseconds);return eT.fromTimestamp(t)}function ok(e,t,r){const n=r.baseMutations.map(t=>aU(e.remoteSerializer,t)),i=r.mutations.map(t=>aU(e.remoteSerializer,t));return{userId:t,batchId:r.batchId,localWriteTimeMs:r.localWriteTime.toMillis(),baseMutations:n,mutations:i}}function oA(e,t){const r=(t.baseMutations||[]).map(t=>aj(e.remoteSerializer,t));for(let e=0;e<t.mutations.length-1;++e){const r=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const n=t.mutations[e+1];r.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const n=t.mutations.map(t=>aj(e.remoteSerializer,t)),i=eb.fromMillis(t.localWriteTimeMs);return new s$(t.batchId,i,r,n)}function oN(e){let t;const r=oR(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?oR(e.lastLimboFreeSnapshotVersion):eT.min();return new oT(t=oO(e.query)?aW(e.query):aX(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,n,r_.fromBase64String(e.resumeToken))}function oD(e,t){let r;const n=oI(t.snapshotVersion),i=oI(t.lastLimboFreeSnapshotVersion);r=id(t.target)?aH(e.remoteSerializer,t.target):aQ(e.remoteSerializer,t.target).queryTarget;const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:il(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function oO(e){return void 0!==e.documents}function ox(e){return{id:e.bundleId,createTime:oR(e.createTime),version:e.version}}function oP(e){return{bundleId:e.id,createTime:oI(ab(e.createTime)),version:e.version}}function oM(e){return{name:e.name,query:oF(e.bundledQuery),readTime:oR(e.readTime)}}function oL(e){return{name:e.name,readTime:oI(ab(e.readTime)),bundledQuery:e.bundledQuery}}function oF(e){const t=aJ({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?iL(t,t.limit,"L"):t}function oB(e){return{name:e.name,query:oF(e.bundledQuery),readTime:ab(e.readTime)}}function oU(e){return{id:e.id,version:e.version,createTime:ab(e.createTime)}}function oj(e,t){return new sK(t.largestBatchId,aj(e.remoteSerializer,t.overlayMutation))}function oV(e,t,r){const[n,i,s]=oz(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:aU(e.remoteSerializer,r.mutation)}}function oz(e,t){const r=t.path.lastSegment();return[e,e8(t.path.popLast()),r]}function oq(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function o$(e,t){const r=t?new eD(t.sequenceNumber,new eP(oR(t.readTime),new es(tr(t.documentKey)),t.largestBatchId)):eD.empty(),n=e.fields.map(([e,t])=>new eA(ei.fromServerFormat(e),t));return new eE(e.indexId,e.collectionGroup,n,r)}function oG(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:oI(n.readTime),documentKey:e8(n.documentKey.path),largestBatchId:n.largestBatchId}}class oK{getBundleMetadata(e,t){return oH(e).get(t).next(e=>{if(e)return ox(e)})}saveBundleMetadata(e,t){return oH(e).put(oP(t))}getNamedQuery(e,t){return oW(e).get(t).next(e=>{if(e)return oM(e)})}saveNamedQuery(e,t){return oW(e).put(oL(t))}}function oH(e){return ru(e,tU)}function oW(e){return ru(e,tV)}class oQ{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){return new oQ(e,t.uid||"")}getOverlay(e,t){return oY(e).get(oz(this.userId,t)).next(e=>e?oj(this.serializer,e):null)}getOverlays(e,t){const r=i3();return eU.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){const n=[];return r.forEach((r,i)=>{const s=new sK(t,i);n.push(this.saveOverlay(e,s))}),eU.waitFor(n)}removeOverlaysForBatchId(e,t,r){const n=new Set;t.forEach(e=>n.add(e8(e.getCollectionPath())));const i=[];return n.forEach(t=>{const n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(oY(e).deleteAll(t3,n))}),eU.waitFor(i)}getOverlaysForCollection(e,t,r){const n=i3(),i=e8(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return oY(e).loadAll(t3,s).next(e=>{for(const t of e){const e=oj(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i;const s=i3(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return oY(e).iterate({index:t6,range:a},(e,t,r)=>{const a=oj(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}saveOverlay(e,t){return oY(e).put(oV(this.serializer,this.userId,t))}}function oY(e){return ru(e,t1)}class oJ{globalsStore(e){return ru(e,t5)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(e=>{const t=e?.value;return t?r_.fromUint8Array(t):r_.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}}const oX=5,oZ=10,o0=13,o1=15,o2=20,o3=25,o4=30,o6=37,o9=45,o5=50,o7=53,o8=55,le=60,lt=2;class lr{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,oX);else if("booleanValue"in e)this.writeValueTypeLabel(t,oZ),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,o1),t.writeNumber(rA(e.integerValue));else if("doubleValue"in e){const r=rA(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,o0):(this.writeValueTypeLabel(t,o1),rG(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,o2),"string"==typeof r&&(r=rk(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,o4),t.writeBytes(rN(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.writeValueTypeLabel(t,o9),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?nR(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):nC(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):A(19022,{indexValue:e})}writeIndexString(e,t){this.writeValueTypeLabel(t,o3),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){const r=e.fields||{};for(const e of(this.writeValueTypeLabel(t,o8),Object.keys(r)))this.writeIndexString(e,t),this.writeIndexValueAux(r[e],t)}writeIndexVector(e,t){const r=e.fields||{};this.writeValueTypeLabel(t,o7);const n=rJ,i=r[n].arrayValue?.values?.length||0;this.writeValueTypeLabel(t,o1),t.writeNumber(rA(i)),this.writeIndexString(n,t),this.writeIndexValueAux(r[n],t)}writeIndexArray(e,t){const r=e.values||[];for(const e of(this.writeValueTypeLabel(t,o5),r))this.writeIndexValueAux(e,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,o6),es.fromName(e).path.forEach(e=>{this.writeValueTypeLabel(t,le),this.writeUnlabeledIndexString(e,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(lt)}}lr.INSTANCE=new lr;const ln="\uD800",li="\uDBFF",ls=0,la=255,lo=1,ll=255,lu=255,lc=0,ld=64,lh=8,lp=1024;function lf(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}function lm(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function lg(e){let t=0;for(let r=0;r<8;++r){const n=lm(255&e[r]);if(t+=n,8!==n)break}return t}function ly(e){return Math.ceil((ld-lg(e))/lh)}class lv{constructor(){this.buffer=new Uint8Array(lp),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.writeByteAscending(e);else if(e<2048)this.writeByteAscending(960|e>>>6),this.writeByteAscending(128|63&e);else if(t<ln||li<t)this.writeByteAscending(480|e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e);else{const e=t.codePointAt(0);this.writeByteAscending(240|e>>>18),this.writeByteAscending(128|63&e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.writeByteDescending(e);else if(e<2048)this.writeByteDescending(960|e>>>6),this.writeByteDescending(128|63&e);else if(t<ln||li<t)this.writeByteDescending(480|e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e);else{const e=t.codePointAt(0);this.writeByteDescending(240|e>>>18),this.writeByteDescending(128|63&e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e)}}this.writeSeparatorDescending()}writeNumberAscending(e){const t=this.toOrderedBits(e),r=ly(t);this.ensureAvailable(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}writeNumberDescending(e){const t=this.toOrderedBits(e),r=ly(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}writeInfinityAscending(){this.writeEscapedByteAscending(ll),this.writeEscapedByteAscending(lu)}writeInfinityDescending(){this.writeEscapedByteDescending(ll),this.writeEscapedByteDescending(lu)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){const t=lf(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let e=1;e<t.length;++e)t[e]^=r?255:0;return t}writeByteAscending(e){const t=255&e;t===ls?(this.writeEscapedByteAscending(ls),this.writeEscapedByteAscending(la)):t===ll?(this.writeEscapedByteAscending(ll),this.writeEscapedByteAscending(lc)):this.writeEscapedByteAscending(t)}writeByteDescending(e){const t=255&e;t===ls?(this.writeEscapedByteDescending(ls),this.writeEscapedByteDescending(la)):t===ll?(this.writeEscapedByteDescending(ll),this.writeEscapedByteDescending(lc)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(ls),this.writeEscapedByteAscending(lo)}writeSeparatorDescending(){this.writeEscapedByteDescending(ls),this.writeEscapedByteDescending(lo)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class lb{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class lT{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class lw{constructor(){this.orderedCode=new lv,this.ascending=new lb(this.orderedCode),this.descending=new lT(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return 0===e?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class lS{constructor(e,t,r,n){this._indexId=e,this._documentKey=t,this._arrayValue=r,this._directionalValue=n}successor(){const e=this._directionalValue.length,t=0===e||255===this._directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this._directionalValue,0),t!==e?r.set([0],this._directionalValue.length):++r[r.length-1],new lS(this._indexId,this._documentKey,this._arrayValue,r)}dbIndexEntry(e,t,r){return{indexId:this._indexId,uid:e,arrayValue:lC(this._arrayValue),directionalValue:lC(this._directionalValue),orderedDocumentKey:lC(t),documentKey:r.path.toArray()}}dbIndexEntryKey(e,t,r){const n=this.dbIndexEntry(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function lE(e,t){let r=e._indexId-t._indexId;return 0!==r||0!==(r=l_(e._arrayValue,t._arrayValue))||0!==(r=l_(e._directionalValue,t._directionalValue))?r:es.comparator(e._documentKey,t._documentKey)}function l_(e,t){for(let r=0;r<e.length&&r<t.length;++r){const n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function lC(e){return(0,d.WO)()?lR(e):e}function lI(e){return"string"!=typeof e?e:lk(e)}function lR(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}function lk(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}class lA{constructor(e){for(const t of(this.inequalityFilters=new ry((e,t)=>ei.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[],e.filters)){const e=t;e.isInequality()?this.inequalityFilters=this.inequalityFilters.add(e):this.equalityFilters.push(e)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(D(e.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;const t=e_(e);if(void 0!==t&&!this.hasMatchingEqualityFilter(t))return!1;let r=eC(e),n=new Set,i=0,s=0;for(;i<r.length;++i)if(this.hasMatchingEqualityFilter(r[i]))n=n.add(r[i].fieldPath.canonicalString());else break;if(i===r.length)return!0;if(this.inequalityFilters.size>0){const e=this.inequalityFilters.getIterator().getNext();if(!n.has(e.field.canonicalString())){const t=r[i];if(!this.matchesFilter(e,t)||!this.matchesOrderBy(this.orderBys[s++],t))return!1}++i}for(;i<r.length;++i){const e=r[i];if(s>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[s++],e))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new ry(ei.comparator),t=[];for(const r of this.equalityFilters)if(!r.field.isKeyField()){if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new eA(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new eA(r.field,0))}}for(const r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new eA(r.field,"asc"===r.dir?0:1)));return new eE(eE.UNKNOWN_ID,this.collectionId,t,eD.empty())}hasMatchingEqualityFilter(e){for(const t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}matchesOrderBy(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function lN(e){if(D(e instanceof nH||e instanceof nW,20012),e instanceof nH){if(!(e instanceof ir))return e;{const t=e.value.arrayValue?.values?.map(t=>nH.create(e.field,"==",t))||[];return nW.create(t,"or")}}const t=e.filters.map(e=>lN(e));return nW.create(t,e.op)}function lD(e){if(0===e.getFilters().length)return[];const t=lL(lN(e));return(D(lP(t),7391),lO(t)||lx(t))?[t]:t.getFilters()}function lO(e){return e instanceof nH}function lx(e){return e instanceof nW&&nJ(e)}function lP(e){return lO(e)||lx(e)||lM(e)}function lM(e){if(e instanceof nW&&nY(e)){for(const t of e.getFilters())if(!lO(t)&&!lx(t))return!1;return!0}return!1}function lL(e){if(D(e instanceof nH||e instanceof nW,34018),e instanceof nH)return e;if(1===e.filters.length)return lL(e.filters[0]);let t=e.filters.map(e=>lL(e)),r=nW.create(t,e.op);return lP(r=lV(r))?r:(D(r instanceof nW,64498),D(nQ(r),40251),D(r.filters.length>1,57927),r.filters.reduce((e,t)=>lF(e,t)))}function lF(e,t){let r;return D(e instanceof nH||e instanceof nW,38388),D(t instanceof nH||t instanceof nW,25473),lV(r=e instanceof nH?t instanceof nH?lB(e,t):lj(e,t):t instanceof nH?lj(t,e):lU(e,t))}function lB(e,t){return nW.create([e,t],"and")}function lU(e,t){if(D(e.filters.length>0&&t.filters.length>0,48005),nQ(e)&&nQ(t))return n3(e,t.getFilters());const r=nY(e)?e:t,n=nY(e)?t:e,i=r.filters.map(e=>lF(e,n));return nW.create(i,"or")}function lj(e,t){if(nQ(t))return n3(t,e.getFilters());{const r=t.filters.map(t=>lF(e,t));return nW.create(r,"or")}}function lV(e){if(D(e instanceof nH||e instanceof nW,11850),e instanceof nH)return e;const t=e.getFilters();if(1===t.length)return lV(t[0]);if(nX(e))return e;const r=t.map(e=>lV(e)),n=[];return(r.forEach(t=>{t instanceof nH?n.push(t):t instanceof nW&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length)?n[0]:nW.create(n,e.op)}class lz{constructor(){this.collectionParentIndex=new lq}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),eU.resolve()}getCollectionParents(e,t){return eU.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return eU.resolve()}deleteFieldIndex(e,t){return eU.resolve()}deleteAllFieldIndexes(e){return eU.resolve()}createTargetIndexes(e,t){return eU.resolve()}getDocumentsMatchingTarget(e,t){return eU.resolve(null)}getIndexType(e,t){return eU.resolve(0)}getFieldIndexes(e,t){return eU.resolve([])}getNextCollectionGroupToUpdate(e){return eU.resolve(null)}getMinOffset(e,t){return eU.resolve(eP.min())}getMinOffsetFromCollectionGroup(e,t){return eU.resolve(eP.min())}updateCollectionGroup(e,t,r){return eU.resolve()}updateIndexEntries(e,t){return eU.resolve()}}class lq{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new ry(er.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new ry(er.comparator)).toArray()}}const l$="IndexedDbIndexManager",lG=new Uint8Array(0);class lK{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new lq,this.targetToDnfSubTargets=new iY(e=>il(e),(e,t)=>ic(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){const r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});const i={collectionId:r,parent:e8(n)};return lH(e).put(i)}return eU.resolve()}getCollectionParents(e,t){const r=[],n=IDBKeyRange.bound([t,""],[Z(t),""],!1,!0);return lH(e).loadAll(n).next(e=>{for(const n of e){if(n.collectionId!==t)break;r.push(tr(n.parent))}return r})}addFieldIndex(e,t){const r=lQ(e),n=oq(t);delete n.indexId;const i=r.add(n);if(!t.indexState)return i.next();{const r=lY(e);return i.next(e=>{r.put(oG(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}}deleteFieldIndex(e,t){const r=lQ(e),n=lY(e),i=lW(e);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=lQ(e),r=lW(e),n=lY(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>n.deleteAll())}createTargetIndexes(e,t){return eU.forEach(this.getSubTargets(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){const r=new lA(t).buildTargetIndex();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=lW(e),n=!0,i=new Map;return eU.forEach(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(!n)return eU.resolve(null);{let e=i8(),n=[];return eU.forEach(i,(i,s)=>{C(l$,`Using index ${ek(i)} to execute ${il(t)}`);const a=ip(s,i),o=im(s,i),l=ig(s,i),u=iy(s,i),c=this.encodeBound(i,s,l),d=this.encodeBound(i,s,u),h=this.encodeValues(i,s,o),p=this.generateIndexRanges(i.indexId,a,c,l.inclusive,d,u.inclusive,h);return eU.forEach(p,i=>r.loadFirst(i,t.limit).next(t=>{t.forEach(t=>{const r=es.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(t=0===e.filters.length?[e]:lD(nW.create(e.filters,"and")).map(t=>io(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t)),t}generateIndexRanges(e,t,r,n,i,s,a){const o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let c=0;c<o;++c){const o=t?this.encodeSingleElement(t[c/l]):lG,d=this.generateLowerBound(e,o,r[c%l],n),h=this.generateUpperBound(e,o,i[c%l],s),p=a.map(t=>this.generateLowerBound(e,o,t,!0));u.push(...this.createRange(d,h,p))}return u}generateLowerBound(e,t,r,n){const i=new lS(e,es.empty(),t,r);return n?i:i.successor()}generateUpperBound(e,t,r,n){const i=new lS(e,es.empty(),t,r);return n?i.successor():i}getFieldIndex(e,t){const r=new lA(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(const n of e)r.servedByIndex(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.getSubTargets(t);return eU.forEach(n,t=>this.getFieldIndex(e,t).next(e=>{e?0!==r&&e.fields.length<iT(t)&&(r=1):r=0})).next(()=>iw(t)&&n.length>1&&2===r?1:r)}encodeDirectionalElements(e,t){const r=new lw;for(const n of eC(e)){const e=t.data.field(n.fieldPath);if(null==e)return null;const i=r.forKind(n.kind);lr.INSTANCE.writeIndexValue(e,i)}return r.encodedBytes()}encodeSingleElement(e){const t=new lw;return lr.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){const r=new lw;return lr.INSTANCE.writeIndexValue(ny(this.databaseId,t),r.forKind(eI(e))),r.encodedBytes()}encodeValues(e,t,r){if(null===r)return[];let n=[];n.push(new lw);let i=0;for(const s of eC(e)){const e=r[i++];for(const r of n)if(this.isInFilter(t,s.fieldPath)&&nw(e))n=this.expandIndexValues(n,s,e);else{const t=r.forKind(s.kind);lr.INSTANCE.writeIndexValue(e,t)}}return this.getEncodedBytes(n)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){const n=[...e],i=[];for(const e of r.arrayValue.values||[])for(const r of n){const n=new lw;n.seed(r.encodedBytes()),lr.INSTANCE.writeIndexValue(e,n.forKind(t.kind)),i.push(n)}return i}isInFilter(e,t){return!!e.filters.find(e=>e instanceof nH&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const r=lQ(e),n=lY(e);return(t?r.loadAll(tG,IDBKeyRange.bound(t,t)):r.loadAll()).next(e=>{const t=[];return eU.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{t.push(o$(e,r))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{const r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:H(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){const n=lQ(e),i=lY(e);return this.getNextSequenceNumber(e).next(e=>n.loadAll(tG,IDBKeyRange.bound(t,t)).next(t=>eU.forEach(t,t=>i.put(oG(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){const r=new Map;return eU.forEach(t,(t,n)=>{const i=r.get(t.collectionGroup);return(i?eU.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),eU.forEach(i,r=>this.getExistingIndexEntries(e,t,r).next(t=>{const i=this.computeIndexEntries(n,r);return t.isEqual(i)?eU.resolve():this.updateEntries(e,n,r,t,i)}))))})}addIndexEntry(e,t,r,n){return lW(e).put(n.dbIndexEntry(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}deleteIndexEntry(e,t,r,n){return lW(e).delete(n.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}getExistingIndexEntries(e,t,r){let n=lW(e),i=new ry(lE);return n.iterate({index:tZ,range:IDBKeyRange.only([r.indexId,this.uid,lC(this.encodeDirectionalKey(r,t))])},(e,n)=>{i=i.add(new lS(r.indexId,t,lI(n.arrayValue),lI(n.directionalValue)))}).next(()=>i)}computeIndexEntries(e,t){let r=new ry(lE),n=this.encodeDirectionalElements(t,e);if(null==n)return r;const i=e_(t);if(null!=i){const s=e.data.field(i.fieldPath);if(nw(s))for(const i of s.arrayValue.values||[])r=r.add(new lS(t.indexId,e.key,this.encodeSingleElement(i),n))}else r=r.add(new lS(t.indexId,e.key,lG,n));return r}updateEntries(e,t,r,n,i){C(l$,"Updating index entries for document '%s'",t.key);const s=[];return rb(n,i,lE,n=>{s.push(this.addIndexEntry(e,t,r,n))},n=>{s.push(this.deleteIndexEntry(e,t,r,n))}),eU.waitFor(s)}getNextSequenceNumber(e){let t=1;return lY(e).iterate({index:tQ,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>lE(e,t)).filter((e,t,r)=>!t||0!==lE(e,r[t-1]));const n=[];for(const i of(n.push(e),r)){const r=lE(i,e),s=lE(i,t);if(0===r)n[0]=e.successor();else if(r>0&&s<0)n.push(i),n.push(i.successor());else if(s>0)break}n.push(t);const i=[];for(let e=0;e<n.length;e+=2){if(this.isRangeMatchable(n[e],n[e+1]))return[];const t=n[e].dbIndexEntryKey(this.uid,lG,es.empty()),r=n[e+1].dbIndexEntryKey(this.uid,lG,es.empty());i.push(IDBKeyRange.bound(t,r))}return i}isRangeMatchable(e,t){return lE(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(lJ)}getMinOffset(e,t){return eU.mapArray(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>e||A(44426))).next(lJ)}}function lH(e){return ru(e,tM)}function lW(e){return ru(e,tJ)}function lQ(e){return ru(e,tq)}function lY(e){return ru(e,tH)}function lJ(e){D(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){const i=e[n].indexState.offset;0>eM(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new eP(t.readTime,t.documentKey,r)}function lX(e,t,r){let n=e.store(tl),i=e.store(tg),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.iterate({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{D(1===o,47070,{batchId:r.batchId})}));const u=[];for(const e of r.mutations){const n=tf(t,e.key.path,r.batchId);s.push(i.delete(n)),u.push(e.key)}return eU.waitFor(s).next(()=>u)}function lZ(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else if(e.noDocument)t=e.noDocument;else throw A(14731);return JSON.stringify(t).length}class l0{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.documentKeysByBatchId={}}static forUser(e,t,r,n){return D(""!==e.uid,64387),new l0(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return l3(e).iterate({index:tc,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){const i=l4(e),s=l3(e);return s.add({}).next(a=>{D("number"==typeof a,49019);let o=new s$(a,t,r,n),l=ok(this.serializer,this.userId,o),u=[],c=new ry((e,t)=>H(e.canonicalString(),t.canonicalString()));for(const e of n){const t=tf(this.userId,e.key.path,a);c=c.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,tm))}return c.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=o.keys()}),eU.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return l3(e).get(t).next(e=>e?(D(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),oA(this.serializer,e)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?eU.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(e=>{if(!e)return null;{const r=e.keys();return this.documentKeysByBatchId[t]=r,r}})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return l3(e).iterate({index:tc,range:n},(e,t,n)=>{t.userId===this.userId&&(D(t.batchId>=r,47524,{nextBatchId:r}),i=oA(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=rq;return l3(e).iterate({index:tc,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,rq],[this.userId,Number.POSITIVE_INFINITY]);return l3(e).loadAll(tc,t).next(e=>e.map(e=>oA(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=tp(this.userId,t.path),n=IDBKeyRange.lowerBound(r),i=[];return l4(e).iterate({range:n},(r,n,s)=>{const[a,o,l]=r,u=tr(o);if(a!==this.userId||!t.path.isEqual(u)){s.done();return}return l3(e).get(l).next(e=>{if(!e)throw A(61480,{indexKey:r,batchId:l});D(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(oA(this.serializer,e))})}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ry(H),n=[];return t.forEach(t=>{const i=tp(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=l4(e).iterate({range:s},(e,n,i)=>{const[s,a,o]=e,l=tr(a);if(s!==this.userId||!t.path.isEqual(l)){i.done();return}r=r.add(o)});n.push(a)}),eU.waitFor(n).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=tp(this.userId,r),s=IDBKeyRange.lowerBound(i),a=new ry(H);return l4(e).iterate({range:s},(e,t,i)=>{const[s,o,l]=e,u=tr(o);if(s!==this.userId||!r.isPrefixOf(u)){i.done();return}u.length===n&&(a=a.add(l))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){const r=[],n=[];return t.forEach(t=>{n.push(l3(e).get(t).next(e=>{if(null===e)throw A(35274,{batchId:t});D(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(oA(this.serializer,e))}))}),eU.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return lX(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),eU.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return eU.resolve();const r=IDBKeyRange.lowerBound(th(this.userId)),n=[];return l4(e).iterate({range:r},(e,t,r)=>{if(e[0]!==this.userId){r.done();return}{const t=tr(e[1]);n.push(t)}}).next(()=>{D(0===n.length,56720,{danglingKeys:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return l1(e,this.userId,t)}getMutationQueueMetadata(e){return l6(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:rq,lastStreamToken:""})}}function l1(e,t,r){let n=tp(t,r.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return l4(e).iterate({range:s,keysOnly:!0},(e,r,n)=>{const[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function l2(e,t){let r=!1;return l6(e).iterateSerial(n=>l1(e,n,t).next(e=>(e&&(r=!0),eU.resolve(!e)))).next(()=>r)}function l3(e){return ru(e,tl)}function l4(e){return ru(e,tg)}function l6(e){return ru(e,ta)}const l9=2;class l5{constructor(e){this.lastId=e}next(){return this.lastId+=l9,this.lastId}static forTargetCache(){return new l5(2-l9)}static forSyncEngine(){return new l5(1-l9)}}class l7{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{const r=new l5(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(e=>eT.fromTimestamp(new eb(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.saveMetadata(e,n)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>l8(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(t=>(D(t.targetCount>0,8065),t.targetCount-=1,this.saveMetadata(e,t)))}removeTargets(e,t,r){let n=0,i=[];return l8(e).iterate((s,a)=>{const o=oN(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>eU.waitFor(i)).next(()=>n)}forEachTarget(e,t){return l8(e).iterate((e,r)=>{t(oN(r))})}retrieveMetadata(e){return ue(e).get(tx).next(e=>(D(null!==e,2888),e))}saveMetadata(e,t){return ue(e).put(tx,t)}saveTargetData(e,t){return l8(e).put(oD(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(e=>e.targetCount)}getTargetData(e,t){let r=il(t),n=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),i=null;return l8(e).iterate({range:n,index:tR},(e,r,n)=>{const s=oN(r);ic(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){const n=[],i=ut(e);return t.forEach(t=>{const s=e8(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),eU.waitFor(n)}removeMatchingKeys(e,t,r){const n=ut(e);return eU.forEach(t,t=>{const i=e8(t.path);return eU.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){const r=ut(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=ut(e),i=i8();return n.iterate({range:r,keysOnly:!0},(e,t,r)=>{const n=new es(tr(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=e8(t.path),n=IDBKeyRange.bound([r],[Z(r)],!1,!0),i=0;return ut(e).iterate({index:tD,keysOnly:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}getTargetDataForTarget(e,t){return l8(e).get(t).next(e=>e?oN(e):null)}}function l8(e){return ru(e,tC)}function ue(e){return ru(e,tP)}function ut(e){return ru(e,tA)}const ur={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},un=-1,ui=41943040;class us{static withCacheSize(e){return new us(e,us.DEFAULT_COLLECTION_PERCENTILE,us.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}us.DEFAULT_COLLECTION_PERCENTILE=10,us.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,us.DEFAULT=new us(ui,us.DEFAULT_COLLECTION_PERCENTILE,us.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),us.DISABLED=new us(un,0,0);const ua="LruGarbageCollector",uo=1048576,ul=6e4,uu=3e5;function uc([e,t],[r,n]){const i=H(e,r);return 0===i?H(t,n):i}class ud{constructor(e){this.maxElements=e,this.buffer=new ry(uc),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){const t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();0>uc(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class uh{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==un&&this.scheduleGC(ul)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(e){C(ua,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){eH(e)?C(ua,"Ignoring IndexedDB error during garbage collection: ",e):await eB(e)}await this.scheduleGC(uu)})}}class up{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return eU.resolve(e4.INVALID);const r=new ud(t);return this.delegate.forEachTarget(e,e=>r.addElement(e.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,e=>r.addElement(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===un?(C("LruGarbageCollector","Garbage collection skipped; disabled"),eU.resolve(ur)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(C("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ur):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,n,i,s,a,o,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(C("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),_()<=u.in.DEBUG&&C("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-c}ms
	Determined least recently used ${n} in ${a-s}ms
	Removed ${i} targets in ${o-a}ms
	Removed ${e} documents in ${l-o}ms
Total Duration: ${l-c}ms`),eU.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}function uf(e,t){return new up(e,t)}class um{constructor(e,t){this.db=e,this.garbageCollector=uf(this,t)}getSequenceNumberCount(e){const t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(e,r)=>t(r))}addReference(e,t,r){return uv(e,r)}removeReference(e,t,r){return uv(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return uv(e,t)}isPinned(e,t){return l2(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.forEachOrphanedDocument(e,(s,a)=>{if(a<=t){const t=this.isPinned(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,eT.min()),ut(e).delete(ug(s))))});n.push(t)}}).next(()=>eU.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return uv(e,t)}forEachOrphanedDocument(e,t){let r;let n=ut(e),i=e4.INVALID;return n.iterate({index:tD},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==e4.INVALID&&t(new es(tr(r)),i),i=a,r=s):i=e4.INVALID}).next(()=>{i!==e4.INVALID&&t(new es(tr(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ug(e){return[0,e8(e.path)]}function uy(e,t){return{targetId:0,path:e8(e.path),sequenceNumber:t}}function uv(e,t){return ut(e).put(uy(t,e.currentSequenceNumber))}class ub{constructor(){this.changes=new iY(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,nM.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?eU.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class uT{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return u_(e).put(r)}removeEntry(e,t,r){return u_(e).delete(uI(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=nM.newInvalidDocument(t);return u_(e).iterate({index:tb,range:IDBKeyRange.only(uC(t))},(e,n)=>{r=this.maybeDecodeDocument(t,n)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:nM.newInvalidDocument(t)};return u_(e).iterate({index:tb,range:IDBKeyRange.only(uC(t))},(e,n)=>{r={document:this.maybeDecodeDocument(t,n),size:lZ(n)}}).next(()=>r)}getEntries(e,t){let r=iX();return this.forEachDbEntry(e,t,(e,t)=>{const n=this.maybeDecodeDocument(e,t);r=r.insert(e,n)}).next(()=>r)}getSizedEntries(e,t){let r=iX(),n=new rp(es.comparator);return this.forEachDbEntry(e,t,(e,t)=>{const i=this.maybeDecodeDocument(e,t);r=r.insert(e,i),n=n.insert(e,lZ(t))}).next(()=>({documents:r,sizeMap:n}))}forEachDbEntry(e,t,r){if(t.isEmpty())return eU.resolve();let n=new ry(uk);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(uC(n.first()),uC(n.last())),s=n.getIterator(),a=s.getNext();return u_(e).iterate({index:tb,range:i},(e,t,n)=>{const i=es.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>uk(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.skip(uC(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){const s=t.path,a=[s.popLast().toArray(),s.lastSegment(),o_(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return u_(e).loadAll(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=iX();for(const i of e){const e=this.maybeDecodeDocument(es.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(iz(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=iX(),s=uR(t,r),a=uR(t,eP.max());return u_(e).iterate({index:tw,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{const s=this.maybeDecodeDocument(es.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new uS(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return uE(e).get(t_).next(e=>(D(!!e,20021),e))}setMetadata(e,t){return uE(e).put(t_,t)}maybeDecodeDocument(e,t){if(t){const e=oS(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(eT.min())))return e}return nM.newInvalidDocument(e)}}function uw(e){return new uT(e)}class uS extends ub{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new iY(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new ry((e,t)=>H(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{const a=this.documentStates.get(i);if(t.push(this.documentCache.removeEntry(e,i,a.readTime)),s.isValidDocument()){const o=oE(this.documentCache.serializer,s);n=n.add(i.path.popLast());const l=lZ(o);r+=l-a.size,t.push(this.documentCache.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){const r=oE(this.documentCache.serializer,s.convertToNoDocument(eT.min()));t.push(this.documentCache.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.documentCache.updateMetadata(e,r)),eU.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(e=>(this.documentStates.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:e,sizeMap:t})=>(t.forEach((t,r)=>{this.documentStates.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function uE(e){return ru(e,tE)}function u_(e){return ru(e,ty)}function uC(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function uI(e,t){const r=e.path.toArray();return[r.slice(0,r.length-2),r[r.length-2],o_(t),r[r.length-1]]}function uR(e,t){const r=t.documentKey.path.toArray();return[e,o_(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function uk(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=H(r[e],n[e]))return i;return(i=H(r.length,n.length))||(i=H(r[r.length-2],n[n.length-2]))?i:H(r[r.length-1],n[n.length-1])}const uA=18;class uN{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class uD{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&sk(r.mutation,e,rw.empty(),eb.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,i8()).next(()=>t))}getLocalViewOfDocuments(e,t,r=i8()){const n=i3();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=i0();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const r=i3();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i8()))}populateOverlays(e,t,r){const n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=iX(),s=i6(),a=i1();return t.forEach((e,t)=>{const a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof sP)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),sk(a.mutation,t,a.mutation.getFieldMask(),eb.now())):s.set(t.key,rw.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new uN(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=i6(),n=new rp((e,t)=>e-t),i=i8();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const s=t.get(e);if(null===s)return;let a=r.get(e)||rw.empty();a=i.applyToLocalView(s,a),r.set(e,a);const o=(n.get(i.batchId)||i8()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{const s=[],a=n.getReverseIterator();for(;a.hasNext();){const n=a.getNext(),o=n.key,l=n.value,u=i4();l.forEach(e=>{if(!i.has(e)){const n=sI(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return eU.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return ik(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):iA(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):eU.resolve(i3()),a=ew,o=i;return s.next(t=>eU.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t))?eU.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)})).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,i8())).next(e=>({batchId:a,changes:i2(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new es(t)).next(e=>{let t=i0();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=i0();return this.indexManager.getCollectionParents(e,i).next(a=>eU.forEach(a,a=>{const o=iC(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{const n=r.getKey();null===e.get(n)&&(e=e.insert(n,nM.newInvalidDocument(n)))});let r=i0();return e.forEach((e,n)=>{const s=i.get(e);void 0!==s&&sk(s.mutation,n,rw.empty(),eb.now()),iz(t,n)&&(r=r.insert(e,n))}),r})}}class uO{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return eU.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,oU(t)),eU.resolve()}getNamedQuery(e,t){return eU.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,oB(t)),eU.resolve()}}class ux{constructor(){this.overlays=new rp(es.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return eU.resolve(this.overlays.get(t))}getOverlays(e,t){const r=i3();return eU.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.saveOverlay(e,t,n)}),eU.resolve()}removeOverlaysForBatchId(e,t,r){const n=this.overlayByBatchId.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.overlayByBatchId.delete(r)),eU.resolve()}getOverlaysForCollection(e,t,r){const n=i3(),i=t.length+1,s=new es(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return eU.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new rp((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=i3(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=i3(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return eU.resolve(a)}saveOverlay(e,t,r){const n=this.overlays.get(r.key);if(null!==n){const e=this.overlayByBatchId.get(n.largestBatchId).delete(r.key);this.overlayByBatchId.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new sK(t,r));let i=this.overlayByBatchId.get(t);void 0===i&&(i=i8(),this.overlayByBatchId.set(t,i)),this.overlayByBatchId.set(t,i.add(r.key))}}class uP{constructor(){this.sessionToken=r_.EMPTY_BYTE_STRING}getSessionToken(e){return eU.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,eU.resolve()}}class uM{constructor(){this.refsByKey=new ry(uL.compareByKey),this.refsByTarget=new ry(uL.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){const r=new uL(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.removeRef(new uL(e,t))}removeReferences(e,t){e.forEach(e=>this.removeReference(e,t))}removeReferencesForId(e){const t=new es(new er([])),r=new uL(t,e),n=new uL(t,e+1),i=[];return this.refsByTarget.forEachInRange([r,n],e=>{this.removeRef(e),i.push(e.key)}),i}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new es(new er([])),r=new uL(t,e),n=new uL(t,e+1),i=i8();return this.refsByTarget.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new uL(e,0),r=this.refsByKey.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class uL{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return es.comparator(e.key,t.key)||H(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return H(e.targetOrBatchId,t.targetOrBatchId)||es.comparator(e.key,t.key)}}class uF{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new ry(uL.compareByKey)}checkEmpty(e){return eU.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){const i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new s$(i,t,r,n);for(const t of(this.mutationQueue.push(s),n))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new uL(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return eU.resolve(s)}lookupMutationBatch(e,t){return eU.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=this.indexOfBatchId(r),i=n<0?0:n;return eU.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return eU.resolve(0===this.mutationQueue.length?rq:this.nextBatchId-1)}getAllMutationBatches(e){return eU.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new uL(t,0),n=new uL(t,Number.POSITIVE_INFINITY),i=[];return this.batchesByDocumentKey.forEachInRange([r,n],e=>{const t=this.findMutationBatch(e.targetOrBatchId);i.push(t)}),eU.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ry(H);return t.forEach(e=>{const t=new uL(e,0),n=new uL(e,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([t,n],e=>{r=r.add(e.targetOrBatchId)})}),eU.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;es.isDocumentKey(i)||(i=i.child(""));let s=new uL(new es(i),0),a=new ry(H);return this.batchesByDocumentKey.forEachWhile(e=>{const t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.targetOrBatchId)),!0)},s),eU.resolve(this.findMutationBatches(a))}findMutationBatches(e){const t=[];return e.forEach(e=>{const r=this.findMutationBatch(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){D(0===this.indexOfExistingBatchId(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.batchesByDocumentKey;return eU.forEach(t.mutations,n=>{const i=new uL(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.batchesByDocumentKey=r})}removeCachedMutationKeys(e){}containsKey(e,t){const r=new uL(t,0),n=this.batchesByDocumentKey.firstAfterOrEqual(r);return eU.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,eU.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}findMutationBatch(e){const t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}const uB="-9223372036854775808";function uU(){return new rp(es.comparator)}class uj{constructor(e){this.sizer=e,this.docs=uU(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return eU.resolve(r?r.document.mutableCopy():nM.newInvalidDocument(t))}getEntries(e,t){let r=iX();return t.forEach(e=>{const t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():nM.newInvalidDocument(e))}),eU.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=iX(),s=t.path,a=new es(s.child("__id"+uB+"__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;!(e.path.length>s.length+1||0>=eM(ex(a),r))&&(n.has(a.key)||iz(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return eU.resolve(i)}getAllFromCollectionGroup(e,t,r,n){A(9500)}forEachDocumentKey(e,t){return eU.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new uz(this)}getSize(e){return eU.resolve(this.size)}}function uV(e){return new uj(e)}class uz extends ub{constructor(e){super(),this.documentCache=e}applyChanges(e){const t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.documentCache.addEntry(e,n)):this.documentCache.removeEntry(r)}),eU.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}}class uq{constructor(e){this.persistence=e,this.targets=new iY(e=>il(e),ic),this.lastRemoteSnapshotVersion=eT.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new uM,this.targetCount=0,this.targetIdGenerator=l5.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((e,r)=>t(r)),eU.resolve()}getLastRemoteSnapshotVersion(e){return eU.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return eU.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),eU.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),eU.resolve()}saveTargetData(e){this.targets.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new l5(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,eU.resolve()}updateTargetData(e,t){return this.saveTargetData(t),eU.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,eU.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.targets.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.targets.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),eU.waitFor(i).next(()=>n)}getTargetCount(e){return eU.resolve(this.targetCount)}getTargetData(e,t){const r=this.targets.get(t)||null;return eU.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),eU.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);const n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),eU.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),eU.resolve()}getMatchingKeysForTargetId(e,t){const r=this.references.referencesForId(t);return eU.resolve(r)}containsKey(e,t){return eU.resolve(this.references.containsKey(t))}}const u$="MemoryPersistence";class uG{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new e4(0),this._started=!1,this._started=!0,this.globalsCache=new uP,this.referenceDelegate=e(this),this.targetCache=new uq(this);const r=e=>this.referenceDelegate.documentSize(e);this.indexManager=new lz,this.remoteDocumentCache=uV(r),this.serializer=new ow(t),this.bundleCache=new uO(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ux,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new uF(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){C(u$,"Starting transaction:",e);const n=new uK(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(n).next(e=>this.referenceDelegate.onTransactionCommitted(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}mutationQueuesContainKey(e,t){return eU.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}}class uK extends eF{constructor(e){super(),this.currentSequenceNumber=e}}class uH{constructor(e){this.persistence=e,this.localViewReferences=new uM,this._orphanedDocuments=null}static factory(e){return new uH(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw A(60996)}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),eU.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),eU.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),eU.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(e=>this.orphanedDocuments.add(e.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.orphanedDocuments.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return eU.forEach(this.orphanedDocuments,r=>{const n=es.fromPath(r);return this.isReferenced(e,n).next(e=>{e||t.removeEntry(n,eT.min())})}).next(()=>(this._orphanedDocuments=null,t.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(e=>{e?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return eU.or([()=>eU.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}}class uW{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new iY(e=>e8(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=uf(this,t)}static factory(e,t){return new uW(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return eU.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){const t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return eU.forEach(this.orphanedSequenceNumbers,(r,n)=>this.isPinned(e,r,n).next(e=>e?eU.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.forEachDocumentKey(e,n=>this.isPinned(e,n,t).next(e=>{e||(r++,i.removeEntry(n,eT.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),eU.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),eU.resolve()}removeReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),eU.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),eU.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=nf(e.data.value)),t}isPinned(e,t,r){return eU.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.orphanedSequenceNumbers.get(t);return eU.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class uQ{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,n){const i=new ez("createOrUpgrade",t);r<1&&n>=1&&(uJ(e),uX(e),u3(e),u0(e));let s=eU.resolve();return r<3&&n>=3&&(0!==r&&(u4(e),u3(e)),s=s.next(()=>u9(i))),r<4&&n>=4&&(0!==r&&(s=s.next(()=>uZ(e,i))),s=s.next(()=>{u5(e)})),r<5&&n>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),r<6&&n>=6&&(s=s.next(()=>(u2(e),this.addDocumentGlobal(i)))),r<7&&n>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),r<8&&n>=8&&(s=s.next(()=>this.createCollectionParentIndex(e,i))),r<9&&n>=9&&(s=s.next(()=>{u6(e)})),r<10&&n>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),r<11&&n>=11&&(s=s.next(()=>{u7(e),u8(e)})),r<12&&n>=12&&(s=s.next(()=>{ct(e)})),r<13&&n>=13&&(s=s.next(()=>u1(e)).next(()=>this.rewriteRemoteDocumentCache(e,i)).next(()=>e.deleteObjectStore(tn))),r<14&&n>=14&&(s=s.next(()=>this.runOverlayMigration(e,i))),r<15&&n>=15&&(s=s.next(()=>ce(e))),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(tH).clear()}).next(()=>{t.objectStore(tJ).clear()})),r<17&&n>=17&&(s=s.next(()=>{cr(e)})),r<18&&n>=18&&(0,d.WO)()&&(s=s.next(()=>{t.objectStore(tH).clear()}).next(()=>{t.objectStore(tJ).clear()})),s}addDocumentGlobal(e){let t=0;return e.store(tn).iterate((e,r)=>{t+=lZ(r)}).next(()=>{const r={byteSize:t};return e.store(tE).put(t_,r)})}removeAcknowledgedMutations(e){const t=e.store(ta),r=e.store(tl);return t.loadAll().next(t=>eU.forEach(t,t=>{const n=IDBKeyRange.bound([t.userId,rq],[t.userId,t.lastAcknowledgedBatchId]);return r.loadAll(tc,n).next(r=>eU.forEach(r,r=>{D(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});const n=oA(this.serializer,r);return lX(e,t.userId,n).next(()=>{})}))}))}ensureSequenceNumbers(e){const t=e.store(tA),r=e.store(tn);return e.store(tP).get(tx).next(e=>{const n=r=>t.put({targetId:0,path:e8(r),sequenceNumber:e.highestListenSequenceNumber}),i=[];return r.iterate((e,r)=>{const s=new er(e),a=uY(s);i.push(t.get(a).next(e=>e?eU.resolve():n(s)))}).next(()=>eU.waitFor(i))})}createCollectionParentIndex(e,t){e.createObjectStore(tM,{keyPath:tL});const r=t.store(tM),n=new lq,i=e=>{if(n.add(e)){const t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:e8(n)})}};return t.store(tn).iterate({keysOnly:!0},(e,t)=>i(new er(e).popLast())).next(()=>t.store(tg).iterate({keysOnly:!0},([e,t,r],n)=>i(tr(t).popLast())))}rewriteCanonicalIds(e){const t=e.store(tC);return t.iterate((e,r)=>{const n=oN(r),i=oD(this.serializer,n);return t.put(i)})}rewriteRemoteDocumentCache(e,t){const r=t.store(tn),n=[];return r.iterate((e,r)=>{const i=t.store(ty),s=cn(r).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>eU.waitFor(n))}runOverlayMigration(e,t){const r=t.store(tl),n=uw(this.serializer),i=new uG(uH.factory,this.serializer.remoteSerializer);return r.loadAll().next(e=>{const r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??i8();oA(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),eU.forEach(r,(e,r)=>{const s=new b(r),a=oQ.forUser(this.serializer,s),o=i.getIndexManager(s);return new uD(n,l0.forUser(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new rl(t,e4.INVALID),e).next()})})}}function uY(e){return[0,e8(e)]}function uJ(e){e.createObjectStore(ti)}function uX(e){e.createObjectStore(ta,{keyPath:to}),e.createObjectStore(tl,{keyPath:tu,autoIncrement:!0}).createIndex(tc,td,{unique:!0}),e.createObjectStore(tg)}function uZ(e,t){return t.store(tl).loadAll().next(r=>{e.deleteObjectStore(tl),e.createObjectStore(tl,{keyPath:tu,autoIncrement:!0}).createIndex(tc,td,{unique:!0});const n=t.store(tl),i=r.map(e=>n.put(e));return eU.waitFor(i)})}function u0(e){e.createObjectStore(tn)}function u1(e){const t=e.createObjectStore(ty,{keyPath:tv});t.createIndex(tb,tT),t.createIndex(tw,tS)}function u2(e){e.createObjectStore(tE)}function u3(e){e.createObjectStore(tA,{keyPath:tN}).createIndex(tD,tO,{unique:!0}),e.createObjectStore(tC,{keyPath:tI}).createIndex(tR,tk,{unique:!0}),e.createObjectStore(tP)}function u4(e){e.deleteObjectStore(tA),e.deleteObjectStore(tC),e.deleteObjectStore(tP)}function u6(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}function u9(e){const t=e.store(tP),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:eT.min().toTimestamp(),targetCount:0};return t.put(tx,r)}function u5(e){e.createObjectStore(tF,{keyPath:tB})}function u7(e){e.createObjectStore(tU,{keyPath:tj})}function u8(e){e.createObjectStore(tV,{keyPath:tz})}function ce(e){e.createObjectStore(tq,{keyPath:t$,autoIncrement:!0}).createIndex(tG,tK,{unique:!1}),e.createObjectStore(tH,{keyPath:tW}).createIndex(tQ,tY,{unique:!1}),e.createObjectStore(tJ,{keyPath:tX}).createIndex(tZ,t0,{unique:!1})}function ct(e){const t=e.createObjectStore(t1,{keyPath:t2});t.createIndex(t3,t4,{unique:!1}),t.createIndex(t6,t9,{unique:!1})}function cr(e){e.createObjectStore(t5,{keyPath:t7})}function cn(e){return e.document?new es(er.fromString(e.document.name).popFirst(5)):e.noDocument?es.fromSegments(e.noDocument.path):e.unknownDocument?es.fromSegments(e.unknownDocument.path):A(36783)}const ci="IndexedDbPersistence",cs=18e5,ca=5e3,co=4e3,cl="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",cu="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",cc="firestore_zombie",cd="main";class ch{constructor(e,t,r,n,i,s,a,o,l,u,c=uA){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=i,this.window=s,this.document=a,this.sequenceNumberSyncer=l,this.forceOwningTab=u,this.schemaVersion=c,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=e=>Promise.resolve(),!ch.isAvailable())throw new P(x.UNIMPLEMENTED,cu);this.referenceDelegate=new um(this,n),this.dbName=t+cd,this.serializer=new ow(o),this.simpleDb=new eq(this.dbName,this.schemaVersion,new uQ(this.serializer)),this.globalsCache=new oJ,this.targetCache=new l7(this.referenceDelegate,this.serializer),this.remoteDocumentCache=uw(this.serializer),this.bundleCache=new oK,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===u&&I(ci,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new P(x.FAILED_PRECONDITION,cl);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new e4(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>cf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(e=>{e||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(t=>this.isPrimary&&!t?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):!!t&&this.acquireOrExtendPrimaryLease(e).next(()=>!0))).catch(e=>{if(eH(e))return C(ci,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return C(ci,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return cp(e).get(ts).next(e=>eU.resolve(this.isLocalClient(e)))}removeClientMetadata(e){return cf(e).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,cs)){this.lastGarbageCollectionTime=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const t=ru(e,tF);return t.loadAll().next(e=>{const r=this.filterActiveClients(e,cs),n=e.filter(e=>-1===r.indexOf(e));return eU.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.webStorage)for(const t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",co,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return!!e&&e.ownerId===this.clientId}canActAsPrimary(e){return this.forceOwningTab?eU.resolve(!0):cp(e).get(ts).next(t=>{if(null!==t&&this.isWithinAge(t.leaseTimestampMs,ca)&&!this.isClientZombied(t.ownerId)){if(this.isLocalClient(t)&&this.networkEnabled)return!0;if(!this.isLocalClient(t)){if(!t.allowTabSynchronization)throw new P(x.FAILED_PRECONDITION,cl);return!1}}return!!this.networkEnabled&&!!this.inForeground||cf(e).loadAll().next(e=>void 0===this.filterActiveClients(e,ca).find(e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&C(ci,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[ti,tF],e=>{const t=new rl(e,e4.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(e,t){return e.filter(e=>this.isWithinAge(e.updateTimeMs,t)&&!this.isClientZombied(e.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>cf(e).loadAll().next(e=>this.filterActiveClients(e,cs).map(e=>e.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return l0.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new lK(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return oQ.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){let n;C(ci,"Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=ro(this.schemaVersion);return this.simpleDb.runTransaction(e,i,s,i=>(n=new rl(i,this.listenSequence?this.listenSequence.next():e4.INVALID),"readwrite-primary"===t)?this.verifyPrimaryLease(n).next(e=>!!e||this.canActAsPrimary(n)).next(t=>{if(!t)throw I(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new P(x.FAILED_PRECONDITION,eL);return r(n)}).next(e=>this.acquireOrExtendPrimaryLease(n).next(()=>e)):this.verifyAllowTabSynchronization(n).next(()=>r(n))).then(e=>(n.raiseOnCommittedEvent(),e))}verifyAllowTabSynchronization(e){return cp(e).get(ts).next(e=>{if(null!==e&&this.isWithinAge(e.leaseTimestampMs,ca)&&!this.isClientZombied(e.ownerId)&&!this.isLocalClient(e)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!e.allowTabSynchronization))throw new P(x.FAILED_PRECONDITION,cl)})}acquireOrExtendPrimaryLease(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return cp(e).put(ts,t)}static isAvailable(){return eq.isAvailable()}releasePrimaryLeaseIfHeld(e){const t=cp(e);return t.get(ts).next(e=>this.isLocalClient(e)?(C(ci,"Releasing primary lease."),t.delete(ts)):eU.resolve())}isWithinAge(e,t){const r=Date.now(),n=r-t,i=r;return!(e<n)&&(!(e>i)||(I(`Detected an update time that is in the future: ${e} > ${i}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){"function"==typeof this.window?.addEventListener&&(this.windowUnloadHandler=()=>{this.markClientZombied();const e=/(?:Version|Mobile)\/1[456]/;(0,d.G6)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){try{const t=this.webStorage?.getItem(this.zombiedClientLocalStorageKey(e))!==null;return C(ci,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return I(ci,"Failed to get zombied client id.",e),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){I("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}}zombiedClientLocalStorageKey(e){return`${cc}_${this.persistenceKey}_${e}`}}function cp(e){return ru(e,ti)}function cf(e){return ru(e,tF)}function cm(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}function cg(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){const s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])}function cy(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}const cv="LocalStore",cb=3e8;class cT{constructor(e,t,r,n){this.persistence=e,this.queryEngine=t,this.serializer=n,this.targetDataByTarget=new rp(H),this.targetIdByTarget=new iY(e=>il(e),ic),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new uD(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}}function cw(e,t,r,n){return new cT(e,t,r,n)}async function cS(e,t){const r=O(e);return await r.persistence.runTransaction("Handle user change","readonly",e=>{let n;return r.mutationQueue.getAllMutationBatches(e).next(i=>(n=i,r.initializeUserComponents(t),r.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],a=i8();for(const e of n)for(const t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(const e of t)for(const t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return r.localDocuments.getDocuments(e,a).next(e=>({affectedDocuments:e,removedBatchIds:i,addedBatchIds:s}))})})}function cE(e,t){let r,n;const i=O(e),s=eb.now(),a=t.reduce((e,t)=>e.add(t.key),i8());return i.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=iX(),l=i8();return i.remoteDocuments.getEntries(e,a).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(e,o)).next(n=>{r=n;const a=[];for(const e of t){const t=sA(e,r.get(e.key).overlayedDocument);null!=t&&a.push(new sP(e.key,t,nP(t.value.mapValue),sE.exists(!0)))}return i.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{n=t;const s=t.applyToLocalDocumentSet(r,l);return i.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:n.batchId,changes:i2(r)}))}function c_(e,t){const r=O(e);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const n=t.batch.keys(),i=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});return cU(r,e,t,i).next(()=>i.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,cC(t))).next(()=>r.localDocuments.getDocuments(e,n))})}function cC(e){let t=i8();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}function cI(e,t){const r=O(e);return r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(D(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))})}function cR(e){const t=O(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}function ck(e){const t=O(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.targetCache.getLastRemoteSnapshotVersion(e))}function cA(e,t){let r=O(e),n=t.snapshotVersion,i=r.targetDataByTarget;return r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=r.targetDataByTarget;const a=[];t.targetChanges.forEach((s,o)=>{const l=i.get(o);if(!l)return;a.push(r.targetCache.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.targetCache.addMatchingKeys(e,s.addedDocuments,o)));let u=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?u=u.withResumeToken(r_.EMPTY_BYTE_STRING,eT.min()).withLastLimboFreeSnapshotVersion(eT.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,n)),i=i.insert(o,u),cD(l,u,s)&&a.push(r.targetCache.updateTargetData(e,u))});let o=iX(),l=i8();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(cN(e,s,t.documentUpdates).next(e=>{o=e.changedDocuments,l=e.existenceChangedKeys})),!n.isEqual(eT.min())){const t=r.targetCache.getLastRemoteSnapshotVersion(e).next(t=>r.targetCache.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return eU.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.targetDataByTarget=i,e))}function cN(e,t,r){let n=i8(),i=i8();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=iX();return r.forEach((r,s)=>{const a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(eT.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):C(cv,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{changedDocuments:n,existenceChangedKeys:i}})}function cD(e,t,r){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=cb)||r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size>0}async function cO(e,t){const r=O(e);try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>eU.forEach(t,t=>eU.forEach(t.addedKeys,n=>r.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>eU.forEach(t.removedKeys,n=>r.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(eH(e))C(cv,"Failed to update sequence numbers: "+e);else throw e}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.targetDataByTarget.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.targetDataByTarget=r.targetDataByTarget.insert(t,i)}}}function cx(e,t){const r=O(e);return r.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=rq),r.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function cP(e,t){const r=O(e);return r.persistence.runTransaction("read document","readonly",e=>r.localDocuments.getDocument(e,t))}function cM(e,t){const r=O(e);return r.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return r.targetCache.getTargetData(e,t).next(i=>i?(n=i,eU.resolve(n)):r.targetCache.allocateTargetId(e).next(i=>(n=new oT(t,i,"TargetPurposeListen",e.currentSequenceNumber),r.targetCache.addTargetData(e,n).next(()=>n))))}).then(e=>{const n=r.targetDataByTarget.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.targetDataByTarget=r.targetDataByTarget.insert(e.targetId,e),r.targetIdByTarget.set(t,e.targetId)),e})}function cL(e,t,r){const n=O(e),i=n.targetIdByTarget.get(r);return void 0!==i?eU.resolve(n.targetDataByTarget.get(i)):n.targetCache.getTargetData(t,r)}async function cF(e,t,r){const n=O(e),i=n.targetDataByTarget.get(t),s=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",s,e=>n.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(eH(e))C(cv,`Failed to update sequence numbers for target ${t}: ${e}`);else throw e}n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(i.target)}function cB(e,t,r){let n=O(e),i=eT.min(),s=i8();return n.persistence.runTransaction("Execute query","readwrite",e=>cL(n,e,iD(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>n.queryEngine.getDocumentsMatchingQuery(e,t,r?i:eT.min(),r?s:i8())).next(e=>(cG(n,iH(t),e),{documents:e,remoteKeys:s})))}function cU(e,t,r,n){let i=r.batch,s=i.keys(),a=eU.resolve();return s.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{const s=r.docVersions.get(e);D(null!==s,48541),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&(t.setReadTime(r.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}function cj(e,t){const r=O(e),n=O(r.mutationQueue);return r.persistence.runTransaction("Lookup mutation documents","readonly",e=>n.lookupMutationKeys(e,t).next(t=>t?r.localDocuments.getDocuments(e,t):eU.resolve(null)))}function cV(e,t){O(O(e,cT).mutationQueue).removeCachedMutationKeys(t)}function cz(e){return O(O(e,cT).persistence).getActiveClients()}function cq(e,t){const r=O(e),n=O(r.targetCache),i=r.targetDataByTarget.get(t);return i?Promise.resolve(i.target):r.persistence.runTransaction("Get target data","readonly",e=>n.getTargetDataForTarget(e,t).next(e=>e?e.target:null))}function c$(e,t){const r=O(e),n=r.collectionGroupReadTime.get(t)||eT.min();return r.persistence.runTransaction("Get new document changes","readonly",e=>r.remoteDocuments.getAllFromCollectionGroup(e,t,eO(n,ew),Number.MAX_SAFE_INTEGER)).then(e=>(cG(r,t,e),e))}function cG(e,t,r){let n=e.collectionGroupReadTime.get(t)||eT.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.collectionGroupReadTime.set(t,n)}function cK(e){return iD(i_(er.fromString(`__bundle__/docs/${e}`)))}async function cH(e,t,r,n){let i=O(e),s=i8(),a=iX();for(const e of r){const r=t.toDocumentKey(e.metadata.name);e.document&&(s=s.add(r));const n=t.toMutableDocument(e);n.setReadTime(t.toSnapshotVersion(e.metadata.readTime)),a=a.insert(r,n)}const o=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=await cM(i,cK(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>cN(e,o,a).next(t=>(o.apply(e),t)).next(t=>i.targetCache.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.targetCache.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.changedDocuments,t.existenceChangedKeys)).next(()=>t.changedDocuments)))}function cW(e,t){const r=O(e),n=ab(t.createTime);return r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.bundleCache.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(n)>=0)}function cQ(e,t){const r=O(e);return r.persistence.runTransaction("Save bundle","readwrite",e=>r.bundleCache.saveBundleMetadata(e,t))}function cY(e,t){const r=O(e);return r.persistence.runTransaction("Get named query","readonly",e=>r.bundleCache.getNamedQuery(e,t))}async function cJ(e,t,r=i8()){const n=await cM(e,iD(oF(t.bundledQuery))),i=O(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{const s=ab(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return i.bundleCache.saveNamedQuery(e,t);const a=n.withResumeToken(r_.EMPTY_BYTE_STRING,s);return i.targetDataByTarget=i.targetDataByTarget.insert(a.targetId,a),i.targetCache.updateTargetData(e,a).next(()=>i.targetCache.removeMatchingKeysForTargetId(e,n.targetId)).next(()=>i.targetCache.addMatchingKeys(e,r,n.targetId)).next(()=>i.bundleCache.saveNamedQuery(e,t))})}function cX(e,t){O(e).queryEngine.indexAutoCreationEnabled=t}class cZ{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}const c0=100;function c1(){return(0,d.G6)()?8:e$((0,d.z$)())>0?6:4}class c2{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=c0,this.relativeIndexReadCostPerDocument=c1()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,n){const i={result:null};return this.performQueryUsingIndex(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.performQueryUsingRemoteKeys(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;const r=new cZ;return this.executeFullCollectionScan(e,t,r).next(n=>{if(i.result=n,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,r,n.size)})}).next(()=>i.result)}createCacheIndexes(e,t,r,n){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(_()<=u.in.DEBUG&&C("QueryEngine","SDK will not create cache indexes for query:",iV(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),eU.resolve()):(_()<=u.in.DEBUG&&C("QueryEngine","Query:",iV(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*n)?(_()<=u.in.DEBUG&&C("QueryEngine","The SDK decides to create cache indexes for query:",iV(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,iD(t))):eU.resolve()}performQueryUsingIndex(e,t){if(iI(t))return eU.resolve(null);let r=iD(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=iD(t=iL(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{const i=i8(...n);return this.localDocumentsView.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{const s=this.applyQuery(t,n);return this.needsRefill(t,s,i,r.readTime)?this.performQueryUsingIndex(e,iL(t,null,"F")):this.appendRemainingResults(e,s,t,r)}))})))}performQueryUsingRemoteKeys(e,t,r,n){return iI(t)||n.isEqual(eT.min())?eU.resolve(null):this.localDocumentsView.getDocuments(e,r).next(i=>{const s=this.applyQuery(t,i);return this.needsRefill(t,s,r,n)?eU.resolve(null):(_()<=u.in.DEBUG&&C("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),iV(t)),this.appendRemainingResults(e,s,t,eO(n,ew)).next(e=>e))})}applyQuery(e,t){let r=new ry(iW(e));return t.forEach((t,n)=>{iz(e,n)&&(r=r.add(n))}),r}needsRefill(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}executeFullCollectionScan(e,t,r){return _()<=u.in.DEBUG&&C("QueryEngine","Using full collection scan to execute query:",iV(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,eP.min(),r)}appendRemainingResults(e,t,r,n){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const c3="firestore_clients";function c4(e,t){return`${c3}_${e}_${t}`}const c6="firestore_mutations";function c9(e,t,r){let n=`${c6}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}const c5="firestore_targets";function c7(e,t){return`${c5}_${e}_${t}`}const c8="firestore_online_state";function de(e){return`${c8}_${e}`}const dt="firestore_bundle_loaded_v2";function dr(e){return`${dt}_${e}`}const dn="firestore_sequence_number";function di(e){return`${dn}_${e}`}const ds="SharedClientState";class da{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static fromWebStorageEntry(e,t,r){let n;let i=JSON.parse(r),s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return(s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(n=new P(i.error.code,i.error.message)),s)?new da(e,t,i.state,n):(I(ds,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class dl{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r;let n=JSON.parse(t),i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return(i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new P(n.error.code,n.error.message)),i)?new dl(e,n.state,r):(I(ds,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class du{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=st();for(let e=0;n&&e<r.activeTargetIds.length;++e)n=rK(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new du(e,i):(I(ds,`Failed to parse client data for instance '${e}': ${t}`),null)}}class dc{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new dc(t.clientId,t.onlineState):(I(ds,`Failed to parse online state: ${e}`),null)}}class dd{constructor(){this.activeTargetIds=st()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class dh{constructor(e,t,r,n,i){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new rp(H),this.started=!1,this.earlyEvents=[];const s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=c4(this.persistenceKey,this.localClientId),this.sequenceNumberKey=di(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new dd),this.clientStateKeyRe=RegExp(`^${c3}_${s}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${c6}_${s}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${c5}_${s}_(\\d+)$`),this.onlineStateKey=de(this.persistenceKey),this.bundleLoadedKey=dr(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}async start(){for(const e of(await this.syncEngine.getActiveClients())){if(e===this.localClientId)continue;const t=this.getItem(c4(this.persistenceKey,e));if(t){const r=du.fromWebStorageEntry(e,t);r&&(this.activeClients=this.activeClients.insert(r.clientId,r))}}this.persistClientState();const e=this.storage.getItem(this.onlineStateKey);if(e){const t=this.fromWebStorageOnlineState(e);t&&this.handleOnlineStateEvent(t)}for(const e of this.earlyEvents)this.handleWebStorageEvent(e);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const t=this.storage.getItem(c7(this.persistenceKey,e));if(t){const n=dl.fromWebStorageEntry(e,t);n&&(r=n.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(c7(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.removeMutationState(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return C(ds,"READ",e,t),t}setItem(e,t){C(ds,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){C(ds,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){const t=e;if(t.storageArea===this.storage){if(C(ds,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){I("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(async()=>{if(!this.started){this.earlyEvents.push(t);return}if(null!==t.key){if(this.clientStateKeyRe.test(t.key)){if(null!=t.newValue){const e=this.fromWebStorageClientState(t.key,t.newValue);if(e)return this.handleClientStateEvent(e.clientId,e)}else{const e=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(e,null)}}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue){const e=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(e)return this.handleMutationBatchEvent(e)}}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue){const e=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(e)return this.handleQueryTargetEvent(e)}}else if(t.key===this.onlineStateKey){if(null!==t.newValue){const e=this.fromWebStorageOnlineState(t.newValue);if(e)return this.handleOnlineStateEvent(e)}}else if(t.key===this.sequenceNumberKey){const e=dp(t.newValue);e!==e4.INVALID&&this.sequenceNumberHandler(e)}else if(t.key===this.bundleLoadedKey){const e=this.fromWebStoreBundleLoadedState(t.newValue);await Promise.all(e.map(e=>this.syncEngine.synchronizeWithChangedDocuments(e)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){const n=new da(this.currentUser,e,t,r),i=c9(this.persistenceKey,this.currentUser,e);this.setItem(i,n.toWebStorageJSON())}removeMutationState(e){const t=c9(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){const t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){const n=c7(this.persistenceKey,e),i=new dl(e,t,r);this.setItem(n,i.toWebStorageJSON())}persistBundleLoadedState(e){const t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){const t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){const r=this.fromWebStorageClientStateKey(e);return du.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){const r=this.mutationBatchKeyRe.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return da.fromWebStorageEntry(new b(i),n,t)}fromWebStorageQueryTargetMetadata(e,t){const r=Number(this.queryTargetKeyRe.exec(e)[1]);return dl.fromWebStorageEntry(r,t)}fromWebStorageOnlineState(e){return dc.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}async handleMutationBatchEvent(e){if(e.user.uid!==this.currentUser.uid){C(ds,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){const r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),n=this.extractActiveQueryTargets(this.activeClients),i=this.extractActiveQueryTargets(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.applyActiveTargetsChange(s,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=st();return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}function dp(e){let t=e4.INVALID;if(null!=e)try{const r=JSON.parse(e);D("number"==typeof r,30636,{seqString:e}),t=r}catch(e){I(ds,"Failed to read sequence number from WebStorage",e)}return t}class df{constructor(){this.localState=new dd,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new dd,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class dm{addCallback(e){}shutdown(){}}class dg{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}}let dy=null;function dv(){return 268435456+Math.round(2147483648*Math.random())}function db(){return null===dy?dy=dv():dy++,"0x"+dy.toString(16)}function dT(e){return new Promise((t,r)=>{e((e,n)=>{e?r(e):t(n)})})}const dw="1.9.15",dS="GrpcConnection",dE=`gl-node/${process.versions.node} fire/${T} grpc/${dw}`;function d_(e,t,r,n){D(null===t||"OAuth"===t.type,36936);const i=new m.SF;return t&&t.headers.forEach((e,t)=>i.set(t,e)),r&&r.headers.forEach((e,t)=>i.set(t,e)),n&&i.set("X-Firebase-GMPID",n),i.set("X-Goog-Api-Client",dE),i.set("Google-Cloud-Resource-Prefix",e),i.set("x-goog-request-params",e),i}class dC{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){C(dS,"Creating Firestore stub.");const e=this.databaseInfo.ssl?m.K9.createSsl():m.K9.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,n,i){const s=db(),a=this.ensureActiveStub(),o=d_(this.databasePath,n,i,this.databaseInfo.appId),l={database:this.databasePath,...r};return dT(t=>(C(dS,`RPC '${e}' ${s} invoked with request:`,r),a[e](l,o,(r,n)=>{r?(C(dS,`RPC '${e}' ${s} failed with error:`,r),t(new P(sY(r.code),r.message))):(C(dS,`RPC '${e}' ${s} completed with response:`,n),t(void 0,n))})))}invokeStreamingRPC(e,t,r,n,i,s){const a=db(),o=[],l=new M;C(dS,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),c=d_(this.databasePath,n,i,this.databaseInfo.appId),d={...r,database:this.databasePath},h=u[e](d,c),p=!1;return h.on("data",t=>{C(dS,`RPC ${e} ${a} received result:`,t),o.push(t),void 0!==s&&o.length===s&&(p=!0,l.resolve(o))}),h.on("end",()=>{C(dS,`RPC '${e}' ${a} completed.`),p||(p=!0,l.resolve(o))}),h.on("error",t=>{C(dS,`RPC '${e}' ${a} failed with error:`,t);const r=sY(t.code);l.reject(new P(r,t.message))}),l.promise}openStream(e,t,r){let n=db(),i=this.ensureActiveStub(),s=d_(this.databasePath,t,r,this.databaseInfo.appId),a=i[e](s),o=!1,l=e=>{o||(o=!0,u.callOnClose(e),a.end())},u=new dg({sendFn:t=>{if(o)C(dS,`RPC '${e}' stream ${n} not sending because gRPC stream is closed:`,t);else{C(dS,`RPC '${e}' stream ${n} sending:`,t);try{a.write(t)}catch(e){throw I("Failure sending:",t),I("Error:",e),e}}},closeFn:()=>{C(dS,`RPC '${e}' stream ${n} closed locally via close().`),l()}}),c=!1;return a.on("data",t=>{o||(C(dS,`RPC '${e}' stream ${n} received:`,t),c||(u.callOnConnected(),c=!0),u.callOnMessage(t))}),a.on("end",()=>{C(dS,`RPC '${e}' stream ${n} ended.`),l()}),a.on("error",t=>{o||(R(dS,`RPC '${e}' stream ${n} error. Code:`,t.code,"Message:",t.message),l(new P(sY(t.code),t.message)))}),C(dS,`Opening RPC '${e}' stream ${n} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}const dI={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};const dR={nested:dI},dk=Object.freeze({__proto__:null,nested:dI,default:dR});const dA={longs:String,enums:String,defaults:!0,oneofs:!1};function dN(){const e=g.im(dk,dA);return m.Rz(e)}function dD(e){return new dC(dN(),e)}function dO(){return new dm}function dx(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function dP(){return null}function dM(e){return new ac(e,!1)}const dL="ExponentialBackoff",dF=1e3,dB=1.5,dU=6e4;class dj{constructor(e,t,r=dF,n=dB,i=dU){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=n,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();const t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),n=Math.max(0,t-r);n>0&&C(dL,`Backing off for ${n} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,n,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}const dV="PersistentStream",dz=6e4,dq=1e4;class d${constructor(e,t,r,n,i,s,a,o){this.queue=e,this.idleTimerId=r,this.healthTimerId=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new dj(e,t)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){if(this.responseCount=0,4===this.state){this.performBackoff();return}this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,dz,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==e?this.backoff.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(I(t.toString()),I("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===x.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;const e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.closeCount===t&&this.startStream(e,r)},t=>{e(()=>{const e=new P(x.UNKNOWN,"Fetching auth token failed: "+t.message);return this.handleStreamClose(e)})})}startStream(e,t){const r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,dq,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(e=>{r(()=>this.handleStreamClose(e))}),this.stream.onMessage(e=>{r(()=>1==++this.responseCount?this.onFirst(e):this.onNext(e))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return C(dV,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(C(dV,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class dG extends d${constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();const t=aL(this.serializer,e),r=aB(e);return this.listener.onWatchChange(t,r)}watch(e){const t={};t.database=aR(this.serializer),t.addTarget=a1(this.serializer,e);const r=aZ(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){const t={};t.database=aR(this.serializer),t.removeTarget=e,this.sendRequest(t)}}class dK extends d${constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return D(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,D(!e.writeResults||0===e.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(e){D(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.backoff.reset();const t=a$(e.writeResults,e.commitTime),r=ab(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){const e={};e.database=aR(this.serializer),this.sendRequest(e)}writeMutations(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>aU(this.serializer,e))};this.sendRequest(t)}}class dH{}class dW extends dH{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new P(x.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,n){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeRPC(e,aw(t,r),n,i,s)).catch(e=>{if("FirebaseError"===e.name)throw e.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new P(x.UNKNOWN,e.toString())})}invokeStreamingRPC(e,t,r,n,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.invokeStreamingRPC(e,aw(t,r),n,s,a,i)).catch(e=>{if("FirebaseError"===e.name)throw e.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new P(x.UNKNOWN,e.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function dQ(e,t,r,n){return new dW(e,t,r,n)}async function dY(e,t){const r=O(e),n={writes:t.map(e=>aU(r.serializer,e))};await r.invokeRPC("Commit",r.serializer.databaseId,er.emptyPath(),n)}async function dJ(e,t){const r=O(e),n={documents:t.map(e=>aE(r.serializer,e))},i=await r.invokeStreamingRPC("BatchGetDocuments",r.serializer.databaseId,er.emptyPath(),n,t.length),s=new Map;i.forEach(e=>{const t=aM(r.serializer,e);s.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{const t=s.get(e.toString());D(!!t,55234,{key:e}),a.push(t)}),a}async function dX(e,t,r){const n=O(e),{request:i,aliasMap:s,parent:a}=aY(n.serializer,iO(t),r);n.connection.shouldResourcePathBeIncludedInRequest||delete i.parent;const o=(await n.invokeStreamingRPC("RunAggregationQuery",n.serializer.databaseId,a,i,1)).filter(e=>!!e.result);D(1===o.length,64727);const l=o[0].result?.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}function dZ(e,t,r){const n=O(e);return n.verifyInitialized(),new dK(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}function d0(e,t,r){const n=O(e);return n.verifyInitialized(),new dG(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}const d1="OnlineStateTracker",d2=1,d3=1e4;class d4{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",d3,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${d3/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=d2&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${d2} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(I(t),this.shouldWarnClientIsOffline=!1):C(d1,t)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}const d6="RemoteStore",d9=10;class d5{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(e=>{r.enqueueAndForget(async()=>{hl(this)&&(C(d6,"Restarting streams for network reachability change."),await hk(this))})}),this.onlineStateTracker=new d4(r,n)}}function d7(e,t,r,n,i){return new d5(e,t,r,n,i)}async function d8(e){if(hl(e))for(const t of e.onNetworkStatusChange)await t(!0)}async function he(e){for(const t of e.onNetworkStatusChange)await t(!1)}async function ht(e){const t=O(e);C(d6,"RemoteStore shutting down."),t.offlineCauses.add(5),await he(t),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown")}function hr(e,t){const r=O(e);!r.listenTargets.has(t.targetId)&&(r.listenTargets.set(t.targetId,t),ho(r)?ha(r):hD(r).isOpen()&&hi(r,t))}function hn(e,t){const r=O(e),n=hD(r);r.listenTargets.delete(t),n.isOpen()&&hs(r,t),0===r.listenTargets.size&&(n.isOpen()?n.markIdle():hl(r)&&r.onlineStateTracker.set("Unknown"))}function hi(e,t){if(e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(eT.min())>0){const r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}hD(e).watch(t)}function hs(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),hD(e).unwatch(t)}function ha(e){e.watchChangeAggregator=new an({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),getTargetDataForTarget:t=>e.listenTargets.get(t)||null,getDatabaseId:()=>e.datastore.serializer.databaseId}),hD(e).start(),e.onlineStateTracker.handleWatchStreamStart()}function ho(e){return hl(e)&&!hD(e).isStarted()&&e.listenTargets.size>0}function hl(e){return 0===O(e).offlineCauses.size}function hu(e){e.watchChangeAggregator=void 0}async function hc(e){e.onlineStateTracker.set("Online")}async function hd(e){e.listenTargets.forEach((t,r)=>{hi(e,t)})}async function hh(e,t){hu(e),ho(e)?(e.onlineStateTracker.handleWatchStreamFailure(t),ha(e)):e.onlineStateTracker.set("Unknown")}async function hp(e,t,r){if(e.onlineStateTracker.set("Online"),t instanceof ae&&2===t.state&&t.cause){try{await hy(e,t)}catch(r){C(d6,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await hf(e,r)}return}if(t instanceof s7?e.watchChangeAggregator.handleDocumentChange(t):t instanceof s8?e.watchChangeAggregator.handleExistenceFilter(t):e.watchChangeAggregator.handleTargetChange(t),!r.isEqual(eT.min()))try{const t=await ck(e.localStore);r.compareTo(t)>=0&&await hg(e,r)}catch(t){C(d6,"Failed to raise snapshot:",t),await hf(e,t)}}async function hf(e,t,r){if(eH(t))e.offlineCauses.add(1),await he(e),e.onlineStateTracker.set("Offline"),r||(r=()=>ck(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{C(d6,"Retrying IndexedDB access"),await r(),e.offlineCauses.delete(1),await d8(e)});else throw t}function hm(e,t){return t().catch(r=>hf(e,r,t))}function hg(e,t){const r=e.watchChangeAggregator.createRemoteEvent(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){const i=e.listenTargets.get(n);i&&e.listenTargets.set(n,i.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{const n=e.listenTargets.get(t);n&&(e.listenTargets.set(t,n.withResumeToken(r_.EMPTY_BYTE_STRING,n.snapshotVersion)),hs(e,t),hi(e,new oT(n.target,t,r,n.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(r)}async function hy(e,t){const r=t.cause;for(const n of t.targetIds)e.listenTargets.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.listenTargets.delete(n),e.watchChangeAggregator.removeTarget(n))}async function hv(e){let t=O(e),r=hO(t),n=t.writePipeline.length>0?t.writePipeline[t.writePipeline.length-1].batchId:rq;for(;hb(t);)try{const e=await cx(t.localStore,n);if(null===e){0===t.writePipeline.length&&r.markIdle();break}n=e.batchId,hT(t,e)}catch(e){await hf(t,e)}hw(t)&&hS(t)}function hb(e){return hl(e)&&e.writePipeline.length<d9}function hT(e,t){e.writePipeline.push(t);const r=hO(e);r.isOpen()&&r.handshakeComplete&&r.writeMutations(t.mutations)}function hw(e){return hl(e)&&!hO(e).isStarted()&&e.writePipeline.length>0}function hS(e){hO(e).start()}async function hE(e){hO(e).writeHandshake()}async function h_(e){const t=hO(e);for(const r of e.writePipeline)t.writeMutations(r.mutations)}async function hC(e,t,r){const n=e.writePipeline.shift(),i=sG.from(n,t,r);await hm(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await hv(e)}async function hI(e,t){t&&hO(e).handshakeComplete&&await hR(e,t),hw(e)&&hS(e)}async function hR(e,t){if(sQ(t.code)){const r=e.writePipeline.shift();hO(e).inhibitBackoff(),await hm(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await hv(e)}}async function hk(e){const t=O(e);t.offlineCauses.add(4),await he(t),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),await d8(t)}async function hA(e,t){const r=O(e);r.asyncQueue.verifyOperationInProgress(),C(d6,"RemoteStore received new credentials");const n=hl(r);r.offlineCauses.add(3),await he(r),n&&r.onlineStateTracker.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.offlineCauses.delete(3),await d8(r)}async function hN(e,t){const r=O(e);t?(r.offlineCauses.delete(2),await d8(r)):t||(r.offlineCauses.add(2),await he(r),r.onlineStateTracker.set("Unknown"))}function hD(e){return e.watchStream||(e.watchStream=d0(e.datastore,e.asyncQueue,{onConnected:hc.bind(null,e),onOpen:hd.bind(null,e),onClose:hh.bind(null,e),onWatchChange:hp.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.watchStream.inhibitBackoff(),ho(e)?ha(e):e.onlineStateTracker.set("Unknown")):(await e.watchStream.stop(),hu(e))})),e.watchStream}function hO(e){return e.writeStream||(e.writeStream=dZ(e.datastore,e.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:hE.bind(null,e),onClose:hI.bind(null,e),onHandshakeComplete:h_.bind(null,e),onMutationResult:hC.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.writeStream.inhibitBackoff(),await hv(e)):(await e.writeStream.stop(),e.writePipeline.length>0&&(C(d6,`Stopping write stream with ${e.writePipeline.length} pending writes`),e.writePipeline=[]))})),e.writeStream}const hx="AsyncQueue";class hP{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new M,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){const s=new hP(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new P(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hM(e,t){if(I(hx,`${t}: ${e}`),eH(e))return new P(x.UNAVAILABLE,`${t}: ${e}`);throw e}class hL{static emptySet(e){return new hL(e.comparator)}constructor(e){e?this.comparator=(t,r)=>e(t,r)||es.comparator(t.key,r.key):this.comparator=(e,t)=>es.comparator(e.key,t.key),this.keyedMap=i0(),this.sortedSet=new rp(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof hL)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){const e=[];return(this.forEach(t=>{e.push(t.toString())}),0===e.length)?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new hL;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class hF{constructor(){this.changeMap=new rp(es.comparator)}track(e){const t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}0!==e.type&&3===r.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==r.type?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):A(63341,{change:e,oldChange:r})}getChanges(){const e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}}class hB{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new hB(e,t,hL.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!iU(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class hU{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}}function hj(){return new hV}class hV{constructor(){this.queries=hz(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){hW(this,new P(x.ABORTED,"Firestore shutting down"))}}function hz(){return new iY(e=>ij(e),iU)}async function hq(e,t){let r=O(e),n=3,i=t.query,s=r.queries.get(i);s?!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(n=2):(s=new hU,n=t.listensToRemoteStore()?0:1);try{switch(n){case 0:s.viewSnap=await r.onListen(i,!0);break;case 1:s.viewSnap=await r.onListen(i,!1);break;case 2:await r.onFirstRemoteStoreListen(i)}}catch(r){const e=hM(r,`Initialization of query '${iV(t.query)}' failed`);t.onError(e);return}r.queries.set(i,s),s.listeners.push(t),t.applyOnlineStateChange(r.onlineState),s.viewSnap&&t.onViewSnapshot(s.viewSnap)&&hQ(r)}async function h$(e,t){let r=O(e),n=t.query,i=3,s=r.queries.get(n);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),0===s.listeners.length?i=t.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(i=2))}switch(i){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function hG(e,t){let r=O(e),n=!1;for(const e of t){const t=e.query,i=r.queries.get(t);if(i){for(const t of i.listeners)t.onViewSnapshot(e)&&(n=!0);i.viewSnap=e}}n&&hQ(r)}function hK(e,t,r){const n=O(e),i=n.queries.get(t);if(i)for(const e of i.listeners)e.onError(r);n.queries.delete(t)}function hH(e,t){const r=O(e);r.onlineState=t;let n=!1;r.queries.forEach((e,r)=>{for(const e of r.listeners)e.applyOnlineStateChange(t)&&(n=!0)}),n&&hQ(r)}function hW(e,t){const r=O(e),n=r.queries;r.queries=hz(),n.forEach((e,r)=>{for(const e of r.listeners)e.onError(t)})}function hQ(e){e.snapshotsInSyncListeners.forEach(e=>{e.next()})}!function(e){e.Default="default",e.Cache="cache"}(a||(a={}));class hY{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){const t=[];for(const r of e.docChanges)3!==r.type&&t.push(r);e=new hB(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;const r="Offline"!==t;return(!this.options.waitForSyncWhenOnline||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;const t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return(!!e.syncStateChanged||!!t)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(e){e=hB.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==a.Cache}}class hJ{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=n}static fromSnapshot(e,t){let r=i8(),n=i8();for(const e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new hJ(e,t.fromCache,r,n)}}class hX{constructor(e){this.serializer=e}toDocumentKey(e){return a_(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?aO(this.serializer,e.document,!1):nM.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return ab(e)}}class hZ{constructor(e,t){this.bundleMetadata=e,this.serializer=t,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=h0(e)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this._queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this._documents.push({metadata:e.payload.documentMetadata}),!e.payload.documentMetadata.exists&&++t;const r=er.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this._documents[this._documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}getQueryDocumentMapping(e){const t=new Map,r=new hX(this.serializer);for(const n of e)if(n.metadata.queries){const e=r.toDocumentKey(n.metadata.name);for(const r of n.metadata.queries){const n=(t.get(r)||i8()).add(e);t.set(r,n)}}return t}async completeAndStoreAsync(e){const t=await cH(e,new hX(this.serializer),this._documents,this.bundleMetadata.id),r=this.getQueryDocumentMapping(this.documents);for(const t of this._queries)await cJ(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:t}}}function h0(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}function h1(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class h2{constructor(e){this.key=e}}class h3{constructor(e){this.key=e}}class h4{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=i8(),this.mutatedKeys=i8(),this.docComparator=iW(e),this.documentSet=new hL(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new hF,n=t?t.documentSet:this.documentSet,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),c=iz(this.query,t)?t:null,d=!!u&&this.mutatedKeys.has(u.key),h=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),p=!1;u&&c?u.data.isEqual(c.data)?d!==h&&(r.track({type:3,doc:c}),p=!0):!this.shouldWaitForSyncedDocument(u,c)&&(r.track({type:2,doc:c}),p=!0,(o&&this.docComparator(c,o)>0||l&&0>this.docComparator(c,l))&&(a=!0)):!u&&c?(r.track({type:0,doc:c}),p=!0):u&&!c&&(r.track({type:1,doc:u}),p=!0,(o||l)&&(a=!0)),p&&(c?(s=s.add(c),i=h?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{documentSet:s,changeSet:r,needsRefill:a,mutatedKeys:i}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){const i=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;const s=e.changeSet.getChanges();s.sort((e,t)=>h6(e.type,t.type)||this.docComparator(e.doc,t.doc)),this.applyTargetChange(r),n=n??!1;const a=t&&!n?this.updateLimboDocuments():[],o=0===this.limboDocuments.size&&this.current&&!n?1:0,l=o!==this.syncState;return(this.syncState=o,0!==s.length||l)?{snapshot:new hB(this.query,e.documentSet,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),limboChanges:a}:{limboChanges:a}}applyOnlineStateChange(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new hF,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations}applyTargetChange(e){e&&(e.addedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.delete(e)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];const e=this.limboDocuments;this.limboDocuments=i8(),this.documentSet.forEach(e=>{this.shouldBeInLimbo(e.key)&&(this.limboDocuments=this.limboDocuments.add(e.key))});const t=[];return e.forEach(e=>{this.limboDocuments.has(e)||t.push(new h3(e))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new h2(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=i8();const t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return hB.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function h6(e,t){const r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return A(20277,{change:e})}};return r(e)-r(t)}const h9="SyncEngine";class h5{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class h7{constructor(e){this.key=e,this.receivedDocument=!1}}class h8{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.syncEngineListener={},this.queryViewsByQuery=new iY(e=>ij(e),iU),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new rp(es.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new uM,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=l5.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function pe(e,t,r,n,i,s,a){const o=new h8(e,t,r,n,i,s);return a&&(o._isPrimaryClient=!0),o}async function pt(e,t,r=!0){let n;const i=pL(e),s=i.queryViewsByQuery.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.computeInitialSnapshot()):n=await pn(i,t,r,!0),n}async function pr(e,t){const r=pL(e);await pn(r,t,!0,!1)}async function pn(e,t,r,n){let i;const s=await cM(e.localStore,iD(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await pi(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&hr(e.remoteStore,s),i}async function pi(e,t,r,n,i){e.applyDocChanges=(t,r,n)=>pE(e,t,r,n);const s=await cB(e.localStore,t,!0),a=new h4(t,s.remoteKeys),o=a.computeDocChanges(s.documents),l=s5.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);pb(e,r,u.limboChanges);const c=new h5(t,r,a);return e.queryViewsByQuery.set(t,c),e.queriesByTarget.has(r)?e.queriesByTarget.get(r).push(t):e.queriesByTarget.set(r,[t]),u.snapshot}async function ps(e,t,r){const n=O(e),i=n.queryViewsByQuery.get(t),s=n.queriesByTarget.get(i.targetId);if(s.length>1){n.queriesByTarget.set(i.targetId,s.filter(e=>!iU(e,t))),n.queryViewsByQuery.delete(t);return}n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await cF(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),r&&hn(n.remoteStore,i.targetId),py(n,i.targetId)}).catch(eB)):(py(n,i.targetId),await cF(n.localStore,i.targetId,!0))}async function pa(e,t){const r=O(e),n=r.queryViewsByQuery.get(t),i=r.queriesByTarget.get(n.targetId);r.isPrimaryClient&&1===i.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),hn(r.remoteStore,n.targetId))}async function po(e,t,r){const n=pF(e);try{const e=await cE(n.localStore,t);n.sharedClientState.addPendingMutation(e.batchId),pm(n,e.batchId,r),await pS(n,e.changes),await hv(n.remoteStore)}catch(t){const e=hM(t,"Failed to persist write");r.reject(e)}}async function pl(e,t){const r=O(e);try{const e=await cA(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.activeLimboResolutionsByTarget.get(t);n&&(D(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?n.receivedDocument=!0:e.modifiedDocuments.size>0?D(n.receivedDocument,14607):e.removedDocuments.size>0&&(D(n.receivedDocument,42227),n.receivedDocument=!1))}),await pS(r,e,t)}catch(e){await eB(e)}}function pu(e,t,r){const n=O(e);if(n.isPrimaryClient&&0===r||!n.isPrimaryClient&&1===r){const e=[];n.queryViewsByQuery.forEach((r,n)=>{const i=n.view.applyOnlineStateChange(t);i.snapshot&&e.push(i.snapshot)}),hH(n.eventManager,t),e.length&&n.syncEngineListener.onWatchChange(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function pc(e,t,r){const n=O(e);n.sharedClientState.updateQueryState(t,"rejected",r);const i=n.activeLimboResolutionsByTarget.get(t),s=i&&i.key;if(s){let e=new rp(es.comparator);e=e.insert(s,nM.newNoDocument(s,eT.min()));const r=i8().add(s),i=new s9(eT.min(),new Map,new rp(H),e,r);await pl(n,i),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(s),n.activeLimboResolutionsByTarget.delete(t),pw(n)}else await cF(n.localStore,t,!1).then(()=>py(n,t,r)).catch(eB)}async function pd(e,t){const r=O(e),n=t.batch.batchId;try{const e=await c_(r.localStore,t);pg(r,n,null),pp(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await pS(r,e)}catch(e){await eB(e)}}async function ph(e,t,r){const n=O(e);try{const e=await cI(n.localStore,t);pg(n,t,r),pp(n,t),n.sharedClientState.updateMutationState(t,"rejected",r),await pS(n,e)}catch(e){await eB(e)}}function pp(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(e=>{e.resolve()}),e.pendingWritesCallbacks.delete(t)}function pf(e,t){e.pendingWritesCallbacks.forEach(e=>{e.forEach(e=>{e.reject(new P(x.CANCELLED,t))})}),e.pendingWritesCallbacks.clear()}function pm(e,t,r){let n=e.mutationUserCallbacks[e.currentUser.toKey()];n||(n=new rp(H)),n=n.insert(t,r),e.mutationUserCallbacks[e.currentUser.toKey()]=n}function pg(e,t,r){let n=O(e),i=n.mutationUserCallbacks[n.currentUser.toKey()];if(i){const e=i.get(t);e&&(r?e.reject(r):e.resolve(),i=i.remove(t)),n.mutationUserCallbacks[n.currentUser.toKey()]=i}}function py(e,t,r=null){for(const n of(e.sharedClientState.removeLocalQueryTarget(t),e.queriesByTarget.get(t)))e.queryViewsByQuery.delete(n),r&&e.syncEngineListener.onWatchError(n,r);e.queriesByTarget.delete(t),e.isPrimaryClient&&e.limboDocumentRefs.removeReferencesForId(t).forEach(t=>{e.limboDocumentRefs.containsKey(t)||pv(e,t)})}function pv(e,t){e.enqueuedLimboResolutions.delete(t.path.canonicalString());const r=e.activeLimboTargetsByKey.get(t);null!==r&&(hn(e.remoteStore,r),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(r),pw(e))}function pb(e,t,r){for(const n of r)n instanceof h2?(e.limboDocumentRefs.addReference(n.key,t),pT(e,n)):n instanceof h3?(C(h9,"Document no longer in limbo: "+n.key),e.limboDocumentRefs.removeReference(n.key,t),e.limboDocumentRefs.containsKey(n.key)||pv(e,n.key)):A(19791,{limboChange:n})}function pT(e,t){const r=t.key,n=r.path.canonicalString();e.activeLimboTargetsByKey.get(r)||e.enqueuedLimboResolutions.has(n)||(C(h9,"New document in limbo: "+r),e.enqueuedLimboResolutions.add(n),pw(e))}function pw(e){for(;e.enqueuedLimboResolutions.size>0&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){const t=e.enqueuedLimboResolutions.values().next().value;e.enqueuedLimboResolutions.delete(t);const r=new es(er.fromString(t)),n=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(n,new h7(r)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(r,n),hr(e.remoteStore,new oT(iD(i_(r.path)),n,"TargetPurposeLimboResolution",e4.INVALID))}}async function pS(e,t,r){const n=O(e),i=[],s=[],a=[];n.queryViewsByQuery.isEmpty()||(n.queryViewsByQuery.forEach((e,o)=>{a.push(n.applyDocChanges(o,t,r).then(e=>{if((e||r)&&n.isPrimaryClient){const t=e?!e.fromCache:r?.targetChanges.get(o.targetId)?.current;n.sharedClientState.updateQueryState(o.targetId,t?"current":"not-current")}if(e){i.push(e);const t=hJ.fromSnapshot(o.targetId,e);s.push(t)}}))}),await Promise.all(a),n.syncEngineListener.onWatchChange(i),await cO(n.localStore,s))}async function pE(e,t,r,n){let i=t.view.computeDocChanges(r);i.needsRefill&&(i=await cB(e.localStore,t.query,!1).then(({documents:e})=>t.view.computeDocChanges(e,i)));const s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return pb(e,t.targetId,o.limboChanges),o.snapshot}async function p_(e,t){const r=O(e);if(!r.currentUser.isEqual(t)){C(h9,"User change. New user:",t.toKey());const e=await cS(r.localStore,t);r.currentUser=t,pf(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await pS(r,e.affectedDocuments)}}function pC(e,t){const r=O(e),n=r.activeLimboResolutionsByTarget.get(t);if(n&&n.receivedDocument)return i8().add(n.key);{let e=i8(),n=r.queriesByTarget.get(t);if(!n)return e;for(const t of n){const n=r.queryViewsByQuery.get(t);e=e.unionWith(n.view.syncedDocuments)}return e}}async function pI(e,t){const r=O(e),n=await cB(r.localStore,t.query,!0),i=t.view.synchronizeWithPersistedState(n);return r.isPrimaryClient&&pb(r,t.targetId,i.limboChanges),i}async function pR(e,t){const r=O(e);return c$(r.localStore,t).then(e=>pS(r,e))}async function pk(e,t,r,n){const i=O(e),s=await cj(i.localStore,t);if(null===s){C(h9,"Cannot apply mutation batch with id: "+t);return}"pending"===r?await hv(i.remoteStore):"acknowledged"===r||"rejected"===r?(pg(i,t,n||null),pp(i,t),cV(i.localStore,t)):A(6720,"Unknown batchState",{batchState:r}),await pS(i,s)}async function pA(e,t){const r=O(e);if(pL(r),pF(r),!0===t&&!0!==r._isPrimaryClient){const e=r.sharedClientState.getAllActiveQueryTargets(),t=await pD(r,e.toArray());for(const e of(r._isPrimaryClient=!0,await hN(r.remoteStore,!0),t))hr(r.remoteStore,e)}else if(!1===t&&!1!==r._isPrimaryClient){let e=[],t=Promise.resolve();r.queriesByTarget.forEach((n,i)=>{r.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(py(r,i),cF(r.localStore,i,!0))),hn(r.remoteStore,i)}),await t,await pD(r,e),pN(r),r._isPrimaryClient=!1,await hN(r.remoteStore,!1)}}function pN(e){const t=O(e);t.activeLimboResolutionsByTarget.forEach((e,r)=>{hn(t.remoteStore,r)}),t.limboDocumentRefs.removeAllReferences(),t.activeLimboResolutionsByTarget=new Map,t.activeLimboTargetsByKey=new rp(es.comparator)}async function pD(e,t,r){const n=O(e),i=[],s=[];for(const e of t){let t;const r=n.queriesByTarget.get(e);if(r&&0!==r.length)for(const e of(t=await cM(n.localStore,iD(r[0])),r)){const t=n.queryViewsByQuery.get(e),r=await pI(n,t);r.snapshot&&s.push(r.snapshot)}else{const r=await cq(n.localStore,e);t=await cM(n.localStore,r),await pi(n,pO(r),e,!1,t.resumeToken)}i.push(t)}return n.syncEngineListener.onWatchChange(s),i}function pO(e){return iE(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function px(e){return cz(O(e).localStore)}async function pP(e,t,r,n){const i=O(e);if(i._isPrimaryClient){C(h9,"Ignoring unexpected query state notification.");return}const s=i.queriesByTarget.get(t);if(s&&s.length>0)switch(r){case"current":case"not-current":{const e=await c$(i.localStore,iH(s[0])),n=s9.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,r_.EMPTY_BYTE_STRING);await pS(i,e,n);break}case"rejected":await cF(i.localStore,t,!0),py(i,t,n);break;default:A(64155,r)}}async function pM(e,t,r){const n=pL(e);if(n._isPrimaryClient){for(const e of t){if(n.queriesByTarget.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){C(h9,"Adding an already active target "+e);continue}const t=await cq(n.localStore,e),r=await cM(n.localStore,t);await pi(n,pO(t),r.targetId,!1,r.resumeToken),hr(n.remoteStore,r)}for(const e of r)n.queriesByTarget.has(e)&&await cF(n.localStore,e,!1).then(()=>{hn(n.remoteStore,e),py(n,e)}).catch(eB)}}function pL(e){const t=O(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=pl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=pC.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=pc.bind(null,t),t.syncEngineListener.onWatchChange=hG.bind(null,t.eventManager),t.syncEngineListener.onWatchError=hK.bind(null,t.eventManager),t}function pF(e){const t=O(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=pd.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=ph.bind(null,t),t}function pB(e,t,r){const n=O(e);pU(n,t,r).then(e=>{n.sharedClientState.notifyBundleLoaded(e)})}async function pU(e,t,r){try{const n=await t.getMetadata();if(await cW(e.localStore,n))return await t.close(),r._completeWith(h1(n)),Promise.resolve(new Set);r._updateProgress(h0(n));let i=new hZ(n,t.serializer),s=await t.nextElement();for(;s;){const e=await i.addSizedElement(s);e&&r._updateProgress(e),s=await t.nextElement()}const a=await i.completeAndStoreAsync(e.localStore);return await pS(e,a.changedDocs,void 0),await cQ(e.localStore,n),r._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(e){return R(h9,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}}class pj{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=dM(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return cw(this.persistence,new c2,e.initialUser,this.serializer)}createPersistence(e){return new uG(uH.factory,this.serializer)}createSharedClientState(e){return new df}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}pj.provider={build:()=>new pj};class pV extends pj{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){return D(this.persistence.referenceDelegate instanceof uW,46915),new uh(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createPersistence(e){const t=void 0!==this.cacheSizeBytes?us.withCacheSize(this.cacheSizeBytes):us.DEFAULT;return new uG(e=>uW.factory(e,t),this.serializer)}}class pz extends pj{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.onlineComponentProvider.initialize(this,e),await pF(this.onlineComponentProvider.syncEngine),await hv(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return cw(this.persistence,new c2,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new uh(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new e3(t,this.persistence);return new e2(e.asyncQueue,r)}createPersistence(e){const t=cm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?us.withCacheSize(this.cacheSizeBytes):us.DEFAULT;return new ch(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,dx(),dP(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new df}}class pq{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>pu(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=p_.bind(null,this.syncEngine),await hN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return hj()}createDatastore(e){const t=dM(e.databaseInfo.databaseId),r=dD(e.databaseInfo);return dQ(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return d7(this.localStore,this.datastore,e.asyncQueue,e=>pu(this.syncEngine,e,0),dO())}createSyncEngine(e,t){return pe(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await ht(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}pq.provider={build:()=>new pq};const p$=10240;function pG(e,t=p$){let r=0;return{async read(){if(r<e.byteLength){const n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function pK(e,t){if(!(e instanceof Uint8Array))throw new P(x.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${ed(e)}`);return pG(e,t)}class pH{constructor(e){this.observer=e,this.muted=!1}next(e){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):I("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class pW{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}}class pQ{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new M,this.buffer=new Uint8Array,this.textDecoder=s0(),this.nextElementImpl().then(e=>{e&&e.isBundleMetadata()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.payload)}`))},e=>this.metadata.reject(e))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){const e=await this.readLength();if(null===e)return null;const t=this.textDecoder.decode(e),r=Number(t);return isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`),new pW(JSON.parse(await this.readJsonString(r)),e.length+r)}indexOfOpenBracket(){return this.buffer.findIndex(e=>123===e)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;const e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async readJsonString(e){for(;this.buffer.length<e;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");const t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}raiseError(e){throw this.reader.cancel(),Error(`Invalid bundle format: ${e}`)}async pullMoreDataToBuffer(){const e=await this.reader.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}function pY(e,t){return new pQ(e,t)}class pJ{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.nextElement();if(r&&r.isBundleMetadata())this.metadata=r;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.payload)}`);do null!==(r=this.nextElement())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;const e=this.readLength();return new pW(JSON.parse(this.readJsonString(e)),e)}readJsonString(e){if(this.cursor+e>this.bundleData.length)throw new P(x.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}readLength(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class pX{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new P(x.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await dJ(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new sj(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{const r=es.fromPath(t);this.mutations.push(new sq(r,this.precondition(r)))}),await dY(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=eT.min();else throw A(50498,{documentName:e.constructor.name});const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new P(x.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return this.writtenDocs.has(e.toString())||!t?sE.none():t.isEqual(eT.min())?sE.exists(!1):sE.updateTime(t)}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return sE.exists(!0);if(t.isEqual(eT.min()))throw new P(x.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return sE.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}const pZ="FirestoreClient",p0=100,p1=11,p2=20,p3=22;class p4{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=b.UNAUTHENTICATED,this.clientId=K.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{C(pZ,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(C(pZ,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:p0}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new M;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){const t=hM(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function p6(e,t){e.asyncQueue.verifyOperationInProgress(),C(pZ,"Initializing OfflineComponentProvider");const r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await cS(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function p9(e,t){e.asyncQueue.verifyOperationInProgress();const r=await p7(e);C(pZ,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>hA(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>hA(t.remoteStore,r)),e._onlineComponents=t}function p5(e){return"FirebaseError"===e.name?e.code===x.FAILED_PRECONDITION||e.code===x.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||e.code===p3||e.code===p2||e.code===p1}async function p7(e){if(!e._offlineComponents){if(e._uninitializedComponentsProvider){C(pZ,"Using user provided OfflineComponentProvider");try{await p6(e,e._uninitializedComponentsProvider._offline)}catch(r){const t=r;if(!p5(t))throw t;R("Error using user provided cache. Falling back to memory cache: "+t),await p6(e,new pj)}}else C(pZ,"Using default OfflineComponentProvider"),await p6(e,new pV(void 0))}return e._offlineComponents}async function p8(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(C(pZ,"Using user provided OnlineComponentProvider"),await p9(e,e._uninitializedComponentsProvider._online)):(C(pZ,"Using default OnlineComponentProvider"),await p9(e,new pq))),e._onlineComponents}function fe(e){return p7(e).then(e=>e.localStore)}function ft(e){return p8(e).then(e=>e.syncEngine)}function fr(e){return p8(e).then(e=>e.datastore)}async function fn(e){const t=await p8(e),r=t.eventManager;return r.onListen=pt.bind(null,t.syncEngine),r.onUnlisten=ps.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=pr.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=pa.bind(null,t.syncEngine),r}function fi(e,t,r,n){const i=new pH(n),s=new hY(t,i,r);return e.asyncQueue.enqueueAndForget(async()=>hq(await fn(e),s)),()=>{i.mute(),e.asyncQueue.enqueueAndForget(async()=>h$(await fn(e),s))}}function fs(e,t,r={}){const n=new M;return e.asyncQueue.enqueueAndForget(async()=>fl(await fn(e),e.asyncQueue,t,r,n)),n.promise}function fa(e,t,r={}){const n=new M;return e.asyncQueue.enqueueAndForget(async()=>fu(await fn(e),e.asyncQueue,t,r,n)),n.promise}function fo(e,t){const r=new M;return e.asyncQueue.enqueueAndForget(async()=>po(await ft(e),t,r)),r.promise}function fl(e,t,r,n,i){const s=new pH({next:o=>{s.mute(),t.enqueueAndForget(()=>h$(e,a));const l=o.docs.has(r);!l&&o.fromCache?i.reject(new P(x.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&n&&"server"===n.source?i.reject(new P(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new hY(i_(r.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return hq(e,a)}function fu(e,t,r,n,i){const s=new pH({next:r=>{s.mute(),t.enqueueAndForget(()=>h$(e,a)),r.fromCache&&"server"===n.source?i.reject(new P(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(r)},error:e=>i.reject(e)}),a=new hY(r,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return hq(e,a)}function fc(e,t,r,n){const i=fh(r,dM(t));e.asyncQueue.enqueueAndForget(async()=>{pB(await ft(e),i,n)})}function fd(e,t){return e.asyncQueue.enqueue(async()=>cY(await fe(e),t))}function fh(e,t){let r;return pY(pK(r="string"==typeof e?sZ().encode(e):e),t)}function fp(e,t){return e.timeoutSeconds===t.timeoutSeconds}function ff(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const fm="ComponentProvider",fg=new Map;function fy(e){const t=fg.get(e);t&&(C(fm,"Removing Datastore"),fg.delete(e),t.terminate())}function fv(e,t,r,n){return new rU(e,t,r,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,ff(n.experimentalLongPollingOptions),n.useFetchStreams,n.isUsingEmulator)}const fb="firestore.googleapis.com",fT=!0,fw=5,fS=30,fE=!0;class f_{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new P(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=fb,this.ssl=fT}else this.host=e.host,this.ssl=e.ssl??fT;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=ui;else{if(e.cacheSizeBytes!==un&&e.cacheSizeBytes<uo)throw new P(x.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${uo}`);this.cacheSizeBytes=e.cacheSizeBytes}eo("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=fE:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ff(e.experimentalLongPollingOptions??{}),fC(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&fp(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}function fC(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new P(x.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<fw)throw new P(x.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is ${fw})`);if(e.timeoutSeconds>fS)throw new P(x.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is ${fS})`)}}class fI{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new f_({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new P(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new P(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new f_(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=$(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return fy(this),Promise.resolve()}}function fR(e,t,r,n={}){e=ep(e,fI);const i=(0,d.Xx)(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&((0,d.Uo)(`https://${o}`),(0,d.dp)("Firestore",!0)),s.host!==fb&&s.host!==o&&R("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...s,host:o,ssl:i,emulatorOptions:n};if(!(0,d.vZ)(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=b.MOCK_USER;else{t=(0,d.Sg)(n.mockUserToken,e._app?.options.projectId);const i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new P(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new b(i)}e._authCredentials=new B(new L(t,r))}}class fk{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new fk(this.firestore,e,this._query)}}class fA{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fN(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new fA(this.firestore,e,this._key)}toJSON(){return{type:fA._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(eg(t,fA._jsonSchema))return new fA(e,r||null,new es(er.fromString(t.referencePath)))}}fA._jsonSchemaVersion="firestore/documentReference/1.0",fA._jsonSchema={type:em("string",fA._jsonSchemaVersion),referencePath:em("string")};class fN extends fk{constructor(e,t,r){super(e,t,i_(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new fA(this.firestore,null,new es(e))}withConverter(e){return new fN(this.firestore,e,this._path)}}function fD(e,t,...r){if(e=(0,d.m9)(e),ea("collection","path",t),e instanceof fI){const n=er.fromString(t,...r);return eu(n),new fN(e,null,n)}{if(!(e instanceof fA)&&!(e instanceof fN))throw new P(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(er.fromString(t,...r));return eu(n),new fN(e.firestore,null,n)}}function fO(e,t,...r){if(e=(0,d.m9)(e),1==arguments.length&&(t=K.newId()),ea("doc","path",t),e instanceof fI){const n=er.fromString(t,...r);return el(n),new fA(e,null,new es(n))}{if(!(e instanceof fA)&&!(e instanceof fN))throw new P(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(er.fromString(t,...r));return el(n),new fA(e.firestore,e instanceof fN?e.converter:null,new es(n))}}const fx="AsyncQueue";class fP{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new dj(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});const t=new M;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(eH(e))C(fx,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){const t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(e=>{throw this.failure=e,this.operationInProgress=!1,I("INTERNAL UNHANDLED ERROR: ",fM(e)),e}).then(e=>(this.operationInProgress=!1,e))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);const n=hP.createAndSchedule(this,e,t,r,e=>this.removeDelayedOperation(e));return this.delayedOperations.push(n),n}verifyNotFailed(){this.failure&&A(47125,{messageOrStack:fM(this.failure)})}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(const t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{for(const t of(this.delayedOperations.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.delayedOperations))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){const t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}}function fM(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class fL{constructor(){this._progressObserver={},this._taskCompletionResolver=new M,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class fF extends fI{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new fP,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new fP(e),this._firestoreClient=void 0,await e}}}function fB(e,t){const r="object"==typeof e?e:(0,o.Mq)(),n="string"==typeof e?e:t||rj,i=(0,o.qX)(r,"firestore").getImmediate({identifier:n});if(!i._initialized){const e=(0,d.P0)("firestore");e&&fR(i,...e)}return i}function fU(e){if(e._terminated)throw new P(x.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||fj(e),e._firestoreClient}function fj(e){const t=e._freezeSettings(),r=fv(e._databaseId,e._app?.options.appId||"",e._persistenceKey,t);!e._componentsProvider&&t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new p4(e._authCredentials,e._appCheckCredentials,e._queue,r,e._componentsProvider&&fV(e._componentsProvider))}function fV(e){const t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}function fz(e,t=!0){w(o.Jn),(0,o.Xd)(new l.wA("firestore",(e,{instanceIdentifier:r,options:n})=>{const i=e.getProvider("app").getImmediate(),s=new fF(new U(e.getProvider("auth-internal")),new q(i,e.getProvider("app-check-internal")),rz(i,r),i);return n={useFetchStreams:t,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),(0,o.KN)(y,v,e),(0,o.KN)(y,v,"esm2020")}class fq{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class f${constructor(e){this._byteString=e}static fromBase64String(e){try{return new f$(r_.fromBase64String(e))}catch(e){throw new P(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new f$(r_.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:f$._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(eg(e,f$._jsonSchema))return f$.fromBase64String(e.bytes)}}f$._jsonSchemaVersion="firestore/bytes/1.0",f$._jsonSchema={type:em("string",f$._jsonSchemaVersion),bytes:em("string")};class fG{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new P(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ei(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class fK{constructor(e){this._methodName=e}}class fH{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new P(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new P(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return H(this._lat,e._lat)||H(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:fH._jsonSchemaVersion}}static fromJSON(e){if(eg(e,fH._jsonSchema))return new fH(e.latitude,e.longitude)}}fH._jsonSchemaVersion="firestore/geoPoint/1.0",fH._jsonSchema={type:em("string",fH._jsonSchemaVersion),latitude:em("number"),longitude:em("number")};class fW{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return cy(this._values,e._values)}toJSON(){return{type:fW._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(eg(e,fW._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new fW(e.vectorValues);throw new P(x.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}fW._jsonSchemaVersion="firestore/vectorValue/1.0",fW._jsonSchema={type:em("string",fW._jsonSchemaVersion),vectorValues:em("object")};const fQ=/^__.*__$/;class fY{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new sP(e,this.data,this.fieldMask,t,this.fieldTransforms):new sD(e,this.data,t,this.fieldTransforms)}}class fJ{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new sP(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function fX(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw A(40011,{dataSource:e})}}class fZ{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new fZ({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return mp(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(fX(this.dataSource)&&fQ.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class f0{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||dM(e)}createContext(e,t,r,n=!1){return new fZ({dataSource:e,methodName:t,targetDoc:r,path:ei.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function f1(e){const t=e._freezeSettings(),r=dM(e._databaseId);return new f0(e._databaseId,!!t.ignoreUndefinedProperties,r)}function f2(e,t,r,n,i,s={}){let a,o;const l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);mu("Data must be an object, but it was:",l,n);const u=mn(n,l);if(s.merge)a=new rw(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){const e=[];for(const n of s.mergeFields){const i=mc(t,n,r);if(!l.contains(i))throw new P(x.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);mf(e,i)||e.push(i)}a=new rw(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new fY(new nx(u),a,o)}class f3 extends fK{_toFieldTransform(e){if(2===e.dataSource)e.fieldMask.push(e.path);else if(1===e.dataSource)throw e.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof f3}}function f4(e,t,r){return new fZ({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class f6 extends null{_toFieldTransform(e){return new sb(e.path,new sc)}isEqual(e){return e instanceof f6}}class f9 extends fK{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){const t=f4(this,e,!0),r=new sd(this._elements.map(e=>mr(e,t)));return new sb(e.path,r)}isEqual(e){return e instanceof f9&&(0,d.vZ)(this._elements,e._elements)}}class f5 extends fK{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){const t=f4(this,e,!0),r=new sp(this._elements.map(e=>mr(e,t)));return new sb(e.path,r)}isEqual(e){return e instanceof f5&&(0,d.vZ)(this._elements,e._elements)}}class f7 extends fK{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){const t=new sm(e.serializer,si(e.serializer,this._operand));return new sb(e.path,t)}isEqual(e){return e instanceof f7&&this._operand===e._operand}}function f8(e,t,r,n){const i=e.createContext(1,t,r);mu("Data must be an object, but it was:",i,n);const s=[],a=nx.empty();return rd(n,(e,n)=>{const o=mh(t,e,r);n=(0,d.m9)(n);const l=i.childContextForFieldPath(o);if(n instanceof f3)s.push(o);else{const e=mr(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new fJ(a,new rw(s),i.fieldTransforms)}function me(e,t,r,n,i,s){const a=e.createContext(1,t,r),o=[mc(t,n,r)],l=[i];if(s.length%2!=0)throw new P(x.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(mc(t,s[e])),l.push(s[e+1]);const u=[],c=nx.empty();for(let e=o.length-1;e>=0;--e)if(!mf(u,o[e])){let t=o[e],r=l[e];r=(0,d.m9)(r);const n=a.childContextForFieldPath(t);if(r instanceof f3)u.push(t);else{const e=mr(r,n);null!=e&&(u.push(t),c.set(t,e))}}return new fJ(c,new rw(u),a.fieldTransforms)}function mt(e,t,r,n=!1){return mr(r,e.createContext(n?4:3,t))}function mr(e,t){if(ml(e=(0,d.m9)(e)))return mu("Unsupported field value:",t,e),mn(e,t);if(e instanceof fK)return ms(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),!(e instanceof Array))return ma(e,t);if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return mi(e,t)}function mn(e,t){const r={};return rh(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):rd(e,(e,n)=>{const i=mr(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function mi(e,t){let r=[],n=0;for(const i of e){let e=mr(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}function ms(e,t){if(!fX(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);const r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}function ma(e,t){if(null===(e=(0,d.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return si(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const r=eb.fromDate(e);return{timestampValue:af(t.serializer,r)}}if(e instanceof eb){const r=new eb(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:af(t.serializer,r)}}if(e instanceof fH)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};else if(e instanceof f$)return{bytesValue:ag(t.serializer,e._byteString)};else if(e instanceof fA){const r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:aT(e.firestore._databaseId||t.databaseId,e._key.path)}}else if(e instanceof fW)return mo(e,t);else throw t.createError(`Unsupported field value: ${ed(e)}`)}function mo(e,t){return{mapValue:{fields:{[rH]:{stringValue:rY},[rJ]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return sr(t.serializer,e)})}}}}}}function ml(e){return"object"==typeof e&&null!==e&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof eb)&&!(e instanceof fH)&&!(e instanceof f$)&&!(e instanceof fA)&&!(e instanceof fK)&&!(e instanceof fW)}function mu(e,t,r){if(!ml(r)||!ec(r)){const n=ed(r);if("an object"===n)throw t.createError(e+" a custom object");throw t.createError(e+" "+n)}}function mc(e,t,r){if((t=(0,d.m9)(t))instanceof fG)return t._internalPath;if("string"==typeof t)return mh(e,t);throw mp("Field path arguments must be of type string or ",e,!1,void 0,r)}const md=RegExp("[~\\*/\\[\\]]");function mh(e,t,r){if(t.search(md)>=0)throw mp(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new fG(...t.split("."))._internalPath}catch(n){throw mp(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function mp(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new P(x.INVALID_ARGUMENT,o+e+l)}function mf(e,t){return e.some(e=>e.isEqual(t))}class mm{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new fA(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{const e=new mg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}}}get(e){if(this._document){const t=this._document.data.field(my("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class mg extends mm{data(){return super.data()}}function my(e,t){return"string"==typeof t?mh(e,t):t instanceof fG?t._internalPath:t._delegate._internalPath}function mv(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new P(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class mb{}class mT extends mb{}function mw(e,t,...r){let n=[];for(const i of(t instanceof mb&&n.push(t),mz(n=n.concat(r)),n))e=i._apply(e);return e}class mS extends mT{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new mS(e,t,r)}_apply(e){const t=this._parse(e);return mU(e._query,t),new fk(e.firestore,e.converter,iP(e._query,t))}_parse(e){const t=f1(e.firestore);return mO(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function mE(e,t,r){const n=t,i=my("where",e);return mS._create(i,n,r)}class m_ extends mb{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new m_(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:nW.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(mj(e._query,t),new fk(e.firestore,e.converter,iP(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class mC extends mT{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new mC(e,t)}_apply(e){const t=mx(e._query,this._field,this._direction);return new fk(e.firestore,e.converter,iM(e._query,t))}}function mI(e,t="asc"){const r=t,n=my("orderBy",e);return mC._create(n,r)}class mR extends mT{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new mR(e,t,r)}_apply(e){return new fk(e.firestore,e.converter,iL(e._query,this._limit,this._limitType))}}function mk(e){return ef("limit",e),mR._create("limit",e,"F")}class mA extends mT{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new mA(e,t,r)}_apply(e){const t=mD(e,this.type,this._docOrFields,this._inclusive);return new fk(e.firestore,e.converter,iF(e._query,t))}}class mN extends mT{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new mN(e,t,r)}_apply(e){const t=mD(e,this.type,this._docOrFields,this._inclusive);return new fk(e.firestore,e.converter,iB(e._query,t))}}function mD(e,t,r,n){if(r[0]=(0,d.m9)(r[0]),r[0]instanceof mm)return mP(e._query,e.firestore._databaseId,t,r[0]._document,n);{const i=f1(e.firestore);return mM(e._query,e.firestore._databaseId,i,t,r,n)}}function mO(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new P(x.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){mF(a,s);const t=[];for(const r of a)t.push(mL(n,e,r));o={arrayValue:{values:t}}}else o=mL(n,e,a)}else("in"===s||"not-in"===s||"array-contains-any"===s)&&mF(a,s),o=mt(r,t,a,"in"===s||"not-in"===s);return nH.create(i,s,o)}function mx(e,t,r){if(null!==e.startAt)throw new P(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new P(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new nz(t,r)}function mP(e,t,r,n,i){if(!n)throw new P(x.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);const s=[];for(const r of iN(e))if(r.field.isKeyField())s.push(ny(t,n.key));else{const e=n.data.field(r.field);if(rM(e))throw new P(x.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==e)s.push(e);else{const e=r.field.canonicalString();throw new P(x.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}}return new nF(s,i)}function mM(e,t,r,n,i,s){const a=e.explicitOrderBy;if(i.length>a.length)throw new P(x.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const o=[];for(let s=0;s<i.length;s++){const l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new P(x.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!iA(e)&&-1!==l.indexOf("/"))throw new P(x.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);const r=e.path.child(er.fromString(l));if(!es.isDocumentKey(r))throw new P(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);const i=new es(r);o.push(ny(t,i))}else{const e=mt(r,n,l);o.push(e)}}return new nF(o,s)}function mL(e,t,r){if("string"==typeof(r=(0,d.m9)(r))){if(""===r)throw new P(x.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!iA(t)&&-1!==r.indexOf("/"))throw new P(x.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);const n=t.path.child(er.fromString(r));if(!es.isDocumentKey(n))throw new P(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ny(e,new es(n))}if(r instanceof fA)return ny(e,r._key);throw new P(x.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ed(r)}.`)}function mF(e,t){if(!Array.isArray(e)||0===e.length)throw new P(x.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function mB(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function mU(e,t){const r=mV(e.filters,mB(t.op));if(null!==r){if(r===t.op)throw new P(x.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`);throw new P(x.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}}function mj(e,t){let r=e;for(const e of t.getFlattenedFilters())mU(r,e),r=iP(r,e)}function mV(e,t){for(const r of e)for(const e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}function mz(e){const t=e.filter(e=>e instanceof m_).length,r=e.filter(e=>e instanceof mS).length;if(t>1||t>0&&r>0)throw new P(x.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}class mq{convertValue(e,t="none"){switch(rZ(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rA(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(rN(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw A(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return rd(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new fW(e.fields?.[rJ].arrayValue?.values?.map(e=>rA(e.doubleValue)))}convertGeoPoint(e){return new fH(rA(e.latitude),rA(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=rF(e);if(null==r)return null;return this.convertValue(r,t);case"estimate":return this.convertTimestamp(rB(e));default:return null}}convertTimestamp(e){const t=rk(e);return new eb(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=er.fromString(e);D(ob(r),9688,{name:e});const n=new rV(r.get(1),r.get(3)),i=new es(r.popFirst(5));return n.isEqual(t)||I(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function m$(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class mG extends mq{constructor(e){super(),this.firestore=e}convertBytes(e){return new f$(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new fA(this.firestore,null,t)}}function mK(e){return mH(e,["next","error","complete"])}function mH(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const e of t)if(e in r&&"function"==typeof r[e])return!0;return!1}const mW=sZ();function mQ(e){const t=JSON.stringify(e),r=mW.encode(t).byteLength;return`${r}${t}`}mQ({metadata:{id:"test-bundle",createTime:{seconds:1577836805,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),mQ({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),mQ({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),mQ({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),mQ({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),mQ({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),mQ({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:1590011379,nanos:191164e3}}}),mQ({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:1590011379,nanos:543063e3}}});const mY=1;class mJ{constructor(e,t){this.firestore=e,this.bundleId=t,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new eb(0,0),this.databaseId=e._databaseId,this.serializer=new ac(this.databaseId,!0),this.userDataReader=new f0(this.databaseId,!0,this.serializer)}addBundleDocument(e,t){const r=this.documents.get(e.documentPath),n=r?.metadata.queries,i=e.readTime,s=r?.metadata.readTime?am(r.metadata.readTime):null,a=!i&&null==s,o=void 0!==i&&(null==s||s<i);if((a||o)&&this.documents.set(e.documentPath,{document:this.toBundleDocument(e),metadata:{name:aE(this.serializer,e.documentKey),readTime:i?af(this.serializer,i):void 0,exists:e.documentExists}}),i&&i>this.latestReadTime&&(this.latestReadTime=i),t){const r=this.documents.get(e.documentPath);r.metadata.queries=n||[],r.metadata.queries.push(t)}}addBundleQuery(e){if(this.namedQueries.has(e.name))throw Error(`Query name conflict: ${name} has already been added.`);let t=new eb(0,0);for(const r of e.docBundleDataArray)this.addBundleDocument(r,e.name),r.readTime&&r.readTime>t&&(t=r.readTime);const r=aQ(this.serializer,iD(e.query)),n={parent:e.parent,structuredQuery:r.queryTarget.structuredQuery};this.namedQueries.set(e.name,{name:e.name,bundledQuery:n,readTime:af(this.serializer,t)})}toBundleDocument(e){const t=this.userDataReader.createContext(4,"internal toBundledDocument"),r=mn(e.documentData,t);return{name:aE(this.serializer,e.documentKey),fields:r.mapValue.fields,updateTime:af(this.serializer,e.versionTime),createTime:af(this.serializer,e.createdTime)}}lengthPrefixedString(e){const t=JSON.stringify(e),r=mW.encode(t).byteLength;return`${r}${t}`}build(){let e="";for(const t of this.namedQueries.values())e+=this.lengthPrefixedString({namedQuery:t});for(const t of this.documents.values()){const r=t.metadata;e+=this.lengthPrefixedString({documentMetadata:r});const n=t.document;n&&(e+=this.lengthPrefixedString({document:n}))}const t={id:this.bundleId,createTime:af(this.serializer,this.latestReadTime),version:mY,totalDocuments:this.documents.size,totalBytes:mW.encode(e).length};return this.lengthPrefixedString({metadata:t})+e}}function mX(e,t,r,n){const i=new mJ(e,K.newId());return i.addBundleDocument(m0(n,r,t)),i.build()}function mZ(e,t,r,n,i,s,a){const o=[];for(let e=0;e<s.length;e++)o.push(m0(i[e],a[e],s[e]));const l={name:r,query:t,parent:n,docBundleDataArray:o},u=new mJ(e,r);return u.addBundleQuery(l),u.build()}function m0(e,t,r){return{documentData:t,documentKey:r.mutableCopy().key,documentPath:e,documentExists:!0,createdTime:r.createTime.toTimestamp(),readTime:r.readTime.toTimestamp(),versionTime:r.version.toTimestamp()}}class m1{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class m2 extends mm{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);{const t=new m3(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}}}get(e,t={}){if(this._document){const r=this._document.data.field(my("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new P(x.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};if(t.type=m2._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument())return t;const r=this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous");return t.bundle=mX(this._firestore,e,r,this.ref.path),t}}m2._jsonSchemaVersion="firestore/documentSnapshot/1.0",m2._jsonSchema={type:em("string",m2._jsonSchemaVersion),bundleSource:em("string","DocumentSnapshot"),bundleName:em("string"),bundle:em("string")};class m3 extends m2{data(e={}){return super.data(e)}}class m4{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new m1(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new m3(this._firestore,this._userDataWriter,r.key,r,new m1(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new P(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=m6(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new P(x.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=m4._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=K.newId();const t=this._firestore._databaseId.database,r=this._firestore._databaseId.projectId,n=`projects/${r}/databases/${t}/documents`,i=[],s=[],a=[];return this.docs.forEach(e=>{null!==e._document&&(i.push(e._document),s.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),a.push(e.ref.path))}),e.bundle=mZ(this._firestore,this.query._query,e.bundleName,n,a,i,s),e}}function m6(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{const n=new m3(e._firestore,e._userDataWriter,r.doc.key,r.doc,new m1(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new m3(e._firestore,e._userDataWriter,t.doc.key,t.doc,new m1(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:m9(t.type),doc:n,oldIndex:i,newIndex:s}})}}function m9(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return A(61501,{type:e})}}function m5(e){e=ep(e,fA);const t=ep(e.firestore,fF);return fs(fU(t),e._key).then(r=>gi(t,e,r))}m4._jsonSchemaVersion="firestore/querySnapshot/1.0",m4._jsonSchema={type:em("string",m4._jsonSchemaVersion),bundleSource:em("string","QuerySnapshot"),bundleName:em("string"),bundle:em("string")};class m7 extends mq{constructor(e){super(),this.firestore=e}convertBytes(e){return new f$(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new fA(this.firestore,null,t)}}function m8(e){e=ep(e,fk);const t=ep(e.firestore,fF),r=fU(t),n=new m7(t);return mv(e._query),fa(r,e._query).then(r=>new m4(t,n,e,r))}function ge(e,t,r,...n){let i;e=ep(e,fA);const s=ep(e.firestore,fF),a=f1(s);return gn(s,[(i="string"==typeof(t=(0,d.m9)(t))||t instanceof fG?me(a,"updateDoc",e._key,t,r,n):f8(a,"updateDoc",e._key,t)).toMutation(e._key,sE.exists(!0))])}function gt(e){return gn(ep(e.firestore,fF),[new sj(e._key,sE.none())])}function gr(e,t){const r=ep(e.firestore,fF),n=fO(e),i=m$(e.converter,t);return gn(r,[f2(f1(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,sE.exists(!1))]).then(()=>n)}function gn(e,t){return fo(fU(e),t)}function gi(e,t,r){const n=r.docs.get(t._key),i=new m7(e);return new m2(e,i,t._key,n,new m1(r.hasPendingWrites,r.fromCache),t.converter)}class gs{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=pq.provider,this._offlineComponentProvider={build:t=>new pz(t,e?.cacheSizeBytes,this.forceOwnership)}}}function ga(e,t){if((e=(0,d.m9)(e)).firestore===t)return e;throw new P(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.")}new WeakMap,fz("node")},14389:(e,t,r)=>{"use strict";let n,i,s,a,o,l,u;var c,d,h,p=r(32181),f=r(78549),m=function(){const e=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},g=function(e){if("loading"===document.readyState)return"loading";const t=m();if(t){if(e<t.domInteractive)return"loading";if(0===t.domContentLoadedEventStart||e<t.domContentLoadedEventStart)return"dom-interactive";if(0===t.domComplete||e<t.domComplete)return"dom-content-loaded"}return"complete"},y=function(e){const t=e.nodeName;return 1===e.nodeType?t.toLowerCase():t.toUpperCase().replace(/^#/,"")},v=function(e,t){let r="";try{for(;e&&9!==e.nodeType;){const n=e,i=n.id?"#"+n.id:y(n)+(n.classList&&n.classList.value&&n.classList.value.trim()&&n.classList.value.trim().length?"."+n.classList.value.trim().replace(/\s+/g,"."):"");if(r.length+i.length>(t||100)-1)return r||i;if(r=r?i+">"+r:i,n.id)break;e=n.parentNode}}catch(e){}return r},b=-1,T=function(){return b},w=function(e){addEventListener("pageshow",function(t){t.persisted&&(b=t.timeStamp,e(t))},!0)},S=function(){const e=m();return e&&e.activationStart||0},E=function(e,t){let r=m(),n="navigate";return T()>=0?n="back-forward-cache":r&&(document.prerendering||S()>0?n="prerender":document.wasDiscarded?n="restore":r.type&&(n=r.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:n}},_=function(e,t,r){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const n=new PerformanceObserver(function(e){Promise.resolve().then(function(){t(e.getEntries())})});return n.observe(Object.assign({type:e,buffered:!0},r||{})),n}}catch(e){}},C=function(e,t,r,n){let i,s;return function(a){t.value>=0&&(a||n)&&((s=t.value-(i||0))||void 0===i)&&(i=t.value,t.delta=s,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,r),e(t))}},I=function(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})},R=function(e){document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e()})},k=function(e){let t=!1;return function(){t||(e(),t=!0)}},A=-1,N=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},D=function(e){"hidden"===document.visibilityState&&A>-1&&(A="visibilitychange"===e.type?e.timeStamp:0,x())},O=function(){addEventListener("visibilitychange",D,!0),addEventListener("prerenderingchange",D,!0)},x=function(){removeEventListener("visibilitychange",D,!0),removeEventListener("prerenderingchange",D,!0)},P=function(){return A<0&&(A=N(),O(),w(function(){setTimeout(function(){A=N(),O()},0)})),{get firstHiddenTime(){return A}}},M=function(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()},L=[1800,3e3],F=function(e,t){t=t||{},M(function(){var r,n=P(),i=E("FCP"),s=_("paint",function(e){e.forEach(function(e){"first-contentful-paint"===e.name&&(s.disconnect(),e.startTime<n.firstHiddenTime&&(i.value=Math.max(e.startTime-S(),0),i.entries.push(e),r(!0)))})});s&&(r=C(e,i,L,t.reportAllChanges),w(function(n){r=C(e,i=E("FCP"),L,t.reportAllChanges),I(function(){i.value=performance.now()-n.timeStamp,r(!0)})}))})},B=[.1,.25],U=function(e,t){!function(e,t){t=t||{},F(k(function(){let r,n=E("CLS",0),i=0,s=[],a=function(e){e.forEach(function(e){if(!e.hadRecentInput){const t=s[0],r=s[s.length-1];i&&e.startTime-r.startTime<1e3&&e.startTime-t.startTime<5e3?(i+=e.value,s.push(e)):(i=e.value,s=[e])}}),i>n.value&&(n.value=i,n.entries=s,r())},o=_("layout-shift",a);o&&(r=C(e,n,B,t.reportAllChanges),R(function(){a(o.takeRecords()),r(!0)}),w(function(){i=0,r=C(e,n=E("CLS",0),B,t.reportAllChanges),I(function(){return r()})}),setTimeout(r,0))}))}(function(t){e(function(e){let t,r={};if(e.entries.length){const n=e.entries.reduce(function(e,t){return e&&e.value>t.value?e:t});if(n&&n.sources&&n.sources.length){const i=(t=n.sources).find(function(e){return e.node&&1===e.node.nodeType})||t[0];i&&(r={largestShiftTarget:v(i.node),largestShiftTime:n.startTime,largestShiftValue:n.value,largestShiftSource:i,largestShiftEntry:n,loadState:g(n.startTime)})}}return Object.assign(e,{attribution:r})}(t))},t)},j=0,V=1/0,z=0,q=function(e){e.forEach(function(e){e.interactionId&&(V=Math.min(V,e.interactionId),j=(z=Math.max(z,e.interactionId))?(z-V)/7+1:0)})},$=function(){return d?j:performance.interactionCount||0},G=function(){"interactionCount"in performance||d||(d=_("event",q,{type:"event",buffered:!0,durationThreshold:0}))},K=[],H=new Map,W=0,Q=function(){const e=Math.min(K.length-1,Math.floor(($()-W)/50));return K[e]},Y=[],J=function(e){if(Y.forEach(function(t){return t(e)}),e.interactionId||"first-input"===e.entryType){const t=K[K.length-1],r=H.get(e.interactionId);if(r||K.length<10||e.duration>t.latency){if(r)e.duration>r.latency?(r.entries=[e],r.latency=e.duration):e.duration===r.latency&&e.startTime===r.entries[0].startTime&&r.entries.push(e);else{const n={id:e.interactionId,latency:e.duration,entries:[e]};H.set(n.id,n),K.push(n)}K.sort(function(e,t){return t.latency-e.latency}),K.length>10&&K.splice(10).forEach(function(e){return H.delete(e.id)})}}},X=function(e){let t=self.requestIdleCallback||self.setTimeout,r=-1;return e=k(e),"hidden"===document.visibilityState?e():(r=t(e),R(e)),r},Z=[200,500],ee=function(e,t){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(t=t||{},M(function(){G();let r,n,i=E("INP"),s=function(e){X(function(){e.forEach(J);const t=Q();t&&t.latency!==i.value&&(i.value=t.latency,i.entries=t.entries,n())})},a=_("event",s,{durationThreshold:null!==(r=t.durationThreshold)&&void 0!==r?r:40});n=C(e,i,Z,t.reportAllChanges),a&&(a.observe({type:"first-input",buffered:!0}),R(function(){s(a.takeRecords()),n(!0)}),w(function(){W=$(),K.length=0,H.clear(),n=C(e,i=E("INP"),Z,t.reportAllChanges)}))}))},et=[],er=[],en=0,ei=new WeakMap,es=new Map,ea=-1,eo=function(e){et=et.concat(e),el()},el=function(){ea<0&&(ea=X(eu))},eu=function(){es.size>10&&es.forEach(function(e,t){H.has(t)||es.delete(t)});const e=K.map(function(e){return ei.get(e.entries[0])}),t=er.length-50;er=er.filter(function(r,n){return n>=t||e.includes(r)});for(var r=new Set,n=0;n<er.length;n++){const i=er[n];ef(i.startTime,i.processingEnd).forEach(function(e){r.add(e)})}const s=et.length-1-50;et=et.filter(function(e,t){return e.startTime>en&&t>s||r.has(e)}),ea=-1};Y.push(function(e){e.interactionId&&e.target&&!es.has(e.interactionId)&&es.set(e.interactionId,e.target)},function(e){let t,r=e.startTime+e.duration;en=Math.max(en,e.processingEnd);for(let n=er.length-1;n>=0;n--){const i=er[n];if(8>=Math.abs(r-i.renderTime)){(t=i).startTime=Math.min(e.startTime,t.startTime),t.processingStart=Math.min(e.processingStart,t.processingStart),t.processingEnd=Math.max(e.processingEnd,t.processingEnd),t.entries.push(e);break}}t||(t={startTime:e.startTime,processingStart:e.processingStart,processingEnd:e.processingEnd,renderTime:r,entries:[e]},er.push(t)),(e.interactionId||"first-input"===e.entryType)&&ei.set(e,t),el()});var ec,ed,eh,ep,ef=function(e,t){for(var r,n=[],i=0;r=et[i];i++)if(!(r.startTime+r.duration<e)){if(r.startTime>t)break;n.push(r)}return n},em=function(e,t){h||(h=_("long-animation-frame",eo)),ee(function(t){e(function(e){const t=e.entries[0],r=ei.get(t),n=t.processingStart,i=r.processingEnd,s=r.entries.sort(function(e,t){return e.processingStart-t.processingStart}),a=ef(t.startTime,i),o=e.entries.find(function(e){return e.target}),l=o&&o.target||es.get(t.interactionId),u=[t.startTime+t.duration,i].concat(a.map(function(e){return e.startTime+e.duration})),c=Math.max.apply(Math,u);return Object.assign(e,{attribution:{interactionTarget:v(l),interactionTargetElement:l,interactionType:t.name.startsWith("key")?"keyboard":"pointer",interactionTime:t.startTime,nextPaintTime:c,processedEventEntries:s,longAnimationFrameEntries:a,inputDelay:n-t.startTime,processingDuration:i-n,presentationDelay:Math.max(c-i,0),loadState:g(t.startTime)}})}(t))},t)},eg=[2500,4e3],ey={},ev=function(e,t){!function(e,t){t=t||{},M(function(){let r,n=P(),i=E("LCP"),s=function(e){t.reportAllChanges||(e=e.slice(-1)),e.forEach(function(e){e.startTime<n.firstHiddenTime&&(i.value=Math.max(e.startTime-S(),0),i.entries=[e],r())})},a=_("largest-contentful-paint",s);if(a){r=C(e,i,eg,t.reportAllChanges);const o=k(function(){ey[i.id]||(s(a.takeRecords()),a.disconnect(),ey[i.id]=!0,r(!0))});["keydown","click"].forEach(function(e){addEventListener(e,function(){return X(o)},{once:!0,capture:!0})}),R(o),w(function(n){r=C(e,i=E("LCP"),eg,t.reportAllChanges),I(function(){i.value=performance.now()-n.timeStamp,ey[i.id]=!0,r(!0)})})}})}(function(t){e(function(e){let t={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadDuration:0,elementRenderDelay:e.value};if(e.entries.length){const r=m();if(r){const n=r.activationStart||0,i=e.entries[e.entries.length-1],s=i.url&&performance.getEntriesByType("resource").filter(function(e){return e.name===i.url})[0],a=Math.max(0,r.responseStart-n),o=Math.max(a,s?(s.requestStart||s.startTime)-n:0),l=Math.max(o,s?s.responseEnd-n:0),u=Math.max(l,i.startTime-n);t={element:v(i.element),timeToFirstByte:a,resourceLoadDelay:o-a,resourceLoadDuration:l-o,elementRenderDelay:u-l,navigationEntry:r,lcpEntry:i},i.url&&(t.url=i.url),s&&(t.lcpResourceEntry=s)}}return Object.assign(e,{attribution:t})}(t))},t)},eb={passive:!0,capture:!0},eT=new Date,ew=function(e,t){ec||(ec=t,ed=e,eh=new Date,e_(removeEventListener),eS())},eS=function(){if(ed>=0&&ed<eh-eT){const e={entryType:"first-input",name:ec.type,target:ec.target,cancelable:ec.cancelable,startTime:ec.timeStamp,processingStart:ec.timeStamp+ed};ep.forEach(function(t){t(e)}),ep=[]}},eE=function(e){if(e.cancelable){const t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var r=function(){ew(e,t),i()},n=function(){i()},i=function(){removeEventListener("pointerup",r,eb),removeEventListener("pointercancel",n,eb)};addEventListener("pointerup",r,eb),addEventListener("pointercancel",n,eb)}(t,e):ew(t,e)}},e_=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach(function(t){return e(t,eE,eb)})},eC=r(28660),eI=r(68702);r(53062);const eR="@firebase/performance",ek="0.7.9",eA=ek,eN="FB-PERF-TRACE-START",eD="FB-PERF-TRACE-STOP",eO="FB-PERF-TRACE-MEASURE",ex="_wt_",eP="_fp",eM="_fcp",eL="_fid",eF="_lcp",eB="lcp_element",eU="_inp",ej="inp_interactionTarget",eV="_cls",ez="cls_largestShiftTarget",eq="@firebase/performance/config",e$="@firebase/performance/configexpire",eG="performance",eK="Performance",eH={"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."},eW=new p.LL(eG,eK,eH),eQ=new f.Yd(eK);eQ.logLevel=f.in.INFO;class eY{constructor(e){if(this.window=e,!e)throw eW.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay),this.onLCP=ev,this.onINP=em,this.onCLS=U}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,r){this.performance&&this.performance.measure&&this.performance.measure(e,t,r)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&(0,p.zI)()?!!(0,p.hl)()||(eQ.info("IndexedDB is not supported by current browser"),!1):(eQ.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,t){this.PerformanceObserver&&new this.PerformanceObserver(e=>{for(const r of e.getEntries())t(r)}).observe({entryTypes:[e]})}static getInstance(){return void 0===n&&(n=new eY(i)),n}}function eJ(e){i=e}function eX(e){const t=e.getId();return t.then(e=>{s=e}),t}function eZ(){return s}function e0(e){const t=e.getToken();return t.then(e=>{}),t}function e1(e,t){const r=e.length-t.length;if(r<0||r>1)throw eW.create("invalid String merger input");const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),t.length>r&&n.push(t.charAt(r));return n.join("")}class e2{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=e1("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=e1("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12,this.logMaxFlushSize=40}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===a&&(a=new e2),a}}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.VISIBLE=1]="VISIBLE",e[e.HIDDEN=2]="HIDDEN"}(c||(c={}));const e3=["firebase_","google_","ga_"],e4=RegExp("^[a-zA-Z]\\w*$"),e6=40,e9=100;function e5(){const e=eY.getInstance().navigator;return e?.serviceWorker?e.serviceWorker.controller?2:3:1}function e7(){switch(eY.getInstance().document.visibilityState){case"visible":return c.VISIBLE;case"hidden":return c.HIDDEN;default:return c.UNKNOWN}}function e8(){const e=eY.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function te(e){return 0!==e.length&&!(e.length>e6)&&!e3.some(t=>e.startsWith(t))&&!!e.match(e4)}function tt(e){return 0!==e.length&&e.length<=e9}function tr(e){const t=e.options?.appId;if(!t)throw eW.create("no app id");return t}function tn(e){const t=e.options?.projectId;if(!t)throw eW.create("no project id");return t}function ti(e){const t=e.options?.apiKey;if(!t)throw eW.create("no api key");return t}const ts="0.0.1",ta={loggingEnabled:!0},to="FIREBASE_INSTALLATIONS_AUTH";function tl(e,t){const r=tu();return r?(tp(r),Promise.resolve()):th(e,t).then(tp).then(e=>tc(e),()=>{})}function tu(){const e=eY.getInstance().localStorage;if(!e)return;const t=e.getItem(e$);if(!t||!tf(t))return;const r=e.getItem(eq);if(r)try{return JSON.parse(r)}catch{return}}function tc(e){const t=eY.getInstance().localStorage;e&&t&&(t.setItem(eq,JSON.stringify(e)),t.setItem(e$,String(Date.now()+36e5*e2.getInstance().configTimeToLive)))}const td="Could not fetch config, will use default configs";function th(e,t){return e0(e.installations).then(r=>{const n=tn(e.app),i=ti(e.app);return fetch(new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${n}/namespaces/fireperf:fetch?key=${i}`,{method:"POST",headers:{Authorization:`${to} ${r}`},body:JSON.stringify({app_instance_id:t,app_instance_id_token:r,app_id:tr(e.app),app_version:eA,sdk_version:ts})})).then(e=>{if(e.ok)return e.json();throw eW.create("RC response not ok")})}).catch(()=>{eQ.info(td)})}function tp(e){if(!e)return e;const t=e2.getInstance(),r=e.entries||{};return void 0!==r.fpr_enabled?t.loggingEnabled="true"===String(r.fpr_enabled):t.loggingEnabled=ta.loggingEnabled,r.fpr_log_source?t.logSource=Number(r.fpr_log_source):ta.logSource&&(t.logSource=ta.logSource),r.fpr_log_endpoint_url?t.logEndPointUrl=r.fpr_log_endpoint_url:ta.logEndPointUrl&&(t.logEndPointUrl=ta.logEndPointUrl),r.fpr_log_transport_key?t.transportKey=r.fpr_log_transport_key:ta.transportKey&&(t.transportKey=ta.transportKey),void 0!==r.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(r.fpr_vc_network_request_sampling_rate):void 0!==ta.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=ta.networkRequestsSamplingRate),void 0!==r.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(r.fpr_vc_trace_sampling_rate):void 0!==ta.tracesSamplingRate&&(t.tracesSamplingRate=ta.tracesSamplingRate),r.fpr_log_max_flush_size?t.logMaxFlushSize=Number(r.fpr_log_max_flush_size):ta.logMaxFlushSize&&(t.logMaxFlushSize=ta.logMaxFlushSize),t.logTraceAfterSampling=tm(t.tracesSamplingRate),t.logNetworkAfterSampling=tm(t.networkRequestsSamplingRate),e}function tf(e){return Number(e)>Date.now()}function tm(e){return Math.random()<=e}let tg=1;function ty(e){return tg=2,o=o||tb(e)}function tv(){return 3===tg}function tb(e){return tT().then(()=>eX(e.installations)).then(t=>tl(e,t)).then(()=>tw(),()=>tw())}function tT(){const e=eY.getInstance().document;return new Promise(t=>{if(e&&"complete"!==e.readyState){const r=()=>{"complete"===e.readyState&&(e.removeEventListener("readystatechange",r),t())};e.addEventListener("readystatechange",r)}else t()})}function tw(){tg=3}let tS=1e4,tE=5500,t_=1e3,tC=3,tI=65536,tR=new TextEncoder,tk=tC,tA=[],tN=!1;function tD(){tN||(tO(tE),tN=!0)}function tO(e){setTimeout(()=>{tk<=0||(tA.length>0&&tx(),tO(tS))},e)}function tx(){const e=tA.splice(0,t_);tM(tP(e)).then(()=>{tk=tC}).catch(()=>{tA=[...e,...tA],tk--,eQ.info(`Tries left: ${tk}.`),tO(tS)})}function tP(e){const t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)}));return JSON.stringify({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:e2.getInstance().logSource,log_event:t})}function tM(e){const t=e2.getInstance().getFlTransportFullUrl();return tR.encode(e).length<=tI&&navigator.sendBeacon&&navigator.sendBeacon(t,e)?Promise.resolve():fetch(t,{method:"POST",body:e})}function tL(e){if(!e.eventTime||!e.message)throw eW.create("invalid cc log");tA=[...tA,e]}function tF(e){return(...t)=>{tL({message:e(...t),eventTime:Date.now()})}}function tB(){const e=e2.getInstance().getFlTransportFullUrl();for(;tA.length>0;){const t=tA.splice(-e2.getInstance().logMaxFlushSize),r=tP(t);if(!(navigator.sendBeacon&&navigator.sendBeacon(e,r))){tA=[...tA,...t];break}}tA.length>0&&fetch(e,{method:"POST",body:tP(tA)}).catch(()=>{eQ.info("Failed flushing queued events.")})}function tU(e,t){l||(l={send:tF(t$),flush:tB}),l.send(e,t)}function tj(e){const t=e2.getInstance();(t.instrumentationEnabled||!e.isAuto)&&(t.dataCollectionEnabled||e.isAuto)&&eY.getInstance().requiredApisAvailable()&&(tv()?tz(e):ty(e.performanceController).then(()=>tz(e),()=>tz(e)))}function tV(){l&&l.flush()}function tz(e){if(!eZ())return;const t=e2.getInstance();t.loggingEnabled&&t.logTraceAfterSampling&&tU(e,1)}function tq(e){const t=e2.getInstance();if(!t.instrumentationEnabled)return;const r=e.url,n=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0];r!==n&&r!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&tU(e,0)}function t$(e,t){return 0===t?tG(e):tK(e)}function tG(e){const t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs};return JSON.stringify({application_info:tH(e.performanceController.app),network_request_metric:t})}function tK(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);const r=e.getAttributes();return 0!==Object.keys(r).length&&(t.custom_attributes=r),JSON.stringify({application_info:tH(e.performanceController.app),trace_metric:t})}function tH(e){return{google_app_id:tr(e),app_instance_id:eZ(),web_app_info:{sdk_version:eA,page_url:eY.getInstance().getUrl(),service_worker_status:e5(),visibility_state:e7(),effective_connection_type:e8()},application_process_state:0}}function tW(e,t){const r=t;if(!r||void 0===r.responseStart)return;const n=eY.getInstance().getTimeOrigin(),i=Math.floor((r.startTime+n)*1e3),s=r.responseStart?Math.floor((r.responseStart-r.startTime)*1e3):void 0,a=Math.floor((r.responseEnd-r.startTime)*1e3);tq({performanceController:e,url:r.name&&r.name.split("?")[0],responsePayloadBytes:r.transferSize,startTimeUs:i,timeToResponseInitiatedUs:s,timeToResponseCompletedUs:a})}const tQ=100,tY="_",tJ=[eP,eM,eL,eF,eV,eU];function tX(e,t){return 0!==e.length&&!(e.length>tQ)&&(t&&t.startsWith(ex)&&tJ.indexOf(e)>-1||!e.startsWith(tY))}function tZ(e){const t=Math.floor(e);return t<e&&eQ.info(`Metric value should be an Integer, setting the value as : ${t}.`),t}class t0{constructor(e,t,r=!1,n){this.performanceController=e,this.name=t,this.isAuto=r,this.state=1,this.customAttributes={},this.counters={},this.api=eY.getInstance(),this.randomId=Math.floor(1e6*Math.random()),!this.isAuto&&(this.traceStartMark=`${eN}-${this.randomId}-${this.name}`,this.traceStopMark=`${eD}-${this.randomId}-${this.name}`,this.traceMeasure=n||`${eO}-${this.randomId}-${this.name}`,n&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw eW.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw eW.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),tj(this)}record(e,t,r){if(e<=0)throw eW.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw eW.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),r&&r.attributes&&(this.customAttributes={...r.attributes}),r&&r.metrics)for(const e of Object.keys(r.metrics))isNaN(Number(r.metrics[e]))||(this.counters[e]=Math.floor(Number(r.metrics[e])));tj(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(tX(e,this.name))this.counters[e]=tZ(t??0);else throw eW.create("invalid custom metric name",{customMetricName:e})}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const r=te(e),n=tt(t);if(r&&n){this.customAttributes[e]=t;return}if(!r)throw eW.create("invalid attribute name",{attributeName:e});if(!n)throw eW.create("invalid attribute value",{attributeValue:t})}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return{...this.customAttributes}}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(1e3*t.duration),this.startTimeUs=Math.floor((t.startTime+this.api.getTimeOrigin())*1e3))}static createOobTrace(e,t,r,n,i){const s=eY.getInstance().getUrl();if(!s)return;const a=new t0(e,ex+s,!0),o=Math.floor(1e3*eY.getInstance().getTimeOrigin());a.setStartTime(o),t&&t[0]&&(a.setDuration(Math.floor(1e3*t[0].duration)),a.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),a.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),a.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));const l="first-paint",u="first-contentful-paint";if(r){const e=r.find(e=>e.name===l);e&&e.startTime&&a.putMetric(eP,Math.floor(1e3*e.startTime));const t=r.find(e=>e.name===u);t&&t.startTime&&a.putMetric(eM,Math.floor(1e3*t.startTime)),i&&a.putMetric(eL,Math.floor(1e3*i))}this.addWebVitalMetric(a,eF,eB,n.lcp),this.addWebVitalMetric(a,eV,ez,n.cls),this.addWebVitalMetric(a,eU,ej,n.inp),tj(a),tV()}static addWebVitalMetric(e,t,r,n){n&&(e.putMetric(t,Math.floor(1e3*n.value)),n.elementAttribution&&(n.elementAttribution.length>e9?e.putAttribute(r,n.elementAttribution.substring(0,e9)):e.putAttribute(r,n.elementAttribution)))}static createUserTimingTrace(e,t){tj(new t0(e,t,!1,t))}}let t1={},t2=!1;function t3(e){eZ()&&(setTimeout(()=>t6(e),0),setTimeout(()=>t4(e),0),setTimeout(()=>t9(e),0))}function t4(e){const t=eY.getInstance();for(const r of t.getEntriesByType("resource"))tW(e,r);t.setupObserver("resource",t=>tW(e,t))}function t6(e){const t=eY.getInstance();"onpagehide"in window?t.document.addEventListener("pagehide",()=>t7(e)):t.document.addEventListener("unload",()=>t7(e)),t.document.addEventListener("visibilitychange",()=>{"hidden"===t.document.visibilityState&&t7(e)}),t.onFirstInputDelay&&t.onFirstInputDelay(e=>{u=e}),t.onLCP(e=>{t1.lcp={value:e.value,elementAttribution:e.attribution?.element}}),t.onCLS(e=>{t1.cls={value:e.value,elementAttribution:e.attribution?.largestShiftTarget}}),t.onINP(e=>{t1.inp={value:e.value,elementAttribution:e.attribution?.interactionTarget}})}function t9(e){const t=eY.getInstance();for(const r of t.getEntriesByType("measure"))t5(e,r);t.setupObserver("measure",t=>t5(e,t))}function t5(e,t){const r=t.name;r.substring(0,eO.length)!==eO&&t0.createUserTimingTrace(e,r)}function t7(e){if(!t2){t2=!0;const t=eY.getInstance(),r=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");setTimeout(()=>{t0.createOobTrace(e,r,n,t1,u)},0)}}class t8{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(e?.dataCollectionEnabled!==void 0&&(this.dataCollectionEnabled=e.dataCollectionEnabled),e?.instrumentationEnabled!==void 0&&(this.instrumentationEnabled=e.instrumentationEnabled),eY.getInstance().requiredApisAvailable()?(0,p.eu)().then(e=>{e&&(tD(),ty(this).then(()=>t3(this),()=>t3(this)),this.initialized=!0)}).catch(e=>{eQ.info(`Environment doesn't support IndexedDB: ${e}`)}):eQ.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){e2.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return e2.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){e2.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return e2.getInstance().dataCollectionEnabled}}const re="[DEFAULT]",rt=(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate();if(r.name!==re)throw eW.create("FB not default");if("undefined"==typeof window)throw eW.create("no window");eJ(window);const i=new t8(r,n);return i._init(t),i};(function(){(0,eC.Xd)(new eI.wA("performance",rt,"PUBLIC")),(0,eC.KN)(eR,ek),(0,eC.KN)(eR,ek,"esm2020")})()},14200:(e,t,r)=>{"use strict";r.d(t,{cF:()=>to});let n,i,s=r(28660),a=r(32181),o=r(68702);const l="firebasestorage.googleapis.com",u="storageBucket",c=12e4,d=6e5,h=1e3;class p extends a.ZR{constructor(e,t,r=0){super(f(e),`Firebase Storage: ${t} (${f(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,p.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return f(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function f(e){return"storage/"+e}function m(){const e="An unknown error occurred, please check the error payload for server response.";return new p(n.UNKNOWN,e)}function g(e){return new p(n.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist.")}function y(e){return new p(n.QUOTA_EXCEEDED,"Quota for bucket '"+e+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function v(){const e="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new p(n.UNAUTHENTICATED,e)}function b(){return new p(n.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function T(e){return new p(n.UNAUTHORIZED,"User does not have permission to access '"+e+"'.")}function w(){return new p(n.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function S(){return new p(n.CANCELED,"User canceled the upload/download.")}function E(e){return new p(n.INVALID_URL,"Invalid URL '"+e+"'.")}function _(e){return new p(n.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function C(){return new p(n.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+u+"' property when initializing the app?")}function I(){return new p(n.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function R(){return new p(n.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function k(e){return new p(n.INVALID_ARGUMENT,e)}function A(){return new p(n.APP_DELETED,"The Firebase app was deleted.")}function N(e){return new p(n.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function D(e,t){return new p(n.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function O(e){throw new p(n.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(n||(n={}));class x{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=x.makeFromUrl(e,t)}catch(t){return new x(e,"")}if(""===r.path)return r;throw _(e)}static makeFromUrl(e,t){let r=null,n="([A-Za-z0-9.\\-_]+)";function i(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}const s=RegExp("^gs://"+n+"(/(.*))?$","i"),a={bucket:1,path:3};function o(e){e.path_=decodeURIComponent(e.path)}const u="v[A-Za-z0-9_]+",c=t.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",h=RegExp(`^https?://${c}/${u}/b/${n}/o${d}`,"i"),p=t===l?"(?:storage.googleapis.com|storage.cloud.google.com)":t,f="([^?#]*)",m=[{regex:s,indices:a,postModify:i},{regex:h,indices:{bucket:1,path:3},postModify:o},{regex:RegExp(`^https?://${p}/${n}/${f}`,"i"),indices:{bucket:1,path:2},postModify:o}];for(let t=0;t<m.length;t++){const n=m[t],i=n.regex.exec(e);if(i){let e=i[n.indices.bucket],t=i[n.indices.path];t||(t=""),r=new x(e,t),n.postModify(r);break}}if(null==r)throw E(e);return r}}class P{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function M(e,t,r){let n=1,i=null,s=null,a=!1,o=0;function l(){return 2===o}let u=!1;function c(...e){u||(u=!0,t.apply(null,e))}function d(t){i=setTimeout(()=>{i=null,e(p,l())},t)}function h(){s&&clearTimeout(s)}function p(e,...t){let r;if(u){h();return}if(e||l()||a){h(),c.call(null,e,...t);return}n<64&&(n*=2),1===o?(o=2,r=0):r=(n+Math.random())*1e3,d(r)}let f=!1;function m(e){!f&&(f=!0,h(),!u&&(null!==i?(e||(o=2),clearTimeout(i),d(0)):e||(o=1)))}return d(0),s=setTimeout(()=>{a=!0,m(!0)},r),m}function L(e){e(!1)}function F(e){return void 0!==e}function B(e){return"function"==typeof e}function U(e){return"object"==typeof e&&!Array.isArray(e)}function j(e){return"string"==typeof e||e instanceof String}function V(e){return z()&&e instanceof Blob}function z(){return"undefined"!=typeof Blob}function q(e,t,r,n){if(n<t)throw k(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n>r)throw k(`Invalid value for '${e}'. Expected ${r} or less.`)}function $(e,t,r){let n=t;return null==r&&(n=`https://${t}`),`${r}://${n}/v0${e}`}function G(e){let t=encodeURIComponent,r="?";for(const n in e)e.hasOwnProperty(n)&&(r=r+(t(n)+"=")+t(e[n])+"&");return r.slice(0,-1)}function K(e,t){const r=e>=500&&e<600,n=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return r||n||i}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(i||(i={}));class H{constructor(e,t,r,n,i,s,a,o,l,u,c,d=!0,h=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=c,this.retry=d,this.isUsingEmulator=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t){e(!1,new W(!1,null,!0));return}const r=this.connectionFactory_();this.pendingConnection_=r;const n=e=>{const t=e.loaded,r=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,r)};null!==this.progressCallback_&&r.addUploadProgressListener(n),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&r.removeUploadProgressListener(n),this.pendingConnection_=null;const t=r.getErrorCode()===i.NO_ERROR,s=r.getStatus();if(!t||K(s,this.additionalRetryCodes_)&&this.retry){e(!1,new W(!1,null,r.getErrorCode()===i.ABORT));return}e(!0,new W(-1!==this.successCodes_.indexOf(s),r))})},t=(e,t)=>{const r=this.resolve_,n=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());F(e)?r(e):r()}catch(e){n(e)}else if(null!==i){const e=m();e.serverResponse=i.getErrorText(),n(this.errorCallback_?this.errorCallback_(i,e):e)}else n(t.canceled?this.appDelete_?A():S():w())};this.canceled_?t(!1,new W(!1,null,!0)):this.backoffId_=M(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&L(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class W{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function Q(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}function Y(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function J(e,t){t&&(e["X-Firebase-GMPID"]=t)}function X(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}function Z(e,t,r,n,i,s,a=!0,o=!1){const l=G(e.urlParams),u=e.url+l,c=Object.assign({},e.headers);return J(c,t),Q(c,r),Y(c,s),X(c,n),new H(u,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,a,o)}function ee(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function et(...e){const t=ee();if(void 0!==t){const r=new t;for(let t=0;t<e.length;t++)r.append(e[t]);return r.getBlob()}if(z())return new Blob(e);throw new p(n.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function er(e,t,r){return e.webkitSlice?e.webkitSlice(t,r):e.mozSlice?e.mozSlice(t,r):e.slice?e.slice(t,r):null}function en(e){if(/[^-A-Za-z0-9+/=]/.test(e))throw D("base64","Invalid character found");return Buffer.from(e,"base64").toString("binary")}const ei={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class es{constructor(e,t){this.data=e,this.contentType=t||null}}function ea(e,t){switch(e){case ei.RAW:return new es(eo(t));case ei.BASE64:case ei.BASE64URL:return new es(eu(e,t));case ei.DATA_URL:return new es(ed(t),eh(t))}throw m()}function eo(e){const t=[];for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);n<=127?t.push(n):n<=2047?t.push(192|n>>6,128|63&n):(64512&n)==55296?r<e.length-1&&(64512&e.charCodeAt(r+1))==56320?(n=65536|(1023&n)<<10|1023&e.charCodeAt(++r),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n)):t.push(239,191,189):(64512&n)==56320?t.push(239,191,189):t.push(224|n>>12,128|n>>6&63,128|63&n)}return new Uint8Array(t)}function el(e){let t;try{t=decodeURIComponent(e)}catch(e){throw D(ei.DATA_URL,"Malformed data URL.")}return eo(t)}function eu(e,t){let r;switch(e){case ei.BASE64:{const r=-1!==t.indexOf("-"),n=-1!==t.indexOf("_");if(r||n)throw D(e,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break}case ei.BASE64URL:{const r=-1!==t.indexOf("+"),n=-1!==t.indexOf("/");if(r||n)throw D(e,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}}try{r=en(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw D(e,"Invalid character found")}const n=new Uint8Array(r.length);for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);return n}class ec{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw D(ei.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;null!=r&&(this.base64=ep(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function ed(e){const t=new ec(e);return t.base64?eu(ei.BASE64,t.rest):el(t.rest)}function eh(e){return new ec(e).contentType}function ep(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t}class ef{constructor(e,t){let r=0,n="";V(e)?(this.data_=e,r=e.size,n=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=n}size(){return this.size_}type(){return this.type_}slice(e,t){if(!V(this.data_))return new ef(new Uint8Array(this.data_.buffer,e,t-e),!0);{const r=er(this.data_,e,t);return null===r?null:new ef(r)}}static getBlob(...e){if(z()){const t=e.map(e=>e instanceof ef?e.data_:e);return new ef(et.apply(null,t))}{let t=e.map(e=>j(e)?ea(ei.RAW,e).data:e.data_),r=0;t.forEach(e=>{r+=e.byteLength});let n=new Uint8Array(r),i=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)n[i++]=e[t]}),new ef(n,!0)}}uploadData(){return this.data_}}function em(e){let t;try{t=JSON.parse(e)}catch(e){return null}return U(t)?t:null}function eg(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}function ey(e,t){const r=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?r:e+"/"+r}function ev(e){const t=e.lastIndexOf("/",e.length-2);return -1===t?e:e.slice(t+1)}function eb(e,t){return t}class eT{constructor(e,t,r,n){this.server=e,this.local=t||e,this.writable=!!r,this.xform=n||eb}}let ew=null;function eS(e){return!j(e)||e.length<2?e:ev(e)}function eE(){if(ew)return ew;const e=[];function t(e,t){return eS(t)}e.push(new eT("bucket")),e.push(new eT("generation")),e.push(new eT("metageneration")),e.push(new eT("name","fullPath",!0));const r=new eT("name");function n(e,t){return void 0!==t?Number(t):t}r.xform=t,e.push(r);const i=new eT("size");return i.xform=n,e.push(i),e.push(new eT("timeCreated")),e.push(new eT("updated")),e.push(new eT("md5Hash",null,!0)),e.push(new eT("cacheControl",null,!0)),e.push(new eT("contentDisposition",null,!0)),e.push(new eT("contentEncoding",null,!0)),e.push(new eT("contentLanguage",null,!0)),e.push(new eT("contentType",null,!0)),e.push(new eT("metadata","customMetadata",!0)),ew=e}function e_(e,t){function r(){const r=new x(e.bucket,e.fullPath);return t._makeStorageReference(r)}Object.defineProperty(e,"ref",{get:r})}function eC(e,t,r){const n={};n.type="file";const i=r.length;for(let e=0;e<i;e++){const i=r[e];n[i.local]=i.xform(n,t[i.server])}return e_(n,e),n}function eI(e,t,r){const n=em(t);return null===n?null:eC(e,n,r)}function eR(e,t,r,n){const i=em(t);if(null===i||!j(i.downloadTokens))return null;const s=i.downloadTokens;if(0===s.length)return null;const a=encodeURIComponent;return s.split(",").map(t=>{const i=e.bucket,s=e.fullPath;return $("/b/"+a(i)+"/o/"+a(s),r,n)+G({alt:"media",token:t})})[0]}function ek(e,t){const r={},n=t.length;for(let i=0;i<n;i++){const n=t[i];n.writable&&(r[n.server]=e[n.local])}return JSON.stringify(r)}const eA="prefixes",eN="items";function eD(e,t,r){const n={prefixes:[],items:[],nextPageToken:r.nextPageToken};if(r[eA])for(const i of r[eA]){const r=i.replace(/\/$/,""),s=e._makeStorageReference(new x(t,r));n.prefixes.push(s)}if(r[eN])for(const i of r[eN]){const r=e._makeStorageReference(new x(t,i.name));n.items.push(r)}return n}function eO(e,t,r){const n=em(r);return null===n?null:eD(e,t,n)}class ex{constructor(e,t,r,n){this.url=e,this.method=t,this.handler=r,this.timeout=n,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function eP(e){if(!e)throw m()}function eM(e,t){return function(r,n){const i=eI(e,n,t);return eP(null!==i),i}}function eL(e,t){return function(r,n){const i=eO(e,t,n);return eP(null!==i),i}}function eF(e,t){return function(r,n){const i=eI(e,n,t);return eP(null!==i),eR(i,n,e.host,e._protocol)}}function eB(e){return function(t,r){let n;return(n=401===t.getStatus()?t.getErrorText().includes("Firebase App Check token is invalid")?b():v():402===t.getStatus()?y(e.bucket):403===t.getStatus()?T(e.path):r).status=t.getStatus(),n.serverResponse=r.serverResponse,n}}function eU(e){const t=eB(e);return function(r,n){let i=t(r,n);return 404===r.getStatus()&&(i=g(e.path)),i.serverResponse=n.serverResponse,i}}function ej(e,t,r){const n=$(t.fullServerUrl(),e.host,e._protocol),i="GET",s=e.maxOperationRetryTime,a=new ex(n,i,eM(e,r),s);return a.errorHandler=eU(t),a}function eV(e,t,r,n,i){const s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",r&&r.length>0&&(s.delimiter=r),n&&(s.pageToken=n),i&&(s.maxResults=i);const a=$(t.bucketOnlyServerUrl(),e.host,e._protocol),o="GET",l=e.maxOperationRetryTime,u=new ex(a,o,eL(e,t.bucket),l);return u.urlParams=s,u.errorHandler=eB(t),u}function ez(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}function eq(e,t,r){const n=Object.assign({},r);return n.fullPath=e.path,n.size=t.size(),n.contentType||(n.contentType=ez(null,t)),n}function e$(e,t,r,n,i){const s=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},o=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+o;const l=eq(t,n,i),u="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+ek(l,r)+"\r\n--"+o+"\r\nContent-Type: "+l.contentType+"\r\n\r\n",c="\r\n--"+o+"--",d=ef.getBlob(u,n,c);if(null===d)throw I();const h={name:l.fullPath},p=$(s,e.host,e._protocol),f="POST",m=e.maxUploadRetryTime,g=new ex(p,f,eM(e,r),m);return g.urlParams=h,g.headers=a,g.body=d.uploadData(),g.errorHandler=eB(t),g}class eG{constructor(e,t,r,n){this.current=e,this.total=t,this.finalized=!!r,this.metadata=n||null}}function eK(e,t){let r=null;try{r=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){eP(!1)}const n=t||["active"];return eP(!!r&&-1!==n.indexOf(r)),r}function eH(e,t,r,n,i){const s=t.bucketOnlyServerUrl(),a=eq(t,n,i),o={name:a.fullPath},l=$(s,e.host,e._protocol),u="POST",c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n.size()}`,"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},d=ek(a,r),h=new ex(l,u,function(e){let t;eK(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){eP(!1)}return eP(j(t)),t},e.maxUploadRetryTime);return h.urlParams=o,h.headers=c,h.body=d,h.errorHandler=eB(t),h}function eW(e,t,r,n){const i={"X-Goog-Upload-Command":"query"},s=new ex(r,"POST",function(e){let t=eK(e,["active","final"]),r=null;try{r=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){eP(!1)}r||eP(!1);const i=Number(r);return eP(!isNaN(i)),new eG(i,n.size(),"final"===t)},e.maxUploadRetryTime);return s.headers=i,s.errorHandler=eB(t),s}const eQ=null;function eY(e,t,r,n,i,s,a,o){const l=new eG(0,0);if(a?(l.current=a.current,l.total=a.total):(l.current=0,l.total=n.size()),n.size()!==l.total)throw R();let u=l.total-l.current,c=u;i>0&&(c=Math.min(c,i));let d=l.current,h=d+c,p="",f={"X-Goog-Upload-Command":p=0===c?"finalize":u===c?"upload, finalize":"upload","X-Goog-Upload-Offset":`${l.current}`},m=n.slice(d,h);if(null===m)throw I();const g=new ex(r,"POST",function(e,r){let i;const a=eK(e,["active","final"]),o=l.current+c,u=n.size();return i="final"===a?eM(t,s)(e,r):null,new eG(o,u,"final"===a,i)},t.maxUploadRetryTime);return g.headers=f,g.body=m.uploadData(),g.progressCallback=o||null,g.errorHandler=eB(e),g}const eJ={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function eX(e){switch(e){case"running":case"pausing":case"canceling":return eJ.RUNNING;case"paused":return eJ.PAUSED;case"success":return eJ.SUCCESS;case"canceled":return eJ.CANCELED;default:return eJ.ERROR}}class eZ{constructor(e,t,r){if(B(e)||null!=t||null!=r)this.next=e,this.error=t??void 0,this.complete=r??void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function e0(e){return(...t)=>{Promise.resolve().then(()=>e(...t))}}const e1=null;class e2{constructor(){this.errorText_="",this.sent_=!1,this.errorCode_=i.NO_ERROR}async send(e,t,r,n,s){if(this.sent_)throw O("cannot .send() more than once");this.sent_=!0;try{const a=await e5(e,t,r,s,n);this.headers_=a.headers,this.statusCode_=a.status,this.errorCode_=i.NO_ERROR,this.body_=await a.arrayBuffer()}catch(e){this.errorText_=e?.message,this.statusCode_=0,this.errorCode_=i.NETWORK_ERROR}}getErrorCode(){if(void 0===this.errorCode_)throw O("cannot .getErrorCode() before receiving response");return this.errorCode_}getStatus(){if(void 0===this.statusCode_)throw O("cannot .getStatus() before receiving response");return this.statusCode_}getErrorText(){return this.errorText_}abort(){}getResponseHeader(e){if(!this.headers_)throw O("cannot .getResponseHeader() before receiving response");return this.headers_.get(e)}addUploadProgressListener(e){}removeUploadProgressListener(e){}}class e3 extends null{getResponse(){if(!this.body_)throw O("cannot .getResponse() before receiving response");return Buffer.from(this.body_).toString("utf-8")}}function e4(){return e1?e1():new e3}class e6 extends null{getResponse(){if(!this.body_)throw O("cannot .getResponse() before sending");return this.body_}}class e9 extends e2{constructor(){super(...arguments),this.stream_=null}async send(e,t,r,n,s){if(this.sent_)throw O("cannot .send() more than once");this.sent_=!0;try{const a=await e5(e,t,r,s,n);this.headers_=a.headers,this.statusCode_=a.status,this.errorCode_=i.NO_ERROR,this.stream_=a.body}catch(e){this.errorText_=e?.message,this.statusCode_=0,this.errorCode_=i.NETWORK_ERROR}}getResponse(){if(!this.stream_)throw O("cannot .getResponse() before sending");return this.stream_}}function e5(e,t,r,n,i){const s={method:t,headers:n||{},body:i};return(0,a.Xx)(e)&&r&&(s.credentials="include"),fetch(e,s)}class e7{constructor(e,t){this._service=e,t instanceof x?this._location=t:this._location=x.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new e7(e,t)}get root(){const e=new x(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return ev(this._location.path)}get storage(){return this._service}get parent(){const e=eg(this._location.path);if(null===e)return null;const t=new x(this._location.bucket,e);return new e7(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw N(e)}}function e8(e,t){null!=t&&"number"==typeof t.maxResults&&q("options.maxResults",1,1e3,t.maxResults);const r=t||{},n=eV(e.storage,e._location,"/",r.pageToken,r.maxResults);return e.storage.makeRequestWithTokens(n,e4)}function te(e,t){const r=ey(e._location.path,t),n=new x(e._location.bucket,r);return new e7(e.storage,n)}function tt(e,t){const r=t?.[u];return null==r?null:x.makeFromBucketSpec(r,e)}function tr(e,t,r,n={}){e.host=`${t}:${r}`;const i=(0,a.Xx)(t);i&&((0,a.Uo)(`https://${e.host}/b`),(0,a.dp)("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http";const{mockUserToken:s}=n;s&&(e._overrideAuthToken="string"==typeof s?s:(0,a.Sg)(s,e.app.options.projectId))}class tn{constructor(e,t,r,n,i,s=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=n,this._firebaseVersion=i,this._isUsingEmulator=s,this._bucket=null,this._host=l,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=c,this._maxUploadRetryTime=d,this._requests=new Set,null!=n?this._bucket=x.makeFromBucketSpec(n,this._host):this._bucket=tt(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=x.makeFromBucketSpec(this._url,e):this._bucket=tt(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){q("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){q("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if((0,s.rh)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new e7(this,e)}_makeRequest(e,t,r,n,i=!0){if(this._deleted)return new P(A());{const s=Z(e,this._appId,r,n,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){const[r,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,n).getPromise()}}const ti="@firebase/storage",ts="0.14.0",ta="storage";function to(e=(0,s.Mq)(),t){e=(0,a.m9)(e);const r=(0,s.qX)(e,ta).getImmediate({identifier:t}),n=(0,a.P0)("storage");return n&&tl(r,...n),r}function tl(e,t,r,n={}){tr(e,t,r,n)}function tu(e,{instanceIdentifier:t}){return new tn(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,s.Jn)}(function(){(0,s.Xd)(new o.wA(ta,tu,"PUBLIC").setMultipleInstances(!0)),(0,s.KN)(ti,ts)})()},37645:e=>{"use strict";e.exports={i8:"1.9.15"}},522:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Api":{"fields":{"name":{"type":"string","id":1},"methods":{"rule":"repeated","type":"Method","id":2},"options":{"rule":"repeated","type":"Option","id":3},"version":{"type":"string","id":4},"sourceContext":{"type":"SourceContext","id":5},"mixins":{"rule":"repeated","type":"Mixin","id":6},"syntax":{"type":"Syntax","id":7}}},"Method":{"fields":{"name":{"type":"string","id":1},"requestTypeUrl":{"type":"string","id":2},"requestStreaming":{"type":"bool","id":3},"responseTypeUrl":{"type":"string","id":4},"responseStreaming":{"type":"bool","id":5},"options":{"rule":"repeated","type":"Option","id":6},"syntax":{"type":"Syntax","id":7}}},"Mixin":{"fields":{"name":{"type":"string","id":1},"root":{"type":"string","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}}}}}}}}')},24552:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"options":{"go_package":"google.golang.org/protobuf/types/descriptorpb","java_package":"com.google.protobuf","java_outer_classname":"DescriptorProtos","csharp_namespace":"Google.Protobuf.Reflection","objc_class_prefix":"GPB","cc_enable_arenas":true,"optimize_for":"SPEED"},"nested":{"FileDescriptorSet":{"edition":"proto2","fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}},"extensions":[[536000000,536000000]]},"Edition":{"edition":"proto2","values":{"EDITION_UNKNOWN":0,"EDITION_LEGACY":900,"EDITION_PROTO2":998,"EDITION_PROTO3":999,"EDITION_2023":1000,"EDITION_2024":1001,"EDITION_1_TEST_ONLY":1,"EDITION_2_TEST_ONLY":2,"EDITION_99997_TEST_ONLY":99997,"EDITION_99998_TEST_ONLY":99998,"EDITION_99999_TEST_ONLY":99999,"EDITION_MAX":2147483647}},"FileDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10},"weakDependency":{"rule":"repeated","type":"int32","id":11},"optionDependency":{"rule":"repeated","type":"string","id":15},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12},"edition":{"type":"Edition","id":14}}},"DescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10},"visibility":{"type":"SymbolVisibility","id":11}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2},"options":{"type":"ExtensionRangeOptions","id":3}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"ExtensionRangeOptions":{"edition":"proto2","fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999},"declaration":{"rule":"repeated","type":"Declaration","id":2,"options":{"retention":"RETENTION_SOURCE"}},"features":{"type":"FeatureSet","id":50},"verification":{"type":"VerificationState","id":3,"options":{"default":"UNVERIFIED","retention":"RETENTION_SOURCE"}}},"extensions":[[1000,536870911]],"nested":{"Declaration":{"fields":{"number":{"type":"int32","id":1},"fullName":{"type":"string","id":2},"type":{"type":"string","id":3},"reserved":{"type":"bool","id":5},"repeated":{"type":"bool","id":6}},"reserved":[[4,4]]},"VerificationState":{"values":{"DECLARATION":0,"UNVERIFIED":1}}}},"FieldDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8},"proto3Optional":{"type":"bool","id":17}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REPEATED":3,"LABEL_REQUIRED":2}}}},"OneofDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3},"reservedRange":{"rule":"repeated","type":"EnumReservedRange","id":4},"reservedName":{"rule":"repeated","type":"string","id":5},"visibility":{"type":"SymbolVisibility","id":6}},"nested":{"EnumReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"EnumValueDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"edition":"proto2","fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31,"options":{"default":true}},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"swiftPrefix":{"type":"string","id":39},"phpClassPrefix":{"type":"string","id":40},"phpNamespace":{"type":"string","id":41},"phpMetadataNamespace":{"type":"string","id":44},"rubyPackage":{"type":"string","id":45},"features":{"type":"FeatureSet","id":50},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[42,42],[38,38],"php_generic_services"],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"edition":"proto2","fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":11,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":12},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[5,5],[6,6],[8,8],[9,9]]},"FieldOptions":{"edition":"proto2","fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"unverifiedLazy":{"type":"bool","id":15},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10,"options":{"deprecated":true}},"debugRedact":{"type":"bool","id":16},"retention":{"type":"OptionRetention","id":17},"targets":{"rule":"repeated","type":"OptionTargetType","id":19},"editionDefaults":{"rule":"repeated","type":"EditionDefault","id":20},"features":{"type":"FeatureSet","id":21},"featureSupport":{"type":"FeatureSupport","id":22},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[18,18]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}},"OptionRetention":{"values":{"RETENTION_UNKNOWN":0,"RETENTION_RUNTIME":1,"RETENTION_SOURCE":2}},"OptionTargetType":{"values":{"TARGET_TYPE_UNKNOWN":0,"TARGET_TYPE_FILE":1,"TARGET_TYPE_EXTENSION_RANGE":2,"TARGET_TYPE_MESSAGE":3,"TARGET_TYPE_FIELD":4,"TARGET_TYPE_ONEOF":5,"TARGET_TYPE_ENUM":6,"TARGET_TYPE_ENUM_ENTRY":7,"TARGET_TYPE_SERVICE":8,"TARGET_TYPE_METHOD":9}},"EditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"value":{"type":"string","id":2}}},"FeatureSupport":{"fields":{"editionIntroduced":{"type":"Edition","id":1},"editionDeprecated":{"type":"Edition","id":2},"deprecationWarning":{"type":"string","id":3},"editionRemoved":{"type":"Edition","id":4}}}}},"OneofOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"edition":"proto2","fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":6,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[5,5]]},"EnumValueOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":1},"features":{"type":"FeatureSet","id":2},"debugRedact":{"type":"bool","id":3},"featureSupport":{"type":"FieldOptions.FeatureSupport","id":4},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":34},"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":33},"idempotencyLevel":{"type":"IdempotencyLevel","id":34,"options":{"default":"IDEMPOTENCY_UNKNOWN"}},"features":{"type":"FeatureSet","id":35},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"nested":{"IdempotencyLevel":{"values":{"IDEMPOTENCY_UNKNOWN":0,"NO_SIDE_EFFECTS":1,"IDEMPOTENT":2}}}},"UninterpretedOption":{"edition":"proto2","fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"FeatureSet":{"edition":"proto2","fields":{"fieldPresence":{"type":"FieldPresence","id":1,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_2023","edition_defaults.value":"EXPLICIT"}},"enumType":{"type":"EnumType","id":2,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"OPEN"}},"repeatedFieldEncoding":{"type":"RepeatedFieldEncoding","id":3,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"PACKED"}},"utf8Validation":{"type":"Utf8Validation","id":4,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"VERIFY"}},"messageEncoding":{"type":"MessageEncoding","id":5,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_LEGACY","edition_defaults.value":"LENGTH_PREFIXED"}},"jsonFormat":{"type":"JsonFormat","id":6,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"ALLOW"}},"enforceNamingStyle":{"type":"EnforceNamingStyle","id":7,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_METHOD","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"STYLE2024"}},"defaultSymbolVisibility":{"type":"VisibilityFeature.DefaultSymbolVisibility","id":8,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"EXPORT_TOP_LEVEL"}}},"extensions":[[1000,9994],[9995,9999],[10000,10000]],"reserved":[[999,999]],"nested":{"FieldPresence":{"values":{"FIELD_PRESENCE_UNKNOWN":0,"EXPLICIT":1,"IMPLICIT":2,"LEGACY_REQUIRED":3}},"EnumType":{"values":{"ENUM_TYPE_UNKNOWN":0,"OPEN":1,"CLOSED":2}},"RepeatedFieldEncoding":{"values":{"REPEATED_FIELD_ENCODING_UNKNOWN":0,"PACKED":1,"EXPANDED":2}},"Utf8Validation":{"values":{"UTF8_VALIDATION_UNKNOWN":0,"VERIFY":2,"NONE":3}},"MessageEncoding":{"values":{"MESSAGE_ENCODING_UNKNOWN":0,"LENGTH_PREFIXED":1,"DELIMITED":2}},"JsonFormat":{"values":{"JSON_FORMAT_UNKNOWN":0,"ALLOW":1,"LEGACY_BEST_EFFORT":2}},"EnforceNamingStyle":{"values":{"ENFORCE_NAMING_STYLE_UNKNOWN":0,"STYLE2024":1,"STYLE_LEGACY":2}},"VisibilityFeature":{"fields":{},"reserved":[[1,536870911]],"nested":{"DefaultSymbolVisibility":{"values":{"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN":0,"EXPORT_ALL":1,"EXPORT_TOP_LEVEL":2,"LOCAL_ALL":3,"STRICT":4}}}}}},"FeatureSetDefaults":{"edition":"proto2","fields":{"defaults":{"rule":"repeated","type":"FeatureSetEditionDefault","id":1},"minimumEdition":{"type":"Edition","id":4},"maximumEdition":{"type":"Edition","id":5}},"nested":{"FeatureSetEditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"overridableFeatures":{"type":"FeatureSet","id":4},"fixedFeatures":{"type":"FeatureSet","id":5}},"reserved":[[1,1],[2,2],"features"]}}},"SourceCodeInfo":{"edition":"proto2","fields":{"location":{"rule":"repeated","type":"Location","id":1}},"extensions":[[536000000,536000000]],"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"span":{"rule":"repeated","type":"int32","id":2,"options":{"packed":true}},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"edition":"proto2","fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4},"semantic":{"type":"Semantic","id":5}},"nested":{"Semantic":{"values":{"NONE":0,"SET":1,"ALIAS":2}}}}}},"SymbolVisibility":{"edition":"proto2","values":{"VISIBILITY_UNSET":0,"VISIBILITY_LOCAL":1,"VISIBILITY_EXPORT":2}}}}}}}}')},97105:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},8730:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Type":{"fields":{"name":{"type":"string","id":1},"fields":{"rule":"repeated","type":"Field","id":2},"oneofs":{"rule":"repeated","type":"string","id":3},"options":{"rule":"repeated","type":"Option","id":4},"sourceContext":{"type":"SourceContext","id":5},"syntax":{"type":"Syntax","id":6}}},"Field":{"fields":{"kind":{"type":"Kind","id":1},"cardinality":{"type":"Cardinality","id":2},"number":{"type":"int32","id":3},"name":{"type":"string","id":4},"typeUrl":{"type":"string","id":6},"oneofIndex":{"type":"int32","id":7},"packed":{"type":"bool","id":8},"options":{"rule":"repeated","type":"Option","id":9},"jsonName":{"type":"string","id":10},"defaultValue":{"type":"string","id":11}},"nested":{"Kind":{"values":{"TYPE_UNKNOWN":0,"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Cardinality":{"values":{"CARDINALITY_UNKNOWN":0,"CARDINALITY_OPTIONAL":1,"CARDINALITY_REQUIRED":2,"CARDINALITY_REPEATED":3}}}},"Enum":{"fields":{"name":{"type":"string","id":1},"enumvalue":{"rule":"repeated","type":"EnumValue","id":2},"options":{"rule":"repeated","type":"Option","id":3},"sourceContext":{"type":"SourceContext","id":4},"syntax":{"type":"Syntax","id":5}}},"EnumValue":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"rule":"repeated","type":"Option","id":3}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}},"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')}};
//# sourceMappingURL=596.js.map