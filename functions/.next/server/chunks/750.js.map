{"version":3,"file":"750.js","mappings":"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","sources":["webpack://schools-in/./node_modules/@opentelemetry/instrumentation-redis/node_modules/@opentelemetry/instrumentation/build/esm/platform/node/ sync","webpack://schools-in/./node_modules/@sentry/nextjs/node_modules/@opentelemetry/instrumentation-ioredis/node_modules/@opentelemetry/instrumentation/build/esm/platform/node/ sync","webpack://schools-in/./node_modules/@sentry/nextjs/node_modules/@opentelemetry/instrumentation/build/esm/platform/node/ sync","webpack://schools-in/./node_modules/@sentry/nextjs/node_modules/@prisma/instrumentation/node_modules/@opentelemetry/instrumentation/build/esm/platform/node/ sync","webpack://schools-in/./node_modules/require-in-the-middle/ sync","webpack://schools-in/./src/app/not-found.tsx","webpack://schools-in/./src/lib/providers/AnalyticsProvider.tsx","webpack://schools-in/src/app/layout.tsx","webpack://schools-in/sentry-wrapper-module","webpack://schools-in/?ebb3","webpack://schools-in/?1b13","webpack://schools-in/?c2e5","webpack://schools-in/?24cc","webpack://schools-in/./firebase.config.js","webpack://schools-in/./src/app/error.tsx","webpack://schools-in/./src/components/common/NetworkStatusIndicator.tsx","webpack://schools-in/./src/components/pwa/PWAInstallPrompt.tsx","webpack://schools-in/./src/components/pwa/PWAUpdatePrompt.tsx","webpack://schools-in/./src/lib/offline/offlineDB.ts","webpack://schools-in/./src/lib/offline/serviceManager.ts","webpack://schools-in/./src/lib/hooks/useOffline.ts","webpack://schools-in/./src/components/pwa/PWAStatus.tsx","webpack://schools-in/./src/lib/offline/cacheStrategy.ts","webpack://schools-in/./src/lib/offline/actionQueue.ts","webpack://schools-in/./src/lib/offline/syncManager.ts","webpack://schools-in/./src/lib/offline/queueManager.ts","webpack://schools-in/./src/lib/hooks/useConnectivityRestoration.ts","webpack://schools-in/./src/lib/hooks/useEnhancedOfflineQueue.ts","webpack://schools-in/./src/components/ui/toast.tsx","webpack://schools-in/./src/components/ui/use-toast.ts","webpack://schools-in/./src/components/offline/OfflineMessaging.tsx","webpack://schools-in/./src/components/offline/OfflineStatusIndicator.tsx","webpack://schools-in/./src/components/offline/OfflineStatusBar.tsx","webpack://schools-in/./src/components/ui/toaster.tsx","webpack://schools-in/./src/components/layout/ClientLayout.tsx","webpack://schools-in/./src/components/provider/AuthProvider.tsx","webpack://schools-in/./src/components/ui/alert.tsx","webpack://schools-in/./src/components/ui/badge.tsx","webpack://schools-in/./src/components/ui/button.tsx","webpack://schools-in/./src/components/ui/card.tsx","webpack://schools-in/./src/components/ui/logo.tsx","webpack://schools-in/./src/components/ui/optimized-image.tsx","webpack://schools-in/./src/components/ui/progress.tsx","webpack://schools-in/./src/components/ui/skeleton.tsx","webpack://schools-in/./src/lib/accessibility.tsx","webpack://schools-in/./src/lib/firebase/auth.ts","webpack://schools-in/./src/lib/firebase/firestore.ts","webpack://schools-in/./src/lib/firebase/productionConfig.ts","webpack://schools-in/./src/lib/hooks/useAnalytics.ts","webpack://schools-in/./src/lib/hooks/useAuth.ts","webpack://schools-in/./src/lib/hooks/useNetworkStatus.ts","webpack://schools-in/./src/lib/performance/webVitals.ts","webpack://schools-in/./src/components/dev/PerformanceMonitor.tsx","webpack://schools-in/./src/lib/utils.ts","webpack://schools-in/./src/app/globals.css"],"sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 48872;\nmodule.exports = webpackEmptyContext;","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 95653;\nmodule.exports = webpackEmptyContext;","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 98005;\nmodule.exports = webpackEmptyContext;","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 83293;\nmodule.exports = webpackEmptyContext;","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 12308;\nmodule.exports = webpackEmptyContext;","\"use client\";\n\nimport { BrandHeader } from \"@/components/ui/logo\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { MapPin, Home, ArrowLeft } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\n\nexport default function NotFound() {\n  const router = useRouter();\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md text-center\">\n        <CardContent className=\"pt-8 pb-6\">\n          <BrandHeader\n            title=\"Page Not Found\"\n            subtitle=\"The page you're looking for doesn't exist.\"\n            className=\"mb-6\"\n          />\n\n          <div className=\"flex justify-center mb-6\">\n            <div className=\"p-4 bg-red-50 rounded-full\">\n              <MapPin className=\"h-8 w-8 text-red-500\" />\n            </div>\n          </div>\n\n          <p className=\"text-gray-600 mb-8\">\n            Looks like you've wandered off the school grounds! Let's get you\n            back to safety.\n          </p>\n\n          <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\n            <Button\n              onClick={() => router.back()}\n              variant=\"outline\"\n              className=\"flex items-center gap-2\"\n            >\n              <ArrowLeft className=\"h-4 w-4\" />\n              Go Back\n            </Button>\n            <Link href=\"/dashboard\">\n              <Button className=\"flex items-center gap-2 w-full sm:w-auto\">\n                <Home className=\"h-4 w-4\" />\n                Dashboard\n              </Button>\n            </Link>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","/**\n * Analytics Provider component that integrates performance monitoring\n * and analytics tracking throughout the application\n */\n\n\"use client\";\n\nimport { useEffect } from \"react\";\nimport { useAnalytics } from \"../hooks/useAnalytics\";\nimport { ProductionMonitoring } from \"../firebase/productionConfig\";\nimport { webVitalsMonitor } from \"../performance/webVitals\";\nimport { PerformanceMonitor } from \"../../components/dev/PerformanceMonitor\";\n\ninterface AnalyticsProviderProps {\n  children: React.ReactNode;\n  showPerformanceMonitor?: boolean;\n}\n\nexport function AnalyticsProvider({\n  children,\n  showPerformanceMonitor = process.env.NODE_ENV === \"development\",\n}: AnalyticsProviderProps) {\n  const analytics = useAnalytics();\n\n  useEffect(() => {\n    // Initialize production monitoring in production environment\n    if (process.env.NODE_ENV === \"production\") {\n      ProductionMonitoring.initialize();\n    }\n\n    // Set up global error handlers for production analytics\n    const handleGlobalError = (event: ErrorEvent) => {\n      analytics.trackError(\n        new Error(event.message),\n        {\n          filename: event.filename,\n          lineno: event.lineno,\n          colno: event.colno,\n          source: \"global_error_handler\",\n        },\n        \"high\"\n      );\n    };\n\n    const handleUnhandledRejection = (event: PromiseRejectionEvent) => {\n      analytics.trackError(\n        new Error(String(event.reason)),\n        {\n          source: \"unhandled_promise_rejection\",\n          promise: String(event.promise).substring(0, 100),\n        },\n        \"high\"\n      );\n    };\n\n    // Add event listeners\n    window.addEventListener(\"error\", handleGlobalError);\n    window.addEventListener(\"unhandledrejection\", handleUnhandledRejection);\n\n    // Track initial page load\n    if (performance && performance.timing) {\n      const loadTime =\n        performance.timing.loadEventEnd - performance.timing.navigationStart;\n      if (loadTime > 0) {\n        analytics.trackPerformance(\"initial_page_load\", loadTime, {\n          page: window.location.pathname,\n        });\n      }\n    }\n\n    // Set up visibility change tracking for session analytics\n    const handleVisibilityChange = () => {\n      if (document.visibilityState === \"hidden\") {\n        // Track session pause\n        analytics.trackEvent(\"session_pause\", {\n          page: window.location.pathname,\n          timestamp: Date.now(),\n        });\n      } else {\n        // Track session resume\n        analytics.trackEvent(\"session_resume\", {\n          page: window.location.pathname,\n          timestamp: Date.now(),\n        });\n      }\n    };\n\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange);\n\n    // Cleanup\n    return () => {\n      window.removeEventListener(\"error\", handleGlobalError);\n      window.removeEventListener(\n        \"unhandledrejection\",\n        handleUnhandledRejection\n      );\n      document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n    };\n  }, [analytics]);\n\n  // Track route changes (for client-side navigation)\n  useEffect(() => {\n    const trackRouteChange = () => {\n      analytics.trackEvent(\"page_view\", {\n        page_title: document.title,\n        page_location: window.location.href,\n        page_path: window.location.pathname,\n      });\n    };\n\n    // Track initial route\n    trackRouteChange();\n\n    // Listen for browser navigation\n    window.addEventListener(\"popstate\", trackRouteChange);\n\n    return () => {\n      window.removeEventListener(\"popstate\", trackRouteChange);\n    };\n  }, [analytics]);\n\n  return (\n    <>\n      {children}\n\n      {/* Performance Monitor for development and optional production use */}\n      {showPerformanceMonitor && (\n        <PerformanceMonitor\n          showDetails={process.env.NODE_ENV === \"development\"}\n          autoRefresh={true}\n          refreshInterval={5000}\n        />\n      )}\n    </>\n  );\n}\n","import type { Metadata, Viewport } from \"next\";\nimport { Inter } from \"next/font/google\";\nimport \"./globals.css\";\nimport { AuthProvider } from \"@/components/provider/AuthProvider\";\nimport ClientLayout from \"@/components/layout/ClientLayout\";\nimport { SkipToContent } from \"@/lib/accessibility.tsx\";\nimport { NetworkStatusIndicator } from \"@/components/common/NetworkStatusIndicator\";\nimport { AnalyticsProvider } from \"@/lib/providers/AnalyticsProvider\";\n\nconst inter = Inter({ subsets: [\"latin\"] });\n\nexport const metadata: Metadata = {\n  title: \"DMDL Schools-In - Provider Check-In System\",\n  description:\n    \"Professional location-based check-in system for education service providers\",\n  manifest: \"/manifest.json\",\n  appleWebApp: {\n    capable: true,\n    statusBarStyle: \"default\",\n    title: \"DMDL Schools-In\",\n  },\n  icons: {\n    icon: [\n      { url: \"/icon-192.png\", sizes: \"192x192\", type: \"image/png\" },\n      { url: \"/icon-512.png\", sizes: \"512x512\", type: \"image/png\" },\n      { url: \"/DMDL_logo.png\", sizes: \"280x60\", type: \"image/png\" },\n    ],\n    apple: [{ url: \"/icon-192.png\", sizes: \"192x192\", type: \"image/png\" }],\n  },\n};\n\nexport const viewport: Viewport = {\n  width: \"device-width\",\n  initialScale: 1,\n  maximumScale: 5, // Allow zooming for accessibility\n  userScalable: true, // Enable user scaling for accessibility\n  themeColor: \"#154690\",\n  viewportFit: \"cover\", // Support for safe area insets on notched devices\n};\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <html lang=\"en\" className=\"h-full\">\n      <body\n        className={`${inter.className} h-full bg-background text-foreground antialiased`}\n      >\n        <SkipToContent />\n        <AuthProvider>\n          <AnalyticsProvider>\n            <div className=\"min-h-full safe-area-inset\">\n              <ClientLayout>{children}</ClientLayout>\n              <NetworkStatusIndicator />\n            </div>\n          </AnalyticsProvider>\n        </AuthProvider>\n      </body>\n    </html>\n  );\n}\n","import * as origModule from 'next/dist/client/components/request-async-storage.external.js';\nimport * as serverComponentModule from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport * from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nimport * as Sentry from '@sentry/nextjs';\n\n// @ts-expect-error Because we cannot be sure if the RequestAsyncStorage module exists (it is not part of the Next.js public\n// API) we use a shim if it doesn't exist. The logic for this is in the wrapping loader.\n\nconst asyncStorageModule = { ...origModule } ;\n\nconst requestAsyncStorage =\n  'workUnitAsyncStorage' in asyncStorageModule\n    ? asyncStorageModule.workUnitAsyncStorage\n    : 'requestAsyncStorage' in asyncStorageModule\n      ? asyncStorageModule.requestAsyncStorage\n      : undefined;\n\nconst serverComponent = serverComponentModule.default;\n\nlet wrappedServerComponent;\nif (typeof serverComponent === 'function') {\n  // For some odd Next.js magic reason, `headers()` will not work if used inside `wrapServerComponentsWithSentry`.\n  // Current assumption is that Next.js applies some loader magic to userfiles, but not files in node_modules. This file\n  // is technically a userfile so it gets the loader magic applied.\n  wrappedServerComponent = new Proxy(serverComponent, {\n    apply: (originalFunction, thisArg, args) => {\n      let sentryTraceHeader = undefined;\n      let baggageHeader = undefined;\n      let headers = undefined;\n\n      // We try-catch here just in `requestAsyncStorage` is undefined since it may not be defined\n      try {\n        const requestAsyncStore = requestAsyncStorage?.getStore() ;\n        sentryTraceHeader = requestAsyncStore?.headers.get('sentry-trace') ?? undefined;\n        baggageHeader = requestAsyncStore?.headers.get('baggage') ?? undefined;\n        headers = requestAsyncStore?.headers;\n      } catch {\n        /** empty */\n      }\n\n      return Sentry.wrapServerComponentWithSentry(originalFunction, {\n        componentRoute: '/',\n        componentType: 'Layout',\n        sentryTraceHeader,\n        baggageHeader,\n        headers,\n      }).apply(thisArg, args);\n    },\n  });\n} else {\n  wrappedServerComponent = serverComponent;\n}\n\nconst generateMetadata = serverComponentModule.generateMetadata\n  ? Sentry.wrapGenerationFunctionWithSentry(serverComponentModule.generateMetadata, {\n      componentRoute: '/',\n      componentType: 'Layout',\n      generationFunctionIdentifier: 'generateMetadata',\n      requestAsyncStorage,\n    })\n  : undefined;\n\nconst generateImageMetadata = serverComponentModule.generateImageMetadata\n  ? Sentry.wrapGenerationFunctionWithSentry(serverComponentModule.generateImageMetadata, {\n      componentRoute: '/',\n      componentType: 'Layout',\n      generationFunctionIdentifier: 'generateImageMetadata',\n      requestAsyncStorage,\n    })\n  : undefined;\n\nconst generateViewport = serverComponentModule.generateViewport\n  ? Sentry.wrapGenerationFunctionWithSentry(serverComponentModule.generateViewport, {\n      componentRoute: '/',\n      componentType: 'Layout',\n      generationFunctionIdentifier: 'generateViewport',\n      requestAsyncStorage,\n    })\n  : undefined;\n\nconst wrappedServerComponent$1 = wrappedServerComponent;\n\nexport { wrappedServerComponent$1 as default, generateImageMetadata, generateMetadata, generateViewport };\n","import(/* webpackMode: \"eager\" */ \"/Users/arthurturnbull/Developer/schools-in/node_modules/next/dist/client/components/app-router.js\");\n;\nimport(/* webpackMode: \"eager\" */ \"/Users/arthurturnbull/Developer/schools-in/node_modules/next/dist/client/components/client-page.js\");\n;\nimport(/* webpackMode: \"eager\" */ \"/Users/arthurturnbull/Developer/schools-in/node_modules/next/dist/client/components/error-boundary.js\");\n;\nimport(/* webpackMode: \"eager\" */ \"/Users/arthurturnbull/Developer/schools-in/node_modules/next/dist/client/components/layout-router.js\");\n;\nimport(/* webpackMode: \"eager\" */ \"/Users/arthurturnbull/Developer/schools-in/node_modules/next/dist/client/components/not-found-boundary.js\");\n;\nimport(/* webpackMode: \"eager\" */ \"/Users/arthurturnbull/Developer/schools-in/node_modules/next/dist/client/components/render-from-template-context.js\");\n","import(/* webpackMode: \"eager\", webpackExports: [\"NetworkStatusIndicator\"] */ \"/Users/arthurturnbull/Developer/schools-in/src/components/common/NetworkStatusIndicator.tsx\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"default\"] */ \"/Users/arthurturnbull/Developer/schools-in/src/components/layout/ClientLayout.tsx\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"AuthProvider\"] */ \"/Users/arthurturnbull/Developer/schools-in/src/components/provider/AuthProvider.tsx\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"SkipToContent\"] */ \"/Users/arthurturnbull/Developer/schools-in/src/lib/accessibility.tsx\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"AnalyticsProvider\"] */ \"/Users/arthurturnbull/Developer/schools-in/src/lib/providers/AnalyticsProvider.tsx\");\n","import(/* webpackMode: \"eager\" */ \"/Users/arthurturnbull/Developer/schools-in/src/app/error.tsx\");\n","import(/* webpackMode: \"eager\" */ \"/Users/arthurturnbull/Developer/schools-in/src/app/not-found.tsx\");\n","// Firebase SDK configuration and initialization\n// Production-ready configuration with enhanced features\n\nimport { initializeApp } from \"firebase/app\";\nimport { getAuth, connectAuthEmulator } from \"firebase/auth\";\nimport {\n  getFirestore,\n  connectFirestoreEmulator,\n  enableMultiTabIndexedDbPersistence,\n} from \"firebase/firestore\";\nimport { getStorage, connectStorageEmulator } from \"firebase/storage\";\nimport { getPerformance } from \"firebase/performance\";\nimport { getAnalytics, isSupported } from \"firebase/analytics\";\n\n// Production Firebase configuration\nconst firebaseConfig = {\n  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\n  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\n  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\n};\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\n\n// Initialize Firebase Authentication and get a reference to the service\nexport const auth = getAuth(app);\n\n// Initialize Cloud Firestore and get a reference to the service\nexport const db = getFirestore(app);\n\n// Initialize Firebase Storage\nexport const storage = getStorage(app);\n\n// Initialize Firebase Performance Monitoring (production only)\nexport let performance = null;\nif (typeof window !== \"undefined\" && process.env.NODE_ENV === \"production\") {\n  try {\n    performance = getPerformance(app);\n  } catch (error) {\n    console.warn(\"Failed to initialize Firebase Performance:\", error);\n  }\n}\n\n// Initialize Firebase Analytics (production only)\nexport let analytics = null;\nif (typeof window !== \"undefined\" && process.env.NODE_ENV === \"production\") {\n  isSupported()\n    .then((supported) => {\n      if (supported) {\n        analytics = getAnalytics(app);\n      }\n    })\n    .catch((error) => {\n      console.warn(\"Failed to initialize Firebase Analytics:\", error);\n    });\n}\n\n// Development emulators\nif (process.env.NODE_ENV === \"development\") {\n  connectAuthEmulator(auth, \"http://localhost:9099\");\n  connectFirestoreEmulator(db, \"localhost\", 8080);\n  connectStorageEmulator(storage, \"localhost\", 9199);\n}\n\n// Enable offline persistence in production\nif (typeof window !== \"undefined\" && process.env.NODE_ENV === \"production\") {\n  try {\n    enableMultiTabIndexedDbPersistence(db).catch((err) => {\n      if (err.code === \"failed-precondition\") {\n        console.warn(\"Firebase persistence failed: Multiple tabs open\");\n      } else if (err.code === \"unimplemented\") {\n        console.warn(\"Firebase persistence not supported by browser\");\n      }\n    });\n  } catch (error) {\n    console.warn(\"Failed to enable Firebase persistence:\", error);\n  }\n}\n\nexport default app;\n","\"use client\";\n\nimport { useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\n\nexport default function Error({\n  error,\n  reset,\n}: {\n  error: Error & { digest?: string };\n  reset: () => void;\n}) {\n  useEffect(() => {\n    // Log the error to an error reporting service\n    console.error(error);\n  }, [error]);\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-gray-100 dark:bg-gray-900\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardHeader>\n          <CardTitle className=\"text-2xl font-bold text-center text-red-600\">\n            Something went wrong!\n          </CardTitle>\n          <CardDescription className=\"text-center\">\n            We encountered an unexpected error. Please try again.\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"flex flex-col items-center space-y-4\">\n          <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n            Error details have been logged for review.\n          </p>\n          {error?.digest && (\n            <p className=\"text-xs text-gray-500\">\n              Error Digest: {error.digest}\n            </p>\n          )}\n          <Button\n            onClick={\n              // Attempt to recover by trying to re-render the segment\n              () => reset()\n            }\n          >\n            Try again\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","\"use client\";\n\nimport { WifiOff } from \"lucide-react\";\nimport { useNetworkStatus } from \"@/lib/hooks/useNetworkStatus\";\n\nexport function NetworkStatusIndicator() {\n  const { isOnline } = useNetworkStatus();\n\n  if (isOnline) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 bg-red-600 text-white p-4 text-center z-50 flex items-center justify-center\">\n      <WifiOff className=\"mr-2 h-5 w-5\" />\n      <p>You are currently offline. Some features may be unavailable.</p>\n    </div>\n  );\n}\n","\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Download, X } from \"lucide-react\";\n\ninterface BeforeInstallPromptEvent extends Event {\n  prompt(): Promise<void>;\n  userChoice: Promise<{ outcome: \"accepted\" | \"dismissed\" }>;\n}\n\nexport function PWAInstallPrompt() {\n  const [deferredPrompt, setDeferredPrompt] =\n    useState<BeforeInstallPromptEvent | null>(null);\n  const [showPrompt, setShowPrompt] = useState(false);\n  const [isInstalled, setIsInstalled] = useState(false);\n\n  useEffect(() => {\n    // Check if app is already installed\n    if (\n      window.matchMedia(\"(display-mode: standalone)\").matches ||\n      (window.navigator as any).standalone\n    ) {\n      setIsInstalled(true);\n      return;\n    }\n\n    const handleBeforeInstallPrompt = (e: Event) => {\n      // Prevent the mini-infobar from appearing on mobile\n      e.preventDefault();\n      // Save the event so it can be triggered later\n      setDeferredPrompt(e as BeforeInstallPromptEvent);\n      // Show the custom install prompt\n      setShowPrompt(true);\n    };\n\n    const handleAppInstalled = () => {\n      setIsInstalled(true);\n      setShowPrompt(false);\n      setDeferredPrompt(null);\n    };\n\n    window.addEventListener(\"beforeinstallprompt\", handleBeforeInstallPrompt);\n    window.addEventListener(\"appinstalled\", handleAppInstalled);\n\n    return () => {\n      window.removeEventListener(\n        \"beforeinstallprompt\",\n        handleBeforeInstallPrompt\n      );\n      window.removeEventListener(\"appinstalled\", handleAppInstalled);\n    };\n  }, []);\n\n  const handleInstallClick = async () => {\n    if (!deferredPrompt) return;\n\n    // Show the install prompt\n    await deferredPrompt.prompt();\n\n    // Wait for the user to respond to the prompt\n    const { outcome } = await deferredPrompt.userChoice;\n\n    if (outcome === \"accepted\") {\n      console.log(\"User accepted the install prompt\");\n    } else {\n      console.log(\"User dismissed the install prompt\");\n    }\n\n    // Clear the deferredPrompt for next time\n    setDeferredPrompt(null);\n    setShowPrompt(false);\n  };\n\n  const handleDismiss = () => {\n    setShowPrompt(false);\n    // Remember user dismissed this session\n    sessionStorage.setItem(\"pwa-prompt-dismissed\", \"true\");\n  };\n\n  // Don't show if already installed or user dismissed in this session\n  if (\n    isInstalled ||\n    !showPrompt ||\n    sessionStorage.getItem(\"pwa-prompt-dismissed\")\n  ) {\n    return null;\n  }\n\n  return (\n    <Card className=\"mb-4 status-brand border\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Download className=\"h-5 w-5 text-brand-primary\" />\n            <CardTitle className=\"text-lg text-brand-primary\">\n              Install Schools In\n            </CardTitle>\n          </div>\n          <Button variant=\"ghost\" size=\"sm\" onClick={handleDismiss}>\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n        <CardDescription className=\"text-brand-primary/80\">\n          Install the app for faster access and offline functionality\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"pt-0\">\n        <div className=\"flex gap-2\">\n          <Button onClick={handleInstallClick} className=\"btn-brand-primary\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Install App\n          </Button>\n          <Button variant=\"outline\" onClick={handleDismiss}>\n            Not Now\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { RefreshCw, X } from \"lucide-react\";\n\nexport function PWAUpdatePrompt() {\n  const [showUpdatePrompt, setShowUpdatePrompt] = useState(false);\n  const [registration, setRegistration] =\n    useState<ServiceWorkerRegistration | null>(null);\n\n  useEffect(() => {\n    if (\"serviceWorker\" in navigator) {\n      navigator.serviceWorker.ready.then((reg) => {\n        setRegistration(reg);\n\n        // Listen for updates\n        reg.addEventListener(\"updatefound\", () => {\n          const newWorker = reg.installing;\n          if (newWorker) {\n            newWorker.addEventListener(\"statechange\", () => {\n              if (\n                newWorker.state === \"installed\" &&\n                navigator.serviceWorker.controller\n              ) {\n                // New content is available\n                setShowUpdatePrompt(true);\n              }\n            });\n          }\n        });\n      });\n\n      // Listen for controller change (when new SW takes over)\n      navigator.serviceWorker.addEventListener(\"controllerchange\", () => {\n        window.location.reload();\n      });\n    }\n  }, []);\n\n  const handleUpdate = () => {\n    if (registration?.waiting) {\n      // Tell the waiting service worker to skip waiting and become active\n      registration.waiting.postMessage({ type: \"SKIP_WAITING\" });\n    }\n    setShowUpdatePrompt(false);\n  };\n\n  const handleDismiss = () => {\n    setShowUpdatePrompt(false);\n  };\n\n  if (!showUpdatePrompt) {\n    return null;\n  }\n\n  return (\n    <Card className=\"mb-4 border-green-200 bg-green-50\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <RefreshCw className=\"h-5 w-5 text-green-600\" />\n            <CardTitle className=\"text-lg text-green-900\">\n              Update Available\n            </CardTitle>\n          </div>\n          <Button variant=\"ghost\" size=\"sm\" onClick={handleDismiss}>\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n        <CardDescription className=\"text-green-700\">\n          A new version of Schools In is available with improvements and bug\n          fixes\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"pt-0\">\n        <div className=\"flex gap-2\">\n          <Button\n            onClick={handleUpdate}\n            className=\"bg-green-600 hover:bg-green-700\"\n          >\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\n            Update Now\n          </Button>\n          <Button variant=\"outline\" onClick={handleDismiss}>\n            Later\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","// Custom service worker functionality for Schools In PWA\n// This extends the auto-generated next-pwa service worker\n\nimport { openDB } from \"idb\";\n\n// Types\ninterface OfflineAction {\n  id: string;\n  type: \"checkIn\" | \"checkOut\";\n  data: any;\n  timestamp: number;\n  endpoint: string;\n  method: string;\n  headers: Record<string, string>;\n  body: string;\n  retryCount: number;\n  schoolName?: string;\n}\n\n// Database setup for offline data\nconst DB_NAME = \"schools-in-offline\";\nconst DB_VERSION = 1;\n\nconst STORES = {\n  SCHOOLS: \"schools\",\n  SESSIONS: \"sessions\",\n  PENDING_ACTIONS: \"pending-actions\",\n  USER_DATA: \"user-data\",\n};\n\n// Initialize IndexedDB\nexport async function initDB() {\n  return openDB(DB_NAME, DB_VERSION, {\n    upgrade(db) {\n      // Schools store\n      if (!db.objectStoreNames.contains(STORES.SCHOOLS)) {\n        const schoolsStore = db.createObjectStore(STORES.SCHOOLS, {\n          keyPath: \"id\",\n        });\n        schoolsStore.createIndex(\"name\", \"name\");\n      }\n\n      // Sessions store\n      if (!db.objectStoreNames.contains(STORES.SESSIONS)) {\n        const sessionsStore = db.createObjectStore(STORES.SESSIONS, {\n          keyPath: \"id\",\n        });\n        sessionsStore.createIndex(\"userId\", \"userId\");\n        sessionsStore.createIndex(\"schoolId\", \"schoolId\");\n        sessionsStore.createIndex(\"startTime\", \"startTime\");\n      }\n\n      // Pending actions store (for offline operations)\n      if (!db.objectStoreNames.contains(STORES.PENDING_ACTIONS)) {\n        const pendingStore = db.createObjectStore(STORES.PENDING_ACTIONS, {\n          keyPath: \"id\",\n          autoIncrement: true,\n        });\n        pendingStore.createIndex(\"timestamp\", \"timestamp\");\n        pendingStore.createIndex(\"type\", \"type\");\n      }\n\n      // User data store\n      if (!db.objectStoreNames.contains(STORES.USER_DATA)) {\n        db.createObjectStore(STORES.USER_DATA, {\n          keyPath: \"id\",\n        });\n      }\n    },\n  });\n}\n\n// Cache school data for offline access\nexport async function cacheSchoolData(schools: any[]) {\n  const db = await initDB();\n  const tx = db.transaction(STORES.SCHOOLS, \"readwrite\");\n\n  for (const school of schools) {\n    await tx.store.put(school);\n  }\n\n  await tx.done;\n}\n\n// Get cached schools for offline use\nexport async function getCachedSchools(userId?: string) {\n  const db = await initDB();\n  const schools = await db.getAll(STORES.SCHOOLS);\n\n  // Filter by user assignments if userId provided\n  if (userId) {\n    return schools.filter((school) =>\n      school.assignedProviders?.includes(userId)\n    );\n  }\n\n  return schools;\n}\n\n// Cache session data\nexport async function cacheSessionData(sessions: any[]) {\n  const db = await initDB();\n  const tx = db.transaction(STORES.SESSIONS, \"readwrite\");\n\n  for (const session of sessions) {\n    await tx.store.put(session);\n  }\n\n  await tx.done;\n}\n\n// Get cached sessions\nexport async function getCachedSessions(userId?: string) {\n  const db = await initDB();\n\n  if (userId) {\n    return await db.getAllFromIndex(STORES.SESSIONS, \"userId\", userId);\n  }\n\n  return await db.getAll(STORES.SESSIONS);\n}\n\n// Queue offline actions\nexport async function queueOfflineAction(action: {\n  type: \"check-in\" | \"check-out\" | \"session-update\";\n  data: any;\n  timestamp: number;\n  retry?: number;\n}) {\n  const db = await initDB();\n  await db.add(STORES.PENDING_ACTIONS, {\n    ...action,\n    timestamp: action.timestamp || Date.now(),\n    retry: action.retry || 0,\n  });\n}\n\n// Get pending offline actions\nexport async function getPendingActions() {\n  const db = await initDB();\n  return await db.getAll(STORES.PENDING_ACTIONS);\n}\n\n// Remove completed action\nexport async function removePendingAction(id: number) {\n  const db = await initDB();\n  await db.delete(STORES.PENDING_ACTIONS, id);\n}\n\n// Cache user data\nexport async function cacheUserData(userData: any) {\n  const db = await initDB();\n  await db.put(STORES.USER_DATA, { id: \"current-user\", ...userData });\n}\n\n// Get cached user data\nexport async function getCachedUserData() {\n  const db = await initDB();\n  return await db.get(STORES.USER_DATA, \"current-user\");\n}\n\n// Get all queued actions\nexport async function getQueuedActions(): Promise<OfflineAction[]> {\n  const db = await initDB();\n  return db.getAll(STORES.PENDING_ACTIONS);\n}\n\n// Sync pending actions when online\nexport async function syncPendingActions(): Promise<void> {\n  const db = await initDB();\n  const actions = await db.getAll(STORES.PENDING_ACTIONS);\n\n  for (const action of actions) {\n    try {\n      // Attempt to sync the action based on type\n      let response: Response;\n\n      if (action.type === \"check-in\") {\n        response = await fetch(\"/api/sessions/check-in\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify(action.data),\n        });\n      } else if (action.type === \"check-out\") {\n        response = await fetch(\"/api/sessions/check-out\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify(action.data),\n        });\n      } else {\n        continue; // Skip unknown action types\n      }\n\n      if (response.ok) {\n        // Remove from queue on success\n        await db.delete(STORES.PENDING_ACTIONS, action.id);\n      } else {\n        // Increment retry count\n        action.retry = (action.retry || 0) + 1;\n        await db.put(STORES.PENDING_ACTIONS, action);\n      }\n    } catch (error) {\n      console.error(\"Failed to sync action:\", error);\n      // Increment retry count\n      action.retry = (action.retry || 0) + 1;\n      await db.put(STORES.PENDING_ACTIONS, action);\n    }\n  }\n}\n\n// Clear all queued actions\nexport async function clearQueue(): Promise<void> {\n  const db = await initDB();\n  await db.clear(STORES.PENDING_ACTIONS);\n}\n\n// Clear all cached data (for logout/reset)\nexport async function clearOfflineData() {\n  const db = await initDB();\n\n  await Promise.all([\n    db.clear(STORES.SCHOOLS),\n    db.clear(STORES.SESSIONS),\n    db.clear(STORES.PENDING_ACTIONS),\n    db.clear(STORES.USER_DATA),\n  ]);\n}\n","\"use client\";\n\nimport {\n  initDB,\n  cacheSchoolData,\n  getCachedSchools,\n  cacheSessionData,\n  getCachedSessions,\n  queueOfflineAction,\n  syncPendingActions,\n  cacheUserData,\n  getCachedUserData,\n  clearOfflineData,\n} from \"./offlineDB\";\n\nexport class ServiceManager {\n  private static instance: ServiceManager;\n  private isOnline: boolean = true;\n  private syncInProgress: boolean = false;\n\n  private constructor() {\n    if (typeof window !== \"undefined\") {\n      this.isOnline = navigator.onLine;\n      this.setupEventListeners();\n      this.initializeOfflineDB();\n    }\n  }\n\n  public static getInstance(): ServiceManager {\n    if (!ServiceManager.instance) {\n      ServiceManager.instance = new ServiceManager();\n    }\n    return ServiceManager.instance;\n  }\n\n  private setupEventListeners() {\n    window.addEventListener(\"online\", () => {\n      this.isOnline = true;\n      this.onOnline();\n    });\n\n    window.addEventListener(\"offline\", () => {\n      this.isOnline = false;\n      this.onOffline();\n    });\n\n    // Listen for service worker messages\n    if (\"serviceWorker\" in navigator) {\n      navigator.serviceWorker.addEventListener(\"message\", (event) => {\n        this.handleServiceWorkerMessage(event);\n      });\n    }\n  }\n\n  private async initializeOfflineDB() {\n    try {\n      await initDB();\n      console.log(\"Offline database initialized\");\n    } catch (error) {\n      console.error(\"Failed to initialize offline database:\", error);\n    }\n  }\n\n  private async onOnline() {\n    console.log(\"Device came online\");\n\n    // Trigger background sync\n    if (!this.syncInProgress) {\n      await this.performBackgroundSync();\n    }\n\n    // Notify components about online status\n    this.notifyStatusChange(\"online\");\n  }\n\n  private onOffline() {\n    console.log(\"Device went offline\");\n    this.notifyStatusChange(\"offline\");\n  }\n\n  private handleServiceWorkerMessage(event: MessageEvent) {\n    const { data } = event;\n\n    switch (data.type) {\n      case \"BACKGROUND_SYNC\":\n        this.performBackgroundSync();\n        break;\n      case \"CACHE_UPDATE\":\n        this.notifyStatusChange(\"cache-updated\");\n        break;\n      default:\n        console.log(\"Unknown service worker message:\", data);\n    }\n  }\n\n  private notifyStatusChange(status: string) {\n    // Dispatch custom event for components to listen to\n    window.dispatchEvent(\n      new CustomEvent(\"service-manager-status\", {\n        detail: { status, isOnline: this.isOnline },\n      })\n    );\n  }\n\n  // Public API methods\n\n  public isDeviceOnline(): boolean {\n    return this.isOnline;\n  }\n\n  public async cacheUserSchools(schools: any[]) {\n    try {\n      await cacheSchoolData(schools);\n      console.log(`Cached ${schools.length} schools for offline use`);\n    } catch (error) {\n      console.error(\"Failed to cache school data:\", error);\n    }\n  }\n\n  public async getOfflineSchools(userId?: string) {\n    try {\n      return await getCachedSchools(userId);\n    } catch (error) {\n      console.error(\"Failed to get offline schools:\", error);\n      return [];\n    }\n  }\n\n  public async cacheUserSessions(sessions: any[]) {\n    try {\n      await cacheSessionData(sessions);\n      console.log(`Cached ${sessions.length} sessions for offline use`);\n    } catch (error) {\n      console.error(\"Failed to cache session data:\", error);\n    }\n  }\n\n  public async getOfflineSessions(userId?: string) {\n    try {\n      return await getCachedSessions(userId);\n    } catch (error) {\n      console.error(\"Failed to get offline sessions:\", error);\n      return [];\n    }\n  }\n\n  public async performOfflineCheckIn(checkInData: {\n    schoolId: string;\n    userId: string;\n    coordinates: { lat: number; lng: number };\n    timestamp: number;\n  }) {\n    try {\n      if (this.isOnline) {\n        // Online - perform immediate check-in\n        const response = await fetch(\"/api/sessions\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify(checkInData),\n        });\n\n        if (!response.ok) {\n          throw new Error(\"Check-in failed\");\n        }\n\n        return await response.json();\n      } else {\n        // Offline - queue the action\n        await queueOfflineAction({\n          type: \"check-in\",\n          data: checkInData,\n          timestamp: Date.now(),\n        });\n\n        // Create local session record\n        const localSession = {\n          id: `offline-${Date.now()}`,\n          ...checkInData,\n          status: \"pending-sync\",\n          startTime: new Date(checkInData.timestamp).toISOString(),\n        };\n\n        // Cache locally\n        await cacheSessionData([localSession]);\n\n        console.log(\"Check-in queued for offline sync\");\n        return localSession;\n      }\n    } catch (error) {\n      console.error(\"Check-in error:\", error);\n      throw error;\n    }\n  }\n\n  public async performOfflineCheckOut(checkOutData: {\n    sessionId: string;\n    coordinates: { lat: number; lng: number };\n    timestamp: number;\n  }) {\n    try {\n      if (this.isOnline) {\n        // Online - perform immediate check-out\n        const response = await fetch(\n          `/api/sessions/${checkOutData.sessionId}`,\n          {\n            method: \"PATCH\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n              endTime: new Date(checkOutData.timestamp).toISOString(),\n              endCoordinates: checkOutData.coordinates,\n              status: \"completed\",\n            }),\n          }\n        );\n\n        if (!response.ok) {\n          throw new Error(\"Check-out failed\");\n        }\n\n        return await response.json();\n      } else {\n        // Offline - queue the action\n        await queueOfflineAction({\n          type: \"check-out\",\n          data: checkOutData,\n          timestamp: Date.now(),\n        });\n\n        console.log(\"Check-out queued for offline sync\");\n        return { status: \"pending-sync\" };\n      }\n    } catch (error) {\n      console.error(\"Check-out error:\", error);\n      throw error;\n    }\n  }\n\n  public async performBackgroundSync() {\n    if (this.syncInProgress || !this.isOnline) {\n      return;\n    }\n\n    this.syncInProgress = true;\n    console.log(\"Starting background sync...\");\n\n    try {\n      await syncPendingActions();\n      console.log(\"Background sync completed\");\n      this.notifyStatusChange(\"sync-completed\");\n    } catch (error) {\n      console.error(\"Background sync failed:\", error);\n      this.notifyStatusChange(\"sync-failed\");\n    } finally {\n      this.syncInProgress = false;\n    }\n  }\n\n  public async cacheCurrentUser(userData: any) {\n    try {\n      await cacheUserData(userData);\n    } catch (error) {\n      console.error(\"Failed to cache user data:\", error);\n    }\n  }\n\n  public async getOfflineUserData() {\n    try {\n      return await getCachedUserData();\n    } catch (error) {\n      console.error(\"Failed to get offline user data:\", error);\n      return null;\n    }\n  }\n\n  public async clearAllOfflineData() {\n    try {\n      await clearOfflineData();\n      console.log(\"All offline data cleared\");\n    } catch (error) {\n      console.error(\"Failed to clear offline data:\", error);\n    }\n  }\n\n  public getSyncStatus() {\n    return {\n      isOnline: this.isOnline,\n      syncInProgress: this.syncInProgress,\n    };\n  }\n}\n\n// Export singleton instance\nexport const serviceManager = ServiceManager.getInstance();\n","\"use client\";\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport { serviceManager } from \"../offline/serviceManager\";\n\ninterface OfflineState {\n  isOnline: boolean;\n  syncInProgress: boolean;\n  pendingActions: number;\n  lastSyncTime: Date | null;\n}\n\ninterface UseOfflineReturn {\n  isOnline: boolean;\n  syncInProgress: boolean;\n  lastSyncTime: Date | null;\n  checkInOffline: (checkInData: {\n    schoolId: string;\n    userId: string;\n    coordinates: { lat: number; lng: number };\n    timestamp: number;\n  }) => Promise<any>;\n  checkOutOffline: (checkOutData: {\n    sessionId: string;\n    coordinates: { lat: number; lng: number };\n    timestamp: number;\n  }) => Promise<any>;\n  syncOfflineActions: () => Promise<void>;\n  getCachedSchools: (userId?: string) => Promise<any[]>;\n  getCachedSessions: (userId?: string) => Promise<any[]>;\n  clearOfflineData: () => Promise<void>;\n}\n\nexport function useOffline(): UseOfflineReturn {\n  const [state, setState] = useState<OfflineState>({\n    isOnline: true,\n    syncInProgress: false,\n    pendingActions: 0,\n    lastSyncTime: null,\n  });\n\n  useEffect(() => {\n    // Initialize state\n    const updateState = () => {\n      const { isOnline, syncInProgress } = serviceManager.getSyncStatus();\n      setState((prev) => ({\n        ...prev,\n        isOnline,\n        syncInProgress,\n      }));\n    };\n\n    updateState();\n\n    // Listen for service manager status changes\n    const handleStatusChange = (event: CustomEvent) => {\n      const { status, isOnline } = event.detail;\n\n      setState((prev) => ({\n        ...prev,\n        isOnline,\n        syncInProgress: status === \"sync-started\",\n        lastSyncTime:\n          status === \"sync-completed\" ? new Date() : prev.lastSyncTime,\n      }));\n    };\n\n    window.addEventListener(\n      \"service-manager-status\",\n      handleStatusChange as EventListener\n    );\n\n    // Check online status changes\n    const handleOnline = () =>\n      setState((prev) => ({ ...prev, isOnline: true }));\n    const handleOffline = () =>\n      setState((prev) => ({ ...prev, isOnline: false }));\n\n    window.addEventListener(\"online\", handleOnline);\n    window.addEventListener(\"offline\", handleOffline);\n\n    return () => {\n      window.removeEventListener(\n        \"service-manager-status\",\n        handleStatusChange as EventListener\n      );\n      window.removeEventListener(\"online\", handleOnline);\n      window.removeEventListener(\"offline\", handleOffline);\n    };\n  }, []);\n\n  const performOfflineCheckIn = useCallback(\n    async (checkInData: {\n      schoolId: string;\n      userId: string;\n      coordinates: { lat: number; lng: number };\n      timestamp: number;\n    }) => {\n      try {\n        setState((prev) => ({ ...prev, syncInProgress: true }));\n        const result = await serviceManager.performOfflineCheckIn(checkInData);\n        setState((prev) => ({ ...prev, syncInProgress: false }));\n        return result;\n      } catch (error) {\n        setState((prev) => ({ ...prev, syncInProgress: false }));\n        throw error;\n      }\n    },\n    []\n  );\n\n  const performOfflineCheckOut = useCallback(\n    async (checkOutData: {\n      sessionId: string;\n      coordinates: { lat: number; lng: number };\n      timestamp: number;\n    }) => {\n      try {\n        setState((prev) => ({ ...prev, syncInProgress: true }));\n        const result = await serviceManager.performOfflineCheckOut(\n          checkOutData\n        );\n        setState((prev) => ({ ...prev, syncInProgress: false }));\n        return result;\n      } catch (error) {\n        setState((prev) => ({ ...prev, syncInProgress: false }));\n        throw error;\n      }\n    },\n    []\n  );\n\n  const getCachedSchools = useCallback(async (userId?: string) => {\n    return await serviceManager.getOfflineSchools(userId);\n  }, []);\n\n  const getCachedSessions = useCallback(async (userId?: string) => {\n    return await serviceManager.getOfflineSessions(userId);\n  }, []);\n\n  const triggerSync = useCallback(async () => {\n    setState((prev) => ({ ...prev, syncInProgress: true }));\n    try {\n      await serviceManager.performBackgroundSync();\n      setState((prev) => ({\n        ...prev,\n        syncInProgress: false,\n        lastSyncTime: new Date(),\n      }));\n    } catch (error) {\n      setState((prev) => ({ ...prev, syncInProgress: false }));\n      throw error;\n    }\n  }, []);\n\n  const clearOfflineData = useCallback(async () => {\n    await serviceManager.clearAllOfflineData();\n    setState((prev) => ({\n      ...prev,\n      pendingActions: 0,\n      lastSyncTime: null,\n    }));\n  }, []);\n\n  return {\n    isOnline: state.isOnline,\n    syncInProgress: state.syncInProgress,\n    lastSyncTime: state.lastSyncTime,\n    checkInOffline: performOfflineCheckIn,\n    checkOutOffline: performOfflineCheckOut,\n    syncOfflineActions: triggerSync,\n    getCachedSchools,\n    getCachedSessions,\n    clearOfflineData,\n  };\n}\n","\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Wifi,\n  WifiOff,\n  Smartphone,\n  Monitor,\n  RefreshCw,\n  Clock,\n} from \"lucide-react\";\nimport { useOffline } from \"@/lib/hooks/useOffline\";\n\nexport function PWAStatus() {\n  const [isPWA, setIsPWA] = useState(false);\n  const [installStatus, setInstallStatus] = useState<\n    \"not-supported\" | \"installable\" | \"installed\"\n  >(\"not-supported\");\n\n  const { isOnline, syncInProgress, lastSyncTime } = useOffline();\n\n  useEffect(() => {\n    // Check if running as PWA\n    const isPWAMode =\n      window.matchMedia(\"(display-mode: standalone)\").matches ||\n      (window.navigator as any).standalone ||\n      document.referrer.includes(\"android-app://\");\n\n    setIsPWA(isPWAMode);\n\n    // Check installation status\n    if (isPWAMode) {\n      setInstallStatus(\"installed\");\n    } else if (\"beforeinstallprompt\" in window) {\n      setInstallStatus(\"installable\");\n    } else {\n      setInstallStatus(\"not-supported\");\n    }\n  }, []);\n\n  return (\n    <div className=\"flex items-center gap-2\">\n      {/* Connection Status */}\n      <Badge\n        variant={isOnline ? \"secondary\" : \"destructive\"}\n        className=\"flex items-center gap-1\"\n      >\n        {isOnline ? (\n          <Wifi className=\"h-3 w-3\" />\n        ) : (\n          <WifiOff className=\"h-3 w-3\" />\n        )}\n        {isOnline ? \"Online\" : \"Offline\"}\n      </Badge>\n\n      {/* Sync Status */}\n      {syncInProgress && (\n        <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n          <RefreshCw className=\"h-3 w-3 animate-spin\" />\n          Syncing\n        </Badge>\n      )}\n\n      {/* Last Sync Time */}\n      {lastSyncTime && !syncInProgress && (\n        <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n          <Clock className=\"h-3 w-3\" />\n          Synced {new Date(lastSyncTime).toLocaleTimeString()}\n        </Badge>\n      )}\n\n      {/* PWA Status */}\n      {isPWA && (\n        <Badge variant=\"default\" className=\"flex items-center gap-1\">\n          <Smartphone className=\"h-3 w-3\" />\n          App Mode\n        </Badge>\n      )}\n\n      {/* Installation Status */}\n      {installStatus === \"installable\" && (\n        <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n          <Monitor className=\"h-3 w-3\" />\n          Installable\n        </Badge>\n      )}\n    </div>\n  );\n}\n","// Enhanced offline data caching strategy for Schools-In PWA\n// Implements intelligent caching with expiration, size limits, and refresh policies\n\nimport { openDB, IDBPDatabase } from \"idb\";\n\n// Cache configuration\nexport const CACHE_CONFIG = {\n  // Cache expiration times (in milliseconds)\n  EXPIRATION: {\n    SCHOOLS: 24 * 60 * 60 * 1000, // 24 hours\n    SESSIONS: 7 * 24 * 60 * 60 * 1000, // 7 days\n    USER_DATA: 30 * 24 * 60 * 60 * 1000, // 30 days\n    LOCATION_DATA: 60 * 60 * 1000, // 1 hour\n  },\n\n  // Cache size limits (number of items)\n  SIZE_LIMITS: {\n    SCHOOLS: 500,\n    SESSIONS: 1000,\n    LOCATION_DATA: 100,\n  },\n\n  // Cache refresh strategies\n  REFRESH_STRATEGIES: {\n    BACKGROUND: \"BACKGROUND\",\n    ON_DEMAND: \"ON_DEMAND\",\n    STALE_WHILE_REVALIDATE: \"STALE_WHILE_REVALIDATE\",\n  },\n} as const;\n\n// Enhanced cache metadata interface\ninterface CacheMetadata {\n  id: string;\n  cachedAt: number;\n  expiresAt: number;\n  accessCount: number;\n  lastAccessed: number;\n  size: number;\n  version: string;\n}\n\n// Cache strategy interface\ninterface CacheStrategy {\n  strategy: \"BACKGROUND\" | \"ON_DEMAND\" | \"STALE_WHILE_REVALIDATE\";\n  priority: \"high\" | \"medium\" | \"low\";\n  backgroundRefresh: boolean;\n  staleTime: number;\n}\n\n// Enhanced database stores\nconst CACHE_STORES = {\n  SCHOOLS: \"schools_cache\",\n  SESSIONS: \"sessions_cache\",\n  USER_DATA: \"user_data_cache\",\n  LOCATION_DATA: \"location_cache\",\n  CACHE_METADATA: \"cache_metadata\",\n  PENDING_ACTIONS: \"pending_actions\",\n} as const;\n\nlet dbInstance: IDBPDatabase | null = null;\n\n// Initialize enhanced caching database\nexport async function initCacheDB() {\n  if (dbInstance) {\n    return dbInstance;\n  }\n\n  dbInstance = await openDB(\"schools-in-cache\", 2, {\n    upgrade(db, oldVersion) {\n      // Schools cache store\n      if (!db.objectStoreNames.contains(CACHE_STORES.SCHOOLS)) {\n        const schoolsStore = db.createObjectStore(CACHE_STORES.SCHOOLS, {\n          keyPath: \"id\",\n        });\n        schoolsStore.createIndex(\"name\", \"name\");\n        schoolsStore.createIndex(\"region\", \"region\");\n        schoolsStore.createIndex(\"assignedProviders\", \"assignedProviders\", {\n          multiEntry: true,\n        });\n      }\n\n      // Sessions cache store\n      if (!db.objectStoreNames.contains(CACHE_STORES.SESSIONS)) {\n        const sessionsStore = db.createObjectStore(CACHE_STORES.SESSIONS, {\n          keyPath: \"id\",\n        });\n        sessionsStore.createIndex(\"userId\", \"userId\");\n        sessionsStore.createIndex(\"schoolId\", \"schoolId\");\n        sessionsStore.createIndex(\"startTime\", \"startTime\");\n        sessionsStore.createIndex(\"status\", \"status\");\n      }\n\n      // User data cache store\n      if (!db.objectStoreNames.contains(CACHE_STORES.USER_DATA)) {\n        const userStore = db.createObjectStore(CACHE_STORES.USER_DATA, {\n          keyPath: \"id\",\n        });\n        userStore.createIndex(\"role\", \"role\");\n        userStore.createIndex(\"lastActive\", \"lastActive\");\n      }\n\n      // Location data cache store\n      if (!db.objectStoreNames.contains(CACHE_STORES.LOCATION_DATA)) {\n        const locationStore = db.createObjectStore(CACHE_STORES.LOCATION_DATA, {\n          keyPath: \"id\",\n        });\n        locationStore.createIndex(\"timestamp\", \"timestamp\");\n        locationStore.createIndex(\"accuracy\", \"accuracy\");\n      }\n\n      // Cache metadata store\n      if (!db.objectStoreNames.contains(CACHE_STORES.CACHE_METADATA)) {\n        const metadataStore = db.createObjectStore(\n          CACHE_STORES.CACHE_METADATA,\n          {\n            keyPath: \"id\",\n          }\n        );\n        metadataStore.createIndex(\"expiresAt\", \"expiresAt\");\n        metadataStore.createIndex(\"lastAccessed\", \"lastAccessed\");\n        metadataStore.createIndex(\"accessCount\", \"accessCount\");\n      }\n\n      // Pending actions store\n      if (!db.objectStoreNames.contains(CACHE_STORES.PENDING_ACTIONS)) {\n        const pendingStore = db.createObjectStore(\n          CACHE_STORES.PENDING_ACTIONS,\n          {\n            keyPath: \"id\",\n            autoIncrement: true,\n          }\n        );\n        pendingStore.createIndex(\"timestamp\", \"timestamp\");\n        pendingStore.createIndex(\"type\", \"type\");\n        pendingStore.createIndex(\"priority\", \"priority\");\n      }\n    },\n  });\n\n  return dbInstance;\n}\n\n// Cache data with expiration and metadata\nexport async function cacheData<T>(\n  store: string,\n  data: T[],\n  strategy: CacheStrategy = {\n    strategy: \"STALE_WHILE_REVALIDATE\",\n    priority: \"medium\",\n    backgroundRefresh: true,\n    staleTime: CACHE_CONFIG.EXPIRATION.SCHOOLS,\n  }\n): Promise<void> {\n  const db = await initCacheDB();\n  const tx = db.transaction([store, CACHE_STORES.CACHE_METADATA], \"readwrite\");\n\n  const now = Date.now();\n  const expiresAt = now + strategy.staleTime;\n\n  // Cache the data\n  for (const item of data) {\n    await tx.objectStore(store).put({\n      ...item,\n      _cached: true,\n      _cachedAt: now,\n      _expiresAt: expiresAt,\n    });\n  }\n\n  // Update cache metadata\n  const metadata: CacheMetadata = {\n    id: store,\n    cachedAt: now,\n    expiresAt,\n    accessCount: 0,\n    lastAccessed: now,\n    size: data.length,\n    version: \"1.0\",\n  };\n\n  await tx.objectStore(CACHE_STORES.CACHE_METADATA).put(metadata);\n  await tx.done;\n\n  // Check and enforce cache size limits\n  await enforceCacheSizeLimit(store);\n}\n\n// Get cached data with expiration check\nexport async function getCachedData<T>(\n  store: string,\n  filter?: (item: T) => boolean\n): Promise<{ data: T[]; isStale: boolean; needsRefresh: boolean }> {\n  const db = await initCacheDB();\n\n  // Update access metadata\n  await updateAccessMetadata(store);\n\n  // Get all cached data\n  const cachedItems = await db.getAll(store);\n\n  // Check if cache is expired\n  const metadata = await db.get(CACHE_STORES.CACHE_METADATA, store);\n  const now = Date.now();\n\n  const isExpired = metadata ? now > metadata.expiresAt : true;\n  const isStale = metadata\n    ? now > metadata.cachedAt + (metadata.expiresAt - metadata.cachedAt) * 0.8\n    : true;\n\n  // Filter data if needed\n  let data = cachedItems;\n  if (filter) {\n    data = data.filter(filter);\n  }\n\n  return {\n    data: data as T[],\n    isStale,\n    needsRefresh: isExpired,\n  };\n}\n\n// Update access metadata for analytics\nasync function updateAccessMetadata(store: string): Promise<void> {\n  const db = await initCacheDB();\n  const metadata = await db.get(CACHE_STORES.CACHE_METADATA, store);\n\n  if (metadata) {\n    metadata.accessCount = (metadata.accessCount || 0) + 1;\n    metadata.lastAccessed = Date.now();\n    await db.put(CACHE_STORES.CACHE_METADATA, metadata);\n  }\n}\n\n// Enforce cache size limits using LRU strategy\nasync function enforceCacheSizeLimit(store: string): Promise<void> {\n  const storeKey = store as keyof typeof CACHE_CONFIG.SIZE_LIMITS;\n  const limit = CACHE_CONFIG.SIZE_LIMITS[storeKey];\n  if (!limit) return;\n\n  const db = await initCacheDB();\n  const allItems = await db.getAll(store);\n\n  if (allItems.length <= limit) return;\n\n  // Sort by access time (LRU)\n  const sortedItems = allItems.sort((a: any, b: any) => {\n    const aAccessed = a._lastAccessed || a._cachedAt || 0;\n    const bAccessed = b._lastAccessed || b._cachedAt || 0;\n    return aAccessed - bAccessed;\n  });\n\n  // Remove oldest items\n  const itemsToRemove = sortedItems.slice(0, allItems.length - limit);\n  const tx = db.transaction(store, \"readwrite\");\n\n  for (const item of itemsToRemove) {\n    await tx.store.delete(item.id);\n  }\n\n  await tx.done;\n}\n\n// Clear expired cache entries\nexport async function clearExpiredCache(): Promise<void> {\n  const db = await initCacheDB();\n  const now = Date.now();\n\n  for (const store of Object.values(CACHE_STORES)) {\n    if (store === CACHE_STORES.CACHE_METADATA) continue;\n\n    const allItems = await db.getAll(store);\n    const tx = db.transaction(store, \"readwrite\");\n\n    for (const item of allItems) {\n      if ((item as any)._expiresAt && now > (item as any)._expiresAt) {\n        await tx.store.delete((item as any).id);\n      }\n    }\n\n    await tx.done;\n  }\n}\n\n// Get cache statistics\nexport async function getCacheStats(): Promise<{\n  totalSize: number;\n  storeStats: Record<\n    string,\n    {\n      itemCount: number;\n      lastAccessed: number;\n      accessCount: number;\n      isStale: boolean;\n    }\n  >;\n}> {\n  const db = await initCacheDB();\n  const now = Date.now();\n  let totalSize = 0;\n  const storeStats: Record<string, any> = {};\n\n  for (const store of Object.values(CACHE_STORES)) {\n    if (store === CACHE_STORES.CACHE_METADATA) continue;\n\n    const items = await db.getAll(store);\n    const metadata = await db.get(CACHE_STORES.CACHE_METADATA, store);\n\n    totalSize += items.length;\n\n    storeStats[store] = {\n      itemCount: items.length,\n      lastAccessed: metadata?.lastAccessed || 0,\n      accessCount: metadata?.accessCount || 0,\n      isStale: metadata ? now > metadata.expiresAt : true,\n    };\n  }\n\n  return { totalSize, storeStats };\n}\n\n// Preload critical data for offline use\nexport async function preloadCriticalData(userId: string): Promise<void> {\n  try {\n    // This would typically fetch from API in a real implementation\n    // For now, we'll simulate with mock data\n\n    console.log(\"Preloading critical data for offline use...\");\n\n    // Simulate fetching and caching schools data\n    const mockSchools = [\n      {\n        id: \"school-1\",\n        name: \"Central High School\",\n        address: \"123 Main St\",\n        coordinates: { lat: 40.7128, lng: -74.006 },\n        region: \"downtown\",\n        assignedProviders: [userId],\n      },\n      {\n        id: \"school-2\",\n        name: \"Westside Elementary\",\n        address: \"456 Oak Ave\",\n        coordinates: { lat: 40.7589, lng: -73.9851 },\n        region: \"westside\",\n        assignedProviders: [userId],\n      },\n    ];\n\n    await cacheData(CACHE_STORES.SCHOOLS, mockSchools, {\n      strategy: \"STALE_WHILE_REVALIDATE\",\n      priority: \"high\",\n      backgroundRefresh: true,\n      staleTime: CACHE_CONFIG.EXPIRATION.SCHOOLS,\n    });\n\n    // Cache user's recent sessions\n    const mockSessions = [\n      {\n        id: \"session-1\",\n        userId,\n        schoolId: \"school-1\",\n        startTime: Date.now() - 2 * 60 * 60 * 1000, // 2 hours ago\n        status: \"active\",\n      },\n    ];\n\n    await cacheData(CACHE_STORES.SESSIONS, mockSessions, {\n      strategy: \"STALE_WHILE_REVALIDATE\",\n      priority: \"medium\",\n      backgroundRefresh: true,\n      staleTime: CACHE_CONFIG.EXPIRATION.SESSIONS,\n    });\n\n    console.log(\"Critical data preloaded successfully\");\n  } catch (error) {\n    console.error(\"Failed to preload critical data:\", error);\n  }\n}\n\n// Smart cache refresh based on usage patterns\nexport async function smartCacheRefresh(): Promise<void> {\n  const stats = await getCacheStats();\n\n  for (const [store, stat] of Object.entries(stats.storeStats)) {\n    // Prioritize frequently accessed and stale caches\n    if (stat.accessCount > 10 && stat.isStale) {\n      console.log(`Refreshing frequently accessed stale cache: ${store}`);\n      // In a real implementation, this would trigger a background fetch\n    }\n  }\n}\n\n// Export the enhanced cache stores for use in other modules\nexport { CACHE_STORES };\n","// Offline action queue for check-in/out operations\n// Handles storing, managing, and syncing actions when offline\n\nimport { initCacheDB, CACHE_STORES, CACHE_CONFIG } from \"./cacheStrategy\";\n\n// Action types for the offline queue\nexport const QUEUE_ACTIONS = {\n  CHECK_IN: \"check_in\",\n  CHECK_OUT: \"check_out\",\n  SESSION_UPDATE: \"session_update\",\n  LOCATION_UPDATE: \"location_update\",\n} as const;\n\nexport type QueueActionType =\n  (typeof QUEUE_ACTIONS)[keyof typeof QUEUE_ACTIONS];\n\n// Status of queued actions\nexport const QUEUE_STATUS = {\n  PENDING: \"pending\",\n  SYNCING: \"syncing\",\n  SYNCED: \"synced\",\n  FAILED: \"failed\",\n  CANCELLED: \"cancelled\",\n} as const;\n\nexport type QueueStatus = (typeof QUEUE_STATUS)[keyof typeof QUEUE_STATUS];\n\n// Interface for queued actions\nexport interface QueuedAction {\n  id: string;\n  type: QueueActionType;\n  payload: any;\n  timestamp: number;\n  status: QueueStatus;\n  retryCount: number;\n  maxRetries: number;\n  userId: string;\n  sessionId?: string;\n  schoolId?: string;\n  location?: {\n    latitude: number;\n    longitude: number;\n    accuracy?: number;\n    timestamp: number;\n  };\n  metadata?: {\n    userAgent?: string;\n    appVersion?: string;\n    platform?: string;\n    networkStatus?: string;\n  };\n  // For cache management\n  _cached?: boolean;\n  _cachedAt?: number;\n  _expiresAt?: number;\n}\n\n// Configuration for the action queue\nexport const QUEUE_CONFIG = {\n  MAX_RETRY_ATTEMPTS: 3,\n  RETRY_DELAY_BASE: 1000, // 1 second base delay\n  RETRY_DELAY_MULTIPLIER: 2, // Exponential backoff\n  MAX_QUEUE_SIZE: 1000,\n  SYNC_INTERVAL: 30000, // 30 seconds\n  BATCH_SIZE: 10, // Process 10 actions at a time\n  EXPIRATION_TIME: 7 * 24 * 60 * 60 * 1000, // 7 days\n} as const;\n\n// Initialize the action queue database\nexport async function initActionQueue(): Promise<void> {\n  try {\n    await initCacheDB();\n    console.log(\"Action queue initialized successfully\");\n  } catch (error) {\n    console.error(\"Failed to initialize action queue:\", error);\n    throw error;\n  }\n}\n\n// Add an action to the offline queue\nexport async function queueAction(\n  type: QueueActionType,\n  payload: any,\n  userId: string,\n  metadata?: Partial<QueuedAction>\n): Promise<string> {\n  try {\n    const db = await initCacheDB();\n    const actionId = generateActionId();\n    const now = Date.now();\n\n    const queuedAction: QueuedAction = {\n      id: actionId,\n      type,\n      payload,\n      timestamp: now,\n      status: QUEUE_STATUS.PENDING,\n      retryCount: 0,\n      maxRetries: QUEUE_CONFIG.MAX_RETRY_ATTEMPTS,\n      userId,\n      metadata: {\n        userAgent: navigator.userAgent,\n        appVersion: process.env.NEXT_PUBLIC_APP_VERSION || \"1.0.0\",\n        platform: navigator.platform,\n        networkStatus: navigator.onLine ? \"online\" : \"offline\",\n        ...metadata?.metadata,\n      },\n      ...metadata,\n      // Cache metadata\n      _cached: true,\n      _cachedAt: now,\n      _expiresAt: now + QUEUE_CONFIG.EXPIRATION_TIME,\n    };\n\n    await db.add(CACHE_STORES.PENDING_ACTIONS, queuedAction);\n\n    console.log(`Action queued: ${type} for user ${userId}`, queuedAction);\n\n    // Trigger immediate sync if online\n    if (navigator.onLine) {\n      setTimeout(() => processQueue(), 100);\n    }\n\n    return actionId;\n  } catch (error) {\n    console.error(\"Failed to queue action:\", error);\n    throw error;\n  }\n}\n\n// Queue a check-in action\nexport async function queueCheckIn(\n  schoolId: string,\n  userId: string,\n  location: { latitude: number; longitude: number; accuracy?: number }\n): Promise<string> {\n  const payload = {\n    schoolId,\n    userId,\n    location: {\n      ...location,\n      timestamp: Date.now(),\n    },\n    action: \"check_in\",\n    timestamp: Date.now(),\n  };\n\n  return queueAction(QUEUE_ACTIONS.CHECK_IN, payload, userId, {\n    schoolId,\n    location: {\n      ...location,\n      timestamp: Date.now(),\n    },\n  });\n}\n\n// Queue a check-out action\nexport async function queueCheckOut(\n  sessionId: string,\n  userId: string,\n  location: { latitude: number; longitude: number; accuracy?: number }\n): Promise<string> {\n  const payload = {\n    sessionId,\n    userId,\n    location: {\n      ...location,\n      timestamp: Date.now(),\n    },\n    action: \"check_out\",\n    timestamp: Date.now(),\n  };\n\n  return queueAction(QUEUE_ACTIONS.CHECK_OUT, payload, userId, {\n    sessionId,\n    location: {\n      ...location,\n      timestamp: Date.now(),\n    },\n  });\n}\n\n// Get all pending actions from the queue\nexport async function getPendingActions(\n  userId?: string\n): Promise<QueuedAction[]> {\n  try {\n    const db = await initCacheDB();\n    const allActions = await db.getAll(CACHE_STORES.PENDING_ACTIONS);\n\n    let actions = allActions.filter(\n      (action: QueuedAction) =>\n        action.status === QUEUE_STATUS.PENDING ||\n        action.status === QUEUE_STATUS.FAILED\n    );\n\n    if (userId) {\n      actions = actions.filter(\n        (action: QueuedAction) => action.userId === userId\n      );\n    }\n\n    // Sort by timestamp (oldest first)\n    actions.sort(\n      (a: QueuedAction, b: QueuedAction) => a.timestamp - b.timestamp\n    );\n\n    return actions;\n  } catch (error) {\n    console.error(\"Failed to get pending actions:\", error);\n    return [];\n  }\n}\n\n// Update action status\nexport async function updateActionStatus(\n  actionId: string,\n  status: QueueStatus,\n  errorMessage?: string\n): Promise<void> {\n  try {\n    const db = await initCacheDB();\n    const action = await db.get(CACHE_STORES.PENDING_ACTIONS, actionId);\n\n    if (action) {\n      action.status = status;\n      action._cachedAt = Date.now();\n\n      if (status === QUEUE_STATUS.FAILED && errorMessage) {\n        action.errorMessage = errorMessage;\n        action.retryCount += 1;\n      }\n\n      if (status === QUEUE_STATUS.SYNCED) {\n        action.syncedAt = Date.now();\n      }\n\n      await db.put(CACHE_STORES.PENDING_ACTIONS, action);\n    }\n  } catch (error) {\n    console.error(\"Failed to update action status:\", error);\n  }\n}\n\n// Remove completed actions from the queue\nexport async function removeCompletedActions(): Promise<number> {\n  try {\n    const db = await initCacheDB();\n    const allActions = await db.getAll(CACHE_STORES.PENDING_ACTIONS);\n\n    let removedCount = 0;\n    const now = Date.now();\n\n    for (const action of allActions) {\n      const shouldRemove =\n        action.status === QUEUE_STATUS.SYNCED ||\n        action.status === QUEUE_STATUS.CANCELLED ||\n        (action._expiresAt && action._expiresAt < now) ||\n        (action.retryCount >= action.maxRetries &&\n          action.status === QUEUE_STATUS.FAILED);\n\n      if (shouldRemove) {\n        await db.delete(CACHE_STORES.PENDING_ACTIONS, action.id);\n        removedCount++;\n      }\n    }\n\n    if (removedCount > 0) {\n      console.log(`Removed ${removedCount} completed actions from queue`);\n    }\n\n    return removedCount;\n  } catch (error) {\n    console.error(\"Failed to remove completed actions:\", error);\n    return 0;\n  }\n}\n\n// Process the action queue (sync with server)\nexport async function processQueue(): Promise<{\n  processed: number;\n  synced: number;\n  failed: number;\n}> {\n  try {\n    const pendingActions = await getPendingActions();\n\n    if (pendingActions.length === 0) {\n      return { processed: 0, synced: 0, failed: 0 };\n    }\n\n    console.log(`Processing ${pendingActions.length} pending actions`);\n\n    let synced = 0;\n    let failed = 0;\n    let processed = 0;\n\n    // Process actions in batches\n    const batches = chunkArray(pendingActions, QUEUE_CONFIG.BATCH_SIZE);\n\n    for (const batch of batches) {\n      const batchResults = await Promise.allSettled(\n        batch.map((action) => processAction(action))\n      );\n\n      batchResults.forEach((result, index) => {\n        processed++;\n        if (result.status === \"fulfilled\" && result.value) {\n          synced++;\n        } else {\n          failed++;\n          console.error(\n            `Failed to process action ${batch[index].id}:`,\n            result.status === \"rejected\" ? result.reason : \"Unknown error\"\n          );\n        }\n      });\n\n      // Small delay between batches to avoid overwhelming the server\n      if (batches.length > 1) {\n        await delay(500);\n      }\n    }\n\n    // Clean up completed actions\n    await removeCompletedActions();\n\n    console.log(\n      `Queue processing complete: ${synced} synced, ${failed} failed`\n    );\n\n    return { processed, synced, failed };\n  } catch (error) {\n    console.error(\"Failed to process queue:\", error);\n    return { processed: 0, synced: 0, failed: 0 };\n  }\n}\n\n// Process a single action\nasync function processAction(action: QueuedAction): Promise<boolean> {\n  try {\n    await updateActionStatus(action.id, QUEUE_STATUS.SYNCING);\n\n    let success = false;\n\n    switch (action.type) {\n      case QUEUE_ACTIONS.CHECK_IN:\n        success = await syncCheckIn(action);\n        break;\n      case QUEUE_ACTIONS.CHECK_OUT:\n        success = await syncCheckOut(action);\n        break;\n      case QUEUE_ACTIONS.SESSION_UPDATE:\n        success = await syncSessionUpdate(action);\n        break;\n      case QUEUE_ACTIONS.LOCATION_UPDATE:\n        success = await syncLocationUpdate(action);\n        break;\n      default:\n        console.warn(`Unknown action type: ${action.type}`);\n        success = false;\n    }\n\n    if (success) {\n      await updateActionStatus(action.id, QUEUE_STATUS.SYNCED);\n    } else {\n      await updateActionStatus(\n        action.id,\n        QUEUE_STATUS.FAILED,\n        \"Sync operation failed\"\n      );\n    }\n\n    return success;\n  } catch (error) {\n    console.error(`Error processing action ${action.id}:`, error);\n    const errorMessage =\n      error instanceof Error ? error.message : \"Unknown error\";\n    await updateActionStatus(action.id, QUEUE_STATUS.FAILED, errorMessage);\n    return false;\n  }\n}\n\n// Sync check-in action with server\nasync function syncCheckIn(action: QueuedAction): Promise<boolean> {\n  try {\n    const response = await fetch(\"/api/sessions\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        ...action.payload,\n        queuedActionId: action.id,\n        originalTimestamp: action.timestamp,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    }\n\n    const result = await response.json();\n    console.log(\"Check-in synced successfully:\", result);\n    return true;\n  } catch (error) {\n    console.error(\"Failed to sync check-in:\", error);\n    return false;\n  }\n}\n\n// Sync check-out action with server\nasync function syncCheckOut(action: QueuedAction): Promise<boolean> {\n  try {\n    const response = await fetch(\"/api/sessions\", {\n      method: \"PATCH\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        ...action.payload,\n        queuedActionId: action.id,\n        originalTimestamp: action.timestamp,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    }\n\n    const result = await response.json();\n    console.log(\"Check-out synced successfully:\", result);\n    return true;\n  } catch (error) {\n    console.error(\"Failed to sync check-out:\", error);\n    return false;\n  }\n}\n\n// Sync session update action with server\nasync function syncSessionUpdate(action: QueuedAction): Promise<boolean> {\n  try {\n    const response = await fetch(`/api/sessions/${action.sessionId}`, {\n      method: \"PATCH\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        ...action.payload,\n        queuedActionId: action.id,\n        originalTimestamp: action.timestamp,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    }\n\n    const result = await response.json();\n    console.log(\"Session update synced successfully:\", result);\n    return true;\n  } catch (error) {\n    console.error(\"Failed to sync session update:\", error);\n    return false;\n  }\n}\n\n// Sync location update action with server\nasync function syncLocationUpdate(action: QueuedAction): Promise<boolean> {\n  try {\n    // This could be used for tracking location updates during sessions\n    const response = await fetch(\"/api/locations\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        ...action.payload,\n        queuedActionId: action.id,\n        originalTimestamp: action.timestamp,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    }\n\n    const result = await response.json();\n    console.log(\"Location update synced successfully:\", result);\n    return true;\n  } catch (error) {\n    console.error(\"Failed to sync location update:\", error);\n    return false;\n  }\n}\n\n// Get queue statistics\nexport async function getQueueStats(): Promise<{\n  total: number;\n  pending: number;\n  syncing: number;\n  synced: number;\n  failed: number;\n  cancelled: number;\n  oldestPending?: number;\n  newestPending?: number;\n}> {\n  try {\n    const db = await initCacheDB();\n    const allActions = await db.getAll(CACHE_STORES.PENDING_ACTIONS);\n\n    const stats = {\n      total: allActions.length,\n      pending: 0,\n      syncing: 0,\n      synced: 0,\n      failed: 0,\n      cancelled: 0,\n      oldestPending: undefined as number | undefined,\n      newestPending: undefined as number | undefined,\n    };\n\n    const pendingTimestamps: number[] = [];\n\n    allActions.forEach((action: QueuedAction) => {\n      switch (action.status) {\n        case QUEUE_STATUS.PENDING:\n          stats.pending++;\n          pendingTimestamps.push(action.timestamp);\n          break;\n        case QUEUE_STATUS.SYNCING:\n          stats.syncing++;\n          break;\n        case QUEUE_STATUS.SYNCED:\n          stats.synced++;\n          break;\n        case QUEUE_STATUS.FAILED:\n          stats.failed++;\n          break;\n        case QUEUE_STATUS.CANCELLED:\n          stats.cancelled++;\n          break;\n      }\n    });\n\n    if (pendingTimestamps.length > 0) {\n      stats.oldestPending = Math.min(...pendingTimestamps);\n      stats.newestPending = Math.max(...pendingTimestamps);\n    }\n\n    return stats;\n  } catch (error) {\n    console.error(\"Failed to get queue stats:\", error);\n    return {\n      total: 0,\n      pending: 0,\n      syncing: 0,\n      synced: 0,\n      failed: 0,\n      cancelled: 0,\n    };\n  }\n}\n\n// Cancel a pending action\nexport async function cancelAction(actionId: string): Promise<boolean> {\n  try {\n    await updateActionStatus(actionId, QUEUE_STATUS.CANCELLED);\n    console.log(`Action ${actionId} cancelled`);\n    return true;\n  } catch (error) {\n    console.error(\"Failed to cancel action:\", error);\n    return false;\n  }\n}\n\n// Retry a failed action\nexport async function retryAction(actionId: string): Promise<boolean> {\n  try {\n    const db = await initCacheDB();\n    const action = await db.get(CACHE_STORES.PENDING_ACTIONS, actionId);\n\n    if (action && action.status === QUEUE_STATUS.FAILED) {\n      if (action.retryCount < action.maxRetries) {\n        action.status = QUEUE_STATUS.PENDING;\n        action.retryCount = Math.max(0, action.retryCount - 1); // Reset retry count\n        await db.put(CACHE_STORES.PENDING_ACTIONS, action);\n\n        // Trigger immediate processing\n        setTimeout(() => processQueue(), 100);\n\n        return true;\n      } else {\n        console.warn(`Action ${actionId} has exceeded max retries`);\n        return false;\n      }\n    }\n\n    return false;\n  } catch (error) {\n    console.error(\"Failed to retry action:\", error);\n    return false;\n  }\n}\n\n// Utility functions\nfunction generateActionId(): string {\n  return `action_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\nfunction chunkArray<T>(array: T[], size: number): T[][] {\n  const chunks: T[][] = [];\n  for (let i = 0; i < array.length; i += size) {\n    chunks.push(array.slice(i, i + size));\n  }\n  return chunks;\n}\n\nfunction delay(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n","// Enhanced sync manager for intelligent queue synchronization\n// Optimizes sync behavior based on network conditions and queue priority\n\nimport {\n  processQueue,\n  getPendingActions,\n  getQueueStats,\n  updateActionStatus,\n  removeCompletedActions,\n  QUEUE_STATUS,\n  QUEUE_CONFIG,\n  type QueuedAction,\n} from \"./actionQueue\";\nimport {\n  useNetworkStatus,\n  type NetworkStatus,\n} from \"../hooks/useNetworkStatus\";\n\nexport interface SyncManagerConfig {\n  enableAdaptiveSync: boolean;\n  enablePrioritySync: boolean;\n  enableBatchOptimization: boolean;\n  enableRetryOptimization: boolean;\n  maxConcurrentSyncs: number;\n  syncTimeoutMs: number;\n  priorityThresholdMs: number; // Actions older than this get priority\n  debugMode: boolean;\n}\n\nexport interface SyncResult {\n  success: boolean;\n  processed: number;\n  synced: number;\n  failed: number;\n  skipped: number;\n  duration: number;\n  networkScore: number;\n  strategy: string;\n  errors: Array<{\n    actionId: string;\n    error: string;\n    willRetry: boolean;\n  }>;\n}\n\nexport interface SyncStrategy {\n  name: string;\n  batchSize: number;\n  concurrency: number;\n  timeout: number;\n  shouldSync: boolean;\n  priority: \"low\" | \"medium\" | \"high\" | \"critical\";\n}\n\n// Priority levels for different action types\nconst ACTION_PRIORITIES = {\n  CHECK_IN: \"high\",\n  CHECK_OUT: \"critical\",\n  SESSION_UPDATE: \"medium\",\n  LOCATION_UPDATE: \"low\",\n} as const;\n\nclass SyncManager {\n  private config: SyncManagerConfig;\n  private isSyncing = false;\n  private syncHistory: Array<{\n    timestamp: number;\n    result: SyncResult;\n  }> = [];\n  private lastNetworkStatus?: NetworkStatus;\n\n  constructor(config: Partial<SyncManagerConfig> = {}) {\n    this.config = {\n      enableAdaptiveSync: true,\n      enablePrioritySync: true,\n      enableBatchOptimization: true,\n      enableRetryOptimization: true,\n      maxConcurrentSyncs: 3,\n      syncTimeoutMs: 30000,\n      priorityThresholdMs: 5 * 60 * 1000, // 5 minutes\n      debugMode: false,\n      ...config,\n    };\n  }\n\n  // Main sync function with intelligent behavior\n  async sync(\n    networkStatus: NetworkStatus,\n    forceSync = false\n  ): Promise<SyncResult> {\n    if (this.isSyncing && !forceSync) {\n      if (this.config.debugMode) {\n        console.log(\"Sync already in progress, skipping\");\n      }\n      return this.createSkippedResult(\"Already syncing\");\n    }\n\n    this.isSyncing = true;\n    this.lastNetworkStatus = networkStatus;\n    const startTime = Date.now();\n\n    try {\n      // Get sync strategy based on network conditions\n      const strategy = this.determineSyncStrategy(networkStatus);\n\n      if (!strategy.shouldSync && !forceSync) {\n        if (this.config.debugMode) {\n          console.log(\"Sync skipped due to poor network conditions\");\n        }\n        return this.createSkippedResult(\"Poor network conditions\");\n      }\n\n      if (this.config.debugMode) {\n        console.log(`Starting sync with strategy: ${strategy.name}`, strategy);\n      }\n\n      // Get pending actions\n      const pendingActions = await getPendingActions();\n\n      if (pendingActions.length === 0) {\n        return this.createSuccessResult(\n          0,\n          0,\n          0,\n          0,\n          Date.now() - startTime,\n          networkStatus.connectivityScore,\n          strategy.name\n        );\n      }\n\n      // Apply prioritization if enabled\n      const prioritizedActions = this.config.enablePrioritySync\n        ? this.prioritizeActions(pendingActions)\n        : pendingActions;\n\n      // Execute sync with selected strategy\n      const result = await this.executeSyncStrategy(\n        prioritizedActions,\n        strategy,\n        networkStatus\n      );\n\n      // Record sync history\n      this.recordSyncResult(result);\n\n      // Cleanup completed actions\n      await removeCompletedActions();\n\n      if (this.config.debugMode) {\n        console.log(\"Sync completed:\", result);\n      }\n\n      return result;\n    } catch (error) {\n      const errorMessage =\n        error instanceof Error ? error.message : \"Unknown sync error\";\n      console.error(\"Sync failed:\", error);\n\n      const failureResult = this.createFailureResult(\n        errorMessage,\n        Date.now() - startTime,\n        networkStatus.connectivityScore\n      );\n      this.recordSyncResult(failureResult);\n\n      return failureResult;\n    } finally {\n      this.isSyncing = false;\n    }\n  }\n\n  // Determine optimal sync strategy based on network conditions\n  private determineSyncStrategy(networkStatus: NetworkStatus): SyncStrategy {\n    const { connectivityScore, effectiveType, downlink, rtt, saveData } =\n      networkStatus;\n\n    // Critical network conditions - no sync\n    if (!networkStatus.isConnected || connectivityScore < 20) {\n      return {\n        name: \"no-sync\",\n        batchSize: 0,\n        concurrency: 0,\n        timeout: 0,\n        shouldSync: false,\n        priority: \"low\",\n      };\n    }\n\n    // High quality network - aggressive sync\n    if (connectivityScore >= 80 && downlink >= 5 && rtt <= 50) {\n      return {\n        name: \"aggressive\",\n        batchSize: QUEUE_CONFIG.BATCH_SIZE * 2,\n        concurrency: this.config.maxConcurrentSyncs,\n        timeout: this.config.syncTimeoutMs,\n        shouldSync: true,\n        priority: \"high\",\n      };\n    }\n\n    // Good network - normal sync\n    if (connectivityScore >= 60 && downlink >= 2 && rtt <= 100) {\n      return {\n        name: \"normal\",\n        batchSize: QUEUE_CONFIG.BATCH_SIZE,\n        concurrency: Math.max(2, this.config.maxConcurrentSyncs - 1),\n        timeout: this.config.syncTimeoutMs,\n        shouldSync: true,\n        priority: \"medium\",\n      };\n    }\n\n    // Medium network - conservative sync\n    if (connectivityScore >= 40) {\n      return {\n        name: \"conservative\",\n        batchSize: Math.max(3, Math.floor(QUEUE_CONFIG.BATCH_SIZE / 2)),\n        concurrency: 1,\n        timeout: this.config.syncTimeoutMs * 1.5,\n        shouldSync: true,\n        priority: \"medium\",\n      };\n    }\n\n    // Poor network - minimal sync (critical actions only)\n    if (connectivityScore >= 20 || saveData) {\n      return {\n        name: \"minimal\",\n        batchSize: 2,\n        concurrency: 1,\n        timeout: this.config.syncTimeoutMs * 2,\n        shouldSync: true,\n        priority: \"critical\",\n      };\n    }\n\n    // Fallback - no sync\n    return {\n      name: \"fallback-no-sync\",\n      batchSize: 0,\n      concurrency: 0,\n      timeout: 0,\n      shouldSync: false,\n      priority: \"low\",\n    };\n  }\n\n  // Prioritize actions based on type, age, and retry count\n  private prioritizeActions(actions: QueuedAction[]): QueuedAction[] {\n    const now = Date.now();\n\n    return actions.sort((a, b) => {\n      // Priority by action type\n      const aPriority =\n        ACTION_PRIORITIES[a.type as keyof typeof ACTION_PRIORITIES] || \"low\";\n      const bPriority =\n        ACTION_PRIORITIES[b.type as keyof typeof ACTION_PRIORITIES] || \"low\";\n\n      const priorityOrder = { critical: 4, high: 3, medium: 2, low: 1 };\n      const priorityDiff =\n        priorityOrder[bPriority as keyof typeof priorityOrder] -\n        priorityOrder[aPriority as keyof typeof priorityOrder];\n\n      if (priorityDiff !== 0) return priorityDiff;\n\n      // Priority by age (older actions first)\n      const ageA = now - a.timestamp;\n      const ageB = now - b.timestamp;\n\n      // Critical threshold - very old actions get highest priority\n      const aIsCriticalAge = ageA > this.config.priorityThresholdMs;\n      const bIsCriticalAge = ageB > this.config.priorityThresholdMs;\n\n      if (aIsCriticalAge && !bIsCriticalAge) return -1;\n      if (bIsCriticalAge && !aIsCriticalAge) return 1;\n\n      // Priority by retry count (fewer retries first for fresh attempts)\n      const retryDiff = a.retryCount - b.retryCount;\n      if (retryDiff !== 0) return retryDiff;\n\n      // Finally, sort by timestamp (FIFO)\n      return a.timestamp - b.timestamp;\n    });\n  }\n\n  // Execute sync with the determined strategy\n  private async executeSyncStrategy(\n    actions: QueuedAction[],\n    strategy: SyncStrategy,\n    networkStatus: NetworkStatus\n  ): Promise<SyncResult> {\n    const startTime = Date.now();\n    let processed = 0;\n    let synced = 0;\n    let failed = 0;\n    let skipped = 0;\n    const errors: Array<{\n      actionId: string;\n      error: string;\n      willRetry: boolean;\n    }> = [];\n\n    // Filter actions by priority if needed\n    let actionsToSync = actions;\n    if (strategy.priority === \"critical\") {\n      actionsToSync = actions.filter((action) => {\n        const actionPriority =\n          ACTION_PRIORITIES[action.type as keyof typeof ACTION_PRIORITIES];\n        return actionPriority === \"critical\" || actionPriority === \"high\";\n      });\n    }\n\n    // Batch processing with concurrency control\n    const batches = this.chunkArray(actionsToSync, strategy.batchSize);\n\n    for (const batch of batches) {\n      // Process batch with concurrency limit\n      const batchPromises = batch\n        .slice(0, strategy.concurrency)\n        .map(async (action) => {\n          try {\n            processed++;\n\n            // Update action status to syncing\n            await updateActionStatus(action.id, QUEUE_STATUS.SYNCING);\n\n            // Create timeout promise\n            const timeoutPromise = new Promise<never>((_, reject) => {\n              setTimeout(\n                () => reject(new Error(\"Sync timeout\")),\n                strategy.timeout\n              );\n            });\n\n            // Race between actual sync and timeout\n            const syncPromise = this.syncSingleAction(action);\n            const success = await Promise.race([syncPromise, timeoutPromise]);\n\n            if (success) {\n              synced++;\n              await updateActionStatus(action.id, QUEUE_STATUS.SYNCED);\n            } else {\n              throw new Error(\"Sync failed\");\n            }\n          } catch (error) {\n            failed++;\n            const errorMessage =\n              error instanceof Error ? error.message : \"Unknown error\";\n            const willRetry = action.retryCount < action.maxRetries;\n\n            errors.push({\n              actionId: action.id,\n              error: errorMessage,\n              willRetry,\n            });\n\n            if (willRetry) {\n              // Update retry count and set back to pending\n              await updateActionStatus(action.id, QUEUE_STATUS.PENDING);\n            } else {\n              // Mark as permanently failed\n              await updateActionStatus(action.id, QUEUE_STATUS.FAILED);\n            }\n          }\n        });\n\n      // Wait for batch completion\n      await Promise.allSettled(batchPromises);\n\n      // Add delay between batches for poor connections\n      if (batches.length > 1 && networkStatus.connectivityScore < 50) {\n        await this.delay(1000 * (batches.length - 1)); // Progressive delay\n      }\n    }\n\n    // Count skipped actions\n    skipped = actions.length - actionsToSync.length;\n\n    const duration = Date.now() - startTime;\n    return this.createSuccessResult(\n      processed,\n      synced,\n      failed,\n      skipped,\n      duration,\n      networkStatus.connectivityScore,\n      strategy.name,\n      errors\n    );\n  }\n\n  // Sync a single action (placeholder - actual implementation would call the real sync functions)\n  private async syncSingleAction(action: QueuedAction): Promise<boolean> {\n    // This would call the actual sync functions from actionQueue.ts\n    // For now, we'll simulate the sync\n    try {\n      const response = await processQueue(); // This processes the entire queue, but we can optimize later\n      return response.synced > 0;\n    } catch (error) {\n      return false;\n    }\n  }\n\n  // Get sync recommendations based on current conditions\n  getSyncRecommendations(networkStatus: NetworkStatus): {\n    shouldSync: boolean;\n    strategy: string;\n    reason: string;\n    estimatedDuration: number;\n    recommendedDelay?: number;\n  } {\n    const strategy = this.determineSyncStrategy(networkStatus);\n    const pendingCount = this.getLastKnownPendingCount();\n\n    const estimatedDuration = this.estimateSyncDuration(pendingCount, strategy);\n\n    if (!strategy.shouldSync) {\n      const recommendedDelay = this.calculateOptimalRetryDelay(networkStatus);\n      return {\n        shouldSync: false,\n        strategy: strategy.name,\n        reason: `Network conditions not suitable (score: ${networkStatus.connectivityScore})`,\n        estimatedDuration: 0,\n        recommendedDelay,\n      };\n    }\n\n    return {\n      shouldSync: true,\n      strategy: strategy.name,\n      reason: `Good conditions for ${strategy.name} sync (score: ${networkStatus.connectivityScore})`,\n      estimatedDuration,\n    };\n  }\n\n  // Get sync history and statistics\n  getSyncHistory(): Array<{ timestamp: number; result: SyncResult }> {\n    return [...this.syncHistory].sort((a, b) => b.timestamp - a.timestamp);\n  }\n\n  getSyncStatistics(): {\n    totalSyncs: number;\n    successRate: number;\n    averageDuration: number;\n    averageNetworkScore: number;\n    strategyCounts: Record<string, number>;\n  } {\n    if (this.syncHistory.length === 0) {\n      return {\n        totalSyncs: 0,\n        successRate: 0,\n        averageDuration: 0,\n        averageNetworkScore: 0,\n        strategyCounts: {},\n      };\n    }\n\n    const totalSyncs = this.syncHistory.length;\n    const successfulSyncs = this.syncHistory.filter(\n      (entry) => entry.result.success\n    ).length;\n    const successRate = (successfulSyncs / totalSyncs) * 100;\n\n    const averageDuration =\n      this.syncHistory.reduce((sum, entry) => sum + entry.result.duration, 0) /\n      totalSyncs;\n    const averageNetworkScore =\n      this.syncHistory.reduce(\n        (sum, entry) => sum + entry.result.networkScore,\n        0\n      ) / totalSyncs;\n\n    const strategyCounts: Record<string, number> = {};\n    this.syncHistory.forEach((entry) => {\n      strategyCounts[entry.result.strategy] =\n        (strategyCounts[entry.result.strategy] || 0) + 1;\n    });\n\n    return {\n      totalSyncs,\n      successRate,\n      averageDuration,\n      averageNetworkScore,\n      strategyCounts,\n    };\n  }\n\n  // Helper methods\n  private recordSyncResult(result: SyncResult): void {\n    this.syncHistory.push({\n      timestamp: Date.now(),\n      result,\n    });\n\n    // Keep only last 100 sync results\n    if (this.syncHistory.length > 100) {\n      this.syncHistory = this.syncHistory.slice(-100);\n    }\n  }\n\n  private getLastKnownPendingCount(): number {\n    // This would typically come from the queue stats\n    // For now, return a reasonable estimate\n    return 5; // Placeholder\n  }\n\n  private estimateSyncDuration(\n    actionCount: number,\n    strategy: SyncStrategy\n  ): number {\n    if (actionCount === 0) return 0;\n\n    const baseTimePerAction = 1000; // 1 second per action\n    const networkMultiplier = this.lastNetworkStatus?.connectivityScore\n      ? 100 / this.lastNetworkStatus.connectivityScore\n      : 2;\n\n    const estimatedTime =\n      (actionCount * baseTimePerAction * networkMultiplier) /\n      strategy.concurrency;\n    return Math.max(1000, Math.min(60000, estimatedTime)); // Between 1s and 60s\n  }\n\n  private calculateOptimalRetryDelay(networkStatus: NetworkStatus): number {\n    const baseDelay = 30000; // 30 seconds\n    const scoreMultiplier = (100 - networkStatus.connectivityScore) / 100;\n    return baseDelay * (1 + scoreMultiplier * 2); // 30s to 90s based on connection quality\n  }\n\n  private createSuccessResult(\n    processed: number,\n    synced: number,\n    failed: number,\n    skipped: number,\n    duration: number,\n    networkScore: number,\n    strategy: string,\n    errors: Array<{ actionId: string; error: string; willRetry: boolean }> = []\n  ): SyncResult {\n    return {\n      success: failed === 0 || synced > 0,\n      processed,\n      synced,\n      failed,\n      skipped,\n      duration,\n      networkScore,\n      strategy,\n      errors,\n    };\n  }\n\n  private createFailureResult(\n    error: string,\n    duration: number,\n    networkScore: number\n  ): SyncResult {\n    return {\n      success: false,\n      processed: 0,\n      synced: 0,\n      failed: 1,\n      skipped: 0,\n      duration,\n      networkScore,\n      strategy: \"failed\",\n      errors: [{ actionId: \"unknown\", error, willRetry: false }],\n    };\n  }\n\n  private createSkippedResult(reason: string): SyncResult {\n    return {\n      success: true,\n      processed: 0,\n      synced: 0,\n      failed: 0,\n      skipped: 1,\n      duration: 0,\n      networkScore: this.lastNetworkStatus?.connectivityScore || 0,\n      strategy: \"skipped\",\n      errors: [],\n    };\n  }\n\n  private chunkArray<T>(array: T[], size: number): T[][] {\n    const chunks: T[][] = [];\n    for (let i = 0; i < array.length; i += size) {\n      chunks.push(array.slice(i, i + size));\n    }\n    return chunks;\n  }\n\n  private delay(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n}\n\n// Export singleton instance\nexport const syncManager = new SyncManager({\n  enableAdaptiveSync: true,\n  enablePrioritySync: true,\n  enableBatchOptimization: true,\n  enableRetryOptimization: true,\n  debugMode: process.env.NODE_ENV === \"development\",\n});\n\nexport default SyncManager;\n","// Queue manager integrating with service manager for offline support\n// Automatically queues actions when offline and syncs when online using intelligent sync strategies\n\nimport {\n  initActionQueue,\n  queueCheckIn,\n  queueCheckOut,\n  processQueue,\n  getPendingActions,\n  getQueueStats,\n  removeCompletedActions,\n  QUEUE_CONFIG,\n  type QueuedAction,\n} from \"./actionQueue\";\nimport { syncManager, type SyncResult } from \"./syncManager\";\nimport {\n  useNetworkStatus,\n  type NetworkStatus,\n} from \"../hooks/useNetworkStatus\";\nimport {\n  useConnectivityRestoration,\n  type ConnectivityRestorationConfig,\n} from \"../hooks/useConnectivityRestoration\";\nimport { useEffect, useCallback } from \"react\";\n\nexport interface QueueManagerConfig {\n  enableAutoSync: boolean;\n  syncInterval: number;\n  enableBackgroundSync: boolean;\n  maxRetryAttempts: number;\n  debugMode: boolean;\n  enableIntelligentSync: boolean;\n  connectivityRestoration?: Partial<ConnectivityRestorationConfig>;\n}\n\nclass QueueManager {\n  private config: QueueManagerConfig;\n  private syncInterval: NodeJS.Timeout | null = null;\n  private isInitialized = false;\n  private isProcessing = false;\n  private listeners: Set<(stats: any) => void> = new Set();\n  private networkStatus: NetworkStatus | null = null;\n  private lastSyncResult: SyncResult | null = null;\n\n  constructor(config: Partial<QueueManagerConfig> = {}) {\n    this.config = {\n      enableAutoSync: true,\n      syncInterval: QUEUE_CONFIG.SYNC_INTERVAL,\n      enableBackgroundSync: true,\n      maxRetryAttempts: QUEUE_CONFIG.MAX_RETRY_ATTEMPTS,\n      debugMode: false,\n      enableIntelligentSync: true,\n      connectivityRestoration: {\n        enableAutoSync: true,\n        enableGradualSync: true,\n        stabilityWaitMs: 2000,\n        maxSyncAttempts: 3,\n        syncRetryDelayMs: 5000,\n        enableSyncNotifications: true,\n        debugMode: false,\n      },\n      ...config,\n    };\n\n    // Avoid initializing in SSR where indexedDB is unavailable\n    if (typeof window !== \"undefined\" && typeof indexedDB !== \"undefined\") {\n      this.initialize();\n    }\n  }\n\n  private async initialize(): Promise<void> {\n    try {\n      await initActionQueue();\n      this.isInitialized = true;\n\n      if (this.config.enableAutoSync) {\n        this.startAutoSync();\n      }\n\n      if (this.config.enableBackgroundSync) {\n        this.setupBackgroundSync();\n      }\n\n      this.setupNetworkListeners();\n\n      if (this.config.debugMode) {\n        console.log(\"QueueManager initialized with config:\", this.config);\n      }\n    } catch (error) {\n      console.error(\"Failed to initialize QueueManager:\", error);\n    }\n  }\n\n  // Check-in with offline support\n  async checkIn(\n    schoolId: string,\n    userId: string,\n    location: { latitude: number; longitude: number; accuracy?: number }\n  ): Promise<{\n    success: boolean;\n    actionId?: string;\n    sessionId?: string;\n    offline?: boolean;\n  }> {\n    if (!this.isInitialized) {\n      throw new Error(\"QueueManager not initialized\");\n    }\n\n    try {\n      if (navigator.onLine) {\n        // Try direct API call first when online\n        const response = await fetch(\"/api/sessions\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({\n            schoolId,\n            userId,\n            location: {\n              ...location,\n              timestamp: Date.now(),\n            },\n            action: \"check_in\",\n            timestamp: Date.now(),\n          }),\n        });\n\n        if (response.ok) {\n          const result = await response.json();\n          if (this.config.debugMode) {\n            console.log(\"Check-in completed online:\", result);\n          }\n          return {\n            success: true,\n            sessionId: result.sessionId,\n            offline: false,\n          };\n        } else {\n          // API failed, fall back to offline queue\n          if (this.config.debugMode) {\n            console.log(\"API call failed, falling back to offline queue\");\n          }\n        }\n      }\n\n      // Queue the action for offline processing\n      const actionId = await queueCheckIn(schoolId, userId, location);\n\n      if (this.config.debugMode) {\n        console.log(\"Check-in queued for offline processing:\", actionId);\n      }\n\n      // Notify listeners\n      this.notifyListeners();\n\n      return {\n        success: true,\n        actionId,\n        offline: true,\n      };\n    } catch (error) {\n      console.error(\"Failed to process check-in:\", error);\n      return { success: false };\n    }\n  }\n\n  // Check-out with offline support\n  async checkOut(\n    sessionId: string,\n    userId: string,\n    location: { latitude: number; longitude: number; accuracy?: number }\n  ): Promise<{ success: boolean; actionId?: string; offline?: boolean }> {\n    if (!this.isInitialized) {\n      throw new Error(\"QueueManager not initialized\");\n    }\n\n    try {\n      if (navigator.onLine) {\n        // Try direct API call first when online\n        const response = await fetch(\"/api/sessions\", {\n          method: \"PATCH\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({\n            sessionId,\n            userId,\n            location: {\n              ...location,\n              timestamp: Date.now(),\n            },\n            action: \"check_out\",\n            timestamp: Date.now(),\n          }),\n        });\n\n        if (response.ok) {\n          const result = await response.json();\n          if (this.config.debugMode) {\n            console.log(\"Check-out completed online:\", result);\n          }\n          return {\n            success: true,\n            offline: false,\n          };\n        } else {\n          // API failed, fall back to offline queue\n          if (this.config.debugMode) {\n            console.log(\"API call failed, falling back to offline queue\");\n          }\n        }\n      }\n\n      // Queue the action for offline processing\n      const actionId = await queueCheckOut(sessionId, userId, location);\n\n      if (this.config.debugMode) {\n        console.log(\"Check-out queued for offline processing:\", actionId);\n      }\n\n      // Notify listeners\n      this.notifyListeners();\n\n      return {\n        success: true,\n        actionId,\n        offline: true,\n      };\n    } catch (error) {\n      console.error(\"Failed to process check-out:\", error);\n      return { success: false };\n    }\n  }\n\n  // Get pending actions\n  async getPendingActions(userId?: string): Promise<QueuedAction[]> {\n    if (!this.isInitialized) {\n      return [];\n    }\n\n    try {\n      return await getPendingActions(userId);\n    } catch (error) {\n      console.error(\"Failed to get pending actions:\", error);\n      return [];\n    }\n  }\n\n  // Get queue statistics\n  async getStats(): Promise<any> {\n    if (!this.isInitialized) {\n      return {\n        total: 0,\n        pending: 0,\n        syncing: 0,\n        synced: 0,\n        failed: 0,\n        cancelled: 0,\n      };\n    }\n\n    try {\n      return await getQueueStats();\n    } catch (error) {\n      console.error(\"Failed to get queue stats:\", error);\n      return {\n        total: 0,\n        pending: 0,\n        syncing: 0,\n        synced: 0,\n        failed: 0,\n        cancelled: 0,\n      };\n    }\n  }\n\n  // Manual sync trigger with intelligent sync strategy\n  async syncNow(forceSync = false): Promise<{\n    processed: number;\n    synced: number;\n    failed: number;\n    strategy?: string;\n    networkScore?: number;\n  } | null> {\n    if (!this.isInitialized) {\n      return null;\n    }\n\n    if (this.isProcessing && !forceSync) {\n      if (this.config.debugMode) {\n        console.log(\"Sync already in progress, skipping\");\n      }\n      return null;\n    }\n\n    try {\n      this.isProcessing = true;\n\n      // Use intelligent sync if enabled and network status available\n      if (this.config.enableIntelligentSync && this.networkStatus) {\n        if (this.config.debugMode) {\n          console.log(\"Using intelligent sync strategy\");\n        }\n\n        const syncResult = await syncManager.sync(\n          this.networkStatus,\n          forceSync\n        );\n        this.lastSyncResult = syncResult;\n\n        if (this.config.debugMode) {\n          console.log(\"Intelligent sync completed:\", syncResult);\n        }\n\n        // Notify listeners\n        this.notifyListeners();\n\n        return {\n          processed: syncResult.processed,\n          synced: syncResult.synced,\n          failed: syncResult.failed,\n          strategy: syncResult.strategy,\n          networkScore: syncResult.networkScore,\n        };\n      } else {\n        // Fall back to basic sync\n        if (!navigator.onLine && !forceSync) {\n          if (this.config.debugMode) {\n            console.log(\"Device offline, skipping sync\");\n          }\n          return null;\n        }\n\n        const result = await processQueue();\n\n        if (this.config.debugMode) {\n          console.log(\"Basic sync completed:\", result);\n        }\n\n        // Notify listeners\n        this.notifyListeners();\n\n        return result;\n      }\n    } catch (error) {\n      console.error(\"Failed to sync queue:\", error);\n      return null;\n    } finally {\n      this.isProcessing = false;\n    }\n  }\n\n  // Add stats listener\n  addStatsListener(callback: (stats: any) => void): () => void {\n    this.listeners.add(callback);\n\n    // Send current stats immediately\n    this.getStats().then((stats) => callback(stats));\n\n    // Return unsubscribe function\n    return () => {\n      this.listeners.delete(callback);\n    };\n  }\n\n  // Update network status for intelligent sync\n  updateNetworkStatus(networkStatus: NetworkStatus): void {\n    this.networkStatus = networkStatus;\n\n    if (this.config.debugMode) {\n      console.log(\"Network status updated:\", networkStatus);\n    }\n\n    // Trigger sync if conditions are favorable\n    if (\n      this.config.enableIntelligentSync &&\n      networkStatus.isOnline &&\n      !this.isProcessing\n    ) {\n      const recommendations = syncManager.getSyncRecommendations(networkStatus);\n\n      if (recommendations.shouldSync) {\n        this.syncNow().catch((error) => {\n          console.error(\"Auto-sync after network update failed:\", error);\n        });\n      }\n    }\n  }\n\n  // Get last sync result\n  getLastSyncResult(): SyncResult | null {\n    return this.lastSyncResult;\n  }\n\n  // Get sync recommendations based on current network status\n  getSyncRecommendations(): {\n    shouldSync: boolean;\n    reason: string;\n    recommendedDelay?: number;\n  } {\n    if (!this.networkStatus) {\n      return { shouldSync: false, reason: \"No network status available\" };\n    }\n\n    return syncManager.getSyncRecommendations(this.networkStatus);\n  }\n\n  // Start automatic sync with intelligent strategies\n  private startAutoSync(): void {\n    if (this.syncInterval) {\n      clearInterval(this.syncInterval);\n    }\n\n    this.syncInterval = setInterval(async () => {\n      if (!this.isProcessing) {\n        const stats = await this.getStats();\n        if (stats.pending > 0) {\n          // Use intelligent sync if enabled and network status available\n          if (this.config.enableIntelligentSync && this.networkStatus) {\n            const recommendations = syncManager.getSyncRecommendations(\n              this.networkStatus\n            );\n\n            if (recommendations.shouldSync) {\n              await this.syncNow();\n            } else if (this.config.debugMode) {\n              console.log(\"Auto-sync skipped:\", recommendations.reason);\n            }\n          } else if (navigator.onLine) {\n            // Fall back to basic sync when online\n            await this.syncNow();\n          }\n        }\n      }\n    }, this.config.syncInterval);\n\n    if (this.config.debugMode) {\n      console.log(\n        `Auto-sync started with interval: ${this.config.syncInterval}ms`\n      );\n    }\n  }\n\n  // Setup background sync for when connectivity returns\n  private setupBackgroundSync(): void {\n    // Clean up old actions periodically\n    setInterval(async () => {\n      if (this.isInitialized) {\n        try {\n          const removedCount = await removeCompletedActions();\n          if (removedCount > 0 && this.config.debugMode) {\n            console.log(\n              `Background cleanup removed ${removedCount} completed actions`\n            );\n          }\n        } catch (error) {\n          console.error(\"Background cleanup failed:\", error);\n        }\n      }\n    }, 5 * 60 * 1000); // Every 5 minutes\n  }\n\n  // Setup network connectivity listeners - now uses basic detection since intelligent sync is handled elsewhere\n  private setupNetworkListeners(): void {\n    const handleOnline = async () => {\n      if (this.config.debugMode) {\n        console.log(\"Network connectivity restored\");\n      }\n\n      // Note: Intelligent sync handling is done via useConnectivityRestoration hook\n      // This is just for basic fallback when not using intelligent sync\n      if (!this.config.enableIntelligentSync) {\n        // Wait a moment for network to stabilize\n        setTimeout(async () => {\n          await this.syncNow();\n        }, 1000);\n      }\n    };\n\n    const handleOffline = () => {\n      if (this.config.debugMode) {\n        console.log(\"Network connectivity lost, switching to offline mode\");\n      }\n    };\n\n    window.addEventListener(\"online\", handleOnline);\n    window.addEventListener(\"offline\", handleOffline);\n  }\n\n  // Notify all listeners of stats changes\n  private async notifyListeners(): Promise<void> {\n    if (this.listeners.size > 0) {\n      try {\n        const stats = await this.getStats();\n        this.listeners.forEach((callback) => {\n          try {\n            callback(stats);\n          } catch (error) {\n            console.error(\"Error in stats listener:\", error);\n          }\n        });\n      } catch (error) {\n        console.error(\"Failed to notify listeners:\", error);\n      }\n    }\n  }\n\n  // Check if queue has pending actions\n  async hasPendingActions(): Promise<boolean> {\n    const stats = await this.getStats();\n    return stats.pending > 0;\n  }\n\n  // Check if queue has failed actions\n  async hasFailedActions(): Promise<boolean> {\n    const stats = await this.getStats();\n    return stats.failed > 0;\n  }\n\n  // Get offline status\n  isOffline(): boolean {\n    return !navigator.onLine;\n  }\n\n  // Cleanup\n  destroy(): void {\n    if (this.syncInterval) {\n      clearInterval(this.syncInterval);\n      this.syncInterval = null;\n    }\n\n    this.listeners.clear();\n    this.isInitialized = false;\n\n    if (this.config.debugMode) {\n      console.log(\"QueueManager destroyed\");\n    }\n  }\n}\n\n// Export singleton instance with intelligent sync enabled\nexport const queueManager =\n  typeof window !== \"undefined\" && typeof indexedDB !== \"undefined\"\n    ? new QueueManager({\n        enableAutoSync: true,\n        enableBackgroundSync: true,\n        enableIntelligentSync: true,\n        debugMode: process.env.NODE_ENV === \"development\",\n      })\n    : ({} as unknown as QueueManager);\n\nexport default QueueManager;\n","// Connectivity restoration manager for intelligent sync orchestration\n// Handles reconnection events and optimizes sync behavior\n\nimport { useEffect, useCallback, useRef, useState } from \"react\";\nimport { useNetworkStatus } from \"../hooks/useNetworkStatus\";\nimport { syncManager, type SyncResult } from \"../offline/syncManager\";\nimport { getQueueStats } from \"../offline/actionQueue\";\n\nexport interface ConnectivityRestorationConfig {\n  enableAutoSync: boolean;\n  enableGradualSync: boolean;\n  stabilityWaitMs: number;\n  maxSyncAttempts: number;\n  syncRetryDelayMs: number;\n  enableSyncNotifications: boolean;\n  debugMode: boolean;\n}\n\nexport interface Restoration {\n  timestamp: number;\n  triggerReason: string;\n  networkScore: number;\n  stabilityWaitTime: number;\n  syncAttempts: number;\n  syncResults: SyncResult[];\n  totalDuration: number;\n  success: boolean;\n}\n\nexport interface UseConnectivityRestorationReturn {\n  // Current state\n  isRestoring: boolean;\n  lastRestoration?: Restoration;\n  restorationHistory: Restoration[];\n\n  // Manual controls\n  triggerSync: (reason?: string) => Promise<SyncResult>;\n  cancelSync: () => void;\n\n  // Configuration\n  updateConfig: (config: Partial<ConnectivityRestorationConfig>) => void;\n\n  // Statistics\n  getRestorationStats: () => {\n    totalRestorations: number;\n    successRate: number;\n    averageDuration: number;\n    averageSyncAttempts: number;\n  };\n}\n\nconst DEFAULT_CONFIG: ConnectivityRestorationConfig = {\n  enableAutoSync: true,\n  enableGradualSync: true,\n  stabilityWaitMs: 2000, // Wait 2 seconds for connection to stabilize\n  maxSyncAttempts: 3,\n  syncRetryDelayMs: 5000, // 5 seconds between retry attempts\n  enableSyncNotifications: true,\n  debugMode: false,\n};\n\nexport function useConnectivityRestoration(\n  initialConfig: Partial<ConnectivityRestorationConfig> = {}\n): UseConnectivityRestorationReturn {\n  const networkStatus = useNetworkStatus();\n  const [config, setConfig] = useState<ConnectivityRestorationConfig>({\n    ...DEFAULT_CONFIG,\n    ...initialConfig,\n  });\n\n  const [isRestoring, setIsRestoring] = useState(false);\n  const [restorationHistory, setRestorationHistory] = useState<Restoration[]>(\n    []\n  );\n  const [lastRestoration, setLastRestoration] = useState<Restoration>();\n\n  // Refs for managing async operations\n  const stabilityTimeoutRef = useRef<NodeJS.Timeout>();\n  const syncCancelRef = useRef<(() => void) | null>(null);\n  const wasOfflineRef = useRef(false);\n  const lastOnlineScoreRef = useRef(0);\n\n  // Initialize offline state tracking\n  useEffect(() => {\n    wasOfflineRef.current = !networkStatus.isOnline;\n    lastOnlineScoreRef.current = networkStatus.connectivityScore;\n  }, []);\n\n  // Main restoration orchestrator\n  const executeRestoration = useCallback(\n    async (triggerReason: string, forceSync = false): Promise<SyncResult> => {\n      if (isRestoring && !forceSync) {\n        if (config.debugMode) {\n          console.log(\"Restoration already in progress, skipping\");\n        }\n        throw new Error(\"Restoration already in progress\");\n      }\n\n      setIsRestoring(true);\n      const startTime = Date.now();\n      const restoration: Restoration = {\n        timestamp: startTime,\n        triggerReason,\n        networkScore: networkStatus.connectivityScore,\n        stabilityWaitTime: 0,\n        syncAttempts: 0,\n        syncResults: [],\n        totalDuration: 0,\n        success: false,\n      };\n\n      try {\n        if (config.debugMode) {\n          console.log(`Starting connectivity restoration: ${triggerReason}`);\n          console.log(\"Network status:\", networkStatus);\n        }\n\n        // Step 1: Wait for connection stability if needed\n        if (config.enableGradualSync && networkStatus.isUnstable) {\n          if (config.debugMode) {\n            console.log(\n              `Waiting ${config.stabilityWaitMs}ms for connection stability`\n            );\n          }\n\n          restoration.stabilityWaitTime = config.stabilityWaitMs;\n          await new Promise((resolve) => {\n            stabilityTimeoutRef.current = setTimeout(\n              resolve,\n              config.stabilityWaitMs\n            );\n          });\n        }\n\n        // Step 2: Check if we still should sync\n        const recommendations =\n          syncManager.getSyncRecommendations(networkStatus);\n\n        if (!recommendations.shouldSync && !forceSync) {\n          if (config.debugMode) {\n            console.log(\n              \"Sync not recommended after stability wait:\",\n              recommendations.reason\n            );\n          }\n\n          if (recommendations.recommendedDelay) {\n            // Schedule retry\n            setTimeout(() => {\n              if (networkStatus.isOnline) {\n                executeRestoration(\"delayed-retry\").catch(console.error);\n              }\n            }, recommendations.recommendedDelay);\n          }\n\n          throw new Error(`Sync not recommended: ${recommendations.reason}`);\n        }\n\n        // Step 3: Execute sync with retries\n        let lastSyncResult: SyncResult | null = null;\n        let syncAttempts = 0;\n\n        while (syncAttempts < config.maxSyncAttempts) {\n          syncAttempts++;\n          restoration.syncAttempts = syncAttempts;\n\n          if (config.debugMode) {\n            console.log(\n              `Sync attempt ${syncAttempts}/${config.maxSyncAttempts}`\n            );\n          }\n\n          try {\n            const syncResult = await syncManager.sync(networkStatus, forceSync);\n            restoration.syncResults.push(syncResult);\n            lastSyncResult = syncResult;\n\n            if (syncResult.success && syncResult.synced > 0) {\n              restoration.success = true;\n\n              if (config.debugMode) {\n                console.log(\"Sync successful:\", syncResult);\n              }\n\n              break; // Success - exit retry loop\n            } else if (syncResult.success && syncResult.synced === 0) {\n              // No actions to sync - still a success\n              restoration.success = true;\n\n              if (config.debugMode) {\n                console.log(\"No actions to sync\");\n              }\n\n              break;\n            } else {\n              // Sync failed but we might retry\n              if (config.debugMode) {\n                console.log(\"Sync failed:\", syncResult);\n              }\n\n              if (syncAttempts < config.maxSyncAttempts) {\n                // Wait before retry with exponential backoff\n                const retryDelay =\n                  config.syncRetryDelayMs * Math.pow(2, syncAttempts - 1);\n\n                if (config.debugMode) {\n                  console.log(`Waiting ${retryDelay}ms before retry`);\n                }\n\n                await new Promise((resolve) => setTimeout(resolve, retryDelay));\n\n                // Check if we're still online before retrying\n                if (!networkStatus.isOnline) {\n                  throw new Error(\"Connection lost during retry wait\");\n                }\n              }\n            }\n          } catch (syncError) {\n            const errorMessage =\n              syncError instanceof Error\n                ? syncError.message\n                : \"Unknown sync error\";\n\n            if (config.debugMode) {\n              console.error(`Sync attempt ${syncAttempts} failed:`, syncError);\n            }\n\n            // Create error result\n            const errorResult: SyncResult = {\n              success: false,\n              processed: 0,\n              synced: 0,\n              failed: 1,\n              skipped: 0,\n              duration: 1000,\n              networkScore: networkStatus.connectivityScore,\n              strategy: \"error\",\n              errors: [\n                {\n                  actionId: \"unknown\",\n                  error: errorMessage,\n                  willRetry: syncAttempts < config.maxSyncAttempts,\n                },\n              ],\n            };\n\n            restoration.syncResults.push(errorResult);\n            lastSyncResult = errorResult;\n\n            if (syncAttempts < config.maxSyncAttempts) {\n              // Wait before retry\n              await new Promise((resolve) =>\n                setTimeout(resolve, config.syncRetryDelayMs)\n              );\n            }\n          }\n        }\n\n        // Step 4: Finalize restoration\n        restoration.totalDuration = Date.now() - startTime;\n\n        if (config.debugMode) {\n          console.log(\"Restoration completed:\", restoration);\n        }\n\n        // Update history\n        setLastRestoration(restoration);\n        setRestorationHistory((prev) => {\n          const updated = [...prev, restoration];\n          // Keep only last 50 restorations\n          return updated.slice(-50);\n        });\n\n        // Show notification if enabled\n        if (config.enableSyncNotifications && restoration.success) {\n          showSyncNotification(restoration);\n        }\n\n        return (\n          lastSyncResult ||\n          restoration.syncResults[restoration.syncResults.length - 1]\n        );\n      } catch (error) {\n        const errorMessage =\n          error instanceof Error ? error.message : \"Unknown restoration error\";\n\n        if (config.debugMode) {\n          console.error(\"Restoration failed:\", error);\n        }\n\n        restoration.totalDuration = Date.now() - startTime;\n        restoration.success = false;\n\n        setLastRestoration(restoration);\n        setRestorationHistory((prev) => [...prev, restoration].slice(-50));\n\n        throw error;\n      } finally {\n        setIsRestoring(false);\n\n        // Cleanup\n        if (stabilityTimeoutRef.current) {\n          clearTimeout(stabilityTimeoutRef.current);\n          stabilityTimeoutRef.current = undefined;\n        }\n        syncCancelRef.current = null;\n      }\n    },\n    [config, networkStatus, isRestoring]\n  );\n\n  // Manual sync trigger\n  const triggerSync = useCallback(\n    async (reason = \"manual\"): Promise<SyncResult> => {\n      return executeRestoration(reason, true);\n    },\n    [executeRestoration]\n  );\n\n  // Cancel ongoing sync\n  const cancelSync = useCallback(() => {\n    if (syncCancelRef.current) {\n      syncCancelRef.current();\n    }\n\n    if (stabilityTimeoutRef.current) {\n      clearTimeout(stabilityTimeoutRef.current);\n      stabilityTimeoutRef.current = undefined;\n    }\n\n    setIsRestoring(false);\n  }, []);\n\n  // Update configuration\n  const updateConfig = useCallback(\n    (newConfig: Partial<ConnectivityRestorationConfig>) => {\n      setConfig((prev) => ({ ...prev, ...newConfig }));\n    },\n    []\n  );\n\n  // Get restoration statistics\n  const getRestorationStats = useCallback(() => {\n    if (restorationHistory.length === 0) {\n      return {\n        totalRestorations: 0,\n        successRate: 0,\n        averageDuration: 0,\n        averageSyncAttempts: 0,\n      };\n    }\n\n    const totalRestorations = restorationHistory.length;\n    const successfulRestorations = restorationHistory.filter(\n      (r) => r.success\n    ).length;\n    const successRate = (successfulRestorations / totalRestorations) * 100;\n\n    const averageDuration =\n      restorationHistory.reduce((sum, r) => sum + r.totalDuration, 0) /\n      totalRestorations;\n    const averageSyncAttempts =\n      restorationHistory.reduce((sum, r) => sum + r.syncAttempts, 0) /\n      totalRestorations;\n\n    return {\n      totalRestorations,\n      successRate,\n      averageDuration,\n      averageSyncAttempts,\n    };\n  }, [restorationHistory]);\n\n  // Listen for network status changes\n  useEffect(() => {\n    const previousOffline = wasOfflineRef.current;\n    const currentOnline = networkStatus.isOnline;\n    const currentScore = networkStatus.connectivityScore;\n    const previousScore = lastOnlineScoreRef.current;\n\n    // Update refs\n    wasOfflineRef.current = !currentOnline;\n    lastOnlineScoreRef.current = currentScore;\n\n    // Trigger restoration on reconnection\n    if (config.enableAutoSync && previousOffline && currentOnline) {\n      if (config.debugMode) {\n        console.log(\"Network reconnection detected, triggering restoration\");\n      }\n\n      executeRestoration(\"reconnection\").catch((error) => {\n        console.error(\"Auto-restoration failed after reconnection:\", error);\n      });\n    }\n\n    // Trigger restoration on significant quality improvement\n    else if (\n      config.enableAutoSync &&\n      currentOnline &&\n      currentScore > previousScore + 30\n    ) {\n      if (config.debugMode) {\n        console.log(\"Significant network quality improvement detected\");\n      }\n\n      executeRestoration(\"quality-improvement\").catch((error) => {\n        console.error(\n          \"Auto-restoration failed after quality improvement:\",\n          error\n        );\n      });\n    }\n  }, [\n    networkStatus.isOnline,\n    networkStatus.connectivityScore,\n    config.enableAutoSync,\n    config.debugMode,\n    executeRestoration,\n  ]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      cancelSync();\n    };\n  }, [cancelSync]);\n\n  return {\n    isRestoring,\n    lastRestoration,\n    restorationHistory,\n    triggerSync,\n    cancelSync,\n    updateConfig,\n    getRestorationStats,\n  };\n}\n\n// Helper function to show sync notifications\nfunction showSyncNotification(restoration: Restoration): void {\n  if (\"Notification\" in window && Notification.permission === \"granted\") {\n    const totalSynced = restoration.syncResults.reduce(\n      (sum, result) => sum + result.synced,\n      0\n    );\n\n    if (totalSynced > 0) {\n      new Notification(\"Sync Completed\", {\n        body: `Successfully synced ${totalSynced} pending actions`,\n        icon: \"/icons/sync-icon.png\",\n        tag: \"sync-completion\",\n      });\n    }\n  }\n}\n\n// Export hook for use in components - no JSX wrapper needed\nexport { useConnectivityRestoration as default };\n","// Enhanced offline queue hook with intelligent sync and connectivity restoration\n// Integrates queue manager, network status, and sync management for comprehensive offline support\n\nimport { useState, useEffect, useCallback, useRef } from \"react\";\nimport { queueManager, type QueueManagerConfig } from \"../offline/queueManager\";\nimport { useNetworkStatus } from \"./useNetworkStatus\";\nimport {\n  useConnectivityRestoration,\n  type ConnectivityRestorationConfig,\n} from \"./useConnectivityRestoration\";\nimport type { QueuedAction } from \"../offline/actionQueue\";\nimport type { SyncResult } from \"../offline/syncManager\";\n\nexport interface EnhancedOfflineQueueState {\n  // Queue statistics\n  queueStats: {\n    total: number;\n    pending: number;\n    syncing: number;\n    synced: number;\n    failed: number;\n    cancelled: number;\n  };\n\n  // Pending actions\n  pendingActions: QueuedAction[];\n\n  // Sync state\n  isSyncing: boolean;\n  lastSyncResult?: SyncResult;\n  syncError?: string;\n\n  // Network and restoration state\n  isOnline: boolean;\n  isUnstable: boolean;\n  connectivityScore: number;\n  isRestoring: boolean;\n\n  // Sync recommendations\n  syncRecommendations: {\n    shouldSync: boolean;\n    reason: string;\n    recommendedDelay?: number;\n  };\n}\n\nexport interface EnhancedOfflineQueueActions {\n  // Queue operations\n  checkIn: (\n    schoolId: string,\n    userId: string,\n    location: { latitude: number; longitude: number; accuracy?: number }\n  ) => Promise<{\n    success: boolean;\n    actionId?: string;\n    sessionId?: string;\n    offline?: boolean;\n  }>;\n\n  checkOut: (\n    sessionId: string,\n    userId: string,\n    location: { latitude: number; longitude: number; accuracy?: number }\n  ) => Promise<{ success: boolean; actionId?: string; offline?: boolean }>;\n\n  // Sync operations\n  syncNow: (forceSync?: boolean) => Promise<SyncResult | null>;\n\n  // Manual connectivity restoration\n  triggerRestoration: (reason?: string) => Promise<SyncResult>;\n\n  // Queue management\n  getPendingActions: (userId?: string) => Promise<QueuedAction[]>;\n  refreshStats: () => Promise<void>;\n\n  // Configuration\n  updateRestorationConfig: (\n    config: Partial<ConnectivityRestorationConfig>\n  ) => void;\n}\n\nexport interface UseEnhancedOfflineQueueConfig {\n  restorationConfig?: Partial<ConnectivityRestorationConfig>;\n  autoRefreshInterval?: number;\n  enableDebugLogs?: boolean;\n}\n\nexport function useEnhancedOfflineQueue(\n  config: UseEnhancedOfflineQueueConfig = {}\n): {\n  state: EnhancedOfflineQueueState;\n  actions: EnhancedOfflineQueueActions;\n} {\n  const { autoRefreshInterval = 5000, enableDebugLogs = false } = config;\n\n  // Network status and connectivity restoration\n  const networkStatus = useNetworkStatus();\n  const connectivityRestoration = useConnectivityRestoration(\n    config.restorationConfig\n  );\n\n  // Local state\n  const [queueStats, setQueueStats] = useState({\n    total: 0,\n    pending: 0,\n    syncing: 0,\n    synced: 0,\n    failed: 0,\n    cancelled: 0,\n  });\n\n  const [pendingActions, setPendingActions] = useState<QueuedAction[]>([]);\n  const [isSyncing, setIsSyncing] = useState(false);\n  const [lastSyncResult, setLastSyncResult] = useState<SyncResult>();\n  const [syncError, setSyncError] = useState<string>();\n  const [syncRecommendations, setSyncRecommendations] = useState({\n    shouldSync: false,\n    reason: \"No network status available\",\n  });\n\n  // Refs for managing intervals\n  const refreshIntervalRef = useRef<NodeJS.Timeout>();\n  const statsListenerRef = useRef<(() => void) | null>(null);\n\n  // Update queue manager with current network status\n  useEffect(() => {\n    queueManager.updateNetworkStatus(networkStatus);\n\n    // Update sync recommendations\n    const recommendations = queueManager.getSyncRecommendations();\n    setSyncRecommendations(recommendations);\n\n    if (enableDebugLogs) {\n      console.log(\"Network status updated:\", networkStatus);\n      console.log(\"Sync recommendations:\", recommendations);\n    }\n  }, [networkStatus, enableDebugLogs]);\n\n  // Setup stats listener\n  useEffect(() => {\n    if (statsListenerRef.current) {\n      statsListenerRef.current();\n    }\n\n    statsListenerRef.current = queueManager.addStatsListener((stats) => {\n      setQueueStats(stats);\n\n      if (enableDebugLogs) {\n        console.log(\"Queue stats updated:\", stats);\n      }\n    });\n\n    return () => {\n      if (statsListenerRef.current) {\n        statsListenerRef.current();\n        statsListenerRef.current = null;\n      }\n    };\n  }, [enableDebugLogs]);\n\n  // Auto-refresh pending actions\n  useEffect(() => {\n    const refreshPendingActions = async () => {\n      try {\n        const actions = await queueManager.getPendingActions();\n        setPendingActions(actions);\n      } catch (error) {\n        console.error(\"Failed to refresh pending actions:\", error);\n      }\n    };\n\n    // Initial refresh\n    refreshPendingActions();\n\n    // Setup interval\n    if (autoRefreshInterval > 0) {\n      refreshIntervalRef.current = setInterval(\n        refreshPendingActions,\n        autoRefreshInterval\n      );\n    }\n\n    return () => {\n      if (refreshIntervalRef.current) {\n        clearInterval(refreshIntervalRef.current);\n      }\n    };\n  }, [autoRefreshInterval]);\n\n  // Update last sync result from queue manager\n  useEffect(() => {\n    const result = queueManager.getLastSyncResult();\n    if (result) {\n      setLastSyncResult(result);\n    }\n  }, [queueStats]); // Refresh when stats change (indicating sync activity)\n\n  // Actions\n  const checkIn = useCallback(\n    async (\n      schoolId: string,\n      userId: string,\n      location: { latitude: number; longitude: number; accuracy?: number }\n    ) => {\n      try {\n        setSyncError(undefined);\n        const result = await queueManager.checkIn(schoolId, userId, location);\n\n        if (enableDebugLogs) {\n          console.log(\"Check-in result:\", result);\n        }\n\n        return result;\n      } catch (error) {\n        const errorMessage =\n          error instanceof Error ? error.message : \"Check-in failed\";\n        setSyncError(errorMessage);\n        console.error(\"Check-in error:\", error);\n        return { success: false };\n      }\n    },\n    [enableDebugLogs]\n  );\n\n  const checkOut = useCallback(\n    async (\n      sessionId: string,\n      userId: string,\n      location: { latitude: number; longitude: number; accuracy?: number }\n    ) => {\n      try {\n        setSyncError(undefined);\n        const result = await queueManager.checkOut(sessionId, userId, location);\n\n        if (enableDebugLogs) {\n          console.log(\"Check-out result:\", result);\n        }\n\n        return result;\n      } catch (error) {\n        const errorMessage =\n          error instanceof Error ? error.message : \"Check-out failed\";\n        setSyncError(errorMessage);\n        console.error(\"Check-out error:\", error);\n        return { success: false };\n      }\n    },\n    [enableDebugLogs]\n  );\n\n  const syncNow = useCallback(\n    async (forceSync = false): Promise<SyncResult | null> => {\n      if (isSyncing && !forceSync) {\n        return null;\n      }\n\n      try {\n        setIsSyncing(true);\n        setSyncError(undefined);\n\n        const result = await queueManager.syncNow(forceSync);\n\n        if (result) {\n          const syncResult: SyncResult = {\n            success: result.synced > 0 || result.processed === 0,\n            processed: result.processed,\n            synced: result.synced,\n            failed: result.failed,\n            skipped: 0,\n            duration: 0,\n            networkScore:\n              result.networkScore || networkStatus.connectivityScore,\n            strategy: result.strategy || \"basic\",\n            errors: [],\n          };\n\n          setLastSyncResult(syncResult);\n\n          if (enableDebugLogs) {\n            console.log(\"Manual sync result:\", syncResult);\n          }\n\n          return syncResult;\n        }\n\n        return null;\n      } catch (error) {\n        const errorMessage =\n          error instanceof Error ? error.message : \"Sync failed\";\n        setSyncError(errorMessage);\n        console.error(\"Sync error:\", error);\n        return null;\n      } finally {\n        setIsSyncing(false);\n      }\n    },\n    [isSyncing, networkStatus.connectivityScore, enableDebugLogs]\n  );\n\n  const triggerRestoration = useCallback(\n    async (reason = \"manual\"): Promise<SyncResult> => {\n      try {\n        setSyncError(undefined);\n        const result = await connectivityRestoration.triggerSync(reason);\n        setLastSyncResult(result);\n\n        if (enableDebugLogs) {\n          console.log(\"Connectivity restoration result:\", result);\n        }\n\n        return result;\n      } catch (error) {\n        const errorMessage =\n          error instanceof Error ? error.message : \"Restoration failed\";\n        setSyncError(errorMessage);\n        console.error(\"Restoration error:\", error);\n        throw error;\n      }\n    },\n    [connectivityRestoration, enableDebugLogs]\n  );\n\n  const getPendingActions = useCallback(\n    async (userId?: string): Promise<QueuedAction[]> => {\n      try {\n        const actions = await queueManager.getPendingActions(userId);\n        setPendingActions(actions);\n        return actions;\n      } catch (error) {\n        console.error(\"Failed to get pending actions:\", error);\n        return [];\n      }\n    },\n    []\n  );\n\n  const refreshStats = useCallback(async (): Promise<void> => {\n    try {\n      const stats = await queueManager.getStats();\n      setQueueStats(stats);\n    } catch (error) {\n      console.error(\"Failed to refresh stats:\", error);\n    }\n  }, []);\n\n  const updateRestorationConfig = useCallback(\n    (newConfig: Partial<ConnectivityRestorationConfig>) => {\n      connectivityRestoration.updateConfig(newConfig);\n    },\n    [connectivityRestoration]\n  );\n\n  // Compose final state\n  const state: EnhancedOfflineQueueState = {\n    queueStats,\n    pendingActions,\n    isSyncing: isSyncing || connectivityRestoration.isRestoring,\n    lastSyncResult,\n    syncError,\n    isOnline: networkStatus.isOnline,\n    isUnstable: networkStatus.isUnstable,\n    connectivityScore: networkStatus.connectivityScore,\n    isRestoring: connectivityRestoration.isRestoring,\n    syncRecommendations,\n  };\n\n  const actions: EnhancedOfflineQueueActions = {\n    checkIn,\n    checkOut,\n    syncNow,\n    triggerRestoration,\n    getPendingActions,\n    refreshStats,\n    updateRestorationConfig,\n  };\n\n  return { state, actions };\n}\n","// Toast UI components for notifications\n// Based on shadcn/ui toast implementation\n\n\"use client\";\n\nimport * as React from \"react\";\nimport * as ToastPrimitives from \"@radix-ui/react-toast\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\nimport { X } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst ToastProvider = ToastPrimitives.Provider;\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n));\nToastViewport.displayName = ToastPrimitives.Viewport.displayName;\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n);\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  );\n});\nToast.displayName = ToastPrimitives.Root.displayName;\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n));\nToastAction.displayName = ToastPrimitives.Action.displayName;\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n));\nToastClose.displayName = ToastPrimitives.Close.displayName;\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n));\nToastTitle.displayName = ToastPrimitives.Title.displayName;\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n));\nToastDescription.displayName = ToastPrimitives.Description.displayName;\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>;\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>;\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n};\n","// Toast hook for managing toast notifications\n// Based on shadcn/ui useToast implementation\n\n\"use client\";\n\nimport * as React from \"react\";\n\nimport type { ToastActionElement, ToastProps } from \"@/components/ui/toast\";\n\nconst TOAST_LIMIT = 1;\nconst TOAST_REMOVE_DELAY = 1000000;\n\ntype ToasterToast = ToastProps & {\n  id: string;\n  title?: React.ReactNode;\n  description?: React.ReactNode;\n  action?: ToastActionElement;\n};\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const;\n\nlet count = 0;\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER;\n  return count.toString();\n}\n\ntype ActionType = typeof actionTypes;\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"];\n      toast: ToasterToast;\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"];\n      toast: Partial<ToasterToast>;\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"];\n      toastId?: ToasterToast[\"id\"];\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"];\n      toastId?: ToasterToast[\"id\"];\n    };\n\ninterface State {\n  toasts: ToasterToast[];\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>();\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return;\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId);\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    });\n  }, TOAST_REMOVE_DELAY);\n\n  toastTimeouts.set(toastId, timeout);\n};\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      };\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      };\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action;\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId);\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id);\n        });\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      };\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        };\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      };\n  }\n};\n\nconst listeners: Array<(state: State) => void> = [];\n\nlet memoryState: State = { toasts: [] };\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action);\n  listeners.forEach((listener) => {\n    listener(memoryState);\n  });\n}\n\ntype Toast = Omit<ToasterToast, \"id\">;\n\nfunction toast({ ...props }: Toast) {\n  const id = genId();\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    });\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id });\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss();\n      },\n    },\n  });\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  };\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState);\n\n  React.useEffect(() => {\n    listeners.push(setState);\n    return () => {\n      const index = listeners.indexOf(setState);\n      if (index > -1) {\n        listeners.splice(index, 1);\n      }\n    };\n  }, [state]);\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  };\n}\n\nexport { useToast, toast };\n","// Offline messaging system for user notifications and feedback\n// Handles different types of offline-related messages and notifications\n\nimport React, { useState, useEffect } from \"react\";\nimport { useNetworkStatus } from \"@/lib/hooks/useNetworkStatus\";\nimport { useEnhancedOfflineQueue } from \"@/lib/hooks/useEnhancedOfflineQueue\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Toast,\n  ToastAction,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\";\nimport { useToast } from \"@/components/ui/use-toast\";\nimport {\n  CheckCircle,\n  AlertTriangle,\n  Info,\n  Wifi,\n  WifiOff,\n  Clock,\n  RefreshCw,\n  X,\n} from \"lucide-react\";\n\nexport interface OfflineMessage {\n  id: string;\n  type: \"success\" | \"warning\" | \"info\" | \"error\";\n  title: string;\n  description: string;\n  action?: {\n    label: string;\n    handler: () => void;\n  };\n  autoHide?: boolean;\n  duration?: number;\n  timestamp: number;\n}\n\nexport interface OfflineMessagingProviderProps {\n  children: React.ReactNode;\n  maxMessages?: number;\n  enableToasts?: boolean;\n  enableNotifications?: boolean;\n}\n\nexport function OfflineMessagingProvider({\n  children,\n  maxMessages = 5,\n  enableToasts = true,\n  enableNotifications = false,\n}: OfflineMessagingProviderProps) {\n  const networkStatus = useNetworkStatus();\n  const { state, actions } = useEnhancedOfflineQueue();\n  const { toast } = useToast();\n\n  const [messages, setMessages] = useState<OfflineMessage[]>([]);\n  const [previousOnlineStatus, setPreviousOnlineStatus] = useState(\n    networkStatus.isOnline\n  );\n  const [previousPendingCount, setPreviousPendingCount] = useState(\n    state.queueStats.pending\n  );\n\n  // Track network status changes\n  useEffect(() => {\n    if (previousOnlineStatus !== networkStatus.isOnline) {\n      if (networkStatus.isOnline) {\n        // Just came online\n        if (enableToasts) {\n          toast({\n            title: \"Connection Restored\",\n            description:\n              state.queueStats.pending > 0\n                ? `Syncing ${state.queueStats.pending} pending actions...`\n                : \"All data is up to date\",\n            action:\n              state.queueStats.pending > 0 ? (\n                <ToastAction\n                  altText=\"Sync now\"\n                  onClick={() => actions.syncNow(true)}\n                >\n                  Sync Now\n                </ToastAction>\n              ) : undefined,\n          });\n        }\n\n        addMessage({\n          type: \"success\",\n          title: \"Back Online\",\n          description:\n            state.queueStats.pending > 0\n              ? `Syncing ${state.queueStats.pending} pending actions`\n              : \"All data synchronized\",\n          autoHide: true,\n          duration: 5000,\n        });\n      } else {\n        // Just went offline\n        if (enableToasts) {\n          toast({\n            title: \"Connection Lost\",\n            description:\n              \"You can continue working offline. Actions will sync when connection returns.\",\n            variant: \"destructive\",\n          });\n        }\n\n        addMessage({\n          type: \"warning\",\n          title: \"Working Offline\",\n          description:\n            \"You can still check in and out. Actions will sync automatically.\",\n          autoHide: false,\n        });\n      }\n      setPreviousOnlineStatus(networkStatus.isOnline);\n    }\n  }, [\n    networkStatus.isOnline,\n    state.queueStats.pending,\n    enableToasts,\n    toast,\n    actions,\n  ]);\n\n  // Track sync completion\n  useEffect(() => {\n    if (\n      previousPendingCount > 0 &&\n      state.queueStats.pending === 0 &&\n      networkStatus.isOnline\n    ) {\n      if (enableToasts) {\n        toast({\n          title: \"Sync Complete\",\n          description: `Successfully synced ${previousPendingCount} actions`,\n        });\n      }\n\n      addMessage({\n        type: \"success\",\n        title: \"Sync Completed\",\n        description: `${previousPendingCount} actions synchronized successfully`,\n        autoHide: true,\n        duration: 3000,\n      });\n    }\n    setPreviousPendingCount(state.queueStats.pending);\n  }, [\n    state.queueStats.pending,\n    networkStatus.isOnline,\n    previousPendingCount,\n    enableToasts,\n    toast,\n  ]);\n\n  // Track sync errors\n  useEffect(() => {\n    if (state.syncError) {\n      if (enableToasts) {\n        toast({\n          title: \"Sync Error\",\n          description: state.syncError,\n          variant: \"destructive\",\n          action: (\n            <ToastAction altText=\"Retry\" onClick={() => actions.syncNow(true)}>\n              Retry\n            </ToastAction>\n          ),\n        });\n      }\n\n      addMessage({\n        type: \"error\",\n        title: \"Sync Failed\",\n        description: state.syncError,\n        action: {\n          label: \"Retry\",\n          handler: () => actions.syncNow(true),\n        },\n        autoHide: false,\n      });\n    }\n  }, [state.syncError, enableToasts, toast, actions]);\n\n  // Browser notifications (if enabled and permissions granted)\n  useEffect(() => {\n    if (enableNotifications && \"Notification\" in window) {\n      if (Notification.permission === \"default\") {\n        Notification.requestPermission();\n      }\n    }\n  }, [enableNotifications]);\n\n  const addMessage = (\n    messageData: Omit<OfflineMessage, \"id\" | \"timestamp\">\n  ) => {\n    const message: OfflineMessage = {\n      id: `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      timestamp: Date.now(),\n      ...messageData,\n    };\n\n    setMessages((prev) => {\n      const newMessages = [message, ...prev].slice(0, maxMessages);\n\n      // Auto-hide message if specified\n      if (message.autoHide) {\n        setTimeout(() => {\n          removeMessage(message.id);\n        }, message.duration || 5000);\n      }\n\n      return newMessages;\n    });\n\n    // Show browser notification if enabled\n    if (\n      enableNotifications &&\n      \"Notification\" in window &&\n      Notification.permission === \"granted\"\n    ) {\n      new Notification(message.title, {\n        body: message.description,\n        icon: \"/icon-192.png\",\n        tag: `offline-message-${message.type}`,\n      });\n    }\n  };\n\n  const removeMessage = (id: string) => {\n    setMessages((prev) => prev.filter((msg) => msg.id !== id));\n  };\n\n  const clearAllMessages = () => {\n    setMessages([]);\n  };\n\n  return (\n    <ToastProvider>\n      {children}\n      <ToastViewport />\n    </ToastProvider>\n  );\n}\n\n// Message display component for showing persistent messages\nexport function OfflineMessageList({\n  className,\n  maxVisible = 3,\n}: {\n  className?: string;\n  maxVisible?: number;\n}) {\n  const networkStatus = useNetworkStatus();\n  const { state, actions } = useEnhancedOfflineQueue();\n\n  const getRelevantMessages = (): OfflineMessage[] => {\n    const messages: OfflineMessage[] = [];\n\n    // Offline status message\n    if (!networkStatus.isOnline) {\n      messages.push({\n        id: \"offline-status\",\n        type: \"warning\",\n        title: \"Working Offline\",\n        description: `You can continue working. ${state.queueStats.pending} actions will sync when connected.`,\n        timestamp: Date.now(),\n      });\n    }\n\n    // Unstable connection message\n    if (networkStatus.isOnline && networkStatus.isUnstable) {\n      messages.push({\n        id: \"unstable-connection\",\n        type: \"warning\",\n        title: \"Unstable Connection\",\n        description: \"Some features may be limited due to poor connectivity.\",\n        timestamp: Date.now(),\n      });\n    }\n\n    // Pending actions message\n    if (state.queueStats.pending > 0 && networkStatus.isOnline) {\n      messages.push({\n        id: \"pending-sync\",\n        type: \"info\",\n        title: \"Syncing Actions\",\n        description: `${state.queueStats.pending} actions waiting to sync`,\n        action: {\n          label: \"Sync Now\",\n          handler: () => actions.syncNow(true),\n        },\n        timestamp: Date.now(),\n      });\n    }\n\n    // Failed actions message\n    if (state.queueStats.failed > 0) {\n      messages.push({\n        id: \"failed-actions\",\n        type: \"error\",\n        title: \"Sync Failed\",\n        description: `${state.queueStats.failed} actions failed to sync`,\n        action: {\n          label: \"Retry\",\n          handler: () => actions.syncNow(true),\n        },\n        timestamp: Date.now(),\n      });\n    }\n\n    // Sync recommendations message\n    if (!state.syncRecommendations.shouldSync && state.queueStats.pending > 0) {\n      messages.push({\n        id: \"sync-delayed\",\n        type: \"info\",\n        title: \"Sync Delayed\",\n        description: state.syncRecommendations.reason,\n        timestamp: Date.now(),\n      });\n    }\n\n    return messages.slice(0, maxVisible);\n  };\n\n  const messages = getRelevantMessages();\n\n  if (messages.length === 0) {\n    return null;\n  }\n\n  const getIcon = (type: OfflineMessage[\"type\"]) => {\n    switch (type) {\n      case \"success\":\n        return <CheckCircle className=\"h-4 w-4\" />;\n      case \"warning\":\n        return <AlertTriangle className=\"h-4 w-4\" />;\n      case \"error\":\n        return <X className=\"h-4 w-4\" />;\n      case \"info\":\n      default:\n        return <Info className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getVariant = (type: OfflineMessage[\"type\"]) => {\n    switch (type) {\n      case \"error\":\n        return \"destructive\";\n      default:\n        return \"default\";\n    }\n  };\n\n  return (\n    <div className={className}>\n      {messages.map((message) => (\n        <Alert\n          key={message.id}\n          variant={getVariant(message.type)}\n          className=\"mb-2\"\n        >\n          {getIcon(message.type)}\n          <AlertDescription>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"font-medium\">{message.title}</div>\n                <div className=\"text-sm\">{message.description}</div>\n              </div>\n              {message.action && (\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={message.action.handler}\n                  className=\"ml-4\"\n                >\n                  {message.action.label}\n                </Button>\n              )}\n            </div>\n          </AlertDescription>\n        </Alert>\n      ))}\n    </div>\n  );\n}\n\n// Hook for programmatic message management\nexport function useOfflineMessaging() {\n  const networkStatus = useNetworkStatus();\n  const { state, actions } = useEnhancedOfflineQueue();\n  const { toast } = useToast();\n\n  const showConnectivityMessage = (type: \"online\" | \"offline\" | \"unstable\") => {\n    switch (type) {\n      case \"online\":\n        toast({\n          title: \"Connected\",\n          description: \"Connection restored successfully\",\n        });\n        break;\n      case \"offline\":\n        toast({\n          title: \"Offline\",\n          description: \"Working offline - actions will sync when connected\",\n          variant: \"destructive\",\n        });\n        break;\n      case \"unstable\":\n        toast({\n          title: \"Poor Connection\",\n          description: \"Connection is unstable - some features may be limited\",\n        });\n        break;\n    }\n  };\n\n  const showSyncMessage = (\n    type: \"started\" | \"completed\" | \"failed\",\n    details?: string\n  ) => {\n    switch (type) {\n      case \"started\":\n        toast({\n          title: \"Syncing...\",\n          description: details || \"Synchronizing offline actions\",\n        });\n        break;\n      case \"completed\":\n        toast({\n          title: \"Sync Complete\",\n          description: details || \"All actions synchronized successfully\",\n        });\n        break;\n      case \"failed\":\n        toast({\n          title: \"Sync Failed\",\n          description: details || \"Failed to sync some actions\",\n          variant: \"destructive\",\n          action: (\n            <ToastAction altText=\"Retry\" onClick={() => actions.syncNow(true)}>\n              Retry\n            </ToastAction>\n          ),\n        });\n        break;\n    }\n  };\n\n  const showActionMessage = (\n    action: \"check-in\" | \"check-out\",\n    success: boolean,\n    offline: boolean\n  ) => {\n    const actionName = action === \"check-in\" ? \"Check-in\" : \"Check-out\";\n\n    if (success) {\n      toast({\n        title: `${actionName} ${offline ? \"Queued\" : \"Successful\"}`,\n        description: offline\n          ? `${actionName} saved offline - will sync when connected`\n          : `${actionName} completed successfully`,\n      });\n    } else {\n      toast({\n        title: `${actionName} Failed`,\n        description: `Failed to ${action.replace(\"-\", \" \")} - please try again`,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return {\n    showConnectivityMessage,\n    showSyncMessage,\n    showActionMessage,\n    networkStatus,\n    queueState: state,\n    queueActions: actions,\n  };\n}\n","// Offline status indicator component with user messaging\n// Provides visual feedback about connectivity status and offline capabilities\n\nimport React from \"react\";\nimport { useNetworkStatus } from \"@/lib/hooks/useNetworkStatus\";\nimport { useEnhancedOfflineQueue } from \"@/lib/hooks/useEnhancedOfflineQueue\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Wifi,\n  WifiOff,\n  AlertTriangle,\n  Clock,\n  CheckCircle,\n  RefreshCw,\n  Signal,\n  Info,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface OfflineStatusIndicatorProps {\n  variant?: \"compact\" | \"full\" | \"banner\";\n  showSyncButton?: boolean;\n  showQueueInfo?: boolean;\n  className?: string;\n}\n\nexport function OfflineStatusIndicator({\n  variant = \"compact\",\n  showSyncButton = true,\n  showQueueInfo = true,\n  className,\n}: OfflineStatusIndicatorProps) {\n  const networkStatus = useNetworkStatus();\n  const { state, actions } = useEnhancedOfflineQueue({\n    enableDebugLogs: false,\n  });\n\n  const getStatusIcon = () => {\n    if (!networkStatus.isOnline) {\n      return <WifiOff className=\"h-4 w-4\" />;\n    }\n    if (networkStatus.isUnstable) {\n      return <AlertTriangle className=\"h-4 w-4\" />;\n    }\n    return <Wifi className=\"h-4 w-4\" />;\n  };\n\n  const getStatusColor = () => {\n    if (!networkStatus.isOnline) return \"text-red-600\";\n    if (networkStatus.isUnstable) return \"text-yellow-600\";\n    if (networkStatus.connectivityScore >= 80) return \"text-green-600\";\n    if (networkStatus.connectivityScore >= 60) return \"text-blue-600\";\n    return \"text-gray-600\";\n  };\n\n  const getStatusText = () => {\n    if (!networkStatus.isOnline) return \"Offline\";\n    if (networkStatus.isUnstable) return \"Unstable\";\n    if (networkStatus.connectivityScore >= 80) return \"Excellent\";\n    if (networkStatus.connectivityScore >= 60) return \"Good\";\n    if (networkStatus.connectivityScore >= 40) return \"Fair\";\n    return \"Poor\";\n  };\n\n  const getQueueStatusText = () => {\n    const { queueStats } = state;\n    if (queueStats.pending > 0) {\n      return `${queueStats.pending} pending actions`;\n    }\n    if (queueStats.syncing > 0) {\n      return `${queueStats.syncing} syncing`;\n    }\n    if (queueStats.failed > 0) {\n      return `${queueStats.failed} failed`;\n    }\n    return \"All synced\";\n  };\n\n  const handleSyncNow = async () => {\n    try {\n      await actions.syncNow(true);\n    } catch (error) {\n      console.error(\"Manual sync failed:\", error);\n    }\n  };\n\n  // Compact variant - just icon and basic status\n  if (variant === \"compact\") {\n    return (\n      <div className={cn(\"flex items-center gap-1\", className)}>\n        <div className={cn(\"flex items-center\", getStatusColor())}>\n          {getStatusIcon()}\n        </div>\n        {state.queueStats.pending > 0 && (\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            {state.queueStats.pending}\n          </Badge>\n        )}\n      </div>\n    );\n  }\n\n  // Banner variant - full width status bar\n  if (variant === \"banner\") {\n    if (\n      networkStatus.isOnline &&\n      !networkStatus.isUnstable &&\n      state.queueStats.pending === 0\n    ) {\n      return null; // Hide banner when online, stable, and everything is synced\n    }\n\n    return (\n      <Alert className={cn(\"mb-4\", className)}>\n        <div className=\"flex items-center justify-between w-full\">\n          <div className=\"flex items-center gap-2\">\n            <div className={getStatusColor()}>{getStatusIcon()}</div>\n            <div>\n              <AlertDescription className=\"m-0\">\n                {!networkStatus.isOnline ? (\n                  <>\n                    <span className=\"font-medium\">Working offline</span>\n                    {state.queueStats.pending > 0 && (\n                      <span className=\"ml-2\">\n                         {state.queueStats.pending} actions will sync when\n                        connected\n                      </span>\n                    )}\n                  </>\n                ) : networkStatus.isUnstable ? (\n                  <>\n                    <span className=\"font-medium\">Connection unstable</span>\n                    <span className=\"ml-2\"> Some features may be limited</span>\n                  </>\n                ) : state.queueStats.pending > 0 ? (\n                  <>\n                    <span className=\"font-medium\">Syncing pending actions</span>\n                    <span className=\"ml-2\">\n                       {state.queueStats.pending} remaining\n                    </span>\n                  </>\n                ) : null}\n              </AlertDescription>\n            </div>\n          </div>\n\n          {showSyncButton &&\n            state.queueStats.pending > 0 &&\n            networkStatus.isOnline && (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={handleSyncNow}\n                disabled={state.isSyncing}\n                className=\"ml-4\"\n              >\n                {state.isSyncing ? (\n                  <RefreshCw className=\"h-3 w-3 animate-spin mr-1\" />\n                ) : (\n                  <RefreshCw className=\"h-3 w-3 mr-1\" />\n                )}\n                Sync Now\n              </Button>\n            )}\n        </div>\n      </Alert>\n    );\n  }\n\n  // Full variant - detailed status display\n  return (\n    <div className={cn(\"space-y-3\", className)}>\n      {/* Connection Status */}\n      <div className=\"flex items-center justify-between p-3 border rounded-lg\">\n        <div className=\"flex items-center gap-3\">\n          <div className={cn(\"flex items-center\", getStatusColor())}>\n            {getStatusIcon()}\n          </div>\n          <div>\n            <div className=\"font-medium\">\n              {networkStatus.isOnline ? \"Online\" : \"Offline\"}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">\n              Connection: {getStatusText()}\n            </div>\n          </div>\n        </div>\n\n        {networkStatus.isOnline && (\n          <div className=\"text-right\">\n            <div className=\"text-sm font-medium\">\n              {networkStatus.connectivityScore}/100\n            </div>\n            <div className=\"text-xs text-muted-foreground\">Quality Score</div>\n          </div>\n        )}\n      </div>\n\n      {/* Quality Progress Bar (only when online) */}\n      {networkStatus.isOnline && (\n        <div className=\"space-y-1\">\n          <div className=\"flex justify-between text-xs\">\n            <span className=\"text-muted-foreground\">Connection Quality</span>\n            <span className=\"text-muted-foreground\">\n              {networkStatus.connectivityScore}%\n            </span>\n          </div>\n          <Progress value={networkStatus.connectivityScore} className=\"h-2\" />\n        </div>\n      )}\n\n      {/* Queue Status */}\n      {showQueueInfo && (\n        <div className=\"flex items-center justify-between p-3 border rounded-lg\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"flex items-center text-blue-600\">\n              {state.isSyncing ? (\n                <RefreshCw className=\"h-4 w-4 animate-spin\" />\n              ) : state.queueStats.pending > 0 ? (\n                <Clock className=\"h-4 w-4\" />\n              ) : (\n                <CheckCircle className=\"h-4 w-4 text-green-600\" />\n              )}\n            </div>\n            <div>\n              <div className=\"font-medium\">Queue Status</div>\n              <div className=\"text-sm text-muted-foreground\">\n                {getQueueStatusText()}\n              </div>\n            </div>\n          </div>\n\n          {showSyncButton &&\n            state.queueStats.pending > 0 &&\n            networkStatus.isOnline && (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={handleSyncNow}\n                disabled={state.isSyncing}\n              >\n                {state.isSyncing ? (\n                  <RefreshCw className=\"h-3 w-3 animate-spin mr-1\" />\n                ) : (\n                  <RefreshCw className=\"h-3 w-3 mr-1\" />\n                )}\n                Sync\n              </Button>\n            )}\n        </div>\n      )}\n\n      {/* Sync Recommendations */}\n      {!state.syncRecommendations.shouldSync &&\n        state.queueStats.pending > 0 && (\n          <Alert>\n            <Info className=\"h-4 w-4\" />\n            <AlertDescription>\n              <strong>Sync delayed:</strong> {state.syncRecommendations.reason}\n              {state.syncRecommendations.recommendedDelay && (\n                <span className=\"ml-1\">\n                  (Recommended wait:{\" \"}\n                  {Math.round(\n                    state.syncRecommendations.recommendedDelay / 1000\n                  )}\n                  s)\n                </span>\n              )}\n            </AlertDescription>\n          </Alert>\n        )}\n\n      {/* Offline Message */}\n      {!networkStatus.isOnline && (\n        <Alert>\n          <Info className=\"h-4 w-4\" />\n          <AlertDescription>\n            <strong>Working offline:</strong> You can still check in and out.\n            Actions will sync automatically when connection returns.\n          </AlertDescription>\n        </Alert>\n      )}\n    </div>\n  );\n}\n\nexport default OfflineStatusIndicator;\n","// Offline status bar component for layout integration\n// Provides persistent offline status information across the application\n\nimport React from \"react\";\nimport { OfflineStatusIndicator } from \"./OfflineStatusIndicator\";\nimport { OfflineMessageList } from \"./OfflineMessaging\";\nimport { useNetworkStatus } from \"@/lib/hooks/useNetworkStatus\";\nimport { useEnhancedOfflineQueue } from \"@/lib/hooks/useEnhancedOfflineQueue\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface OfflineStatusBarProps {\n  variant?: \"minimal\" | \"compact\" | \"full\";\n  position?: \"top\" | \"bottom\";\n  showMessages?: boolean;\n  className?: string;\n}\n\nexport function OfflineStatusBar({\n  variant = \"compact\",\n  position = \"top\",\n  showMessages = true,\n  className,\n}: OfflineStatusBarProps) {\n  const networkStatus = useNetworkStatus();\n  const { state } = useEnhancedOfflineQueue();\n\n  // Only show the status bar when offline or when there are pending/failed actions\n  const shouldShow =\n    !networkStatus.isOnline ||\n    state.queueStats.pending > 0 ||\n    state.queueStats.failed > 0 ||\n    networkStatus.isUnstable;\n\n  if (!shouldShow && variant !== \"full\") {\n    return null;\n  }\n\n  const getStatusBarContent = () => {\n    switch (variant) {\n      case \"minimal\":\n        return (\n          <div className=\"flex items-center justify-between\">\n            <OfflineStatusIndicator\n              variant=\"compact\"\n              className=\"flex-shrink-0\"\n            />\n            {(state.queueStats.pending > 0 || state.queueStats.failed > 0) && (\n              <div className=\"text-xs text-muted-foreground ml-2\">\n                {state.queueStats.pending > 0 &&\n                  `${state.queueStats.pending} pending`}\n                {state.queueStats.pending > 0 &&\n                  state.queueStats.failed > 0 &&\n                  \", \"}\n                {state.queueStats.failed > 0 &&\n                  `${state.queueStats.failed} failed`}\n              </div>\n            )}\n          </div>\n        );\n\n      case \"compact\":\n        return (\n          <div className=\"space-y-2\">\n            <OfflineStatusIndicator\n              variant=\"banner\"\n              showSyncButton={true}\n              showQueueInfo={false}\n            />\n            {showMessages && <OfflineMessageList maxVisible={1} />}\n          </div>\n        );\n\n      case \"full\":\n        return (\n          <div className=\"space-y-3\">\n            <OfflineStatusIndicator\n              variant=\"full\"\n              showSyncButton={true}\n              showQueueInfo={true}\n            />\n            {showMessages && <OfflineMessageList maxVisible={3} />}\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  const positionClasses = {\n    top: \"top-0\",\n    bottom: \"bottom-0\",\n  };\n\n  return (\n    <div\n      className={cn(\n        \"w-full z-40\",\n        variant === \"full\"\n          ? \"relative p-4 bg-background border-b\"\n          : `sticky ${positionClasses[position]} bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b px-4 py-2`,\n        className\n      )}\n    >\n      {getStatusBarContent()}\n    </div>\n  );\n}\n\nexport default OfflineStatusBar;\n","// Toaster component for rendering toast notifications\n// Based on shadcn/ui Toaster implementation\n\n\"use client\";\n\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\";\nimport { useToast } from \"@/components/ui/use-toast\";\n\nexport function Toaster() {\n  const { toasts } = useToast();\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        );\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  );\n}\n","\"use client\";\n\nimport { useAuth } from \"@/lib/hooks/useAuth\";\nimport { useAnalytics } from \"@/lib/hooks/useAnalytics\";\nimport { Button } from \"@/components/ui/button\";\nimport { logOut } from \"@/lib/firebase/auth\";\nimport { useRouter } from \"next/navigation\";\nimport Link from \"next/link\";\nimport { PWAInstallPrompt } from \"@/components/pwa/PWAInstallPrompt\";\nimport { PWAUpdatePrompt } from \"@/components/pwa/PWAUpdatePrompt\";\nimport { PWAStatus } from \"@/components/pwa/PWAStatus\";\nimport { OfflineMessagingProvider } from \"@/components/offline/OfflineMessaging\";\nimport { OfflineStatusBar } from \"@/components/offline/OfflineStatusBar\";\nimport { OfflineStatusIndicator } from \"@/components/offline/OfflineStatusIndicator\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { Logo } from \"../ui/logo\";\n\ninterface ClientLayoutProps {\n  children: React.ReactNode;\n}\n\nexport default function ClientLayout({ children }: ClientLayoutProps) {\n  return (\n    <OfflineMessagingProvider enableToasts={true} enableNotifications={true}>\n      <div className=\"flex flex-col min-h-screen\">\n        <Header />\n        <OfflineStatusBar variant=\"compact\" position=\"top\" />\n        <PWAUpdatePrompt />\n        <main\n          id=\"main-content\"\n          className=\"flex-1 container-responsive py-4 sm:py-6 lg:py-8\"\n          tabIndex={-1}\n        >\n          <PWAInstallPrompt />\n          {children}\n        </main>\n        <Toaster />\n      </div>\n    </OfflineMessagingProvider>\n  );\n}\n\nfunction Header() {\n  const { user } = useAuth();\n  const router = useRouter();\n  const { trackLogout } = useAnalytics();\n\n  const handleSignOut = async () => {\n    try {\n      await logOut();\n      trackLogout();\n      router.push(\"/\");\n    } catch (error) {\n      console.error(\"Sign out failed:\", error);\n    }\n  };\n\n  return (\n    <header\n      className=\"sticky top-0 z-50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b\"\n      role=\"banner\"\n    >\n      <div className=\"container-responsive py-3 sm:py-4\">\n        <div className=\"flex justify-between items-center\">\n          <Link href=\"/\" className=\"focus-ring\" aria-label=\"Schools-In Home\">\n            <Logo size=\"sm\" priority />\n          </Link>\n          <nav\n            className=\"flex items-center gap-2 sm:gap-4\"\n            role=\"navigation\"\n            aria-label=\"Main navigation\"\n          >\n            {user && (\n              <>\n                <OfflineStatusIndicator\n                  variant=\"compact\"\n                  className=\"hidden sm:flex\"\n                />\n                <div className=\"hidden md:flex\">\n                  <PWAStatus />\n                </div>\n                <Link\n                  href=\"/profile\"\n                  className=\"touch-target text-sm sm:text-base text-foreground/80 hover:text-foreground transition-colors focus-ring\"\n                  aria-label=\"User profile\"\n                >\n                  Profile\n                </Link>\n                <Button\n                  variant=\"outline\"\n                  onClick={handleSignOut}\n                  className=\"touch-target text-sm sm:text-base focus-ring\"\n                  size=\"sm\"\n                  aria-label=\"Sign out of application\"\n                >\n                  <span className=\"hidden sm:inline\">Sign Out</span>\n                  <span className=\"sm:hidden\">Out</span>\n                </Button>\n              </>\n            )}\n          </nav>\n        </div>\n      </div>\n    </header>\n  );\n}\n","\n\"use client\";\n\nimport { useAuth } from \"@/lib/hooks/useAuth\";\nimport { createContext } from \"react\";\n\nexport const AuthContext = createContext<ReturnType<typeof useAuth>>({ user: null, loading: true });\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const auth = useAuth();\n  return <AuthContext.Provider value={auth}>{children}</AuthContext.Provider>;\n}\n","import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground shadow hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2\",\n        sm: \"h-8 rounded-md px-3 text-xs\",\n        lg: \"h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n);\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean;\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\";\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    );\n  }\n);\nButton.displayName = \"Button\";\n\nexport { Button, buttonVariants };\n","import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","import * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { OptimizedImage } from \"./optimized-image\";\n\ninterface LogoProps {\n  size?: \"sm\" | \"md\" | \"lg\" | \"xl\";\n  className?: string;\n  priority?: boolean;\n  showText?: boolean;\n}\n\nconst sizeMap = {\n  sm: { width: 32, height: 32, textSize: \"text-lg\" },\n  md: { width: 48, height: 48, textSize: \"text-xl\" },\n  lg: { width: 64, height: 64, textSize: \"text-2xl\" },\n  xl: { width: 96, height: 96, textSize: \"text-3xl\" },\n};\n\nexport function Logo({\n  size = \"md\",\n  className,\n  priority = false,\n  showText = true,\n}: LogoProps) {\n  const { width, height, textSize } = sizeMap[size];\n\n  return (\n    <div className={cn(\"flex items-center gap-3\", className)}>\n      <OptimizedImage\n        src=\"/DMDL_logo.png\"\n        alt=\"DMDL Schools-In Logo\"\n        width={width}\n        height={height}\n        priority={priority}\n        quality={90}\n        className=\"object-contain\"\n        loading={priority ? \"eager\" : \"lazy\"}\n      />\n      {showText && (\n        <span className={cn(\"font-bold text-brand-primary\", textSize)}>\n          Schools-In\n        </span>\n      )}\n    </div>\n  );\n}\n\n// Brand header component for pages\nexport function BrandHeader({\n  title,\n  subtitle,\n  className,\n}: {\n  title?: string;\n  subtitle?: string;\n  className?: string;\n}) {\n  return (\n    <div className={cn(\"text-center space-y-4\", className)}>\n      <Logo size=\"xl\" className=\"justify-center\" />\n      {title && (\n        <div className=\"space-y-2\">\n          <h1 className=\"text-3xl sm:text-4xl font-bold text-gray-900\">\n            {title}\n          </h1>\n          {subtitle && (\n            <p className=\"text-muted-foreground text-sm sm:text-base\">\n              {subtitle}\n            </p>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","'use client';\n\nimport React, { useState, useCallback } from 'react';\nimport Image from 'next/image';\nimport { cn } from '@/lib/utils';\nimport { Skeleton } from './skeleton';\n\ninterface OptimizedImageProps {\n  src: string;\n  alt: string;\n  width: number;\n  height: number;\n  priority?: boolean;\n  quality?: number;\n  placeholder?: 'blur' | 'empty';\n  blurDataURL?: string;\n  sizes?: string;\n  fill?: boolean;\n  className?: string;\n  fallback?: React.ReactNode;\n  loading?: 'lazy' | 'eager';\n  onLoad?: () => void;\n  onError?: () => void;\n}\n\nexport function OptimizedImage({\n  src,\n  alt,\n  width,\n  height,\n  priority = false,\n  quality = 75,\n  placeholder = 'empty',\n  blurDataURL,\n  sizes,\n  fill = false,\n  className,\n  fallback,\n  loading = 'lazy',\n  onLoad,\n  onError,\n}: OptimizedImageProps) {\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [imageError, setImageError] = useState(false);\n\n  const handleLoad = useCallback(() => {\n    setImageLoaded(true);\n    onLoad?.();\n  }, [onLoad]);\n\n  const handleError = useCallback(() => {\n    setImageError(true);\n    onError?.();\n  }, [onError]);\n\n  // Show fallback if there's an error and fallback is provided\n  if (imageError && fallback) {\n    return <>{fallback}</>;\n  }\n\n  // Default fallback for broken images\n  if (imageError) {\n    return (\n      <div\n        className={cn(\n          \"flex items-center justify-center bg-gray-100 text-gray-400\",\n          className\n        )}\n        style={{ width: fill ? '100%' : width, height: fill ? '100%' : height }}\n      >\n        <svg\n          className=\"w-6 h-6\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          viewBox=\"0 0 24 24\"\n        >\n          <path\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            strokeWidth={2}\n            d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"\n          />\n        </svg>\n      </div>\n    );\n  }\n\n  return (\n    <div className={cn(\"relative\", className)}>\n      {/* Loading skeleton */}\n      {!imageLoaded && (\n        <div className=\"absolute inset-0 z-10\">\n          <Skeleton\n            className={cn(\"w-full h-full\", {\n              \"absolute inset-0\": fill,\n            })}\n            style={{\n              width: fill ? '100%' : width,\n              height: fill ? '100%' : height,\n            }}\n          />\n        </div>\n      )}\n\n      <Image\n        src={src}\n        alt={alt}\n        width={fill ? undefined : width}\n        height={fill ? undefined : height}\n        fill={fill}\n        priority={priority}\n        quality={quality}\n        placeholder={placeholder}\n        blurDataURL={blurDataURL}\n        sizes={sizes}\n        loading={loading}\n        className={cn(\n          \"transition-opacity duration-200\",\n          imageLoaded ? \"opacity-100\" : \"opacity-0\"\n        )}\n        onLoad={handleLoad}\n        onError={handleError}\n      />\n    </div>\n  );\n}\n\n// Avatar-specific optimized image component\nexport function OptimizedAvatar({\n  src,\n  alt,\n  size = 40,\n  className,\n  fallback,\n}: {\n  src: string;\n  alt: string;\n  size?: number;\n  className?: string;\n  fallback?: React.ReactNode;\n}) {\n  const defaultFallback = (\n    <div\n      className={cn(\n        \"rounded-full bg-gray-300 flex items-center justify-center text-gray-600\",\n        className\n      )}\n      style={{ width: size, height: size }}\n    >\n      <svg\n        className=\"w-1/2 h-1/2\"\n        fill=\"currentColor\"\n        viewBox=\"0 0 24 24\"\n      >\n        <path d=\"M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z\" />\n      </svg>\n    </div>\n  );\n\n  return (\n    <OptimizedImage\n      src={src}\n      alt={alt}\n      width={size}\n      height={size}\n      className={cn(\"rounded-full\", className)}\n      quality={85}\n      placeholder=\"blur\"\n      blurDataURL=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAhEAACAQMDBQAAAAAAAAAAAAABAgMABAUGIWGRkqGx0f/EABUBAQEAAAAAAAAAAAAAAAAAAAMF/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAECEgMRkf/aAAwDAQACEQMRAD8AltJagyeH0AthI5xdrLcNM91BF5pX2HaH9bcfaSXWGaRmknyLhxEDnGFELMO4==\"\n      fallback={fallback || defaultFallback}\n    />\n  );\n}\n\n// Hero image component with advanced lazy loading\nexport function OptimizedHeroImage({\n  src,\n  alt,\n  className,\n  priority = true,\n}: {\n  src: string;\n  alt: string;\n  className?: string;\n  priority?: boolean;\n}) {\n  return (\n    <OptimizedImage\n      src={src}\n      alt={alt}\n      width={1920}\n      height={1080}\n      priority={priority}\n      quality={90}\n      sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 70vw\"\n      className={className}\n      placeholder=\"blur\"\n      blurDataURL=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAhEAACAQMDBQAAAAAAAAAAAAABAgMABAUGIWGRkqGx0f/EABUBAQEAAAAAAAAAAAAAAAAAAAMF/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAECEgMRkf/aAAwDAQACEQMRAD8AltJagyeH0AthI5xdrLcNM91BF5pX2HaH9bcfaSXWGaRmknyLhxEDnGFELMO4=\"\n    />\n  );\n}\n","\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","import * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  );\n}\n\n// Common skeleton patterns for consistent use\nfunction SkeletonText({\n  lines = 1,\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement> & { lines?: number }) {\n  return (\n    <div className={cn(\"space-y-2\", className)} {...props}>\n      {Array.from({ length: lines }).map((_, i) => (\n        <Skeleton\n          key={i}\n          className={cn(\n            \"h-4\",\n            i === lines - 1 && lines > 1 ? \"w-3/4\" : \"w-full\"\n          )}\n        />\n      ))}\n    </div>\n  );\n}\n\nfunction SkeletonCard({\n  showImage = true,\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement> & { showImage?: boolean }) {\n  return (\n    <div className={cn(\"card-brand space-y-4\", className)} {...props}>\n      {showImage && <Skeleton className=\"h-32 w-full rounded-lg\" />}\n      <div className=\"space-y-3\">\n        <Skeleton className=\"h-6 w-3/4\" />\n        <SkeletonText lines={2} />\n        <div className=\"flex space-x-2\">\n          <Skeleton className=\"h-8 w-20\" />\n          <Skeleton className=\"h-8 w-16\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction SkeletonTable({\n  rows = 5,\n  cols = 4,\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement> & { rows?: number; cols?: number }) {\n  return (\n    <div className={cn(\"space-y-4\", className)} {...props}>\n      {/* Header */}\n      <div\n        className=\"grid gap-4\"\n        style={{ gridTemplateColumns: `repeat(${cols}, 1fr)` }}\n      >\n        {Array.from({ length: cols }).map((_, i) => (\n          <Skeleton key={`header-${i}`} className=\"h-8\" />\n        ))}\n      </div>\n      {/* Rows */}\n      {Array.from({ length: rows }).map((_, rowIndex) => (\n        <div\n          key={`row-${rowIndex}`}\n          className=\"grid gap-4\"\n          style={{ gridTemplateColumns: `repeat(${cols}, 1fr)` }}\n        >\n          {Array.from({ length: cols }).map((_, colIndex) => (\n            <Skeleton key={`cell-${rowIndex}-${colIndex}`} className=\"h-6\" />\n          ))}\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction SkeletonList({\n  items = 5,\n  showAvatar = true,\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement> & {\n  items?: number;\n  showAvatar?: boolean;\n}) {\n  return (\n    <div className={cn(\"space-y-4\", className)} {...props}>\n      {Array.from({ length: items }).map((_, i) => (\n        <div key={i} className=\"flex items-center space-x-4\">\n          {showAvatar && <Skeleton className=\"h-12 w-12 rounded-full\" />}\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/2\" />\n          </div>\n          <Skeleton className=\"h-8 w-20\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction SkeletonForm({\n  fields = 4,\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement> & { fields?: number }) {\n  return (\n    <div className={cn(\"space-y-6\", className)} {...props}>\n      {Array.from({ length: fields }).map((_, i) => (\n        <div key={i} className=\"space-y-2\">\n          <Skeleton className=\"h-4 w-24\" />\n          <Skeleton className=\"h-10 w-full\" />\n        </div>\n      ))}\n      <div className=\"flex justify-end space-x-2\">\n        <Skeleton className=\"h-10 w-20\" />\n        <Skeleton className=\"h-10 w-24\" />\n      </div>\n    </div>\n  );\n}\n\nfunction SkeletonButton({\n  size = \"default\",\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement> & {\n  size?: \"sm\" | \"default\" | \"lg\";\n}) {\n  const sizeClasses = {\n    sm: \"h-8 w-16\",\n    default: \"h-10 w-20\",\n    lg: \"h-12 w-24\",\n  };\n\n  return (\n    <Skeleton\n      className={cn(\"rounded-md\", sizeClasses[size], className)}\n      {...props}\n    />\n  );\n}\n\nexport {\n  Skeleton,\n  SkeletonText,\n  SkeletonCard,\n  SkeletonTable,\n  SkeletonList,\n  SkeletonForm,\n  SkeletonButton,\n};\n","\"use client\";\n\nimport * as React from \"react\";\n\n// Screen Reader utilities\nexport function ScreenReaderOnly({\n  children,\n  as: Component = \"span\",\n  ...props\n}: {\n  children: React.ReactNode;\n  as?: React.ElementType;\n} & React.HTMLAttributes<HTMLElement>) {\n  return (\n    <Component className=\"sr-only\" {...props}>\n      {children}\n    </Component>\n  );\n}\n\n// Live region for dynamic announcements\nexport function LiveRegion({\n  children,\n  politeness = \"polite\",\n  atomic = false,\n  className,\n  ...props\n}: {\n  children: React.ReactNode;\n  politeness?: \"off\" | \"polite\" | \"assertive\";\n  atomic?: boolean;\n} & React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      aria-live={politeness}\n      aria-atomic={atomic}\n      className={`sr-only ${className || \"\"}`}\n      {...props}\n    >\n      {children}\n    </div>\n  );\n}\n\n// Skip to content link\nexport function SkipToContent({\n  targetId = \"main-content\",\n  className,\n  children = \"Skip to main content\",\n}: {\n  targetId?: string;\n  className?: string;\n  children?: React.ReactNode;\n}) {\n  const handleClick = (e: React.MouseEvent<HTMLAnchorElement>) => {\n    // Only run on client side\n    if (typeof window === \"undefined\") return;\n\n    // Ensure the target element receives focus\n    const target = document.getElementById(targetId);\n    if (target) {\n      target.focus();\n      target.scrollIntoView({ behavior: \"smooth\" });\n    }\n  };\n\n  return (\n    <a\n      href={`#${targetId}`}\n      className={`\n        absolute left-[-9999px] top-auto w-1 h-1 overflow-hidden z-[999999]\n        focus:fixed focus:top-4 focus:left-4 focus:w-auto focus:h-auto \n        focus:bg-brand-primary focus:text-white focus:px-4 focus:py-2 \n        focus:rounded-md focus:no-underline focus:z-[999999]\n        ${className || \"\"}\n      `}\n      onClick={handleClick}\n    >\n      {children}\n    </a>\n  );\n}\n\n// Focus trap for modals and dialogs\nexport function useFocusTrap(containerRef: React.RefObject<HTMLElement>) {\n  React.useEffect(() => {\n    // Only run on client side\n    if (typeof window === \"undefined\") return;\n\n    const container = containerRef.current;\n    if (!container) return;\n\n    const focusableElements = container.querySelectorAll(\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n\n    const firstElement = focusableElements[0] as HTMLElement;\n    const lastElement = focusableElements[\n      focusableElements.length - 1\n    ] as HTMLElement;\n\n    const handleTabKey = (e: KeyboardEvent) => {\n      if (e.key !== \"Tab\") return;\n\n      if (e.shiftKey) {\n        if (document.activeElement === firstElement) {\n          lastElement?.focus();\n          e.preventDefault();\n        }\n      } else {\n        if (document.activeElement === lastElement) {\n          firstElement?.focus();\n          e.preventDefault();\n        }\n      }\n    };\n\n    container.addEventListener(\"keydown\", handleTabKey);\n    firstElement?.focus();\n\n    return () => {\n      container.removeEventListener(\"keydown\", handleTabKey);\n    };\n  }, [containerRef]);\n}\n\n// Announce content changes to screen readers\nexport function useAnnouncement() {\n  const announce = React.useCallback(\n    (message: string, politeness: \"polite\" | \"assertive\" = \"polite\") => {\n      const region = document.getElementById(\"announcement-region\");\n      if (region) {\n        // By creating a new element each time, we ensure that screen readers announce the message,\n        // even if the text content is the same as the previous one.\n        const newAnnouncement = document.createElement(\"div\");\n        newAnnouncement.textContent = message;\n        newAnnouncement.setAttribute(\"role\", \"log\");\n        newAnnouncement.setAttribute(\"aria-live\", politeness);\n        newAnnouncement.setAttribute(\"aria-atomic\", \"true\");\n\n        // Clear previous announcements\n        while (region.firstChild) {\n          region.removeChild(region.firstChild);\n        }\n\n        region.appendChild(newAnnouncement);\n\n        // Clean up the announcement after a short delay to avoid cluttering the DOM\n        setTimeout(() => {\n          if (region.contains(newAnnouncement)) {\n            region.removeChild(newAnnouncement);\n          }\n        }, 5000); // Keep it long enough for screen readers to pick up\n      }\n    },\n    []\n  );\n\n  return { announce };\n}\n\n// High contrast mode detection\nexport function useHighContrastMode() {\n  const [isHighContrast, setIsHighContrast] = React.useState(false);\n\n  React.useEffect(() => {\n    const mediaQuery = window.matchMedia(\"(prefers-contrast: high)\");\n    setIsHighContrast(mediaQuery.matches);\n\n    const handleChange = (e: MediaQueryListEvent) => {\n      setIsHighContrast(e.matches);\n    };\n\n    mediaQuery.addEventListener(\"change\", handleChange);\n    return () => mediaQuery.removeEventListener(\"change\", handleChange);\n  }, []);\n\n  return isHighContrast;\n}\n\n// Reduced motion preference detection\nexport function useReducedMotion() {\n  const [prefersReducedMotion, setPrefersReducedMotion] = React.useState(false);\n\n  React.useEffect(() => {\n    const mediaQuery = window.matchMedia(\"(prefers-reduced-motion: reduce)\");\n    setPrefersReducedMotion(mediaQuery.matches);\n\n    const handleChange = (e: MediaQueryListEvent) => {\n      setPrefersReducedMotion(e.matches);\n    };\n\n    mediaQuery.addEventListener(\"change\", handleChange);\n    return () => mediaQuery.removeEventListener(\"change\", handleChange);\n  }, []);\n\n  return prefersReducedMotion;\n}\n\n// Keyboard navigation helpers\nexport function useKeyboardNavigation(\n  items: React.RefObject<HTMLElement>[],\n  options: {\n    wrap?: boolean;\n    orientation?: \"horizontal\" | \"vertical\";\n    onSelect?: (index: number) => void;\n  } = {}\n) {\n  const { wrap = true, orientation = \"vertical\", onSelect } = options;\n  const [activeIndex, setActiveIndex] = React.useState(0);\n\n  const handleKeyDown = React.useCallback(\n    (e: KeyboardEvent) => {\n      const isVertical = orientation === \"vertical\";\n      const nextKey = isVertical ? \"ArrowDown\" : \"ArrowRight\";\n      const prevKey = isVertical ? \"ArrowUp\" : \"ArrowLeft\";\n\n      switch (e.key) {\n        case nextKey:\n          e.preventDefault();\n          setActiveIndex((prev) => {\n            const next = prev + 1;\n            if (next >= items.length) {\n              return wrap ? 0 : prev;\n            }\n            return next;\n          });\n          break;\n        case prevKey:\n          e.preventDefault();\n          setActiveIndex((prev) => {\n            const next = prev - 1;\n            if (next < 0) {\n              return wrap ? items.length - 1 : prev;\n            }\n            return next;\n          });\n          break;\n        case \"Home\":\n          e.preventDefault();\n          setActiveIndex(0);\n          break;\n        case \"End\":\n          e.preventDefault();\n          setActiveIndex(items.length - 1);\n          break;\n        case \"Enter\":\n        case \" \":\n          e.preventDefault();\n          onSelect?.(activeIndex);\n          break;\n      }\n    },\n    [items.length, wrap, orientation, onSelect, activeIndex]\n  );\n\n  React.useEffect(() => {\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  }, [handleKeyDown]);\n\n  React.useEffect(() => {\n    const activeElement = items[activeIndex]?.current;\n    if (activeElement) {\n      activeElement.focus();\n    }\n  }, [activeIndex, items]);\n\n  return { activeIndex, setActiveIndex };\n}\n\n// ARIA helpers\nexport const ARIA = {\n  // Generate unique IDs for ARIA relationships\n  useId: (prefix: string = \"id\") => {\n    const [id] = React.useState(\n      () => `${prefix}-${Math.random().toString(36).substr(2, 9)}`\n    );\n    return id;\n  },\n\n  // Common ARIA attributes for form controls\n  getFormControlProps: (\n    id: string,\n    options: {\n      label?: string;\n      description?: string;\n      error?: string;\n      required?: boolean;\n      invalid?: boolean;\n    } = {}\n  ) => {\n    const { label, description, error, required, invalid } = options;\n\n    return {\n      id,\n      \"aria-label\": label,\n      \"aria-describedby\":\n        [description && `${id}-description`, error && `${id}-error`]\n          .filter(Boolean)\n          .join(\" \") || undefined,\n      \"aria-invalid\": invalid,\n      \"aria-required\": required,\n    };\n  },\n\n  // Common ARIA attributes for buttons\n  getButtonProps: (\n    options: {\n      pressed?: boolean;\n      expanded?: boolean;\n      controls?: string;\n      describedBy?: string;\n      label?: string;\n    } = {}\n  ) => {\n    const { pressed, expanded, controls, describedBy, label } = options;\n\n    return {\n      \"aria-pressed\": pressed,\n      \"aria-expanded\": expanded,\n      \"aria-controls\": controls,\n      \"aria-describedby\": describedBy,\n      \"aria-label\": label,\n    };\n  },\n\n  // Common ARIA attributes for lists\n  getListProps: (itemCount: number) => ({\n    role: \"list\",\n    \"aria-setsize\": itemCount,\n  }),\n\n  getListItemProps: (index: number, itemCount: number) => ({\n    role: \"listitem\",\n    \"aria-setsize\": itemCount,\n    \"aria-posinset\": index + 1,\n  }),\n\n  // Additional utility methods\n  live: (politeness: \"polite\" | \"assertive\" | \"off\" = \"polite\") => ({\n    \"aria-live\": politeness,\n    \"aria-atomic\": \"true\",\n  }),\n  label: (text: string) => ({\n    \"aria-label\": text,\n  }),\n  describedBy: (id: string) => ({\n    \"aria-describedby\": id,\n  }),\n};\n\n// Standalone announcement region for screen readers\nexport const AnnouncementRegion = () => (\n  <div\n    id=\"announcement-region\"\n    style={{\n      position: \"absolute\",\n      width: \"1px\",\n      height: \"1px\",\n      padding: \"0\",\n      margin: \"-1px\",\n      overflow: \"hidden\",\n      clip: \"rect(0, 0, 0, 0)\",\n      whiteSpace: \"nowrap\",\n      border: \"0\",\n    }}\n  />\n);\n\nexport default {\n  ScreenReaderOnly,\n  LiveRegion,\n  SkipToContent,\n  useFocusTrap,\n  useAnnouncement,\n  useHighContrastMode,\n  useReducedMotion,\n  useKeyboardNavigation,\n  ARIA,\n};\n","// Firebase Authentication service and utilities\n\nimport { \n  signInWithEmailAndPassword,\n  createUserWithEmailAndPassword,\n  signInWithPopup,\n  GoogleAuthProvider,\n  signOut,\n  User,\n  UserCredential\n} from 'firebase/auth';\nimport { auth } from '../../../firebase.config';\n\n// Google Auth Provider\nconst googleProvider = new GoogleAuthProvider();\n\n// Sign in with email and password\nexport const signInWithEmail = async (email: string, password: string): Promise<UserCredential> => {\n  return await signInWithEmailAndPassword(auth, email, password);\n};\n\n// Create account with email and password\nexport const createAccount = async (email: string, password: string): Promise<UserCredential> => {\n  return await createUserWithEmailAndPassword(auth, email, password);\n};\n\n// Sign in with Google\nexport const signInWithGoogle = async (): Promise<UserCredential> => {\n  return await signInWithPopup(auth, googleProvider);\n};\n\n// Sign out\nexport const logOut = async (): Promise<void> => {\n  return await signOut(auth);\n};\n\n// Get current user\nexport const getCurrentUser = (): User | null => {\n  return auth.currentUser;\n};\n","// Firestore database service and CRUD operations\n\nimport {\n  collection,\n  doc,\n  getDocs,\n  getDoc,\n  addDoc,\n  updateDoc,\n  deleteDoc,\n  query,\n  where,\n  orderBy,\n  limit,\n  Timestamp,\n  DocumentData,\n  QuerySnapshot,\n  DocumentSnapshot,\n} from \"firebase/firestore\";\nimport { db } from \"../../../firebase.config\";\nimport { User, Location, Session } from \"./types\";\n\n// Collection names\nexport const COLLECTIONS = {\n  USERS: \"users\",\n  SESSIONS: \"sessions\",\n  LOCATIONS: \"locations\",\n} as const;\n\n// Generic CRUD operations\nexport const createDocument = async <T extends object>(\n  collectionName: string,\n  data: T\n): Promise<string> => {\n  const docRef = await addDoc(collection(db, collectionName), data);\n  return docRef.id;\n};\n\nexport const getDocument = async <T>(\n  collectionName: string,\n  docId: string\n): Promise<T | null> => {\n  const docSnap = await getDoc(doc(db, collectionName, docId));\n  if (docSnap.exists()) {\n    return { id: docSnap.id, ...docSnap.data() } as T;\n  }\n  return null;\n};\n\nexport const updateDocument = async (\n  collectionName: string,\n  docId: string,\n  data: Record<string, any>\n): Promise<void> => {\n  await updateDoc(doc(db, collectionName, docId), data);\n};\n\nexport const deleteDocument = async (\n  collectionName: string,\n  docId: string\n): Promise<void> => {\n  await deleteDoc(doc(db, collectionName, docId));\n};\n\nexport const getCollection = async <T>(\n  collectionName: string\n): Promise<T[]> => {\n  const querySnapshot = await getDocs(collection(db, collectionName));\n  return querySnapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() } as T));\n};\n\n// Specific queries\nexport const getUserByEmail = async (email: string): Promise<User | null> => {\n  const q = query(\n    collection(db, COLLECTIONS.USERS),\n    where(\"email\", \"==\", email)\n  );\n  const querySnapshot = await getDocs(q);\n  if (querySnapshot.empty) {\n    return null;\n  }\n  const doc = querySnapshot.docs[0];\n  return { uid: doc.id, ...doc.data() } as User;\n};\n\nexport const getLocationsByProvider = async (\n  providerId: string\n): Promise<Location[]> => {\n  const q = query(\n    collection(db, COLLECTIONS.LOCATIONS),\n    where(\"assignedProviders\", \"array-contains\", providerId)\n  );\n  const querySnapshot = await getDocs(q);\n  return querySnapshot.docs.map(\n    (doc) => ({ id: doc.id, ...doc.data() } as Location)\n  );\n};\n\nexport const getSessionsByUser = async (\n  userId: string,\n  page: number = 1,\n  pageSize: number = 10,\n  filters?: {\n    schoolId?: string;\n    startDate?: Date;\n    endDate?: Date;\n  }\n): Promise<{ sessions: Session[]; total: number; hasMore: boolean }> => {\n  // Build query constraints\n  const constraints = [where(\"userId\", \"==\", userId)];\n\n  if (filters?.schoolId) {\n    constraints.push(where(\"schoolId\", \"==\", filters.schoolId));\n  }\n\n  // First, get total count with filters\n  const countQuery = query(\n    collection(db, COLLECTIONS.SESSIONS),\n    ...constraints\n  );\n  const countSnapshot = await getDocs(countQuery);\n  const total = countSnapshot.size;\n\n  // Calculate offset for pagination\n  const offset = (page - 1) * pageSize;\n\n  // Build main query with filters\n  const mainConstraints = [...constraints];\n\n  // Add date range filters if provided\n  if (filters?.startDate) {\n    mainConstraints.push(\n      where(\"checkInTime\", \">=\", Timestamp.fromDate(filters.startDate))\n    );\n  }\n  if (filters?.endDate) {\n    // Set end date to end of day\n    const endOfDay = new Date(filters.endDate);\n    endOfDay.setHours(23, 59, 59, 999);\n    mainConstraints.push(\n      where(\"checkInTime\", \"<=\", Timestamp.fromDate(endOfDay))\n    );\n  }\n\n  // Get paginated results\n  const q = query(\n    collection(db, COLLECTIONS.SESSIONS),\n    ...mainConstraints,\n    orderBy(\"checkInTime\", \"desc\"),\n    limit(pageSize + offset + 1) // Get one extra to check if there are more\n  );\n\n  const querySnapshot = await getDocs(q);\n  const allDocs = querySnapshot.docs;\n\n  // Apply offset and limit\n  const sessions = allDocs\n    .slice(offset, offset + pageSize)\n    .map((doc) => ({ id: doc.id, ...doc.data() } as Session));\n\n  const hasMore = allDocs.length > offset + pageSize;\n\n  return { sessions, total, hasMore };\n};\n\nexport const getActiveSessions = async (): Promise<Session[]> => {\n  const q = query(\n    collection(db, COLLECTIONS.SESSIONS),\n    where(\"status\", \"==\", \"active\")\n  );\n  const querySnapshot = await getDocs(q);\n  return querySnapshot.docs.map(\n    (doc) => ({ id: doc.id, ...doc.data() } as Session)\n  );\n};\n","/**\n * Production-specific Firebase configuration and monitoring setup\n */\n\nimport { analytics, performance } from \"../../../firebase.config\";\n\n// Analytics event types\nexport const ANALYTICS_EVENTS = {\n  // Authentication events\n  LOGIN: \"login\",\n  LOGOUT: \"logout\",\n  SIGNUP: \"sign_up\",\n\n  // Session events\n  SESSION_START: \"session_start\",\n  SESSION_END: \"session_end\",\n  SESSION_PAUSE: \"session_pause\",\n  SESSION_RESUME: \"session_resume\",\n\n  // Location events\n  LOCATION_CHECK_IN: \"location_check_in\",\n  LOCATION_CHECK_OUT: \"location_check_out\",\n  LOCATION_VIEW: \"location_view\",\n\n  // Search and navigation\n  SEARCH: \"search\",\n  PAGE_VIEW: \"page_view\",\n\n  // Error events\n  ERROR: \"error\",\n  CACHE_ERROR: \"cache_error\",\n  NETWORK_ERROR: \"network_error\",\n\n  // Performance events\n  PERFORMANCE_METRIC: \"performance_metric\",\n  CACHE_HIT: \"cache_hit\",\n  CACHE_MISS: \"cache_miss\",\n} as const;\n\n// Custom performance metrics\nexport const PERFORMANCE_METRICS = {\n  CHECK_IN_DURATION: \"check_in_duration\",\n  LOCATION_LOAD_TIME: \"location_load_time\",\n  SESSION_LIST_LOAD: \"session_list_load\",\n  USER_SEARCH_TIME: \"user_search_time\",\n  CACHE_RESPONSE_TIME: \"cache_response_time\",\n} as const;\n\n// Export the class (removing duplicate export at end)\nexport class ProductionMonitoring {\n  // Track user events\n  static trackEvent(\n    eventName: string,\n    parameters: Record<string, any> = {},\n    userProperties: Record<string, any> = {}\n  ): void {\n    if (typeof window === \"undefined\" || !analytics) return;\n\n    try {\n      // Log analytics event\n      analytics.logEvent(eventName, {\n        ...parameters,\n        app_version: process.env.NEXT_PUBLIC_APP_VERSION || \"1.0.0\",\n        environment: \"production\",\n        timestamp: Date.now(),\n      });\n\n      // Set user properties if provided\n      if (Object.keys(userProperties).length > 0) {\n        Object.entries(userProperties).forEach(([key, value]) => {\n          analytics.setUserProperty(key, value);\n        });\n      }\n    } catch (error) {\n      console.warn(\"Analytics tracking failed:\", error);\n    }\n  }\n\n  // Track custom performance metrics\n  static trackPerformance(\n    metricName: string,\n    value: number,\n    attributes: Record<string, string> = {}\n  ): void {\n    if (typeof window === \"undefined\" || !performance) return;\n\n    try {\n      const trace = performance.trace(metricName);\n\n      // Add custom attributes\n      Object.entries(attributes).forEach(([key, val]) => {\n        trace.putAttribute(key, val);\n      });\n\n      // Record the metric value\n      trace.putMetric(metricName, Math.round(value));\n      trace.stop();\n\n      // Also track as analytics event\n      this.trackEvent(ANALYTICS_EVENTS.PERFORMANCE_METRIC, {\n        metric_name: metricName,\n        metric_value: value,\n        ...attributes,\n      });\n    } catch (error) {\n      console.warn(\"Performance tracking failed:\", error);\n    }\n  }\n\n  // Track user sessions\n  static trackUserSession(\n    userId: string,\n    action: \"start\" | \"end\" | \"pause\" | \"resume\",\n    sessionData: Record<string, any> = {}\n  ): void {\n    const eventMap = {\n      start: ANALYTICS_EVENTS.SESSION_START,\n      end: ANALYTICS_EVENTS.SESSION_END,\n      pause: ANALYTICS_EVENTS.SESSION_PAUSE,\n      resume: ANALYTICS_EVENTS.SESSION_RESUME,\n    };\n\n    this.trackEvent(\n      eventMap[action],\n      {\n        user_id: userId,\n        session_duration: sessionData.duration,\n        location_id: sessionData.locationId,\n        session_type: sessionData.type || \"check_in\",\n      },\n      {\n        user_role: sessionData.userRole,\n        total_sessions: sessionData.totalSessions,\n      }\n    );\n  }\n\n  // Track check-in/check-out events\n  static trackLocationEvent(\n    action: \"check_in\" | \"check_out\" | \"view\",\n    locationData: Record<string, any>,\n    userContext: Record<string, any> = {}\n  ): void {\n    const eventName =\n      action === \"check_in\"\n        ? ANALYTICS_EVENTS.LOCATION_CHECK_IN\n        : action === \"check_out\"\n        ? ANALYTICS_EVENTS.LOCATION_CHECK_OUT\n        : ANALYTICS_EVENTS.LOCATION_VIEW;\n\n    this.trackEvent(\n      eventName,\n      {\n        location_id: locationData.locationId,\n        location_name: locationData.locationName,\n        accuracy: locationData.accuracy,\n        distance_from_location: locationData.distance,\n        gps_time: locationData.gpsTime,\n      },\n      {\n        user_role: userContext.role,\n        provider_experience: userContext.experience,\n      }\n    );\n  }\n\n  // Track errors with context\n  static trackError(\n    error: Error,\n    context: Record<string, any> = {},\n    severity: \"low\" | \"medium\" | \"high\" | \"critical\" = \"medium\"\n  ): void {\n    if (typeof window !== \"undefined\") {\n      this.trackEvent(ANALYTICS_EVENTS.ERROR, {\n        error_message: error.message,\n        error_stack: error.stack?.substring(0, 500), // Truncate for analytics\n        error_context: JSON.stringify(context),\n        error_severity: severity,\n        user_agent:\n          typeof navigator !== \"undefined\" ? navigator.userAgent : \"unknown\",\n        url: typeof window !== \"undefined\" ? window.location.href : \"server\",\n      });\n    }\n\n    // Also send to performance monitoring as an error\n    if (performance) {\n      try {\n        const trace = performance.trace(`error_${severity}`);\n        trace.putAttribute(\"error_type\", error.name);\n        trace.putAttribute(\"error_message\", error.message.substring(0, 100));\n        trace.stop();\n      } catch (perfError) {\n        console.warn(\"Performance error tracking failed:\", perfError);\n      }\n    }\n  }\n\n  // Track cache performance\n  static trackCachePerformance(\n    operation: \"hit\" | \"miss\" | \"write\" | \"invalidate\",\n    details: Record<string, any> = {}\n  ): void {\n    const eventName =\n      operation === \"hit\"\n        ? ANALYTICS_EVENTS.CACHE_HIT\n        : ANALYTICS_EVENTS.CACHE_MISS;\n\n    this.trackEvent(eventName, {\n      cache_operation: operation,\n      cache_type: details.cacheType,\n      data_type: details.dataType,\n      response_time: details.responseTime,\n    });\n  }\n\n  // Track search operations\n  static trackSearch(\n    searchTerm: string,\n    searchType: \"users\" | \"locations\" | \"sessions\",\n    results: {\n      count: number;\n      loadTime: number;\n      fromCache: boolean;\n    }\n  ): void {\n    this.trackEvent(ANALYTICS_EVENTS.SEARCH, {\n      search_term: searchTerm.substring(0, 50), // Truncate for privacy\n      search_type: searchType,\n      results_count: results.count,\n      load_time: results.loadTime,\n      from_cache: results.fromCache,\n    });\n  }\n\n  // Set user context for analytics\n  static setUserContext(user: {\n    uid: string;\n    role: \"provider\" | \"admin\";\n    displayName?: string;\n    email?: string;\n  }): void {\n    if (typeof window === \"undefined\" || !analytics) return;\n\n    try {\n      // Set user ID for analytics\n      analytics.setUserId(user.uid);\n\n      // Set user properties\n      analytics.setUserProperties({\n        user_role: user.role,\n        user_type: user.role,\n        display_name: user.displayName,\n      });\n    } catch (error) {\n      console.warn(\"Failed to set user context:\", error);\n    }\n  }\n\n  // Initialize production monitoring\n  static initialize(): void {\n    if (typeof window === \"undefined\") return;\n\n    // Track page views\n    this.trackEvent(ANALYTICS_EVENTS.PAGE_VIEW, {\n      page_title: document.title,\n      page_location: window.location.href,\n      page_path: window.location.pathname,\n    });\n\n    // Monitor performance\n    this.setupPerformanceMonitoring();\n\n    // Monitor errors\n    this.setupErrorMonitoring();\n\n    console.log(\" Production monitoring initialized\");\n  }\n\n  // Setup performance monitoring\n  private static setupPerformanceMonitoring(): void {\n    if (typeof window === \"undefined\" || !performance) return;\n\n    // Monitor page load performance\n    window.addEventListener(\"load\", () => {\n      setTimeout(() => {\n        const navigation = performance.getEntriesByType(\n          \"navigation\"\n        )[0] as PerformanceNavigationTiming;\n\n        if (navigation) {\n          this.trackPerformance(\n            \"page_load_time\",\n            navigation.loadEventEnd - navigation.fetchStart,\n            {\n              page: window.location.pathname,\n            }\n          );\n        }\n      }, 1000);\n    });\n\n    // Monitor largest contentful paint\n    if (\"web-vitals\" in window) {\n      import(\"web-vitals\").then(({ onLCP, onINP, onCLS, onFCP, onTTFB }) => {\n        onLCP((metric) => {\n          this.trackPerformance(\"lcp\", metric.value, {\n            page: window.location.pathname,\n            rating: metric.rating,\n          });\n        });\n\n        onINP((metric) => {\n          this.trackPerformance(\"inp\", metric.value, {\n            page: window.location.pathname,\n            rating: metric.rating,\n          });\n        });\n\n        onCLS((metric) => {\n          this.trackPerformance(\"cls\", metric.value * 1000, {\n            // Convert to milliseconds\n            page: window.location.pathname,\n            rating: metric.rating,\n          });\n        });\n      });\n    }\n  }\n\n  // Setup error monitoring\n  private static setupErrorMonitoring(): void {\n    // Global error handler\n    if (typeof window === \"undefined\") return;\n    window.addEventListener(\"error\", (event) => {\n      this.trackError(\n        new Error(event.message),\n        {\n          filename: event.filename,\n          lineno: event.lineno,\n          colno: event.colno,\n          source: \"global_error_handler\",\n        },\n        \"high\"\n      );\n    });\n\n    // Unhandled promise rejection handler\n    window.addEventListener(\"unhandledrejection\", (event) => {\n      this.trackError(\n        new Error(event.reason),\n        {\n          source: \"unhandled_promise_rejection\",\n          promise: event.promise.toString().substring(0, 100),\n        },\n        \"high\"\n      );\n    });\n  }\n}\n\n// Removed auto-initialize to prevent SSR reference errors. Call ProductionMonitoring.initialize() from a client component (e.g., root layout effect) in production.\n\n// End of ProductionMonitoring class\n","/**\n * Custom hook for application analytics and performance monitoring\n */\n\nimport { useCallback, useEffect } from \"react\";\nimport { useAuth } from \"./useAuth\";\nimport {\n  ProductionMonitoring,\n  ANALYTICS_EVENTS,\n  PERFORMANCE_METRICS,\n} from \"../firebase/productionConfig\";\n\nexport interface AnalyticsOptions {\n  enableAutoTracking?: boolean;\n  enablePerformanceTracking?: boolean;\n  enableErrorTracking?: boolean;\n}\n\nexport function useAnalytics(options: AnalyticsOptions = {}) {\n  const { user } = useAuth();\n  const {\n    enableAutoTracking = true,\n    enablePerformanceTracking = true,\n    enableErrorTracking = true,\n  } = options;\n\n  // Set user context when user changes\n  useEffect(() => {\n    if (user && user.role && process.env.NODE_ENV === \"production\") {\n      ProductionMonitoring.setUserContext({\n        uid: user.uid,\n        role: user.role,\n        displayName: user.displayName || undefined,\n        email: user.email || undefined,\n      });\n    }\n  }, [user]);\n\n  // Track page views automatically\n  useEffect(() => {\n    if (enableAutoTracking && process.env.NODE_ENV === \"production\") {\n      const handleRouteChange = () => {\n        ProductionMonitoring.trackEvent(ANALYTICS_EVENTS.PAGE_VIEW, {\n          page_title: document.title,\n          page_location: window.location.href,\n          page_path: window.location.pathname,\n          user_role: user?.role,\n        });\n      };\n\n      // Track initial page load\n      handleRouteChange();\n\n      // Track route changes\n      window.addEventListener(\"popstate\", handleRouteChange);\n\n      return () => {\n        window.removeEventListener(\"popstate\", handleRouteChange);\n      };\n    }\n  }, [enableAutoTracking, user?.role]);\n\n  // Track user events\n  const trackEvent = useCallback(\n    (\n      eventName: string,\n      parameters: Record<string, any> = {},\n      userProperties: Record<string, any> = {}\n    ) => {\n      if (process.env.NODE_ENV === \"production\") {\n        ProductionMonitoring.trackEvent(\n          eventName,\n          {\n            ...parameters,\n            user_role: user?.role,\n          },\n          userProperties\n        );\n      }\n    },\n    [user?.role]\n  );\n\n  // Track performance metrics\n  const trackPerformance = useCallback(\n    (\n      metricName: string,\n      value: number,\n      attributes: Record<string, string> = {}\n    ) => {\n      if (enablePerformanceTracking && process.env.NODE_ENV === \"production\") {\n        ProductionMonitoring.trackPerformance(metricName, value, {\n          ...attributes,\n          user_role: user?.role || \"anonymous\",\n        });\n      }\n    },\n    [enablePerformanceTracking, user?.role]\n  );\n\n  // Track user sessions\n  const trackUserSession = useCallback(\n    (\n      action: \"start\" | \"end\" | \"pause\" | \"resume\",\n      sessionData: Record<string, any> = {}\n    ) => {\n      if (user && process.env.NODE_ENV === \"production\") {\n        ProductionMonitoring.trackUserSession(user.uid, action, {\n          ...sessionData,\n          userRole: user.role,\n        });\n      }\n    },\n    [user]\n  );\n\n  // Track location events\n  const trackLocationEvent = useCallback(\n    (\n      action: \"check_in\" | \"check_out\" | \"view\",\n      locationData: Record<string, any>,\n      userContext: Record<string, any> = {}\n    ) => {\n      if (process.env.NODE_ENV === \"production\") {\n        ProductionMonitoring.trackLocationEvent(action, locationData, {\n          ...userContext,\n          role: user?.role,\n        });\n      }\n    },\n    [user?.role]\n  );\n\n  // Track search operations\n  const trackSearch = useCallback(\n    (\n      searchTerm: string,\n      searchType: \"users\" | \"locations\" | \"sessions\",\n      results: { count: number; loadTime: number; fromCache: boolean }\n    ) => {\n      if (process.env.NODE_ENV === \"production\") {\n        ProductionMonitoring.trackSearch(searchTerm, searchType, results);\n      }\n    },\n    []\n  );\n\n  // Track errors\n  const trackError = useCallback(\n    (\n      error: Error,\n      context: Record<string, any> = {},\n      severity: \"low\" | \"medium\" | \"high\" | \"critical\" = \"medium\"\n    ) => {\n      if (enableErrorTracking && process.env.NODE_ENV === \"production\") {\n        ProductionMonitoring.trackError(\n          error,\n          {\n            ...context,\n            user_role: user?.role,\n            user_id: user?.uid,\n          },\n          severity\n        );\n      }\n    },\n    [enableErrorTracking, user?.role, user?.uid]\n  );\n\n  // Track cache performance\n  const trackCachePerformance = useCallback(\n    (\n      operation: \"hit\" | \"miss\" | \"write\" | \"invalidate\",\n      details: Record<string, any> = {}\n    ) => {\n      if (enablePerformanceTracking && process.env.NODE_ENV === \"production\") {\n        ProductionMonitoring.trackCachePerformance(operation, details);\n      }\n    },\n    [enablePerformanceTracking]\n  );\n\n  return {\n    trackEvent,\n    trackPerformance,\n    trackUserSession,\n    trackLocationEvent,\n    trackSearch,\n    trackError,\n    trackCachePerformance,\n    // Convenience methods for common events\n    trackLogin: (method: string) =>\n      trackEvent(ANALYTICS_EVENTS.LOGIN, { method }),\n    trackLogout: () => trackEvent(ANALYTICS_EVENTS.LOGOUT),\n    trackCheckIn: (locationData: any) =>\n      trackLocationEvent(\"check_in\", locationData),\n    trackCheckOut: (locationData: any) =>\n      trackLocationEvent(\"check_out\", locationData),\n    // Performance tracking shortcuts\n    trackCheckInDuration: (duration: number) =>\n      trackPerformance(PERFORMANCE_METRICS.CHECK_IN_DURATION, duration),\n    trackLocationLoadTime: (duration: number) =>\n      trackPerformance(PERFORMANCE_METRICS.LOCATION_LOAD_TIME, duration),\n    trackSessionListLoad: (duration: number) =>\n      trackPerformance(PERFORMANCE_METRICS.SESSION_LIST_LOAD, duration),\n    trackUserSearchTime: (duration: number) =>\n      trackPerformance(PERFORMANCE_METRICS.USER_SEARCH_TIME, duration),\n    trackCacheResponseTime: (duration: number) =>\n      trackPerformance(PERFORMANCE_METRICS.CACHE_RESPONSE_TIME, duration),\n  };\n}\n","import { useState, useEffect } from \"react\";\nimport { onAuthStateChanged, User } from \"firebase/auth\";\nimport { auth } from \"../../../firebase.config\";\nimport { getDocument } from \"@/lib/firebase/firestore\";\nimport { COLLECTIONS } from \"@/lib/firebase/firestore\";\n\ninterface AuthUser extends User {\n  role?: \"provider\" | \"admin\";\n}\n\nexport function useAuth() {\n  const [user, setUser] = useState<AuthUser | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\n      if (user) {\n        const userDoc = await getDocument<{ role: \"provider\" | \"admin\" }>(\n          COLLECTIONS.USERS,\n          user.uid,\n        );\n        setUser({ ...user, role: userDoc?.role });\n      } else {\n        setUser(null);\n      }\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, []);\n\n  return { user, loading };\n}\n","// Network status hook for detecting connectivity changes\n// Provides detailed network information and connection quality\n\nimport { useState, useEffect, useCallback } from \"react\";\n\nexport interface NetworkConnection {\n  downlink?: number;\n  effectiveType?: string;\n  rtt?: number;\n  saveData?: boolean;\n}\n\nexport interface NetworkStatus {\n  isOnline: boolean;\n  isConnected: boolean;\n  connectionType: string;\n  effectiveType: string;\n  downlink: number;\n  rtt: number;\n  saveData: boolean;\n  lastOnlineAt?: number;\n  lastOfflineAt?: number;\n  connectivityScore: number; // 0-100 score based on connection quality\n}\n\nexport interface UseNetworkStatusReturn extends NetworkStatus {\n  // Connection quality assessment\n  isHighQuality: boolean;\n  isMediumQuality: boolean;\n  isLowQuality: boolean;\n\n  // Connection stability\n  isStable: boolean;\n  isUnstable: boolean;\n\n  // Sync recommendations\n  shouldSync: boolean;\n  shouldDelaySync: boolean;\n\n  // Event handlers\n  onOnline: (callback: () => void) => void;\n  onOffline: (callback: () => void) => void;\n  onConnectionChange: (callback: (status: NetworkStatus) => void) => void;\n\n  // Manual checks\n  checkConnectivity: () => Promise<boolean>;\n  ping: () => Promise<number>;\n}\n\n// Connection quality thresholds\nconst QUALITY_THRESHOLDS = {\n  HIGH_DOWNLINK: 5, // Mbps\n  MEDIUM_DOWNLINK: 1.5, // Mbps\n  HIGH_RTT: 50, // ms\n  MEDIUM_RTT: 150, // ms\n  STABILITY_WINDOW: 30000, // 30 seconds\n} as const;\n\nexport function useNetworkStatus(): UseNetworkStatusReturn {\n  const [status, setStatus] = useState<NetworkStatus>(() => ({\n    isOnline: navigator.onLine,\n    isConnected: navigator.onLine,\n    connectionType: \"unknown\",\n    effectiveType: \"unknown\",\n    downlink: 0,\n    rtt: 0,\n    saveData: false,\n    connectivityScore: navigator.onLine ? 50 : 0,\n  }));\n\n  const [listeners, setListeners] = useState<{\n    online: Set<() => void>;\n    offline: Set<() => void>;\n    change: Set<(status: NetworkStatus) => void>;\n  }>({\n    online: new Set(),\n    offline: new Set(),\n    change: new Set(),\n  });\n\n  const [stabilityHistory, setStabilityHistory] = useState<\n    {\n      timestamp: number;\n      isOnline: boolean;\n    }[]\n  >([]);\n\n  // Calculate connectivity score based on network metrics\n  const calculateConnectivityScore = useCallback(\n    (\n      isOnline: boolean,\n      downlink: number,\n      rtt: number,\n      effectiveType: string\n    ): number => {\n      if (!isOnline) return 0;\n\n      let score = 40; // Base score for being online\n\n      // Downlink speed contribution (0-30 points)\n      if (downlink >= QUALITY_THRESHOLDS.HIGH_DOWNLINK) {\n        score += 30;\n      } else if (downlink >= QUALITY_THRESHOLDS.MEDIUM_DOWNLINK) {\n        score += 20;\n      } else if (downlink > 0) {\n        score += 10;\n      }\n\n      // RTT contribution (0-20 points)\n      if (rtt <= QUALITY_THRESHOLDS.HIGH_RTT) {\n        score += 20;\n      } else if (rtt <= QUALITY_THRESHOLDS.MEDIUM_RTT) {\n        score += 15;\n      } else if (rtt > 0) {\n        score += 5;\n      }\n\n      // Effective type contribution (0-10 points)\n      switch (effectiveType) {\n        case \"4g\":\n          score += 10;\n          break;\n        case \"3g\":\n          score += 7;\n          break;\n        case \"2g\":\n          score += 3;\n          break;\n        case \"slow-2g\":\n          score += 1;\n          break;\n      }\n\n      return Math.min(100, Math.max(0, score));\n    },\n    []\n  );\n\n  // Update network status from Navigator APIs\n  const updateNetworkStatus = useCallback(() => {\n    const navigator = window.navigator as any;\n    const connection =\n      navigator.connection ||\n      navigator.mozConnection ||\n      navigator.webkitConnection;\n\n    const isOnline = navigator.onLine;\n    const connectionType = connection?.type || \"unknown\";\n    const effectiveType = connection?.effectiveType || \"unknown\";\n    const downlink = connection?.downlink || 0;\n    const rtt = connection?.rtt || 0;\n    const saveData = connection?.saveData || false;\n\n    const connectivityScore = calculateConnectivityScore(\n      isOnline,\n      downlink,\n      rtt,\n      effectiveType\n    );\n\n    const newStatus: NetworkStatus = {\n      isOnline,\n      isConnected: isOnline && connectivityScore > 20,\n      connectionType,\n      effectiveType,\n      downlink,\n      rtt,\n      saveData,\n      connectivityScore,\n    };\n\n    // Track connection timing\n    setStatus((prevStatus) => {\n      const now = Date.now();\n      const updated = { ...newStatus };\n\n      if (isOnline && !prevStatus.isOnline) {\n        updated.lastOnlineAt = now;\n      } else if (!isOnline && prevStatus.isOnline) {\n        updated.lastOfflineAt = now;\n      } else {\n        updated.lastOnlineAt = prevStatus.lastOnlineAt;\n        updated.lastOfflineAt = prevStatus.lastOfflineAt;\n      }\n\n      return updated;\n    });\n\n    // Update stability history\n    setStabilityHistory((prev) => {\n      const now = Date.now();\n      const cutoff = now - QUALITY_THRESHOLDS.STABILITY_WINDOW;\n\n      return [\n        ...prev.filter((entry) => entry.timestamp > cutoff),\n        { timestamp: now, isOnline },\n      ];\n    });\n  }, [calculateConnectivityScore]);\n\n  // Manual connectivity check via ping\n  const checkConnectivity = useCallback(async (): Promise<boolean> => {\n    try {\n      const start = Date.now();\n      const response = await fetch(\"/api/health\", {\n        method: \"HEAD\",\n        cache: \"no-cache\",\n        signal: AbortSignal.timeout(5000),\n      });\n      const end = Date.now();\n\n      const isConnected = response.ok;\n      const rtt = end - start;\n\n      // Update status with real connectivity check\n      setStatus((prev) => ({\n        ...prev,\n        isConnected,\n        rtt: Math.min(prev.rtt || Infinity, rtt),\n        connectivityScore: calculateConnectivityScore(\n          isConnected,\n          prev.downlink,\n          rtt,\n          prev.effectiveType\n        ),\n      }));\n\n      return isConnected;\n    } catch (error) {\n      setStatus((prev) => ({\n        ...prev,\n        isConnected: false,\n        connectivityScore: 0,\n      }));\n      return false;\n    }\n  }, [calculateConnectivityScore]);\n\n  // Ping test for latency measurement\n  const ping = useCallback(async (): Promise<number> => {\n    try {\n      const start = performance.now();\n      await fetch(\"/api/health\", {\n        method: \"HEAD\",\n        cache: \"no-cache\",\n        signal: AbortSignal.timeout(3000),\n      });\n      const end = performance.now();\n      return Math.round(end - start);\n    } catch (error) {\n      return -1; // Error indicator\n    }\n  }, []);\n\n  // Event listener management\n  const onOnline = useCallback((callback: () => void) => {\n    setListeners((prev) => {\n      const newOnline = new Set(prev.online);\n      newOnline.add(callback);\n      return {\n        ...prev,\n        online: newOnline,\n      };\n    });\n\n    return () => {\n      setListeners((prev) => {\n        const newOnline = new Set(prev.online);\n        newOnline.delete(callback);\n        return {\n          ...prev,\n          online: newOnline,\n        };\n      });\n    };\n  }, []);\n\n  const onOffline = useCallback((callback: () => void) => {\n    setListeners((prev) => {\n      const newOffline = new Set(prev.offline);\n      newOffline.add(callback);\n      return {\n        ...prev,\n        offline: newOffline,\n      };\n    });\n\n    return () => {\n      setListeners((prev) => {\n        const newOffline = new Set(prev.offline);\n        newOffline.delete(callback);\n        return {\n          ...prev,\n          offline: newOffline,\n        };\n      });\n    };\n  }, []);\n\n  const onConnectionChange = useCallback(\n    (callback: (status: NetworkStatus) => void) => {\n      setListeners((prev) => {\n        const newChange = new Set(prev.change);\n        newChange.add(callback);\n        return {\n          ...prev,\n          change: newChange,\n        };\n      });\n\n      return () => {\n        setListeners((prev) => {\n          const newChange = new Set(prev.change);\n          newChange.delete(callback);\n          return {\n            ...prev,\n            change: newChange,\n          };\n        });\n      };\n    },\n    []\n  );\n\n  // Setup event listeners\n  useEffect(() => {\n    const handleOnline = () => {\n      updateNetworkStatus();\n      listeners.online.forEach((callback) => {\n        try {\n          callback();\n        } catch (error) {\n          console.error(\"Error in online callback:\", error);\n        }\n      });\n    };\n\n    const handleOffline = () => {\n      updateNetworkStatus();\n      listeners.offline.forEach((callback) => {\n        try {\n          callback();\n        } catch (error) {\n          console.error(\"Error in offline callback:\", error);\n        }\n      });\n    };\n\n    const handleConnectionChange = () => {\n      updateNetworkStatus();\n    };\n\n    // Add native event listeners\n    window.addEventListener(\"online\", handleOnline);\n    window.addEventListener(\"offline\", handleOffline);\n\n    // Add connection change listeners if supported\n    const navigator = window.navigator as any;\n    const connection =\n      navigator.connection ||\n      navigator.mozConnection ||\n      navigator.webkitConnection;\n\n    if (connection) {\n      connection.addEventListener(\"change\", handleConnectionChange);\n    }\n\n    // Initial status check\n    updateNetworkStatus();\n\n    // Periodic connectivity verification\n    const verificationInterval = setInterval(async () => {\n      if (status.isOnline) {\n        await checkConnectivity();\n      }\n    }, 30000); // Every 30 seconds\n\n    return () => {\n      window.removeEventListener(\"online\", handleOnline);\n      window.removeEventListener(\"offline\", handleOffline);\n\n      if (connection) {\n        connection.removeEventListener(\"change\", handleConnectionChange);\n      }\n\n      clearInterval(verificationInterval);\n    };\n  }, [updateNetworkStatus, checkConnectivity, status.isOnline, listeners]);\n\n  // Notify change listeners when status changes\n  useEffect(() => {\n    listeners.change.forEach((callback) => {\n      try {\n        callback(status);\n      } catch (error) {\n        console.error(\"Error in change callback:\", error);\n      }\n    });\n  }, [status, listeners.change]);\n\n  // Calculate derived properties\n  const isHighQuality = status.connectivityScore >= 80;\n  const isMediumQuality =\n    status.connectivityScore >= 50 && status.connectivityScore < 80;\n  const isLowQuality =\n    status.connectivityScore >= 20 && status.connectivityScore < 50;\n\n  // Calculate stability\n  const isStable =\n    stabilityHistory.length >= 3 &&\n    stabilityHistory\n      .slice(-3)\n      .every((entry) => entry.isOnline === status.isOnline);\n  const isUnstable = !isStable && stabilityHistory.length >= 2;\n\n  // Sync recommendations\n  const shouldSync =\n    status.isConnected && status.connectivityScore >= 30 && isStable;\n  const shouldDelaySync =\n    status.isOnline && (status.connectivityScore < 30 || isUnstable);\n\n  return {\n    ...status,\n    isHighQuality,\n    isMediumQuality,\n    isLowQuality,\n    isStable,\n    isUnstable,\n    shouldSync,\n    shouldDelaySync,\n    onOnline,\n    onOffline,\n    onConnectionChange,\n    checkConnectivity,\n    ping,\n  };\n}\n","// Web Vitals monitoring utility\nimport { onCLS, onINP, onFCP, onLCP, onTTFB } from \"web-vitals\";\n\nexport interface WebVitalsMetric {\n  name: \"CLS\" | \"INP\" | \"FCP\" | \"LCP\" | \"TTFB\";\n  value: number;\n  delta: number;\n  id: string;\n  rating: \"good\" | \"needs-improvement\" | \"poor\";\n  navigationType:\n    | \"navigate\"\n    | \"reload\"\n    | \"back-forward\"\n    | \"back-forward-cache\"\n    | \"prerender\";\n  timestamp: number;\n  url: string;\n  userAgent: string;\n}\n\nexport interface WebVitalsReport {\n  metrics: WebVitalsMetric[];\n  timestamp: number;\n  sessionId: string;\n  userId?: string;\n  page: string;\n  viewport: {\n    width: number;\n    height: number;\n  };\n  connection?: {\n    effectiveType?: string;\n    rtt?: number;\n    downlink?: number;\n  };\n}\n\n// Performance thresholds (based on Core Web Vitals recommendations)\nexport const PERFORMANCE_THRESHOLDS = {\n  LCP: { good: 2500, needsImprovement: 4000 }, // Largest Contentful Paint\n  INP: { good: 200, needsImprovement: 500 }, // Interaction to Next Paint\n  CLS: { good: 0.1, needsImprovement: 0.25 }, // Cumulative Layout Shift\n  FCP: { good: 1800, needsImprovement: 3000 }, // First Contentful Paint\n  TTFB: { good: 800, needsImprovement: 1800 }, // Time to First Byte\n} as const;\n\nclass WebVitalsMonitor {\n  private metrics: Map<string, WebVitalsMetric> = new Map();\n  private sessionId: string;\n  private userId?: string;\n  private isProduction: boolean;\n\n  constructor() {\n    this.sessionId = this.generateSessionId();\n    this.isProduction = process.env.NODE_ENV === \"production\";\n    // Avoid accessing browser APIs during SSR\n    if (typeof window !== \"undefined\" && typeof document !== \"undefined\") {\n      this.initialize();\n    }\n  }\n\n  private generateSessionId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  private initialize() {\n    if (typeof window === \"undefined\" || typeof document === \"undefined\")\n      return;\n    try {\n      // Initialize all Core Web Vitals monitoring\n      onCLS(this.handleMetric.bind(this));\n      onINP(this.handleMetric.bind(this));\n      onFCP(this.handleMetric.bind(this));\n      onLCP(this.handleMetric.bind(this));\n      onTTFB(this.handleMetric.bind(this));\n\n      // Set up page visibility change handler\n      document.addEventListener(\"visibilitychange\", () => {\n        if (document.visibilityState === \"hidden\") {\n          this.sendReport();\n        }\n      });\n\n      // Set up beforeunload handler\n      window.addEventListener(\"beforeunload\", () => {\n        this.sendReport();\n      });\n    } catch (e) {\n      // Fail silently on SSR or restricted environments\n    }\n  }\n\n  private handleMetric(metric: any) {\n    const webVitalsMetric: WebVitalsMetric = {\n      name: metric.name,\n      value: metric.value,\n      delta: metric.delta,\n      id: metric.id,\n      rating: this.getRating(metric.name, metric.value),\n      navigationType:\n        this.normalizeNavigationType(\n          (\n            performance.getEntriesByType(\n              \"navigation\"\n            )[0] as PerformanceNavigationTiming\n          )?.type\n        ) || \"navigate\",\n      timestamp: Date.now(),\n      url: window.location.href,\n      userAgent: navigator.userAgent,\n    };\n\n    this.metrics.set(metric.name, webVitalsMetric);\n\n    // Log in development\n    if (!this.isProduction) {\n      console.log(`[Web Vitals] ${metric.name}:`, webVitalsMetric);\n    }\n\n    // Send real-time alerts for poor performance\n    if (webVitalsMetric.rating === \"poor\") {\n      this.sendAlert(webVitalsMetric);\n    }\n  }\n\n  private normalizeNavigationType(\n    type: string\n  ):\n    | \"navigate\"\n    | \"reload\"\n    | \"back-forward\"\n    | \"back-forward-cache\"\n    | \"prerender\" {\n    switch (type) {\n      case \"back_forward\":\n        return \"back-forward\";\n      case \"back_forward_cache\":\n        return \"back-forward-cache\";\n      default:\n        return type as\n          | \"navigate\"\n          | \"reload\"\n          | \"back-forward\"\n          | \"back-forward-cache\"\n          | \"prerender\";\n    }\n  }\n\n  private getRating(\n    name: string,\n    value: number\n  ): \"good\" | \"needs-improvement\" | \"poor\" {\n    const thresholds =\n      PERFORMANCE_THRESHOLDS[name as keyof typeof PERFORMANCE_THRESHOLDS];\n    if (!thresholds) return \"good\";\n\n    if (value <= thresholds.good) return \"good\";\n    if (value <= thresholds.needsImprovement) return \"needs-improvement\";\n    return \"poor\";\n  }\n\n  private getConnectionInfo() {\n    const connection =\n      (navigator as any).connection ||\n      (navigator as any).mozConnection ||\n      (navigator as any).webkitConnection;\n    if (!connection) return undefined;\n\n    return {\n      effectiveType: connection.effectiveType,\n      rtt: connection.rtt,\n      downlink: connection.downlink,\n    };\n  }\n\n  public generateReport(): WebVitalsReport {\n    return {\n      metrics: Array.from(this.metrics.values()),\n      timestamp: Date.now(),\n      sessionId: this.sessionId,\n      userId: this.userId,\n      page: window.location.pathname,\n      viewport: {\n        width: window.innerWidth,\n        height: window.innerHeight,\n      },\n      connection: this.getConnectionInfo(),\n    };\n  }\n\n  private sendReport() {\n    if (this.metrics.size === 0) return;\n\n    const report = this.generateReport();\n\n    // Send to analytics in production\n    if (this.isProduction) {\n      this.sendToAnalytics(report);\n    }\n\n    // Always send to Firebase Performance if available\n    this.sendToFirebasePerformance(report);\n  }\n\n  private sendAlert(metric: WebVitalsMetric) {\n    console.warn(`[Performance Alert] Poor ${metric.name}: ${metric.value}ms`);\n\n    // In production, send to monitoring service\n    if (this.isProduction) {\n      // Send to error reporting service\n      this.sendToErrorReporting({\n        type: \"performance-alert\",\n        metric: metric.name,\n        value: metric.value,\n        rating: metric.rating,\n        url: window.location.href,\n        timestamp: metric.timestamp,\n      });\n    }\n  }\n\n  private sendToAnalytics(report: WebVitalsReport) {\n    // Google Analytics 4 integration\n    if (typeof window !== \"undefined\" && (window as any).gtag) {\n      report.metrics.forEach((metric) => {\n        (window as any).gtag(\"event\", \"web_vitals\", {\n          event_category: \"Web Vitals\",\n          event_label: metric.name,\n          value: Math.round(metric.value),\n          custom_map: {\n            metric_rating: metric.rating,\n            metric_delta: metric.delta,\n          },\n        });\n      });\n    }\n\n    // Send to custom analytics endpoint\n    fetch(\"/api/analytics/web-vitals\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(report),\n      keepalive: true,\n    }).catch((err) => {\n      console.warn(\"Failed to send Web Vitals report:\", err);\n    });\n  }\n\n  private sendToFirebasePerformance(report: WebVitalsReport) {\n    // Firebase Performance Monitoring integration\n    if (typeof performance !== \"undefined\" && \"mark\" in performance) {\n      report.metrics.forEach((metric) => {\n        // Create custom performance marks\n        performance.mark(\n          `web-vitals-${metric.name.toLowerCase()}-${metric.value}`\n        );\n\n        // Send custom trace (if Firebase Performance is initialized)\n        if ((window as any).firebase && (window as any).firebase.performance) {\n          const trace = (window as any).firebase\n            .performance()\n            .trace(`web_vitals_${metric.name}`);\n          trace.putAttribute(\"rating\", metric.rating);\n          trace.putAttribute(\"page\", report.page);\n          trace.putMetric(\"value\", Math.round(metric.value));\n          trace.stop();\n        }\n      });\n    }\n  }\n\n  private sendToErrorReporting(error: any) {\n    // Send to error reporting service (e.g., Sentry)\n    if ((window as any).Sentry) {\n      (window as any).Sentry.captureMessage(\"Performance Alert\", {\n        level: \"warning\",\n        extra: error,\n      });\n    }\n  }\n\n  // Public methods\n  public setUserId(userId: string) {\n    this.userId = userId;\n  }\n\n  public getCurrentMetrics(): WebVitalsMetric[] {\n    return Array.from(this.metrics.values());\n  }\n\n  public getMetric(\n    name: keyof typeof PERFORMANCE_THRESHOLDS\n  ): WebVitalsMetric | undefined {\n    return this.metrics.get(name);\n  }\n\n  public getAllMetrics(): { [key: string]: number } {\n    // Return the current collected metrics\n    const result: { [key: string]: number } = {};\n    this.metrics.forEach((metric) => {\n      result[metric.name] = metric.value;\n    });\n    return result;\n  }\n\n  public getPerformanceGrade(): \"A\" | \"B\" | \"C\" | \"D\" | \"F\" {\n    const metrics = this.getCurrentMetrics();\n    if (metrics.length === 0) return \"F\";\n\n    const scores = metrics.map((metric) => {\n      switch (metric.rating) {\n        case \"good\":\n          return 3;\n        case \"needs-improvement\":\n          return 2;\n        case \"poor\":\n          return 1;\n        default:\n          return 0;\n      }\n    });\n\n    const averageScore =\n      scores.reduce((a: number, b: number) => a + b, 0) / scores.length;\n\n    if (averageScore >= 2.8) return \"A\";\n    if (averageScore >= 2.4) return \"B\";\n    if (averageScore >= 2.0) return \"C\";\n    if (averageScore >= 1.5) return \"D\";\n    return \"F\";\n  }\n}\n\n// Global instance\nexport const webVitalsMonitor =\n  typeof window !== \"undefined\" && typeof document !== \"undefined\"\n    ? new WebVitalsMonitor()\n    : ({} as unknown as WebVitalsMonitor); // SSR placeholder\n\n// Convenience function for manual tracking\nexport function trackWebVitals(callback?: (report: WebVitalsReport) => void) {\n  const monitor = new WebVitalsMonitor();\n\n  if (callback) {\n    // Return current metrics after a short delay\n    setTimeout(() => {\n      callback(monitor.generateReport());\n    }, 1000);\n  }\n\n  return monitor;\n}\n\n// Export for global access\nif (typeof window !== \"undefined\") {\n  (window as any).webVitalsMonitor = webVitalsMonitor;\n}\n","\"use client\";\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { webVitalsMonitor, WebVitalsMetric, PERFORMANCE_THRESHOLDS } from '../../lib/performance/webVitals';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Activity,\n  Clock,\n  Zap,\n  Eye,\n  Gauge,\n  RefreshCw,\n  Download,\n  AlertTriangle,\n  CheckCircle,\n} from \"lucide-react\";\n\ninterface PerformanceMonitorProps {\n  showDetails?: boolean;\n  autoRefresh?: boolean;\n  refreshInterval?: number;\n}\n\nexport function PerformanceMonitor({ \n  showDetails = true, \n  autoRefresh = true, \n  refreshInterval = 5000 \n}: PerformanceMonitorProps) {\n  const [metrics, setMetrics] = useState<WebVitalsMetric[]>([]);\n  const [isVisible, setIsVisible] = useState(false);\n  const [lastUpdate, setLastUpdate] = useState<Date | null>(null);\n\n  const refreshMetrics = useCallback(() => {\n    const currentMetrics = webVitalsMonitor.getCurrentMetrics();\n    setMetrics(currentMetrics);\n    setLastUpdate(new Date());\n  }, []);\n\n  useEffect(() => {\n    // Initial load\n    refreshMetrics();\n\n    // Auto refresh\n    if (autoRefresh) {\n      const interval = setInterval(refreshMetrics, refreshInterval);\n      return () => clearInterval(interval);\n    }\n  }, [refreshMetrics, autoRefresh, refreshInterval]);\n\n  const getMetricIcon = (name: string) => {\n    switch (name) {\n      case 'LCP': return <Eye className=\"w-4 h-4\" />;\n      case 'FID': return <Zap className=\"w-4 h-4\" />;\n      case 'CLS': return <Activity className=\"w-4 h-4\" />;\n      case 'FCP': return <Clock className=\"w-4 h-4\" />;\n      case 'TTFB': return <Gauge className=\"w-4 h-4\" />;\n      default: return <Activity className=\"w-4 h-4\" />;\n    }\n  };\n\n  const getMetricBadgeVariant = (rating: string) => {\n    switch (rating) {\n      case 'good': return 'default';\n      case 'needs-improvement': return 'secondary';\n      case 'poor': return 'destructive';\n      default: return 'outline';\n    }\n  };\n\n  const getMetricColor = (rating: string) => {\n    switch (rating) {\n      case 'good': return 'text-green-600';\n      case 'needs-improvement': return 'text-yellow-600';\n      case 'poor': return 'text-red-600';\n      default: return 'text-gray-600';\n    }\n  };\n\n  const getPerformanceGrade = () => {\n    return webVitalsMonitor.getPerformanceGrade();\n  };\n\n  const exportMetrics = () => {\n    const data = {\n      timestamp: new Date().toISOString(),\n      grade: getPerformanceGrade(),\n      metrics: metrics,\n      url: window.location.href,\n      userAgent: navigator.userAgent,\n      viewport: {\n        width: window.innerWidth,\n        height: window.innerHeight,\n      }\n    };\n\n    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `web-vitals-${Date.now()}.json`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  const getScoreProgress = (name: string, value: number) => {\n    const thresholds = PERFORMANCE_THRESHOLDS[name as keyof typeof PERFORMANCE_THRESHOLDS];\n    if (!thresholds) return 100;\n    \n    const max = thresholds.needsImprovement * 1.5;\n    return Math.max(0, Math.min(100, ((max - value) / max) * 100));\n  };\n\n  if (process.env.NODE_ENV === 'production' && !isVisible) {\n    return (\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={() => setIsVisible(true)}\n        className=\"fixed bottom-4 right-4 z-50\"\n      >\n        <Activity className=\"w-4 h-4 mr-2\" />\n        Performance\n      </Button>\n    );\n  }\n\n  return (\n    <div className={`${process.env.NODE_ENV === 'production' ? 'fixed bottom-4 right-4 z-50 w-96' : ''}`}>\n      <Card className=\"w-full\">\n        <CardHeader className=\"pb-3\">\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center text-lg\">\n              <Activity className=\"w-5 h-5 mr-2\" />\n              Performance Monitor\n            </CardTitle>\n            <div className=\"flex items-center space-x-2\">\n              <Badge variant=\"outline\" className=\"font-mono\">\n                Grade: {getPerformanceGrade()}\n              </Badge>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={refreshMetrics}\n                disabled={!metrics.length}\n              >\n                <RefreshCw className=\"w-4 h-4\" />\n              </Button>\n              {process.env.NODE_ENV === 'production' && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setIsVisible(false)}\n                >\n                  \n                </Button>\n              )}\n            </div>\n          </div>\n          <CardDescription>\n            Core Web Vitals monitoring\n            {lastUpdate && (\n              <span className=\"block text-xs mt-1\">\n                Last updated: {lastUpdate.toLocaleTimeString()}\n              </span>\n            )}\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {metrics.length === 0 ? (\n            <div className=\"flex items-center justify-center py-8 text-muted-foreground\">\n              <Activity className=\"w-6 h-6 mr-2 animate-pulse\" />\n              Collecting metrics...\n            </div>\n          ) : (\n            <>\n              <div className=\"grid grid-cols-1 gap-3\">\n                {metrics.map((metric) => (\n                  <div key={metric.name} className=\"flex items-center space-x-3 p-3 border rounded-lg\">\n                    <div className={`p-2 rounded-full bg-gray-100 ${getMetricColor(metric.rating)}`}>\n                      {getMetricIcon(metric.name)}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center justify-between\">\n                        <p className=\"font-medium\">\n                          {metric.name}\n                        </p>\n                        <Badge variant={getMetricBadgeVariant(metric.rating)}>\n                          {metric.rating.replace('-', ' ')}\n                        </Badge>\n                      </div>\n                      <div className=\"flex items-center space-x-2 mt-1\">\n                        <span className=\"text-2xl font-bold\">\n                          {metric.name === 'CLS' \n                            ? metric.value.toFixed(3)\n                            : Math.round(metric.value)\n                          }\n                        </span>\n                        <span className=\"text-sm text-muted-foreground\">\n                          {metric.name === 'CLS' ? 'score' : 'ms'}\n                        </span>\n                      </div>\n                      {showDetails && (\n                        <Progress \n                          value={getScoreProgress(metric.name, metric.value)} \n                          className=\"mt-2 h-2\"\n                        />\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n\n              {showDetails && (\n                <div className=\"border-t pt-4 space-y-3\">\n                  <div className=\"flex items-center justify-between text-sm\">\n                    <span className=\"font-medium\">Performance Summary</span>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={exportMetrics}\n                    >\n                      <Download className=\"w-4 h-4 mr-2\" />\n                      Export\n                    </Button>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                    <div className=\"space-y-1\">\n                      <p className=\"text-muted-foreground\">Overall Grade</p>\n                      <p className=\"font-mono text-lg\">{getPerformanceGrade()}</p>\n                    </div>\n                    <div className=\"space-y-1\">\n                      <p className=\"text-muted-foreground\">Metrics Count</p>\n                      <p className=\"font-mono text-lg\">{metrics.length}</p>\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center space-x-2 text-xs text-muted-foreground\">\n                    <div className=\"flex items-center space-x-1\">\n                      <CheckCircle className=\"w-3 h-3 text-green-600\" />\n                      <span>Good</span>\n                    </div>\n                    <div className=\"flex items-center space-x-1\">\n                      <AlertTriangle className=\"w-3 h-3 text-yellow-600\" />\n                      <span>Needs Improvement</span>\n                    </div>\n                    <div className=\"flex items-center space-x-1\">\n                      <AlertTriangle className=\"w-3 h-3 text-red-600\" />\n                      <span>Poor</span>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\n// Export for development use\nexport default PerformanceMonitor;\n","import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":["webpackEmptyContext","req","e","code","keys","resolve","id","module","exports","NotFound","router","useRouter","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","jsx","div","className","Card","jsxs","CardContent","BrandHeader","title","subtitle","MapPin","p","Button","onClick","back","variant","ArrowLeft","Link","href","Home","wrappedServerComponent","metadata","description","manifest","appleWebApp","capable","statusBarStyle","icons","icon","url","sizes","type","apple","viewport","width","initialScale","maximumScale","userScalable","themeColor","viewportFit","asyncStorageModule","request_async_storage_external_js_","requestAsyncStorage","workUnitAsyncStorage","undefined","Proxy","children","_jsx","html","lang","_jsxs","body","inter","SkipToContent","AuthProvider","AnalyticsProvider","ClientLayout","NetworkStatusIndicator","apply","originalFunction","thisArg","args","sentryTraceHeader","baggageHeader","headers","requestAsyncStore","getStore","get","index_server","wrapServerComponentWithSentry","componentRoute","componentType","generateMetadata","generateImageMetadata","generateViewport","wrappedServerComponent$1","next_dist_client_components_request_async_storage_external_js__WEBPACK_IMPORTED_MODULE_0__","serverComponentModule.default","_sentry_nextjs__WEBPACK_IMPORTED_MODULE_2__","Promise","then","__webpack_require__","t","bind","app","initializeApp","apiKey","process","authDomain","projectId","storageBucket","messagingSenderId","appId","auth","getAuth","db","getFirestore","getStorage","performance","analytics","Error","error","reset","CardHeader","CardTitle","CardDescription","digest","isOnline","useNetworkStatus","WifiOff","PWAInstallPrompt","deferredPrompt","setDeferredPrompt","useState","showPrompt","setShowPrompt","isInstalled","setIsInstalled","handleInstallClick","prompt","outcome","userChoice","console","log","handleDismiss","sessionStorage","setItem","getItem","react_jsx_runtime","Download","size","X","PWAUpdatePrompt","showUpdatePrompt","setShowUpdatePrompt","registration","setRegistration","RefreshCw","waiting","postMessage","STORES","SCHOOLS","SESSIONS","PENDING_ACTIONS","USER_DATA","initDB","openDB","upgrade","objectStoreNames","contains","schoolsStore","createObjectStore","keyPath","createIndex","sessionsStore","pendingStore","autoIncrement","cacheSchoolData","schools","tx","transaction","school","store","put","done","getCachedSchools","userId","getAll","filter","assignedProviders","includes","cacheSessionData","sessions","session","getCachedSessions","getAllFromIndex","queueOfflineAction","action","add","timestamp","Date","now","retry","cacheUserData","userData","getCachedUserData","syncPendingActions","response","fetch","method","JSON","stringify","data","ok","delete","clearOfflineData","all","clear","ServiceManager","constructor","syncInProgress","getInstance","instance","setupEventListeners","window","addEventListener","onOnline","onOffline","navigator","serviceWorker","handleServiceWorkerMessage","event","initializeOfflineDB","performBackgroundSync","notifyStatusChange","status","dispatchEvent","CustomEvent","detail","isDeviceOnline","cacheUserSchools","length","getOfflineSchools","cacheUserSessions","getOfflineSessions","performOfflineCheckIn","checkInData","json","localSession","startTime","toISOString","performOfflineCheckOut","checkOutData","sessionId","endTime","endCoordinates","coordinates","cacheCurrentUser","getOfflineUserData","clearAllOfflineData","getSyncStatus","serviceManager","PWAStatus","isPWA","setIsPWA","installStatus","setInstallStatus","lastSyncTime","useOffline","state","setState","pendingActions","useCallback","prev","result","triggerSync","checkInOffline","checkOutOffline","syncOfflineActions","Badge","Wifi","Clock","toLocaleTimeString","Smartphone","Monitor","CACHE_CONFIG","SIZE_LIMITS","LOCATION_DATA","CACHE_STORES","CACHE_METADATA","dbInstance","initCacheDB","oldVersion","multiEntry","userStore","locationStore","metadataStore","QUEUE_ACTIONS","CHECK_IN","CHECK_OUT","SESSION_UPDATE","LOCATION_UPDATE","QUEUE_STATUS","PENDING","SYNCING","SYNCED","FAILED","CANCELLED","QUEUE_CONFIG","BATCH_SIZE","getPendingActions","actions","allActions","sort","a","b","updateActionStatus","actionId","errorMessage","_cachedAt","retryCount","syncedAt","removeCompletedActions","removedCount","_expiresAt","maxRetries","processQueue","processed","synced","failed","batches","chunkArray","array","chunks","i","push","slice","batch","batchResults","allSettled","map","processAction","forEach","index","value","reason","setTimeout","success","syncCheckIn","syncCheckOut","syncSessionUpdate","syncLocationUpdate","warn","message","payload","queuedActionId","originalTimestamp","statusText","ACTION_PRIORITIES","SyncManager","config","isSyncing","syncHistory","enableAdaptiveSync","enablePrioritySync","enableBatchOptimization","enableRetryOptimization","maxConcurrentSyncs","syncTimeoutMs","priorityThresholdMs","debugMode","sync","networkStatus","forceSync","createSkippedResult","lastNetworkStatus","strategy","determineSyncStrategy","shouldSync","name","createSuccessResult","connectivityScore","prioritizedActions","prioritizeActions","executeSyncStrategy","recordSyncResult","failureResult","createFailureResult","effectiveType","downlink","rtt","saveData","isConnected","batchSize","concurrency","timeout","priority","Math","max","floor","aPriority","bPriority","priorityOrder","critical","high","medium","low","priorityDiff","ageA","ageB","aIsCriticalAge","bIsCriticalAge","retryDiff","skipped","errors","actionsToSync","actionPriority","batchPromises","timeoutPromise","_","reject","syncPromise","syncSingleAction","race","willRetry","delay","duration","getSyncRecommendations","pendingCount","getLastKnownPendingCount","estimatedDuration","estimateSyncDuration","recommendedDelay","calculateOptimalRetryDelay","getSyncHistory","getSyncStatistics","totalSyncs","successRate","averageDuration","averageNetworkScore","strategyCounts","successfulSyncs","entry","reduce","sum","networkScore","actionCount","min","baseDelay","scoreMultiplier","ms","syncManager","queueManager","DEFAULT_CONFIG","enableAutoSync","enableGradualSync","stabilityWaitMs","maxSyncAttempts","syncRetryDelayMs","enableSyncNotifications","useEnhancedOfflineQueue","autoRefreshInterval","enableDebugLogs","connectivityRestoration","useConnectivityRestoration","initialConfig","setConfig","isRestoring","setIsRestoring","restorationHistory","setRestorationHistory","lastRestoration","setLastRestoration","stabilityTimeoutRef","useRef","syncCancelRef","executeRestoration","triggerReason","restoration","stabilityWaitTime","syncAttempts","syncResults","totalDuration","isUnstable","current","recommendations","catch","lastSyncResult","syncResult","retryDelay","pow","syncError","errorResult","updated","showSyncNotification","Notification","permission","totalSynced","tag","clearTimeout","cancelSync","updateConfig","newConfig","getRestorationStats","totalRestorations","averageSyncAttempts","successfulRestorations","r","restorationConfig","queueStats","setQueueStats","total","pending","syncing","cancelled","setPendingActions","setIsSyncing","setLastSyncResult","setSyncError","syncRecommendations","setSyncRecommendations","checkIn","schoolId","location","checkOut","syncNow","triggerRestoration","refreshStats","stats","getStats","updateRestorationConfig","ToastProvider","ToastPrimitives","ToastViewport","React","props","ref","cn","displayName","toastVariants","cva","variants","default","destructive","defaultVariants","Toast","ToastAction","ToastClose","toast-close","ToastTitle","ToastDescription","count","toastTimeouts","Map","addToRemoveQueue","has","toastId","dispatch","set","reducer","toasts","toast","open","listeners","memoryState","listener","Number","MAX_SAFE_INTEGER","toString","dismiss","onOpenChange","update","useToast","indexOf","splice","OfflineMessagingProvider","maxMessages","enableToasts","enableNotifications","messages","setMessages","previousOnlineStatus","setPreviousOnlineStatus","previousPendingCount","setPreviousPendingCount","OfflineMessageList","maxVisible","getRelevantMessages","label","handler","getIcon","CheckCircle","AlertTriangle","Info","getVariant","Alert","AlertDescription","OfflineStatusIndicator","showSyncButton","showQueueInfo","getStatusIcon","getStatusColor","handleSyncNow","Fragment","span","disabled","Progress","getQueueStatusText","strong","round","OfflineStatusBar","position","showMessages","positionClasses","top","bottom","getStatusBarContent","Toaster","Header","main","tabIndex","user","useAuth","trackLogout","useAnalytics","handleSignOut","logOut","header","role","aria-label","Logo","nav","AuthContext","createContext","loading","Provider","alertVariants","AlertTitle","h5","badgeVariants","secondary","outline","buttonVariants","ghost","link","sm","lg","asChild","Comp","Slot","CardFooter","sizeMap","height","textSize","md","xl","showText","OptimizedImage","src","alt","quality","h1","placeholder","blurDataURL","fill","fallback","onLoad","onError","imageLoaded","setImageLoaded","imageError","setImageError","handleLoad","handleError","style","svg","stroke","viewBox","path","strokeLinecap","strokeLinejoin","strokeWidth","d","Skeleton","Image","OptimizedAvatar","defaultFallback","ProgressPrimitive","transform","SkeletonText","lines","Array","from","SkeletonCard","showImage","SkeletonList","items","showAvatar","ScreenReaderOnly","as","Component","targetId","useAnnouncement","announce","politeness","region","document","getElementById","newAnnouncement","createElement","textContent","setAttribute","firstChild","removeChild","appendChild","googleProvider","GoogleAuthProvider","signInWithEmail","email","password","signInWithEmailAndPassword","createAccount","createUserWithEmailAndPassword","signInWithGoogle","signInWithPopup","signOut","COLLECTIONS","USERS","LOCATIONS","updateDocument","collectionName","docId","updateDoc","doc","getCollection","querySnapshot","getDocs","collection","docs","ANALYTICS_EVENTS","LOGIN","LOGOUT","SIGNUP","SESSION_START","SESSION_END","SESSION_PAUSE","SESSION_RESUME","LOCATION_CHECK_IN","LOCATION_CHECK_OUT","LOCATION_VIEW","SEARCH","PAGE_VIEW","ERROR","CACHE_ERROR","NETWORK_ERROR","PERFORMANCE_METRIC","CACHE_HIT","CACHE_MISS","PERFORMANCE_METRICS","CHECK_IN_DURATION","LOCATION_LOAD_TIME","SESSION_LIST_LOAD","USER_SEARCH_TIME","CACHE_RESPONSE_TIME","ProductionMonitoring","trackEvent","eventName","parameters","userProperties","trackPerformance","metricName","attributes","trackUserSession","sessionData","eventMap","start","end","pause","resume","user_id","session_duration","location_id","locationId","session_type","user_role","userRole","total_sessions","totalSessions","trackLocationEvent","locationData","userContext","location_name","locationName","accuracy","distance_from_location","distance","gps_time","gpsTime","provider_experience","experience","trackError","context","severity","trace","putAttribute","substring","stop","perfError","trackCachePerformance","operation","details","cache_operation","cache_type","cacheType","data_type","dataType","response_time","responseTime","trackSearch","searchTerm","searchType","results","search_term","search_type","results_count","load_time","loadTime","from_cache","fromCache","setUserContext","initialize","setupPerformanceMonitoring","setupErrorMonitoring","options","enableAutoTracking","enablePerformanceTracking","enableErrorTracking","uid","trackLogin","trackCheckIn","trackCheckOut","trackCheckInDuration","trackLocationLoadTime","trackSessionListLoad","trackUserSearchTime","trackCacheResponseTime","setUser","setLoading","QUALITY_THRESHOLDS","HIGH_DOWNLINK","MEDIUM_DOWNLINK","HIGH_RTT","MEDIUM_RTT","STABILITY_WINDOW","setStatus","onLine","connectionType","setListeners","online","Set","offline","change","stabilityHistory","setStabilityHistory","calculateConnectivityScore","score","connection","mozConnection","webkitConnection","newStatus","prevStatus","lastOnlineAt","lastOfflineAt","cutoff","checkConnectivity","cache","signal","AbortSignal","Infinity","ping","newOnline","callback","newOffline","onConnectionChange","newChange","isHighQuality","isMediumQuality","isLowQuality","isStable","every","shouldDelaySync","PERFORMANCE_THRESHOLDS","LCP","good","needsImprovement","INP","CLS","FCP","TTFB","webVitalsMonitor","PerformanceMonitor","showDetails","autoRefresh","refreshInterval","metrics","setMetrics","isVisible","setIsVisible","lastUpdate","setLastUpdate","refreshMetrics","getCurrentMetrics","getMetricIcon","Eye","Zap","Activity","Gauge","getMetricBadgeVariant","rating","getMetricColor","getPerformanceGrade","getScoreProgress","thresholds","metric","replace","toFixed","blob","Blob","grade","userAgent","innerWidth","innerHeight","URL","createObjectURL","download","click","revokeObjectURL","showPerformanceMonitor","inputs","twMerge","clsx"],"sourceRoot":""}