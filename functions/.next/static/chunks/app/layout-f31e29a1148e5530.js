try{!function(){const e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="59f916e3-2af7-40b2-8451-123686c4cce0",e._sentryDebugIdIdentifier="sentry-dbid-59f916e3-2af7-40b2-8451-123686c4cce0")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{95300:function(e,t,n){Promise.resolve().then(n.t.bind(n,39974,23)),Promise.resolve().then(n.t.bind(n,2778,23)),Promise.resolve().then(n.bind(n,72760)),Promise.resolve().then(n.bind(n,73722)),Promise.resolve().then(n.bind(n,93344)),Promise.resolve().then(n.bind(n,67205)),Promise.resolve().then(n.bind(n,87775))},72760:function(e,t,n){"use strict";n.d(t,{NetworkStatusIndicator:function(){return r}});const s=n(57437),i=n(75395),a=n(45630);function r(){const{isOnline:e}=(0,a.k)();return e?null:(0,s.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 bg-red-600 text-white p-4 text-center z-50 flex items-center justify-center",children:[(0,s.jsx)(i.Z,{className:"mr-2 h-5 w-5"}),(0,s.jsx)("p",{children:"You are currently offline. Some features may be unavailable."})]})}},73722:function(e,t,n){"use strict";n.d(t,{default:function(){return eZ}});const s=n(57437),i=n(85687),a=n(1469),r=n(12381),o=n(27638),c=n(99376),l=n(27648),d=n(2265),u=n(79820),m=n(92735),h=n(32489);function f(){const[e,t]=(0,d.useState)(null),[n,i]=(0,d.useState)(!1),[a,o]=(0,d.useState)(!1);(0,d.useEffect)(()=>{if(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone){o(!0);return}const e=e=>{e.preventDefault(),t(e),i(!0)},n=()=>{o(!0),i(!1),t(null)};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",n),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",n)}},[]);const c=async()=>{if(!e)return;await e.prompt();const{outcome:n}=await e.userChoice;"accepted"===n?console.log("User accepted the install prompt"):console.log("User dismissed the install prompt"),t(null),i(!1)},l=()=>{i(!1),sessionStorage.setItem("pwa-prompt-dismissed","true")};return a||!n||sessionStorage.getItem("pwa-prompt-dismissed")?null:(0,s.jsxs)(u.Zb,{className:"mb-4 status-brand border",children:[(0,s.jsxs)(u.Ol,{className:"pb-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.Z,{className:"h-5 w-5 text-brand-primary"}),(0,s.jsx)(u.ll,{className:"text-lg text-brand-primary",children:"Install Schools In"})]}),(0,s.jsx)(r.z,{variant:"ghost",size:"sm",onClick:l,children:(0,s.jsx)(h.Z,{className:"h-4 w-4"})})]}),(0,s.jsx)(u.SZ,{className:"text-brand-primary/80",children:"Install the app for faster access and offline functionality"})]}),(0,s.jsx)(u.aY,{className:"pt-0",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(r.z,{onClick:c,className:"btn-brand-primary",children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Install App"]}),(0,s.jsx)(r.z,{variant:"outline",onClick:l,children:"Not Now"})]})})]})}const y=n(82431);function g(){const[e,t]=(0,d.useState)(!1),[n,i]=(0,d.useState)(null);(0,d.useEffect)(()=>{"serviceWorker"in navigator&&(navigator.serviceWorker.ready.then(e=>{i(e),e.addEventListener("updatefound",()=>{const n=e.installing;n&&n.addEventListener("statechange",()=>{"installed"===n.state&&navigator.serviceWorker.controller&&t(!0)})})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}))},[]);const a=()=>{t(!1)};return e?(0,s.jsxs)(u.Zb,{className:"mb-4 border-green-200 bg-green-50",children:[(0,s.jsxs)(u.Ol,{className:"pb-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(y.Z,{className:"h-5 w-5 text-green-600"}),(0,s.jsx)(u.ll,{className:"text-lg text-green-900",children:"Update Available"})]}),(0,s.jsx)(r.z,{variant:"ghost",size:"sm",onClick:a,children:(0,s.jsx)(h.Z,{className:"h-4 w-4"})})]}),(0,s.jsx)(u.SZ,{className:"text-green-700",children:"A new version of Schools In is available with improvements and bug fixes"})]}),(0,s.jsx)(u.aY,{className:"pt-0",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(r.z,{onClick:()=>{(null==n?void 0:n.waiting)&&n.waiting.postMessage({type:"SKIP_WAITING"}),t(!1)},className:"bg-green-600 hover:bg-green-700",children:[(0,s.jsx)(y.Z,{className:"h-4 w-4 mr-2"}),"Update Now"]}),(0,s.jsx)(r.z,{variant:"outline",onClick:a,children:"Later"})]})})]}):null}const p=n(69174),w=n(62926),S=n(75395),x=n(91723),v=n(33388),N=n(99897),b=n(90960);const A={SCHOOLS:"schools",SESSIONS:"sessions",PENDING_ACTIONS:"pending-actions",USER_DATA:"user-data"};async function j(){return(0,b.X3)("schools-in-offline",1,{upgrade(e){if(e.objectStoreNames.contains(A.SCHOOLS)||e.createObjectStore(A.SCHOOLS,{keyPath:"id"}).createIndex("name","name"),!e.objectStoreNames.contains(A.SESSIONS)){const t=e.createObjectStore(A.SESSIONS,{keyPath:"id"});t.createIndex("userId","userId"),t.createIndex("schoolId","schoolId"),t.createIndex("startTime","startTime")}if(!e.objectStoreNames.contains(A.PENDING_ACTIONS)){const t=e.createObjectStore(A.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});t.createIndex("timestamp","timestamp"),t.createIndex("type","type")}e.objectStoreNames.contains(A.USER_DATA)||e.createObjectStore(A.USER_DATA,{keyPath:"id"})}})}async function I(e){const t=(await j()).transaction(A.SCHOOLS,"readwrite");for(const n of e)await t.store.put(n);await t.done}async function k(e){const t=await j(),n=await t.getAll(A.SCHOOLS);return e?n.filter(t=>{let n;return null===(n=t.assignedProviders)||void 0===n?void 0:n.includes(e)}):n}async function C(e){const t=(await j()).transaction(A.SESSIONS,"readwrite");for(const n of e)await t.store.put(n);await t.done}async function E(e){const t=await j();return e?await t.getAllFromIndex(A.SESSIONS,"userId",e):await t.getAll(A.SESSIONS)}async function O(e){const t=await j();await t.add(A.PENDING_ACTIONS,{...e,timestamp:e.timestamp||Date.now(),retry:e.retry||0})}async function T(e){const t=await j();await t.put(A.USER_DATA,{id:"current-user",...e})}async function D(){const e=await j();return await e.get(A.USER_DATA,"current-user")}async function P(){const e=await j();for(const t of(await e.getAll(A.PENDING_ACTIONS)))try{let n;if("check-in"===t.type)n=await fetch("/api/sessions/check-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.data)});else{if("check-out"!==t.type)continue;n=await fetch("/api/sessions/check-out",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.data)})}n.ok?await e.delete(A.PENDING_ACTIONS,t.id):(t.retry=(t.retry||0)+1,await e.put(A.PENDING_ACTIONS,t))}catch(n){console.error("Failed to sync action:",n),t.retry=(t.retry||0)+1,await e.put(A.PENDING_ACTIONS,t)}}async function M(){const e=await j();await Promise.all([e.clear(A.SCHOOLS),e.clear(A.SESSIONS),e.clear(A.PENDING_ACTIONS),e.clear(A.USER_DATA)])}class _{static getInstance(){return _.instance||(_.instance=new _),_.instance}setupEventListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.onOnline()}),window.addEventListener("offline",()=>{this.isOnline=!1,this.onOffline()}),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",e=>{this.handleServiceWorkerMessage(e)})}async initializeOfflineDB(){try{await j(),console.log("Offline database initialized")}catch(e){console.error("Failed to initialize offline database:",e)}}async onOnline(){console.log("Device came online"),this.syncInProgress||await this.performBackgroundSync(),this.notifyStatusChange("online")}onOffline(){console.log("Device went offline"),this.notifyStatusChange("offline")}handleServiceWorkerMessage(e){const{data:t}=e;switch(t.type){case"BACKGROUND_SYNC":this.performBackgroundSync();break;case"CACHE_UPDATE":this.notifyStatusChange("cache-updated");break;default:console.log("Unknown service worker message:",t)}}notifyStatusChange(e){window.dispatchEvent(new CustomEvent("service-manager-status",{detail:{status:e,isOnline:this.isOnline}}))}isDeviceOnline(){return this.isOnline}async cacheUserSchools(e){try{await I(e),console.log("Cached ".concat(e.length," schools for offline use"))}catch(e){console.error("Failed to cache school data:",e)}}async getOfflineSchools(e){try{return await k(e)}catch(e){return console.error("Failed to get offline schools:",e),[]}}async cacheUserSessions(e){try{await C(e),console.log("Cached ".concat(e.length," sessions for offline use"))}catch(e){console.error("Failed to cache session data:",e)}}async getOfflineSessions(e){try{return await E(e)}catch(e){return console.error("Failed to get offline sessions:",e),[]}}async performOfflineCheckIn(e){try{if(this.isOnline){const t=await fetch("/api/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Check-in failed");return await t.json()}{await O({type:"check-in",data:e,timestamp:Date.now()});const t={id:"offline-".concat(Date.now()),...e,status:"pending-sync",startTime:new Date(e.timestamp).toISOString()};return await C([t]),console.log("Check-in queued for offline sync"),t}}catch(e){throw console.error("Check-in error:",e),e}}async performOfflineCheckOut(e){try{if(!this.isOnline)return await O({type:"check-out",data:e,timestamp:Date.now()}),console.log("Check-out queued for offline sync"),{status:"pending-sync"};{const t=await fetch("/api/sessions/".concat(e.sessionId),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({endTime:new Date(e.timestamp).toISOString(),endCoordinates:e.coordinates,status:"completed"})});if(!t.ok)throw Error("Check-out failed");return await t.json()}}catch(e){throw console.error("Check-out error:",e),e}}async performBackgroundSync(){if(!this.syncInProgress&&this.isOnline){this.syncInProgress=!0,console.log("Starting background sync...");try{await P(),console.log("Background sync completed"),this.notifyStatusChange("sync-completed")}catch(e){console.error("Background sync failed:",e),this.notifyStatusChange("sync-failed")}finally{this.syncInProgress=!1}}}async cacheCurrentUser(e){try{await T(e)}catch(e){console.error("Failed to cache user data:",e)}}async getOfflineUserData(){try{return await D()}catch(e){return console.error("Failed to get offline user data:",e),null}}async clearAllOfflineData(){try{await M(),console.log("All offline data cleared")}catch(e){console.error("Failed to clear offline data:",e)}}getSyncStatus(){return{isOnline:this.isOnline,syncInProgress:this.syncInProgress}}constructor(){this.isOnline=!0,this.syncInProgress=!1,this.isOnline=navigator.onLine,this.setupEventListeners(),this.initializeOfflineDB()}}const R=_.getInstance();function L(){const[e,t]=(0,d.useState)(!1),[n,i]=(0,d.useState)("not-supported"),{isOnline:a,syncInProgress:r,lastSyncTime:o}=function(){const[e,t]=(0,d.useState)({isOnline:!0,syncInProgress:!1,pendingActions:0,lastSyncTime:null});(0,d.useEffect)(()=>{(()=>{const{isOnline:e,syncInProgress:n}=R.getSyncStatus();t(t=>({...t,isOnline:e,syncInProgress:n}))})();const e=e=>{const{status:n,isOnline:s}=e.detail;t(e=>({...e,isOnline:s,syncInProgress:"sync-started"===n,lastSyncTime:"sync-completed"===n?new Date:e.lastSyncTime}))};window.addEventListener("service-manager-status",e);const n=()=>t(e=>({...e,isOnline:!0})),s=()=>t(e=>({...e,isOnline:!1}));return window.addEventListener("online",n),window.addEventListener("offline",s),()=>{window.removeEventListener("service-manager-status",e),window.removeEventListener("online",n),window.removeEventListener("offline",s)}},[]);const n=(0,d.useCallback)(async e=>{try{t(e=>({...e,syncInProgress:!0}));const n=await R.performOfflineCheckIn(e);return t(e=>({...e,syncInProgress:!1})),n}catch(e){throw t(e=>({...e,syncInProgress:!1})),e}},[]),s=(0,d.useCallback)(async e=>{try{t(e=>({...e,syncInProgress:!0}));const n=await R.performOfflineCheckOut(e);return t(e=>({...e,syncInProgress:!1})),n}catch(e){throw t(e=>({...e,syncInProgress:!1})),e}},[]),i=(0,d.useCallback)(async e=>await R.getOfflineSchools(e),[]),a=(0,d.useCallback)(async e=>await R.getOfflineSessions(e),[]),r=(0,d.useCallback)(async()=>{t(e=>({...e,syncInProgress:!0}));try{await R.performBackgroundSync(),t(e=>({...e,syncInProgress:!1,lastSyncTime:new Date}))}catch(e){throw t(e=>({...e,syncInProgress:!1})),e}},[]),o=(0,d.useCallback)(async()=>{await R.clearAllOfflineData(),t(e=>({...e,pendingActions:0,lastSyncTime:null}))},[]);return{isOnline:e.isOnline,syncInProgress:e.syncInProgress,lastSyncTime:e.lastSyncTime,checkInOffline:n,checkOutOffline:s,syncOfflineActions:r,getCachedSchools:i,getCachedSessions:a,clearOfflineData:o}}();return(0,d.useEffect)(()=>{const e=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://");t(e),e?i("installed"):"beforeinstallprompt"in window?i("installable"):i("not-supported")},[]),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(p.C,{variant:a?"secondary":"destructive",className:"flex items-center gap-1",children:[a?(0,s.jsx)(w.Z,{className:"h-3 w-3"}):(0,s.jsx)(S.Z,{className:"h-3 w-3"}),a?"Online":"Offline"]}),r&&(0,s.jsxs)(p.C,{variant:"outline",className:"flex items-center gap-1",children:[(0,s.jsx)(y.Z,{className:"h-3 w-3 animate-spin"}),"Syncing"]}),o&&!r&&(0,s.jsxs)(p.C,{variant:"outline",className:"flex items-center gap-1",children:[(0,s.jsx)(x.Z,{className:"h-3 w-3"}),"Synced ",new Date(o).toLocaleTimeString()]}),e&&(0,s.jsxs)(p.C,{variant:"default",className:"flex items-center gap-1",children:[(0,s.jsx)(v.Z,{className:"h-3 w-3"}),"App Mode"]}),"installable"===n&&(0,s.jsxs)(p.C,{variant:"outline",className:"flex items-center gap-1",children:[(0,s.jsx)(N.Z,{className:"h-3 w-3"}),"Installable"]})]})}const z=n(45630);let F={SCHOOLS:"schools_cache",SESSIONS:"sessions_cache",USER_DATA:"user_data_cache",LOCATION_DATA:"location_cache",CACHE_METADATA:"cache_metadata",PENDING_ACTIONS:"pending_actions"},H=null;async function U(){return H||(H=await (0,b.X3)("schools-in-cache",2,{upgrade(e,t){if(!e.objectStoreNames.contains(F.SCHOOLS)){const t=e.createObjectStore(F.SCHOOLS,{keyPath:"id"});t.createIndex("name","name"),t.createIndex("region","region"),t.createIndex("assignedProviders","assignedProviders",{multiEntry:!0})}if(!e.objectStoreNames.contains(F.SESSIONS)){const t=e.createObjectStore(F.SESSIONS,{keyPath:"id"});t.createIndex("userId","userId"),t.createIndex("schoolId","schoolId"),t.createIndex("startTime","startTime"),t.createIndex("status","status")}if(!e.objectStoreNames.contains(F.USER_DATA)){const t=e.createObjectStore(F.USER_DATA,{keyPath:"id"});t.createIndex("role","role"),t.createIndex("lastActive","lastActive")}if(!e.objectStoreNames.contains(F.LOCATION_DATA)){const t=e.createObjectStore(F.LOCATION_DATA,{keyPath:"id"});t.createIndex("timestamp","timestamp"),t.createIndex("accuracy","accuracy")}if(!e.objectStoreNames.contains(F.CACHE_METADATA)){const t=e.createObjectStore(F.CACHE_METADATA,{keyPath:"id"});t.createIndex("expiresAt","expiresAt"),t.createIndex("lastAccessed","lastAccessed"),t.createIndex("accessCount","accessCount")}if(!e.objectStoreNames.contains(F.PENDING_ACTIONS)){const t=e.createObjectStore(F.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});t.createIndex("timestamp","timestamp"),t.createIndex("type","type"),t.createIndex("priority","priority")}}}))}const q=n(25566);const B={CHECK_IN:"check_in",CHECK_OUT:"check_out",SESSION_UPDATE:"session_update",LOCATION_UPDATE:"location_update"},Z={PENDING:"pending",SYNCING:"syncing",SYNCED:"synced",FAILED:"failed",CANCELLED:"cancelled"},G={MAX_RETRY_ATTEMPTS:3,SYNC_INTERVAL:3e4,BATCH_SIZE:10,EXPIRATION_TIME:6048e5};async function W(){try{await U(),console.log("Action queue initialized successfully")}catch(e){throw console.error("Failed to initialize action queue:",e),e}}async function K(e,t,n,s){try{const i=await U(),a="action_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),r=Date.now(),o={id:a,type:e,payload:t,timestamp:r,status:Z.PENDING,retryCount:0,maxRetries:G.MAX_RETRY_ATTEMPTS,userId:n,metadata:{userAgent:navigator.userAgent,appVersion:q.env.NEXT_PUBLIC_APP_VERSION||"1.0.0",platform:navigator.platform,networkStatus:navigator.onLine?"online":"offline",...null==s?void 0:s.metadata},...s,_cached:!0,_cachedAt:r,_expiresAt:r+G.EXPIRATION_TIME};return await i.add(F.PENDING_ACTIONS,o),console.log("Action queued: ".concat(e," for user ").concat(n),o),navigator.onLine&&setTimeout(()=>$(),100),a}catch(e){throw console.error("Failed to queue action:",e),e}}async function Y(e,t,n){const s={schoolId:e,userId:t,location:{...n,timestamp:Date.now()},action:"check_in",timestamp:Date.now()};return K(B.CHECK_IN,s,t,{schoolId:e,location:{...n,timestamp:Date.now()}})}async function Q(e,t,n){const s={sessionId:e,userId:t,location:{...n,timestamp:Date.now()},action:"check_out",timestamp:Date.now()};return K(B.CHECK_OUT,s,t,{sessionId:e,location:{...n,timestamp:Date.now()}})}async function X(e){try{let t=await U(),n=(await t.getAll(F.PENDING_ACTIONS)).filter(e=>e.status===Z.PENDING||e.status===Z.FAILED);return e&&(n=n.filter(t=>t.userId===e)),n.sort((e,t)=>e.timestamp-t.timestamp),n}catch(e){return console.error("Failed to get pending actions:",e),[]}}async function J(e,t,n){try{const s=await U(),i=await s.get(F.PENDING_ACTIONS,e);i&&(i.status=t,i._cachedAt=Date.now(),t===Z.FAILED&&n&&(i.errorMessage=n,i.retryCount+=1),t===Z.SYNCED&&(i.syncedAt=Date.now()),await s.put(F.PENDING_ACTIONS,i))}catch(e){console.error("Failed to update action status:",e)}}async function V(){try{let e=await U(),t=await e.getAll(F.PENDING_ACTIONS),n=0,s=Date.now();for(const i of t)(i.status===Z.SYNCED||i.status===Z.CANCELLED||i._expiresAt&&i._expiresAt<s||i.retryCount>=i.maxRetries&&i.status===Z.FAILED)&&(await e.delete(F.PENDING_ACTIONS,i.id),n++);return n>0&&console.log("Removed ".concat(n," completed actions from queue")),n}catch(e){return console.error("Failed to remove completed actions:",e),0}}async function $(){try{const e=await X();if(0===e.length)return{processed:0,synced:0,failed:0};console.log("Processing ".concat(e.length," pending actions"));let t=0,n=0,s=0,i=function(e,t){const n=[];for(let s=0;s<e.length;s+=t)n.push(e.slice(s,s+t));return n}(e,G.BATCH_SIZE);for(const e of i)(await Promise.allSettled(e.map(e=>ee(e)))).forEach((i,a)=>{s++,"fulfilled"===i.status&&i.value?t++:(n++,console.error("Failed to process action ".concat(e[a].id,":"),"rejected"===i.status?i.reason:"Unknown error"))}),i.length>1&&await new Promise(e=>setTimeout(e,500));return await V(),console.log("Queue processing complete: ".concat(t," synced, ").concat(n," failed")),{processed:s,synced:t,failed:n}}catch(e){return console.error("Failed to process queue:",e),{processed:0,synced:0,failed:0}}}async function ee(e){try{await J(e.id,Z.SYNCING);let t=!1;switch(e.type){case B.CHECK_IN:t=await et(e);break;case B.CHECK_OUT:t=await en(e);break;case B.SESSION_UPDATE:t=await es(e);break;case B.LOCATION_UPDATE:t=await ei(e);break;default:console.warn("Unknown action type: ".concat(e.type)),t=!1}return t?await J(e.id,Z.SYNCED):await J(e.id,Z.FAILED,"Sync operation failed"),t}catch(n){console.error("Error processing action ".concat(e.id,":"),n);const t=n instanceof Error?n.message:"Unknown error";return await J(e.id,Z.FAILED,t),!1}}async function et(e){try{const t=await fetch("/api/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e.payload,queuedActionId:e.id,originalTimestamp:e.timestamp})});if(!t.ok)throw Error("HTTP ".concat(t.status,": ").concat(t.statusText));const n=await t.json();return console.log("Check-in synced successfully:",n),!0}catch(e){return console.error("Failed to sync check-in:",e),!1}}async function en(e){try{const t=await fetch("/api/sessions",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e.payload,queuedActionId:e.id,originalTimestamp:e.timestamp})});if(!t.ok)throw Error("HTTP ".concat(t.status,": ").concat(t.statusText));const n=await t.json();return console.log("Check-out synced successfully:",n),!0}catch(e){return console.error("Failed to sync check-out:",e),!1}}async function es(e){try{const t=await fetch("/api/sessions/".concat(e.sessionId),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e.payload,queuedActionId:e.id,originalTimestamp:e.timestamp})});if(!t.ok)throw Error("HTTP ".concat(t.status,": ").concat(t.statusText));const n=await t.json();return console.log("Session update synced successfully:",n),!0}catch(e){return console.error("Failed to sync session update:",e),!1}}async function ei(e){try{const t=await fetch("/api/locations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e.payload,queuedActionId:e.id,originalTimestamp:e.timestamp})});if(!t.ok)throw Error("HTTP ".concat(t.status,": ").concat(t.statusText));const n=await t.json();return console.log("Location update synced successfully:",n),!0}catch(e){return console.error("Failed to sync location update:",e),!1}}async function ea(){try{const e=await U(),t=await e.getAll(F.PENDING_ACTIONS),n={total:t.length,pending:0,syncing:0,synced:0,failed:0,cancelled:0,oldestPending:void 0,newestPending:void 0},s=[];return t.forEach(e=>{switch(e.status){case Z.PENDING:n.pending++,s.push(e.timestamp);break;case Z.SYNCING:n.syncing++;break;case Z.SYNCED:n.synced++;break;case Z.FAILED:n.failed++;break;case Z.CANCELLED:n.cancelled++}}),s.length>0&&(n.oldestPending=Math.min(...s),n.newestPending=Math.max(...s)),n}catch(e){return console.error("Failed to get queue stats:",e),{total:0,pending:0,syncing:0,synced:0,failed:0,cancelled:0}}}const er={CHECK_IN:"high",CHECK_OUT:"critical",SESSION_UPDATE:"medium",LOCATION_UPDATE:"low"};class eo{async sync(e){const t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isSyncing&&!t)return this.config.debugMode&&console.log("Sync already in progress, skipping"),this.createSkippedResult("Already syncing");this.isSyncing=!0,this.lastNetworkStatus=e;const n=Date.now();try{const s=this.determineSyncStrategy(e);if(!s.shouldSync&&!t)return this.config.debugMode&&console.log("Sync skipped due to poor network conditions"),this.createSkippedResult("Poor network conditions");this.config.debugMode&&console.log("Starting sync with strategy: ".concat(s.name),s);const i=await X();if(0===i.length)return this.createSuccessResult(0,0,0,0,Date.now()-n,e.connectivityScore,s.name);const a=this.config.enablePrioritySync?this.prioritizeActions(i):i,r=await this.executeSyncStrategy(a,s,e);return this.recordSyncResult(r),await V(),this.config.debugMode&&console.log("Sync completed:",r),r}catch(i){const t=i instanceof Error?i.message:"Unknown sync error";console.error("Sync failed:",i);const s=this.createFailureResult(t,Date.now()-n,e.connectivityScore);return this.recordSyncResult(s),s}finally{this.isSyncing=!1}}determineSyncStrategy(e){const{connectivityScore:t,effectiveType:n,downlink:s,rtt:i,saveData:a}=e;return!e.isConnected||t<20?{name:"no-sync",batchSize:0,concurrency:0,timeout:0,shouldSync:!1,priority:"low"}:t>=80&&s>=5&&i<=50?{name:"aggressive",batchSize:2*G.BATCH_SIZE,concurrency:this.config.maxConcurrentSyncs,timeout:this.config.syncTimeoutMs,shouldSync:!0,priority:"high"}:t>=60&&s>=2&&i<=100?{name:"normal",batchSize:G.BATCH_SIZE,concurrency:Math.max(2,this.config.maxConcurrentSyncs-1),timeout:this.config.syncTimeoutMs,shouldSync:!0,priority:"medium"}:t>=40?{name:"conservative",batchSize:Math.max(3,Math.floor(G.BATCH_SIZE/2)),concurrency:1,timeout:1.5*this.config.syncTimeoutMs,shouldSync:!0,priority:"medium"}:t>=20||a?{name:"minimal",batchSize:2,concurrency:1,timeout:2*this.config.syncTimeoutMs,shouldSync:!0,priority:"critical"}:{name:"fallback-no-sync",batchSize:0,concurrency:0,timeout:0,shouldSync:!1,priority:"low"}}prioritizeActions(e){const t=Date.now();return e.sort((e,n)=>{const s=er[e.type]||"low",i=er[n.type]||"low",a={critical:4,high:3,medium:2,low:1},r=a[i]-a[s];if(0!==r)return r;const o=t-e.timestamp,c=t-n.timestamp,l=o>this.config.priorityThresholdMs,d=c>this.config.priorityThresholdMs;if(l&&!d)return -1;if(d&&!l)return 1;const u=e.retryCount-n.retryCount;return 0!==u?u:e.timestamp-n.timestamp})}async executeSyncStrategy(e,t,n){let s=Date.now(),i=0,a=0,r=0,o=0,c=[],l=e;"critical"===t.priority&&(l=e.filter(e=>{const t=er[e.type];return"critical"===t||"high"===t}));const d=this.chunkArray(l,t.batchSize);for(const e of d){const s=e.slice(0,t.concurrency).map(async e=>{try{i++,await J(e.id,Z.SYNCING);const n=new Promise((e,n)=>{setTimeout(()=>n(Error("Sync timeout")),t.timeout)}),s=this.syncSingleAction(e);if(await Promise.race([s,n]))a++,await J(e.id,Z.SYNCED);else throw Error("Sync failed")}catch(s){r++;const t=s instanceof Error?s.message:"Unknown error",n=e.retryCount<e.maxRetries;c.push({actionId:e.id,error:t,willRetry:n}),n?await J(e.id,Z.PENDING):await J(e.id,Z.FAILED)}});await Promise.allSettled(s),d.length>1&&n.connectivityScore<50&&await this.delay(1e3*(d.length-1))}o=e.length-l.length;const u=Date.now()-s;return this.createSuccessResult(i,a,r,o,u,n.connectivityScore,t.name,c)}async syncSingleAction(e){try{return(await $()).synced>0}catch(e){return!1}}getSyncRecommendations(e){const t=this.determineSyncStrategy(e),n=this.getLastKnownPendingCount(),s=this.estimateSyncDuration(n,t);if(!t.shouldSync){const n=this.calculateOptimalRetryDelay(e);return{shouldSync:!1,strategy:t.name,reason:"Network conditions not suitable (score: ".concat(e.connectivityScore,")"),estimatedDuration:0,recommendedDelay:n}}return{shouldSync:!0,strategy:t.name,reason:"Good conditions for ".concat(t.name," sync (score: ").concat(e.connectivityScore,")"),estimatedDuration:s}}getSyncHistory(){return[...this.syncHistory].sort((e,t)=>t.timestamp-e.timestamp)}getSyncStatistics(){if(0===this.syncHistory.length)return{totalSyncs:0,successRate:0,averageDuration:0,averageNetworkScore:0,strategyCounts:{}};const e=this.syncHistory.length,t=this.syncHistory.filter(e=>e.result.success).length,n=this.syncHistory.reduce((e,t)=>e+t.result.duration,0)/e,s=this.syncHistory.reduce((e,t)=>e+t.result.networkScore,0)/e,i={};return this.syncHistory.forEach(e=>{i[e.result.strategy]=(i[e.result.strategy]||0)+1}),{totalSyncs:e,successRate:t/e*100,averageDuration:n,averageNetworkScore:s,strategyCounts:i}}recordSyncResult(e){this.syncHistory.push({timestamp:Date.now(),result:e}),this.syncHistory.length>100&&(this.syncHistory=this.syncHistory.slice(-100))}getLastKnownPendingCount(){return 5}estimateSyncDuration(e,t){let n;return 0===e?0:Math.max(1e3,Math.min(6e4,1e3*e*((null===(n=this.lastNetworkStatus)||void 0===n?void 0:n.connectivityScore)?100/this.lastNetworkStatus.connectivityScore:2)/t.concurrency))}calculateOptimalRetryDelay(e){return 3e4*(1+(100-e.connectivityScore)/100*2)}createSuccessResult(e,t,n,s,i,a,r){const o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[];return{success:0===n||t>0,processed:e,synced:t,failed:n,skipped:s,duration:i,networkScore:a,strategy:r,errors:o}}createFailureResult(e,t,n){return{success:!1,processed:0,synced:0,failed:1,skipped:0,duration:t,networkScore:n,strategy:"failed",errors:[{actionId:"unknown",error:e,willRetry:!1}]}}createSkippedResult(e){let t;return{success:!0,processed:0,synced:0,failed:0,skipped:1,duration:0,networkScore:(null===(t=this.lastNetworkStatus)||void 0===t?void 0:t.connectivityScore)||0,strategy:"skipped",errors:[]}}chunkArray(e,t){const n=[];for(let s=0;s<e.length;s+=t)n.push(e.slice(s,s+t));return n}delay(e){return new Promise(t=>setTimeout(t,e))}constructor(e={}){this.isSyncing=!1,this.syncHistory=[],this.config={enableAdaptiveSync:!0,enablePrioritySync:!0,enableBatchOptimization:!0,enableRetryOptimization:!0,maxConcurrentSyncs:3,syncTimeoutMs:3e4,priorityThresholdMs:3e5,debugMode:!1,...e}}}const ec=new eo({enableAdaptiveSync:!0,enablePrioritySync:!0,enableBatchOptimization:!0,enableRetryOptimization:!0,debugMode:!1});class el{async initialize(){try{await W(),this.isInitialized=!0,this.config.enableAutoSync&&this.startAutoSync(),this.config.enableBackgroundSync&&this.setupBackgroundSync(),this.setupNetworkListeners(),this.config.debugMode&&console.log("QueueManager initialized with config:",this.config)}catch(e){console.error("Failed to initialize QueueManager:",e)}}async checkIn(e,t,n){if(!this.isInitialized)throw Error("QueueManager not initialized");try{if(navigator.onLine){const s=await fetch("/api/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schoolId:e,userId:t,location:{...n,timestamp:Date.now()},action:"check_in",timestamp:Date.now()})});if(s.ok){const e=await s.json();return this.config.debugMode&&console.log("Check-in completed online:",e),{success:!0,sessionId:e.sessionId,offline:!1}}this.config.debugMode&&console.log("API call failed, falling back to offline queue")}const s=await Y(e,t,n);return this.config.debugMode&&console.log("Check-in queued for offline processing:",s),this.notifyListeners(),{success:!0,actionId:s,offline:!0}}catch(e){return console.error("Failed to process check-in:",e),{success:!1}}}async checkOut(e,t,n){if(!this.isInitialized)throw Error("QueueManager not initialized");try{if(navigator.onLine){const s=await fetch("/api/sessions",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e,userId:t,location:{...n,timestamp:Date.now()},action:"check_out",timestamp:Date.now()})});if(s.ok){const e=await s.json();return this.config.debugMode&&console.log("Check-out completed online:",e),{success:!0,offline:!1}}this.config.debugMode&&console.log("API call failed, falling back to offline queue")}const s=await Q(e,t,n);return this.config.debugMode&&console.log("Check-out queued for offline processing:",s),this.notifyListeners(),{success:!0,actionId:s,offline:!0}}catch(e){return console.error("Failed to process check-out:",e),{success:!1}}}async getPendingActions(e){if(!this.isInitialized)return[];try{return await X(e)}catch(e){return console.error("Failed to get pending actions:",e),[]}}async getStats(){if(!this.isInitialized)return{total:0,pending:0,syncing:0,synced:0,failed:0,cancelled:0};try{return await ea()}catch(e){return console.error("Failed to get queue stats:",e),{total:0,pending:0,syncing:0,synced:0,failed:0,cancelled:0}}}async syncNow(){const e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isInitialized)return null;if(this.isProcessing&&!e)return this.config.debugMode&&console.log("Sync already in progress, skipping"),null;try{if(this.isProcessing=!0,this.config.enableIntelligentSync&&this.networkStatus){this.config.debugMode&&console.log("Using intelligent sync strategy");const t=await ec.sync(this.networkStatus,e);return this.lastSyncResult=t,this.config.debugMode&&console.log("Intelligent sync completed:",t),this.notifyListeners(),{processed:t.processed,synced:t.synced,failed:t.failed,strategy:t.strategy,networkScore:t.networkScore}}{if(!navigator.onLine&&!e)return this.config.debugMode&&console.log("Device offline, skipping sync"),null;const t=await $();return this.config.debugMode&&console.log("Basic sync completed:",t),this.notifyListeners(),t}}catch(e){return console.error("Failed to sync queue:",e),null}finally{this.isProcessing=!1}}addStatsListener(e){return this.listeners.add(e),this.getStats().then(t=>e(t)),()=>{this.listeners.delete(e)}}updateNetworkStatus(e){this.networkStatus=e,this.config.debugMode&&console.log("Network status updated:",e),this.config.enableIntelligentSync&&e.isOnline&&!this.isProcessing&&ec.getSyncRecommendations(e).shouldSync&&this.syncNow().catch(e=>{console.error("Auto-sync after network update failed:",e)})}getLastSyncResult(){return this.lastSyncResult}getSyncRecommendations(){return this.networkStatus?ec.getSyncRecommendations(this.networkStatus):{shouldSync:!1,reason:"No network status available"}}startAutoSync(){this.syncInterval&&clearInterval(this.syncInterval),this.syncInterval=setInterval(async()=>{if(!this.isProcessing&&(await this.getStats()).pending>0){if(this.config.enableIntelligentSync&&this.networkStatus){const e=ec.getSyncRecommendations(this.networkStatus);e.shouldSync?await this.syncNow():this.config.debugMode&&console.log("Auto-sync skipped:",e.reason)}else navigator.onLine&&await this.syncNow()}},this.config.syncInterval),this.config.debugMode&&console.log("Auto-sync started with interval: ".concat(this.config.syncInterval,"ms"))}setupBackgroundSync(){setInterval(async()=>{if(this.isInitialized)try{const e=await V();e>0&&this.config.debugMode&&console.log("Background cleanup removed ".concat(e," completed actions"))}catch(e){console.error("Background cleanup failed:",e)}},3e5)}setupNetworkListeners(){const e=async()=>{this.config.debugMode&&console.log("Network connectivity restored"),this.config.enableIntelligentSync||setTimeout(async()=>{await this.syncNow()},1e3)};window.addEventListener("online",e),window.addEventListener("offline",()=>{this.config.debugMode&&console.log("Network connectivity lost, switching to offline mode")})}async notifyListeners(){if(this.listeners.size>0)try{const e=await this.getStats();this.listeners.forEach(t=>{try{t(e)}catch(e){console.error("Error in stats listener:",e)}})}catch(e){console.error("Failed to notify listeners:",e)}}async hasPendingActions(){return(await this.getStats()).pending>0}async hasFailedActions(){return(await this.getStats()).failed>0}isOffline(){return!navigator.onLine}destroy(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null),this.listeners.clear(),this.isInitialized=!1,this.config.debugMode&&console.log("QueueManager destroyed")}constructor(e={}){this.syncInterval=null,this.isInitialized=!1,this.isProcessing=!1,this.listeners=new Set,this.networkStatus=null,this.lastSyncResult=null,this.config={enableAutoSync:!0,syncInterval:G.SYNC_INTERVAL,enableBackgroundSync:!0,maxRetryAttempts:G.MAX_RETRY_ATTEMPTS,debugMode:!1,enableIntelligentSync:!0,connectivityRestoration:{enableAutoSync:!0,enableGradualSync:!0,stabilityWaitMs:2e3,maxSyncAttempts:3,syncRetryDelayMs:5e3,enableSyncNotifications:!0,debugMode:!1},...e},"undefined"!=typeof indexedDB&&this.initialize()}}const ed="undefined"!=typeof indexedDB?new el({enableAutoSync:!0,enableBackgroundSync:!0,enableIntelligentSync:!0,debugMode:!1}):{},eu={enableAutoSync:!0,enableGradualSync:!0,stabilityWaitMs:2e3,maxSyncAttempts:3,syncRetryDelayMs:5e3,enableSyncNotifications:!0,debugMode:!1};function em(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{autoRefreshInterval:t=5e3,enableDebugLogs:n=!1}=e,s=(0,z.k)(),i=function(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,z.k)(),[n,s]=(0,d.useState)({...eu,...e}),[i,a]=(0,d.useState)(!1),[r,o]=(0,d.useState)([]),[c,l]=(0,d.useState)(),u=(0,d.useRef)(),m=(0,d.useRef)(null),h=(0,d.useRef)(!1),f=(0,d.useRef)(0);(0,d.useEffect)(()=>{h.current=!t.isOnline,f.current=t.connectivityScore},[]);const y=(0,d.useCallback)(async function(e){const s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(i&&!s)throw n.debugMode&&console.log("Restoration already in progress, skipping"),Error("Restoration already in progress");a(!0);const r=Date.now(),c={timestamp:r,triggerReason:e,networkScore:t.connectivityScore,stabilityWaitTime:0,syncAttempts:0,syncResults:[],totalDuration:0,success:!1};try{n.debugMode&&(console.log("Starting connectivity restoration: ".concat(e)),console.log("Network status:",t)),n.enableGradualSync&&t.isUnstable&&(n.debugMode&&console.log("Waiting ".concat(n.stabilityWaitMs,"ms for connection stability")),c.stabilityWaitTime=n.stabilityWaitMs,await new Promise(e=>{u.current=setTimeout(e,n.stabilityWaitMs)}));const i=ec.getSyncRecommendations(t);if(!i.shouldSync&&!s)throw n.debugMode&&console.log("Sync not recommended after stability wait:",i.reason),i.recommendedDelay&&setTimeout(()=>{t.isOnline&&y("delayed-retry").catch(console.error)},i.recommendedDelay),Error("Sync not recommended: ".concat(i.reason));let a=null,d=0;for(;d<n.maxSyncAttempts;){d++,c.syncAttempts=d,n.debugMode&&console.log("Sync attempt ".concat(d,"/").concat(n.maxSyncAttempts));try{const e=await ec.sync(t,s);if(c.syncResults.push(e),a=e,e.success&&e.synced>0){c.success=!0,n.debugMode&&console.log("Sync successful:",e);break}if(e.success&&0===e.synced){c.success=!0,n.debugMode&&console.log("No actions to sync");break}if(n.debugMode&&console.log("Sync failed:",e),d<n.maxSyncAttempts){const e=n.syncRetryDelayMs*Math.pow(2,d-1);if(n.debugMode&&console.log("Waiting ".concat(e,"ms before retry")),await new Promise(t=>setTimeout(t,e)),!t.isOnline)throw Error("Connection lost during retry wait")}}catch(i){const e=i instanceof Error?i.message:"Unknown sync error";n.debugMode&&console.error("Sync attempt ".concat(d," failed:"),i);const s={success:!1,processed:0,synced:0,failed:1,skipped:0,duration:1e3,networkScore:t.connectivityScore,strategy:"error",errors:[{actionId:"unknown",error:e,willRetry:d<n.maxSyncAttempts}]};c.syncResults.push(s),a=s,d<n.maxSyncAttempts&&await new Promise(e=>setTimeout(e,n.syncRetryDelayMs))}}return c.totalDuration=Date.now()-r,n.debugMode&&console.log("Restoration completed:",c),l(c),o(e=>[...e,c].slice(-50)),n.enableSyncNotifications&&c.success&&function(e){if("Notification"in window&&"granted"===Notification.permission){const t=e.syncResults.reduce((e,t)=>e+t.synced,0);t>0&&new Notification("Sync Completed",{body:"Successfully synced ".concat(t," pending actions"),icon:"/icons/sync-icon.png",tag:"sync-completion"})}}(c),a||c.syncResults[c.syncResults.length-1]}catch(e){throw e instanceof Error&&e.message,n.debugMode&&console.error("Restoration failed:",e),c.totalDuration=Date.now()-r,c.success=!1,l(c),o(e=>[...e,c].slice(-50)),e}finally{a(!1),u.current&&(clearTimeout(u.current),u.current=void 0),m.current=null}},[n,t,i]),g=(0,d.useCallback)(async function(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"manual";return y(e,!0)},[y]),p=(0,d.useCallback)(()=>{m.current&&m.current(),u.current&&(clearTimeout(u.current),u.current=void 0),a(!1)},[]),w=(0,d.useCallback)(e=>{s(t=>({...t,...e}))},[]),S=(0,d.useCallback)(()=>{if(0===r.length)return{totalRestorations:0,successRate:0,averageDuration:0,averageSyncAttempts:0};const e=r.length,t=r.filter(e=>e.success).length,n=r.reduce((e,t)=>e+t.totalDuration,0)/e,s=r.reduce((e,t)=>e+t.syncAttempts,0)/e;return{totalRestorations:e,successRate:t/e*100,averageDuration:n,averageSyncAttempts:s}},[r]);return(0,d.useEffect)(()=>{const e=h.current,s=t.isOnline,i=t.connectivityScore,a=f.current;h.current=!s,f.current=i,n.enableAutoSync&&e&&s?(n.debugMode&&console.log("Network reconnection detected, triggering restoration"),y("reconnection").catch(e=>{console.error("Auto-restoration failed after reconnection:",e)})):n.enableAutoSync&&s&&i>a+30&&(n.debugMode&&console.log("Significant network quality improvement detected"),y("quality-improvement").catch(e=>{console.error("Auto-restoration failed after quality improvement:",e)}))},[t.isOnline,t.connectivityScore,n.enableAutoSync,n.debugMode,y]),(0,d.useEffect)(()=>()=>{p()},[p]),{isRestoring:i,lastRestoration:c,restorationHistory:r,triggerSync:g,cancelSync:p,updateConfig:w,getRestorationStats:S}}(e.restorationConfig),[a,r]=(0,d.useState)({total:0,pending:0,syncing:0,synced:0,failed:0,cancelled:0}),[o,c]=(0,d.useState)([]),[l,u]=(0,d.useState)(!1),[m,h]=(0,d.useState)(),[f,y]=(0,d.useState)(),[g,p]=(0,d.useState)({shouldSync:!1,reason:"No network status available"}),w=(0,d.useRef)(),S=(0,d.useRef)(null);(0,d.useEffect)(()=>{ed.updateNetworkStatus(s);const e=ed.getSyncRecommendations();p(e),n&&(console.log("Network status updated:",s),console.log("Sync recommendations:",e))},[s,n]),(0,d.useEffect)(()=>(S.current&&S.current(),S.current=ed.addStatsListener(e=>{r(e),n&&console.log("Queue stats updated:",e)}),()=>{S.current&&(S.current(),S.current=null)}),[n]),(0,d.useEffect)(()=>{const e=async()=>{try{const e=await ed.getPendingActions();c(e)}catch(e){console.error("Failed to refresh pending actions:",e)}};return e(),t>0&&(w.current=setInterval(e,t)),()=>{w.current&&clearInterval(w.current)}},[t]),(0,d.useEffect)(()=>{const e=ed.getLastSyncResult();e&&h(e)},[a]);const x=(0,d.useCallback)(async(e,t,s)=>{try{y(void 0);const i=await ed.checkIn(e,t,s);return n&&console.log("Check-in result:",i),i}catch(e){return y(e instanceof Error?e.message:"Check-in failed"),console.error("Check-in error:",e),{success:!1}}},[n]),v=(0,d.useCallback)(async(e,t,s)=>{try{y(void 0);const i=await ed.checkOut(e,t,s);return n&&console.log("Check-out result:",i),i}catch(e){return y(e instanceof Error?e.message:"Check-out failed"),console.error("Check-out error:",e),{success:!1}}},[n]),N=(0,d.useCallback)(async function(){const e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(l&&!e)return null;try{u(!0),y(void 0);const t=await ed.syncNow(e);if(t){const e={success:t.synced>0||0===t.processed,processed:t.processed,synced:t.synced,failed:t.failed,skipped:0,duration:0,networkScore:t.networkScore||s.connectivityScore,strategy:t.strategy||"basic",errors:[]};return h(e),n&&console.log("Manual sync result:",e),e}return null}catch(e){return y(e instanceof Error?e.message:"Sync failed"),console.error("Sync error:",e),null}finally{u(!1)}},[l,s.connectivityScore,n]),b=(0,d.useCallback)(async function(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"manual";try{y(void 0);const t=await i.triggerSync(e);return h(t),n&&console.log("Connectivity restoration result:",t),t}catch(e){throw y(e instanceof Error?e.message:"Restoration failed"),console.error("Restoration error:",e),e}},[i,n]),A=(0,d.useCallback)(async e=>{try{const t=await ed.getPendingActions(e);return c(t),t}catch(e){return console.error("Failed to get pending actions:",e),[]}},[]),j=(0,d.useCallback)(async()=>{try{const e=await ed.getStats();r(e)}catch(e){console.error("Failed to refresh stats:",e)}},[]),I=(0,d.useCallback)(e=>{i.updateConfig(e)},[i]);return{state:{queueStats:a,pendingActions:o,isSyncing:l||i.isRestoring,lastSyncResult:m,syncError:f,isOnline:s.isOnline,isUnstable:s.isUnstable,connectivityScore:s.connectivityScore,isRestoring:i.isRestoring,syncRecommendations:g},actions:{checkIn:x,checkOut:v,syncNow:N,triggerRestoration:b,getPendingActions:A,refreshStats:j,updateRestorationConfig:I}}}const eh=n(95937),ef=n(81921),ey=n(90535),eg=n(93448);const ep=ef.zt,ew=d.forwardRef((e,t)=>{const{className:n,...i}=e;return(0,s.jsx)(ef.l_,{ref:t,className:(0,eg.cn)("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",n),...i})});ew.displayName=ef.l_.displayName;const eS=(0,ey.j)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),ex=d.forwardRef((e,t)=>{const{className:n,variant:i,...a}=e;return(0,s.jsx)(ef.fC,{ref:t,className:(0,eg.cn)(eS({variant:i}),n),...a})});ex.displayName=ef.fC.displayName;const ev=d.forwardRef((e,t)=>{const{className:n,...i}=e;return(0,s.jsx)(ef.aU,{ref:t,className:(0,eg.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",n),...i})});ev.displayName=ef.aU.displayName;const eN=d.forwardRef((e,t)=>{const{className:n,...i}=e;return(0,s.jsx)(ef.x8,{ref:t,className:(0,eg.cn)("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",n),"toast-close":"",...i,children:(0,s.jsx)(h.Z,{className:"h-4 w-4"})})});eN.displayName=ef.x8.displayName;const eb=d.forwardRef((e,t)=>{const{className:n,...i}=e;return(0,s.jsx)(ef.Dx,{ref:t,className:(0,eg.cn)("text-sm font-semibold",n),...i})});eb.displayName=ef.Dx.displayName;const eA=d.forwardRef((e,t)=>{const{className:n,...i}=e;return(0,s.jsx)(ef.dk,{ref:t,className:(0,eg.cn)("text-sm opacity-90",n),...i})});eA.displayName=ef.dk.displayName;let ej=0,eI=new Map,ek=e=>{if(eI.has(e))return;const t=setTimeout(()=>{eI.delete(e),eT({type:"REMOVE_TOAST",toastId:e})},1e6);eI.set(e,t)},eC=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{const{toastId:n}=t;return n?ek(n):e.toasts.forEach(e=>{ek(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},eE=[],eO={toasts:[]};function eT(e){eO=eC(eO,e),eE.forEach(e=>{e(eO)})}function eD(e){let{...t}=e,n=(ej=(ej+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>eT({type:"DISMISS_TOAST",toastId:n});return eT({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:e=>{e||s()}}}),{id:n,dismiss:s,update:e=>eT({type:"UPDATE_TOAST",toast:{...e,id:n}})}}function eP(){const[e,t]=d.useState(eO);return d.useEffect(()=>(eE.push(t),()=>{const e=eE.indexOf(t);e>-1&&eE.splice(e,1)}),[e]),{...e,toast:eD,dismiss:e=>eT({type:"DISMISS_TOAST",toastId:e})}}const eM=n(41671),e_=n(76865),eR=n(33245);function eL(e){let{children:t,maxMessages:n=5,enableToasts:i=!0,enableNotifications:a=!1}=e,r=(0,z.k)(),{state:o,actions:c}=em(),{toast:l}=eP(),[u,m]=(0,d.useState)([]),[h,f]=(0,d.useState)(r.isOnline),[y,g]=(0,d.useState)(o.queueStats.pending);(0,d.useEffect)(()=>{h!==r.isOnline&&(r.isOnline?(i&&l({title:"Connection Restored",description:o.queueStats.pending>0?"Syncing ".concat(o.queueStats.pending," pending actions..."):"All data is up to date",action:o.queueStats.pending>0?(0,s.jsx)(ev,{altText:"Sync now",onClick:()=>c.syncNow(!0),children:"Sync Now"}):void 0}),p({type:"success",title:"Back Online",description:o.queueStats.pending>0?"Syncing ".concat(o.queueStats.pending," pending actions"):"All data synchronized",autoHide:!0,duration:5e3})):(i&&l({title:"Connection Lost",description:"You can continue working offline. Actions will sync when connection returns.",variant:"destructive"}),p({type:"warning",title:"Working Offline",description:"You can still check in and out. Actions will sync automatically.",autoHide:!1})),f(r.isOnline))},[r.isOnline,o.queueStats.pending,i,l,c]),(0,d.useEffect)(()=>{y>0&&0===o.queueStats.pending&&r.isOnline&&(i&&l({title:"Sync Complete",description:"Successfully synced ".concat(y," actions")}),p({type:"success",title:"Sync Completed",description:"".concat(y," actions synchronized successfully"),autoHide:!0,duration:3e3})),g(o.queueStats.pending)},[o.queueStats.pending,r.isOnline,y,i,l]),(0,d.useEffect)(()=>{o.syncError&&(i&&l({title:"Sync Error",description:o.syncError,variant:"destructive",action:(0,s.jsx)(ev,{altText:"Retry",onClick:()=>c.syncNow(!0),children:"Retry"})}),p({type:"error",title:"Sync Failed",description:o.syncError,action:{label:"Retry",handler:()=>c.syncNow(!0)},autoHide:!1}))},[o.syncError,i,l,c]),(0,d.useEffect)(()=>{a&&"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission()},[a]);const p=e=>{const t={id:"msg-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),timestamp:Date.now(),...e};m(e=>{const s=[t,...e].slice(0,n);return t.autoHide&&setTimeout(()=>{w(t.id)},t.duration||5e3),s}),a&&"Notification"in window&&"granted"===Notification.permission&&new Notification(t.title,{body:t.description,icon:"/icon-192.png",tag:"offline-message-".concat(t.type)})},w=e=>{m(t=>t.filter(t=>t.id!==e))};return(0,s.jsxs)(ep,{children:[t,(0,s.jsx)(ew,{})]})}function ez(e){let{className:t,maxVisible:n=3}=e,i=(0,z.k)(),{state:a,actions:o}=em(),c=(()=>{const e=[];return i.isOnline||e.push({id:"offline-status",type:"warning",title:"Working Offline",description:"You can continue working. ".concat(a.queueStats.pending," actions will sync when connected."),timestamp:Date.now()}),i.isOnline&&i.isUnstable&&e.push({id:"unstable-connection",type:"warning",title:"Unstable Connection",description:"Some features may be limited due to poor connectivity.",timestamp:Date.now()}),a.queueStats.pending>0&&i.isOnline&&e.push({id:"pending-sync",type:"info",title:"Syncing Actions",description:"".concat(a.queueStats.pending," actions waiting to sync"),action:{label:"Sync Now",handler:()=>o.syncNow(!0)},timestamp:Date.now()}),a.queueStats.failed>0&&e.push({id:"failed-actions",type:"error",title:"Sync Failed",description:"".concat(a.queueStats.failed," actions failed to sync"),action:{label:"Retry",handler:()=>o.syncNow(!0)},timestamp:Date.now()}),!a.syncRecommendations.shouldSync&&a.queueStats.pending>0&&e.push({id:"sync-delayed",type:"info",title:"Sync Delayed",description:a.syncRecommendations.reason,timestamp:Date.now()}),e.slice(0,n)})();if(0===c.length)return null;const l=e=>{switch(e){case"success":return(0,s.jsx)(eM.Z,{className:"h-4 w-4"});case"warning":return(0,s.jsx)(e_.Z,{className:"h-4 w-4"});case"error":return(0,s.jsx)(h.Z,{className:"h-4 w-4"});default:return(0,s.jsx)(eR.Z,{className:"h-4 w-4"})}},d=e=>"error"===e?"destructive":"default";return(0,s.jsx)("div",{className:t,children:c.map(e=>(0,s.jsxs)(eh.bZ,{variant:d(e.type),className:"mb-2",children:[l(e.type),(0,s.jsx)(eh.X,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.title}),(0,s.jsx)("div",{className:"text-sm",children:e.description})]}),e.action&&(0,s.jsx)(r.z,{size:"sm",variant:"outline",onClick:e.action.handler,className:"ml-4",children:e.action.label})]})})]},e.id))})}const eF=n(7204);function eH(e){let{variant:t="compact",showSyncButton:n=!0,showQueueInfo:i=!0,className:a}=e,o=(0,z.k)(),{state:c,actions:l}=em({enableDebugLogs:!1}),d=()=>o.isOnline?o.isUnstable?(0,s.jsx)(e_.Z,{className:"h-4 w-4"}):(0,s.jsx)(w.Z,{className:"h-4 w-4"}):(0,s.jsx)(S.Z,{className:"h-4 w-4"}),u=()=>o.isOnline?o.isUnstable?"text-yellow-600":o.connectivityScore>=80?"text-green-600":o.connectivityScore>=60?"text-blue-600":"text-gray-600":"text-red-600",m=async()=>{try{await l.syncNow(!0)}catch(e){console.error("Manual sync failed:",e)}};return"compact"===t?(0,s.jsxs)("div",{className:(0,eg.cn)("flex items-center gap-1",a),children:[(0,s.jsx)("div",{className:(0,eg.cn)("flex items-center",u()),children:d()}),c.queueStats.pending>0&&(0,s.jsx)(p.C,{variant:"secondary",className:"text-xs",children:c.queueStats.pending})]}):"banner"===t?o.isOnline&&!o.isUnstable&&0===c.queueStats.pending?null:(0,s.jsx)(eh.bZ,{className:(0,eg.cn)("mb-4",a),children:(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:u(),children:d()}),(0,s.jsx)("div",{children:(0,s.jsx)(eh.X,{className:"m-0",children:o.isOnline?o.isUnstable?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"font-medium",children:"Connection unstable"}),(0,s.jsx)("span",{className:"ml-2",children:" Some features may be limited"})]}):c.queueStats.pending>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"font-medium",children:"Syncing pending actions"}),(0,s.jsxs)("span",{className:"ml-2",children:[" ",c.queueStats.pending," remaining"]})]}):null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"font-medium",children:"Working offline"}),c.queueStats.pending>0&&(0,s.jsxs)("span",{className:"ml-2",children:[" ",c.queueStats.pending," actions will sync when connected"]})]})})})]}),n&&c.queueStats.pending>0&&o.isOnline&&(0,s.jsxs)(r.z,{size:"sm",variant:"outline",onClick:m,disabled:c.isSyncing,className:"ml-4",children:[c.isSyncing?(0,s.jsx)(y.Z,{className:"h-3 w-3 animate-spin mr-1"}):(0,s.jsx)(y.Z,{className:"h-3 w-3 mr-1"}),"Sync Now"]})]})}):(0,s.jsxs)("div",{className:(0,eg.cn)("space-y-3",a),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:(0,eg.cn)("flex items-center",u()),children:d()}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:o.isOnline?"Online":"Offline"}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Connection: ",o.isOnline?o.isUnstable?"Unstable":o.connectivityScore>=80?"Excellent":o.connectivityScore>=60?"Good":o.connectivityScore>=40?"Fair":"Poor":"Offline"]})]})]}),o.isOnline&&(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"text-sm font-medium",children:[o.connectivityScore,"/100"]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Quality Score"})]})]}),o.isOnline&&(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Connection Quality"}),(0,s.jsxs)("span",{className:"text-muted-foreground",children:[o.connectivityScore,"%"]})]}),(0,s.jsx)(eF.E,{value:o.connectivityScore,className:"h-2"})]}),i&&(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex items-center text-blue-600",children:c.isSyncing?(0,s.jsx)(y.Z,{className:"h-4 w-4 animate-spin"}):c.queueStats.pending>0?(0,s.jsx)(x.Z,{className:"h-4 w-4"}):(0,s.jsx)(eM.Z,{className:"h-4 w-4 text-green-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:"Queue Status"}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:(()=>{const{queueStats:e}=c;return e.pending>0?"".concat(e.pending," pending actions"):e.syncing>0?"".concat(e.syncing," syncing"):e.failed>0?"".concat(e.failed," failed"):"All synced"})()})]})]}),n&&c.queueStats.pending>0&&o.isOnline&&(0,s.jsxs)(r.z,{size:"sm",variant:"outline",onClick:m,disabled:c.isSyncing,children:[c.isSyncing?(0,s.jsx)(y.Z,{className:"h-3 w-3 animate-spin mr-1"}):(0,s.jsx)(y.Z,{className:"h-3 w-3 mr-1"}),"Sync"]})]}),!c.syncRecommendations.shouldSync&&c.queueStats.pending>0&&(0,s.jsxs)(eh.bZ,{children:[(0,s.jsx)(eR.Z,{className:"h-4 w-4"}),(0,s.jsxs)(eh.X,{children:[(0,s.jsx)("strong",{children:"Sync delayed:"})," ",c.syncRecommendations.reason,c.syncRecommendations.recommendedDelay&&(0,s.jsxs)("span",{className:"ml-1",children:["(Recommended wait:"," ",Math.round(c.syncRecommendations.recommendedDelay/1e3),"s)"]})]})]}),!o.isOnline&&(0,s.jsxs)(eh.bZ,{children:[(0,s.jsx)(eR.Z,{className:"h-4 w-4"}),(0,s.jsxs)(eh.X,{children:[(0,s.jsx)("strong",{children:"Working offline:"})," You can still check in and out. Actions will sync automatically when connection returns."]})]})]})}function eU(e){let{variant:t="compact",position:n="top",showMessages:i=!0,className:a}=e,r=(0,z.k)(),{state:o}=em();return!r.isOnline||o.queueStats.pending>0||o.queueStats.failed>0||r.isUnstable||"full"===t?(0,s.jsx)("div",{className:(0,eg.cn)("w-full z-40","full"===t?"relative p-4 bg-background border-b":"sticky ".concat({top:"top-0",bottom:"bottom-0"}[n]," bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b px-4 py-2"),a),children:(()=>{switch(t){case"minimal":return(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(eH,{variant:"compact",className:"flex-shrink-0"}),(o.queueStats.pending>0||o.queueStats.failed>0)&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground ml-2",children:[o.queueStats.pending>0&&"".concat(o.queueStats.pending," pending"),o.queueStats.pending>0&&o.queueStats.failed>0&&", ",o.queueStats.failed>0&&"".concat(o.queueStats.failed," failed")]})]});case"compact":return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eH,{variant:"banner",showSyncButton:!0,showQueueInfo:!1}),i&&(0,s.jsx)(ez,{maxVisible:1})]});case"full":return(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(eH,{variant:"full",showSyncButton:!0,showQueueInfo:!0}),i&&(0,s.jsx)(ez,{maxVisible:3})]});default:return null}})()}):null}function eq(){const{toasts:e}=eP();return(0,s.jsxs)(ep,{children:[e.map(function(e){const{id:t,title:n,description:i,action:a,...r}=e;return(0,s.jsxs)(ex,{...r,children:[(0,s.jsxs)("div",{className:"grid gap-1",children:[n&&(0,s.jsx)(eb,{children:n}),i&&(0,s.jsx)(eA,{children:i})]}),a,(0,s.jsx)(eN,{})]},t)}),(0,s.jsx)(ew,{})]})}const eB=n(79226);function eZ(e){const{children:t}=e;return(0,s.jsx)(eL,{enableToasts:!0,enableNotifications:!0,children:(0,s.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,s.jsx)(eG,{}),(0,s.jsx)(eU,{variant:"compact",position:"top"}),(0,s.jsx)(g,{}),(0,s.jsxs)("main",{id:"main-content",className:"flex-1 container-responsive py-4 sm:py-6 lg:py-8",tabIndex:-1,children:[(0,s.jsx)(f,{}),t]}),(0,s.jsx)(eq,{})]})})}function eG(){const{user:e}=(0,i.a)(),t=(0,c.useRouter)(),{trackLogout:n}=(0,a.z)(),d=async()=>{try{await (0,o.ni)(),n(),t.push("/")}catch(e){console.error("Sign out failed:",e)}};return(0,s.jsx)("header",{className:"sticky top-0 z-50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b",role:"banner",children:(0,s.jsx)("div",{className:"container-responsive py-3 sm:py-4",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(l.default,{href:"/",className:"focus-ring","aria-label":"Schools-In Home",children:(0,s.jsx)(eB.m,{size:"sm",priority:!0})}),(0,s.jsx)("nav",{className:"flex items-center gap-2 sm:gap-4",role:"navigation","aria-label":"Main navigation",children:e&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eH,{variant:"compact",className:"hidden sm:flex"}),(0,s.jsx)("div",{className:"hidden md:flex",children:(0,s.jsx)(L,{})}),(0,s.jsx)(l.default,{href:"/profile",className:"touch-target text-sm sm:text-base text-foreground/80 hover:text-foreground transition-colors focus-ring","aria-label":"User profile",children:"Profile"}),(0,s.jsxs)(r.z,{variant:"outline",onClick:d,className:"touch-target text-sm sm:text-base focus-ring",size:"sm","aria-label":"Sign out of application",children:[(0,s.jsx)("span",{className:"hidden sm:inline",children:"Sign Out"}),(0,s.jsx)("span",{className:"sm:hidden",children:"Out"})]})]})})]})})})}},93344:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return r}});const s=n(57437),i=n(85687);const a=(0,n(2265).createContext)({user:null,loading:!0});function r(e){let{children:t}=e,n=(0,i.a)();return(0,s.jsx)(a.Provider,{value:n,children:t})}},79226:function(e,t,n){"use strict";n.d(t,{T:function(){return c},m:function(){return o}});const s=n(57437);n(2265);const i=n(93448),a=n(78584);const r={sm:{width:32,height:32,textSize:"text-lg"},md:{width:48,height:48,textSize:"text-xl"},lg:{width:64,height:64,textSize:"text-2xl"},xl:{width:96,height:96,textSize:"text-3xl"}};function o(e){let{size:t="md",className:n,priority:o=!1,showText:c=!0}=e,{width:l,height:d,textSize:u}=r[t];return(0,s.jsxs)("div",{className:(0,i.cn)("flex items-center gap-3",n),children:[(0,s.jsx)(a.OptimizedImage,{src:"/DMDL_logo.png",alt:"DMDL Schools-In Logo",width:l,height:d,priority:o,quality:90,className:"object-contain",loading:o?"eager":"lazy"}),c&&(0,s.jsx)("span",{className:(0,i.cn)("font-bold text-brand-primary",u),children:"Schools-In"})]})}function c(e){const{title:t,subtitle:n,className:a}=e;return(0,s.jsxs)("div",{className:(0,i.cn)("text-center space-y-4",a),children:[(0,s.jsx)(o,{size:"xl",className:"justify-center"}),t&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h1",{className:"text-3xl sm:text-4xl font-bold text-gray-900",children:t}),n&&(0,s.jsx)("p",{className:"text-muted-foreground text-sm sm:text-base",children:n})]})]})}},78584:function(e,t,n){"use strict";n.d(t,{OptimizedImage:function(){return c},X:function(){return l}});const s=n(57437),i=n(2265),a=n(33145),r=n(93448),o=n(69140);function c(e){let{src:t,alt:n,width:c,height:l,priority:d=!1,quality:u=75,placeholder:m="empty",blurDataURL:h,sizes:f,fill:y=!1,className:g,fallback:p,loading:w="lazy",onLoad:S,onError:x}=e,[v,N]=(0,i.useState)(!1),[b,A]=(0,i.useState)(!1),j=(0,i.useCallback)(()=>{N(!0),null==S||S()},[S]),I=(0,i.useCallback)(()=>{A(!0),null==x||x()},[x]);return b&&p?(0,s.jsx)(s.Fragment,{children:p}):b?(0,s.jsx)("div",{className:(0,r.cn)("flex items-center justify-center bg-gray-100 text-gray-400",g),style:{width:y?"100%":c,height:y?"100%":l},children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}):(0,s.jsxs)("div",{className:(0,r.cn)("relative",g),children:[!v&&(0,s.jsx)("div",{className:"absolute inset-0 z-10",children:(0,s.jsx)(o.Od,{className:(0,r.cn)("w-full h-full",{"absolute inset-0":y}),style:{width:y?"100%":c,height:y?"100%":l}})}),(0,s.jsx)(a.default,{src:t,alt:n,width:y?void 0:c,height:y?void 0:l,fill:y,priority:d,quality:u,placeholder:m,blurDataURL:h,sizes:f,loading:w,className:(0,r.cn)("transition-opacity duration-200",v?"opacity-100":"opacity-0"),onLoad:j,onError:I})]})}function l(e){let{src:t,alt:n,size:i=40,className:a,fallback:o}=e,l=(0,s.jsx)("div",{className:(0,r.cn)("rounded-full bg-gray-300 flex items-center justify-center text-gray-600",a),style:{width:i,height:i},children:(0,s.jsx)("svg",{className:"w-1/2 h-1/2",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z"})})});return(0,s.jsx)(c,{src:t,alt:n,width:i,height:i,className:(0,r.cn)("rounded-full",a),quality:85,placeholder:"blur",blurDataURL:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAhEAACAQMDBQAAAAAAAAAAAAABAgMABAUGIWGRkqGx0f/EABUBAQEAAAAAAAAAAAAAAAAAAAMF/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAECEgMRkf/aAAwDAQACEQMRAD8AltJagyeH0AthI5xdrLcNM91BF5pX2HaH9bcfaSXWGaRmknyLhxEDnGFELMO4==",fallback:o||l})}},7204:function(e,t,n){"use strict";n.d(t,{E:function(){return o}});const s=n(57437),i=n(2265),a=n(60610),r=n(93448);const o=i.forwardRef((e,t)=>{const{className:n,value:i,...o}=e;return(0,s.jsx)(a.fC,{ref:t,className:(0,r.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",n),...o,children:(0,s.jsx)(a.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(i||0),"%)")}})})});o.displayName=a.fC.displayName},27638:function(e,t,n){"use strict";n.d(t,{Ry:function(){return r},ni:function(){return l},o1:function(){return o},qj:function(){return c}});const s=n(82148),i=n(50237);const a=new s.hJ,r=async(e,t)=>await (0,s.e5)(i.I8,e,t),o=async(e,t)=>await (0,s.Xb)(i.I8,e,t),c=async()=>await (0,s.rh)(i.I8,a),l=async()=>await (0,s.w7)(i.I8)},45630:function(e,t,n){"use strict";n.d(t,{k:function(){return a}});const s=n(2265);const i={HIGH_DOWNLINK:5,MEDIUM_DOWNLINK:1.5,HIGH_RTT:50,MEDIUM_RTT:150,STABILITY_WINDOW:3e4};function a(){const[e,t]=(0,s.useState)(()=>({isOnline:navigator.onLine,isConnected:navigator.onLine,connectionType:"unknown",effectiveType:"unknown",downlink:0,rtt:0,saveData:!1,connectivityScore:navigator.onLine?50:0})),[n,a]=(0,s.useState)({online:new Set,offline:new Set,change:new Set}),[r,o]=(0,s.useState)([]),c=(0,s.useCallback)((e,t,n,s)=>{if(!e)return 0;let a=40;switch(t>=i.HIGH_DOWNLINK?a+=30:t>=i.MEDIUM_DOWNLINK?a+=20:t>0&&(a+=10),n<=i.HIGH_RTT?a+=20:n<=i.MEDIUM_RTT?a+=15:n>0&&(a+=5),s){case"4g":a+=10;break;case"3g":a+=7;break;case"2g":a+=3;break;case"slow-2g":a+=1}return Math.min(100,Math.max(0,a))},[]),l=(0,s.useCallback)(()=>{const e=window.navigator,n=e.connection||e.mozConnection||e.webkitConnection,s=e.onLine,a=(null==n?void 0:n.type)||"unknown",r=(null==n?void 0:n.effectiveType)||"unknown",l=(null==n?void 0:n.downlink)||0,d=(null==n?void 0:n.rtt)||0,u=(null==n?void 0:n.saveData)||!1,m=c(s,l,d,r),h={isOnline:s,isConnected:s&&m>20,connectionType:a,effectiveType:r,downlink:l,rtt:d,saveData:u,connectivityScore:m};t(e=>{const t=Date.now(),n={...h};return s&&!e.isOnline?n.lastOnlineAt=t:!s&&e.isOnline?n.lastOfflineAt=t:(n.lastOnlineAt=e.lastOnlineAt,n.lastOfflineAt=e.lastOfflineAt),n}),o(e=>{const t=Date.now(),n=t-i.STABILITY_WINDOW;return[...e.filter(e=>e.timestamp>n),{timestamp:t,isOnline:s}]})},[c]),d=(0,s.useCallback)(async()=>{try{const e=Date.now(),n=await fetch("/api/health",{method:"HEAD",cache:"no-cache",signal:AbortSignal.timeout(5e3)}),s=Date.now(),i=n.ok,a=s-e;return t(e=>({...e,isConnected:i,rtt:Math.min(e.rtt||1/0,a),connectivityScore:c(i,e.downlink,a,e.effectiveType)})),i}catch(e){return t(e=>({...e,isConnected:!1,connectivityScore:0})),!1}},[c]),u=(0,s.useCallback)(async()=>{try{const e=performance.now();await fetch("/api/health",{method:"HEAD",cache:"no-cache",signal:AbortSignal.timeout(3e3)});const t=performance.now();return Math.round(t-e)}catch(e){return -1}},[]),m=(0,s.useCallback)(e=>(a(t=>{const n=new Set(t.online);return n.add(e),{...t,online:n}}),()=>{a(t=>{const n=new Set(t.online);return n.delete(e),{...t,online:n}})}),[]),h=(0,s.useCallback)(e=>(a(t=>{const n=new Set(t.offline);return n.add(e),{...t,offline:n}}),()=>{a(t=>{const n=new Set(t.offline);return n.delete(e),{...t,offline:n}})}),[]),f=(0,s.useCallback)(e=>(a(t=>{const n=new Set(t.change);return n.add(e),{...t,change:n}}),()=>{a(t=>{const n=new Set(t.change);return n.delete(e),{...t,change:n}})}),[]);(0,s.useEffect)(()=>{const t=()=>{l(),n.online.forEach(e=>{try{e()}catch(e){console.error("Error in online callback:",e)}})},s=()=>{l(),n.offline.forEach(e=>{try{e()}catch(e){console.error("Error in offline callback:",e)}})},i=()=>{l()};window.addEventListener("online",t),window.addEventListener("offline",s);const a=window.navigator,r=a.connection||a.mozConnection||a.webkitConnection;r&&r.addEventListener("change",i),l();const o=setInterval(async()=>{e.isOnline&&await d()},3e4);return()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s),r&&r.removeEventListener("change",i),clearInterval(o)}},[l,d,e.isOnline,n]),(0,s.useEffect)(()=>{n.change.forEach(t=>{try{t(e)}catch(e){console.error("Error in change callback:",e)}})},[e,n.change]);const y=e.connectivityScore>=80,g=e.connectivityScore>=50&&e.connectivityScore<80,p=e.connectivityScore>=20&&e.connectivityScore<50,w=r.length>=3&&r.slice(-3).every(t=>t.isOnline===e.isOnline),S=!w&&r.length>=2,x=e.isConnected&&e.connectivityScore>=30&&w,v=e.isOnline&&(e.connectivityScore<30||S);return{...e,isHighQuality:y,isMediumQuality:g,isLowQuality:p,isStable:w,isUnstable:S,shouldSync:x,shouldDelaySync:v,onOnline:m,onOffline:h,onConnectionChange:f,checkConnectivity:d,ping:u}}},87775:function(e,t,n){"use strict";n.d(t,{AnalyticsProvider:function(){return j}});const s=n(57437),i=n(2265),a=n(1469),r=n(39574),o=n(96430);const c={LCP:{good:2500,needsImprovement:4e3},INP:{good:200,needsImprovement:500},CLS:{good:.1,needsImprovement:.25},FCP:{good:1800,needsImprovement:3e3},TTFB:{good:800,needsImprovement:1800}};class l{generateSessionId(){return"".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))}initialize(){if("undefined"!=typeof document)try{(0,o.onCLS)(this.handleMetric.bind(this)),(0,o.onINP)(this.handleMetric.bind(this)),(0,o.onFCP)(this.handleMetric.bind(this)),(0,o.onLCP)(this.handleMetric.bind(this)),(0,o.onTTFB)(this.handleMetric.bind(this)),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.sendReport()}),window.addEventListener("beforeunload",()=>{this.sendReport()})}catch(e){}}handleMetric(e){let t;const n={name:e.name,value:e.value,delta:e.delta,id:e.id,rating:this.getRating(e.name,e.value),navigationType:this.normalizeNavigationType(null===(t=performance.getEntriesByType("navigation")[0])||void 0===t?void 0:t.type)||"navigate",timestamp:Date.now(),url:window.location.href,userAgent:navigator.userAgent};this.metrics.set(e.name,n),this.isProduction||console.log("[Web Vitals] ".concat(e.name,":"),n),"poor"===n.rating&&this.sendAlert(n)}normalizeNavigationType(e){switch(e){case"back_forward":return"back-forward";case"back_forward_cache":return"back-forward-cache";default:return e}}getRating(e,t){const n=c[e];return!n||t<=n.good?"good":t<=n.needsImprovement?"needs-improvement":"poor"}getConnectionInfo(){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(e)return{effectiveType:e.effectiveType,rtt:e.rtt,downlink:e.downlink}}generateReport(){return{metrics:Array.from(this.metrics.values()),timestamp:Date.now(),sessionId:this.sessionId,userId:this.userId,page:window.location.pathname,viewport:{width:window.innerWidth,height:window.innerHeight},connection:this.getConnectionInfo()}}sendReport(){if(0===this.metrics.size)return;const e=this.generateReport();this.isProduction&&this.sendToAnalytics(e),this.sendToFirebasePerformance(e)}sendAlert(e){console.warn("[Performance Alert] Poor ".concat(e.name,": ").concat(e.value,"ms")),this.isProduction&&this.sendToErrorReporting({type:"performance-alert",metric:e.name,value:e.value,rating:e.rating,url:window.location.href,timestamp:e.timestamp})}sendToAnalytics(e){window.gtag&&e.metrics.forEach(e=>{window.gtag("event","web_vitals",{event_category:"Web Vitals",event_label:e.name,value:Math.round(e.value),custom_map:{metric_rating:e.rating,metric_delta:e.delta}})}),fetch("/api/analytics/web-vitals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),keepalive:!0}).catch(e=>{console.warn("Failed to send Web Vitals report:",e)})}sendToFirebasePerformance(e){"undefined"!=typeof performance&&"mark"in performance&&e.metrics.forEach(t=>{if(performance.mark("web-vitals-".concat(t.name.toLowerCase(),"-").concat(t.value)),window.firebase&&window.firebase.performance){const n=window.firebase.performance().trace("web_vitals_".concat(t.name));n.putAttribute("rating",t.rating),n.putAttribute("page",e.page),n.putMetric("value",Math.round(t.value)),n.stop()}})}sendToErrorReporting(e){window.Sentry&&window.Sentry.captureMessage("Performance Alert",{level:"warning",extra:e})}setUserId(e){this.userId=e}getCurrentMetrics(){return Array.from(this.metrics.values())}getMetric(e){return this.metrics.get(e)}getAllMetrics(){const e={};return this.metrics.forEach(t=>{e[t.name]=t.value}),e}getPerformanceGrade(){const e=this.getCurrentMetrics();if(0===e.length)return"F";const t=e.map(e=>{switch(e.rating){case"good":return 3;case"needs-improvement":return 2;case"poor":return 1;default:return 0}}),n=t.reduce((e,t)=>e+t,0)/t.length;return n>=2.8?"A":n>=2.4?"B":n>=2?"C":n>=1.5?"D":"F"}constructor(){this.metrics=new Map,this.sessionId=this.generateSessionId(),this.isProduction=!0,"undefined"!=typeof document&&this.initialize()}}const d="undefined"!=typeof document?new l:{};window.webVitalsMonitor=d;const u=n(79820),m=n(69174),h=n(12381),f=n(7204),y=n(42208),g=n(11239),p=n(42488),w=n(91723),S=n(40476),x=n(82431),v=n(92735),N=n(41671),b=n(76865);function A(e){let{showDetails:t=!0,autoRefresh:n=!0,refreshInterval:a=5e3}=e,[r,o]=(0,i.useState)([]),[l,A]=(0,i.useState)(!1),[j,I]=(0,i.useState)(null),k=(0,i.useCallback)(()=>{o(d.getCurrentMetrics()),I(new Date)},[]);(0,i.useEffect)(()=>{if(k(),n){const e=setInterval(k,a);return()=>clearInterval(e)}},[k,n,a]);const C=e=>{switch(e){case"LCP":return(0,s.jsx)(y.Z,{className:"w-4 h-4"});case"FID":return(0,s.jsx)(g.Z,{className:"w-4 h-4"});case"CLS":default:return(0,s.jsx)(p.Z,{className:"w-4 h-4"});case"FCP":return(0,s.jsx)(w.Z,{className:"w-4 h-4"});case"TTFB":return(0,s.jsx)(S.Z,{className:"w-4 h-4"})}},E=e=>{switch(e){case"good":return"default";case"needs-improvement":return"secondary";case"poor":return"destructive";default:return"outline"}},O=e=>{switch(e){case"good":return"text-green-600";case"needs-improvement":return"text-yellow-600";case"poor":return"text-red-600";default:return"text-gray-600"}},T=()=>d.getPerformanceGrade(),D=(e,t)=>{const n=c[e];if(!n)return 100;const s=1.5*n.needsImprovement;return Math.max(0,Math.min(100,(s-t)/s*100))};return l?(0,s.jsx)("div",{className:"".concat("fixed bottom-4 right-4 z-50 w-96"),children:(0,s.jsxs)(u.Zb,{className:"w-full",children:[(0,s.jsxs)(u.Ol,{className:"pb-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(u.ll,{className:"flex items-center text-lg",children:[(0,s.jsx)(p.Z,{className:"w-5 h-5 mr-2"}),"Performance Monitor"]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)(m.C,{variant:"outline",className:"font-mono",children:["Grade: ",T()]}),(0,s.jsx)(h.z,{variant:"ghost",size:"sm",onClick:k,disabled:!r.length,children:(0,s.jsx)(x.Z,{className:"w-4 h-4"})}),(0,s.jsx)(h.z,{variant:"ghost",size:"sm",onClick:()=>A(!1),children:""})]})]}),(0,s.jsxs)(u.SZ,{children:["Core Web Vitals monitoring",j&&(0,s.jsxs)("span",{className:"block text-xs mt-1",children:["Last updated: ",j.toLocaleTimeString()]})]})]}),(0,s.jsx)(u.aY,{className:"space-y-4",children:0===r.length?(0,s.jsxs)("div",{className:"flex items-center justify-center py-8 text-muted-foreground",children:[(0,s.jsx)(p.Z,{className:"w-6 h-6 mr-2 animate-pulse"}),"Collecting metrics..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"grid grid-cols-1 gap-3",children:r.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-3 p-3 border rounded-lg",children:[(0,s.jsx)("div",{className:"p-2 rounded-full bg-gray-100 ".concat(O(e.rating)),children:C(e.name)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"font-medium",children:e.name}),(0,s.jsx)(m.C,{variant:E(e.rating),children:e.rating.replace("-"," ")})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,s.jsx)("span",{className:"text-2xl font-bold",children:"CLS"===e.name?e.value.toFixed(3):Math.round(e.value)}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"CLS"===e.name?"score":"ms"})]}),t&&(0,s.jsx)(f.E,{value:D(e.name,e.value),className:"mt-2 h-2"})]})]},e.name))}),t&&(0,s.jsxs)("div",{className:"border-t pt-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"font-medium",children:"Performance Summary"}),(0,s.jsxs)(h.z,{variant:"ghost",size:"sm",onClick:()=>{const e=new Blob([JSON.stringify({timestamp:new Date().toISOString(),grade:T(),metrics:r,url:window.location.href,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight}},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="web-vitals-".concat(Date.now(),".json"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},children:[(0,s.jsx)(v.Z,{className:"w-4 h-4 mr-2"}),"Export"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Overall Grade"}),(0,s.jsx)("p",{className:"font-mono text-lg",children:T()})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Metrics Count"}),(0,s.jsx)("p",{className:"font-mono text-lg",children:r.length})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsx)(N.Z,{className:"w-3 h-3 text-green-600"}),(0,s.jsx)("span",{children:"Good"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsx)(b.Z,{className:"w-3 h-3 text-yellow-600"}),(0,s.jsx)("span",{children:"Needs Improvement"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsx)(b.Z,{className:"w-3 h-3 text-red-600"}),(0,s.jsx)("span",{children:"Poor"})]})]})]})]})})]})}):(0,s.jsxs)(h.z,{variant:"outline",size:"sm",onClick:()=>A(!0),className:"fixed bottom-4 right-4 z-50",children:[(0,s.jsx)(p.Z,{className:"w-4 h-4 mr-2"}),"Performance"]})}function j(e){let{children:t,showPerformanceMonitor:n=!1}=e,o=(0,a.z)();return(0,i.useEffect)(()=>{r.vC.initialize();const e=e=>{o.trackError(Error(e.message),{filename:e.filename,lineno:e.lineno,colno:e.colno,source:"global_error_handler"},"high")},t=e=>{o.trackError(Error(String(e.reason)),{source:"unhandled_promise_rejection",promise:String(e.promise).substring(0,100)},"high")};if(window.addEventListener("error",e),window.addEventListener("unhandledrejection",t),performance&&performance.timing){const e=performance.timing.loadEventEnd-performance.timing.navigationStart;e>0&&o.trackPerformance("initial_page_load",e,{page:window.location.pathname})}const n=()=>{"hidden"===document.visibilityState?o.trackEvent("session_pause",{page:window.location.pathname,timestamp:Date.now()}):o.trackEvent("session_resume",{page:window.location.pathname,timestamp:Date.now()})};return document.addEventListener("visibilitychange",n),()=>{window.removeEventListener("error",e),window.removeEventListener("unhandledrejection",t),document.removeEventListener("visibilitychange",n)}},[o]),(0,i.useEffect)(()=>{const e=()=>{o.trackEvent("page_view",{page_title:document.title,page_location:window.location.href,page_path:window.location.pathname})};return e(),window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}},[o]),(0,s.jsxs)(s.Fragment,{children:[t,n&&(0,s.jsx)(A,{showDetails:!1,autoRefresh:!0,refreshInterval:5e3})]})}},2778:function(){}},function(e){e.O(0,[635,609,15,569,806,145,972,691,533,304,404,971,208,744],function(){return e(e.s=95300)}),_N_E=e.O()}]);