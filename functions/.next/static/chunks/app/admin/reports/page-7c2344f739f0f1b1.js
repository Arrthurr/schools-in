try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},s=(new e.Error).stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="614d8806-c5d2-4d7e-be81-d785f45bc53a",e._sentryDebugIdIdentifier="sentry-dbid-614d8806-c5d2-4d7e-be81-d785f45bc53a")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[375],{30574:function(e,s,t){Promise.resolve().then(t.bind(t,22138))},22138:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return eb}});var a=t(57437),l=t(2265),n=t(53002),r=t(9109),i=t(79820),c=t(12381),o=t(40279),d=t(75060),h=t(40875),u=t(30401),m=t(93448);let x=l.forwardRef((e,s)=>{let{options:t,value:n,placeholder:r="Select...",onValueChange:i,className:o,...d}=e,[x,j]=l.useState(!1),g=e=>{null==i||i(e),j(!1)},p=t.find(e=>e.value===n);return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(c.z,{ref:s,variant:"outline",role:"combobox","aria-expanded":x,className:(0,m.cn)("w-full justify-between",o),onClick:()=>j(!x),...d,children:[p?p.label:r,(0,a.jsx)(h.Z,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]}),x&&(0,a.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg",children:(0,a.jsx)("div",{className:"max-h-60 overflow-auto",children:t.map(e=>(0,a.jsxs)("div",{className:(0,m.cn)("flex items-center px-3 py-2 cursor-pointer hover:bg-gray-100",n===e.value&&"bg-gray-50"),onClick:()=>g(e.value),children:[(0,a.jsx)(u.Z,{className:(0,m.cn)("mr-2 h-4 w-4",n===e.value?"opacity-100":"opacity-0")}),e.label]},e.value))})})]})});x.displayName="Select";let j=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:s,className:(0,m.cn)("w-full caption-bottom text-sm",t),...l})})});j.displayName="Table";let g=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("thead",{ref:s,className:(0,m.cn)("[&_tr]:border-b",t),...l})});g.displayName="TableHeader";let p=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("tbody",{ref:s,className:(0,m.cn)("[&_tr:last-child]:border-0",t),...l})});p.displayName="TableBody",l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("tfoot",{ref:s,className:(0,m.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...l})}).displayName="TableFooter";let f=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("tr",{ref:s,className:(0,m.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...l})});f.displayName="TableRow";let v=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("th",{ref:s,className:(0,m.cn)("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...l})});v.displayName="TableHead";let y=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("td",{ref:s,className:(0,m.cn)("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...l})});y.displayName="TableCell",l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("caption",{ref:s,className:(0,m.cn)("mt-4 text-sm text-muted-foreground",t),...l})}).displayName="TableCaption";var N=t(69174),b=t(95937),S=t(15804),w=t(3577),k=t(94942),D=t(49322),T=t(96215),C=t(91723),I=t(70525),O=t(95805),Z=t(88501),A=t(92735),R=t(56096),L=t(20705),F=t(73634);function M(){let[e,s]=(0,l.useState)([]),[t,n]=(0,l.useState)([]),[r,h]=(0,l.useState)([]),[u,m]=(0,l.useState)(!1),[M,P]=(0,l.useState)(null),[E,_]=(0,l.useState)({dateRange:"month"}),[z,U]=(0,l.useState)({totalSessions:0,totalDuration:0,averageSessionDuration:0,completionRate:0,activeSessionsCount:0,completedSessionsCount:0}),Y=(0,l.useCallback)(e=>{let s;let t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59);switch(e){case"today":s=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0);break;case"week":let l=new Date(t);l.setDate(t.getDate()-t.getDay()),s=new Date(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0);break;case"month":default:s=new Date(t.getFullYear(),t.getMonth(),1,0,0,0);break;case"custom":return{startDate:E.startDate,endDate:E.endDate}}return{startDate:s,endDate:a}},[E.startDate,E.endDate]);(0,l.useEffect)(()=>{(async()=>{try{let[e,s]=await Promise.all([(0,F._N)(F.Ul.LOCATIONS),(0,F._N)(F.Ul.USERS)]);n(e),h(s.filter(e=>"provider"===e.role))}catch(e){console.error("Error loading initial data:",e),P("Failed to load filter data")}})()},[]);let V=(0,l.useCallback)(async()=>{if(!u){m(!0),P(null);try{let e=await (0,F._N)(F.Ul.SESSIONS),t=Y(E.dateRange);t.startDate&&t.endDate&&(e=e.filter(e=>{let s=e.checkInTime.toDate();return s>=t.startDate&&s<=t.endDate})),E.providerId&&(e=e.filter(e=>e.userId===E.providerId)),E.schoolId&&(e=e.filter(e=>e.schoolId===E.schoolId)),E.status&&(e=e.filter(e=>e.status===E.status));let a=e.length,l=e.filter(e=>"completed"===e.status),n=e.filter(e=>"active"===e.status),r=l.reduce((e,s)=>{if(s.checkInTime&&s.checkOutTime){let t=Math.round((s.checkOutTime.toMillis()-s.checkInTime.toMillis())/6e4);return e+t}return e},0),i=l.length>0?Math.round(r/l.length):0,c=a>0?Math.round(l.length/a*100):0;U({totalSessions:a,totalDuration:r,averageSessionDuration:i,completionRate:c,activeSessionsCount:n.length,completedSessionsCount:l.length}),s(e)}catch(e){console.error("Error loading sessions:",e),P("Failed to load session data")}finally{m(!1)}}},[E,u,Y]);(0,l.useEffect)(()=>{V()},[V]);let q=e=>{let s=t.find(s=>s.id===e);return(null==s?void 0:s.name)||"Unknown School"},K=e=>{let s=r.find(s=>s.id===e);return(null==s?void 0:s.displayName)||(null==s?void 0:s.email)||"Unknown Provider"},B=(e,s)=>{_(t=>({...t,[e]:s}))},H=(e,s)=>{let t=s?new Date(s):void 0;_(s=>({...s,[e]:t}))};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(w.Z,{className:"h-5 w-5"}),"Report Filters"]})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"dateRange",children:"Date Range"}),(0,a.jsx)(x,{options:[{value:"today",label:"Today"},{value:"week",label:"This Week"},{value:"month",label:"This Month"},{value:"custom",label:"Custom Range"}],value:E.dateRange,onValueChange:e=>B("dateRange",e),placeholder:"Select date range"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"provider",children:"Provider"}),(0,a.jsx)(x,{options:[{value:"",label:"All Providers"},...r.map(e=>({value:e.id,label:e.displayName||e.email}))],value:E.providerId||"",onValueChange:e=>B("providerId",e||void 0),placeholder:"All Providers"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"school",children:"School"}),(0,a.jsx)(x,{options:[{value:"",label:"All Schools"},...t.map(e=>({value:e.id,label:e.name}))],value:E.schoolId||"",onValueChange:e=>B("schoolId",e||void 0),placeholder:"All Schools"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"status",children:"Status"}),(0,a.jsx)(x,{options:[{value:"",label:"All Statuses"},{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"paused",label:"Paused"},{value:"error",label:"Error"},{value:"cancelled",label:"Cancelled"}],value:E.status||"",onValueChange:e=>B("status",e||void 0),placeholder:"All Statuses"})]})]}),"custom"===E.dateRange&&(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 mt-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"startDate",children:"Start Date"}),(0,a.jsx)(o.I,{id:"startDate",type:"date",value:E.startDate?E.startDate.toISOString().split("T")[0]:"",onChange:e=>H("startDate",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"endDate",children:"End Date"}),(0,a.jsx)(o.I,{id:"endDate",type:"date",value:E.endDate?E.endDate.toISOString().split("T")[0]:"",onChange:e=>H("endDate",e.target.value)})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,a.jsx)(c.z,{onClick:V,disabled:u,children:u?"Loading...":"Apply Filters"}),(0,a.jsx)(c.z,{variant:"outline",onClick:()=>{_({dateRange:"month"}),s([]),P(null)},children:"Reset Filters"}),(0,a.jsxs)(c.z,{variant:"outline",onClick:()=>{if(0===e.length){P("No data to export");return}let s=new Blob([[["Session ID","Provider Name","School Name","Check In Time","Check Out Time","Duration","Status","Check In Location","Check Out Location"],...e.map(e=>[e.id||"N/A",K(e.userId),q(e.schoolId),e.checkInTime?new Date(e.checkInTime.toDate()).toLocaleString():"N/A",e.checkOutTime?new Date(e.checkOutTime.toDate()).toLocaleString():"N/A",e.checkInTime&&e.checkOutTime?(0,L.LU)((0,L.Kc)(e.checkInTime,e.checkOutTime)):"N/A",(0,L.Cp)(e.status).label,e.checkInLocation?"".concat(e.checkInLocation.latitude,", ").concat(e.checkInLocation.longitude):"N/A",e.checkOutLocation?"".concat(e.checkOutLocation.latitude,", ").concat(e.checkOutLocation.longitude):"N/A"])].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");if(void 0!==t.download){let e=URL.createObjectURL(s);t.setAttribute("href",e),t.setAttribute("download","session-report-".concat(new Date().toISOString().split("T")[0],".csv")),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)}},disabled:0===e.length,className:"flex items-center gap-2",children:[(0,a.jsx)(k.Z,{className:"h-4 w-4"}),"Export CSV"]})]})]})]}),M&&(0,a.jsxs)(b.bZ,{variant:"destructive",children:[(0,a.jsx)(D.Z,{className:"h-4 w-4"}),(0,a.jsx)(b.X,{children:M})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Sessions"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:z.totalSessions})]}),(0,a.jsx)(T.Z,{className:"h-8 w-8 text-muted-foreground"})]})})}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Duration"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(0,L.LU)(z.totalDuration)})]}),(0,a.jsx)(C.Z,{className:"h-8 w-8 text-muted-foreground"})]})})}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg Session"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(0,L.LU)(z.averageSessionDuration)})]}),(0,a.jsx)(I.Z,{className:"h-8 w-8 text-muted-foreground"})]})})}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Completion Rate"}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[z.completionRate,"%"]})]}),(0,a.jsx)(O.Z,{className:"h-8 w-8 text-muted-foreground"})]})})})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(Z.Z,{className:"h-5 w-5"}),"Session Data (",e.length," sessions)"]}),(0,a.jsxs)(c.z,{variant:"outline",size:"sm",children:[(0,a.jsx)(A.Z,{className:"h-4 w-4 mr-2"}),"Export"]})]})}),(0,a.jsx)(i.aY,{children:u?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading sessions..."})}):0===e.length?(0,a.jsx)(S.ub,{type:"reports",title:"No sessions found",message:"No sessions match the selected filters. Try adjusting your date range or clearing filters to see more results.",actionLabel:"Clear Filters",onAction:()=>{_({dateRange:"month",startDate:void 0,endDate:void 0,providerId:"",schoolId:"",status:""})}}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(j,{children:[(0,a.jsx)(g,{children:(0,a.jsxs)(f,{children:[(0,a.jsx)(v,{children:"Provider"}),(0,a.jsx)(v,{children:"School"}),(0,a.jsx)(v,{children:"Check In"}),(0,a.jsx)(v,{children:"Check Out"}),(0,a.jsx)(v,{children:"Duration"}),(0,a.jsx)(v,{children:"Status"})]})}),(0,a.jsx)(p,{children:e.map(e=>{let s=e.checkInTime&&e.checkOutTime?Math.round((e.checkOutTime.toMillis()-e.checkInTime.toMillis())/6e4):0,t=(0,L.Cp)(e.status);return(0,a.jsxs)(f,{children:[(0,a.jsx)(y,{className:"font-medium",children:K(e.userId)}),(0,a.jsx)(y,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(R.Z,{className:"h-4 w-4 text-muted-foreground"}),q(e.schoolId)]})}),(0,a.jsx)(y,{children:e.checkInTime.toDate().toLocaleString()}),(0,a.jsx)(y,{children:e.checkOutTime?e.checkOutTime.toDate().toLocaleString():"--"}),(0,a.jsx)(y,{children:s>0?(0,L.LU)(s):"--"}),(0,a.jsx)(y,{children:(0,a.jsx)(N.C,{className:t.color,children:t.label})})]},e.id)})})]})})})]})]})}var P=t(31047),E=t(49663),_=t(83774);function z(){let[e,s]=(0,l.useState)([]),[t,n]=(0,l.useState)([]),[r,h]=(0,l.useState)([]),[u,m]=(0,l.useState)(!1),[S,w]=(0,l.useState)(null),[k,C]=(0,l.useState)({dateRange:"month"}),[Z,A]=(0,l.useState)({providerSummaries:[],schoolSummaries:[],overallStats:{totalProviders:0,totalSchools:0,averageAttendanceRate:0,totalSessionDays:0,mostActiveProvider:"",mostVisitedSchool:""}});(0,l.useEffect)(()=>{(async()=>{try{m(!0);let[e,s]=await Promise.all([(0,F._N)(F.Ul.LOCATIONS),(0,F._N)(F.Ul.USERS)]);n(e),h(s.filter(e=>"provider"===e.role))}catch(e){console.error("Error loading initial data:",e),w("Failed to load initial data")}finally{m(!1)}})()},[]);let M=(0,l.useCallback)(e=>{let s=new Date,t=new Date(s.getFullYear(),s.getMonth(),s.getDate());switch(e){case"today":return{startDate:t,endDate:new Date(t.getTime()+864e5)};case"week":let a=new Date(t);a.setDate(t.getDate()-t.getDay());let l=new Date(a);return l.setDate(a.getDate()+7),{startDate:a,endDate:l};case"month":return{startDate:new Date(t.getFullYear(),t.getMonth(),1),endDate:new Date(t.getFullYear(),t.getMonth()+1,1)};case"quarter":let n=Math.floor(t.getMonth()/3);return{startDate:new Date(t.getFullYear(),3*n,1),endDate:new Date(t.getFullYear(),(n+1)*3,1)};case"custom":return{startDate:k.startDate,endDate:k.endDate};default:return{startDate:null,endDate:null}}},[k.startDate,k.endDate]),z=(0,l.useCallback)(async()=>{if(!u)try{m(!0),w(null);let e=await (0,F._N)(F.Ul.SESSIONS),t=M(k.dateRange);t.startDate&&t.endDate&&(e=e.filter(e=>{let s=new Date(e.checkInTime.toDate());return s>=t.startDate&&s<=t.endDate})),k.providerId&&(e=e.filter(e=>e.userId===k.providerId)),k.schoolId&&(e=e.filter(e=>e.schoolId===k.schoolId));let a=U(e),l=Y(e),n=V(a,l);A({providerSummaries:a,schoolSummaries:l,overallStats:n}),s(e)}catch(e){console.error("Error loading attendance data:",e),w("Failed to load attendance data")}finally{m(!1)}},[k,u,M]),U=e=>{let s=new Map;return e.forEach(e=>{let t=e.userId,a=new Date(e.checkInTime.toDate()).toDateString();s.has(t)||s.set(t,{providerId:t,providerName:H(t),totalDays:new Set,totalSessions:0,totalDuration:0,averageSessionDuration:0,schoolsVisited:new Set,attendanceRate:0,lastSession:void 0});let l=s.get(t);if(l.totalDays.add(a),l.totalSessions++,e.checkOutTime){let s=(0,L.Kc)(e.checkInTime,e.checkOutTime);l.totalDuration+=s}l.schoolsVisited.add(e.schoolId);let n=e.checkInTime.toDate();(!l.lastSession||n>l.lastSession)&&(l.lastSession=n)}),Array.from(s.values()).map(e=>({...e,totalDays:e.totalDays.size,schoolsVisited:Array.from(e.schoolsVisited),averageSessionDuration:e.totalSessions>0?Math.round(e.totalDuration/e.totalSessions):0,attendanceRate:q(e.totalDays,k)}))},Y=e=>{let s=new Map;return e.forEach(e=>{let t=e.schoolId;s.has(t)||s.set(t,{schoolId:t,schoolName:B(t),totalProviders:new Set,totalSessions:0,totalDuration:0,averageSessionDuration:0,providersVisited:new Set,coverageRate:0});let a=s.get(t);if(a.totalProviders.add(e.userId),a.providersVisited.add(e.userId),a.totalSessions++,e.checkOutTime){let s=(0,L.Kc)(e.checkInTime,e.checkOutTime);a.totalDuration+=s}}),Array.from(s.values()).map(e=>({...e,totalProviders:e.totalProviders.size,providersVisited:Array.from(e.providersVisited),averageSessionDuration:e.totalSessions>0?Math.round(e.totalDuration/e.totalSessions):0,coverageRate:r.length>0?Math.round(e.totalProviders.size/r.length*100):0}))},V=(e,s)=>{let t=e.length,a=s.length,l=t>0?Math.round(e.reduce((e,s)=>e+s.attendanceRate,0)/t):0;return{totalProviders:t,totalSchools:a,averageAttendanceRate:l,totalSessionDays:e.reduce((e,s)=>e+s.totalDays,0),mostActiveProvider:e.length>0?e.reduce((e,s)=>s.totalSessions>e.totalSessions?s:e).providerName:"",mostVisitedSchool:s.length>0?s.reduce((e,s)=>s.totalSessions>e.totalSessions?s:e).schoolName:""}},q=(e,s)=>{let t=M(s.dateRange);if(!t.startDate||!t.endDate)return 0;let a=K(t.startDate,t.endDate);return a>0?Math.round(e.size/a*100):0},K=(e,s)=>{let t=0,a=new Date(e);for(;a<s;){let e=a.getDay();0!==e&&6!==e&&t++,a.setDate(a.getDate()+1)}return t};(0,l.useEffect)(()=>{z()},[z]);let B=e=>{let s=t.find(s=>s.id===e);return(null==s?void 0:s.name)||"Unknown School"},H=e=>{let s=r.find(s=>s.id===e);return(null==s?void 0:s.displayName)||(null==s?void 0:s.email)||"Unknown Provider"},W=(e,s)=>{C(t=>({...t,[e]:s}))},X=(e,s)=>{let t=s?new Date(s):void 0;C(s=>({...s,[e]:t}))};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(P.Z,{className:"h-5 w-5"}),"Attendance Summary Filters"]})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"dateRange",children:"Date Range"}),(0,a.jsx)(x,{options:[{value:"today",label:"Today"},{value:"week",label:"This Week"},{value:"month",label:"This Month"},{value:"quarter",label:"This Quarter"},{value:"custom",label:"Custom Range"}],value:k.dateRange,onValueChange:e=>W("dateRange",e),placeholder:"Select date range"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"provider",children:"Provider"}),(0,a.jsx)(x,{options:[{value:"",label:"All Providers"},...r.map(e=>({value:e.id,label:e.displayName||e.email}))],value:k.providerId||"",onValueChange:e=>W("providerId",e||void 0),placeholder:"All Providers"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"school",children:"School"}),(0,a.jsx)(x,{options:[{value:"",label:"All Schools"},...t.map(e=>({value:e.id,label:e.name}))],value:k.schoolId||"",onValueChange:e=>W("schoolId",e||void 0),placeholder:"All Schools"})]})]}),"custom"===k.dateRange&&(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 mt-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"startDate",children:"Start Date"}),(0,a.jsx)(o.I,{id:"startDate",type:"date",value:k.startDate?k.startDate.toISOString().split("T")[0]:"",onChange:e=>X("startDate",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"endDate",children:"End Date"}),(0,a.jsx)(o.I,{id:"endDate",type:"date",value:k.endDate?k.endDate.toISOString().split("T")[0]:"",onChange:e=>X("endDate",e.target.value)})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,a.jsx)(c.z,{onClick:z,disabled:u,children:u?"Loading...":"Apply Filters"}),(0,a.jsx)(c.z,{variant:"outline",onClick:()=>{C({dateRange:"month"}),w(null)},children:"Reset Filters"})]})]})]}),S&&(0,a.jsxs)(b.bZ,{variant:"destructive",children:[(0,a.jsx)(D.Z,{className:"h-4 w-4"}),(0,a.jsx)(b.X,{children:S})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ll,{className:"text-sm font-medium",children:"Total Providers"}),(0,a.jsx)(O.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(i.aY,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:Z.overallStats.totalProviders})})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ll,{className:"text-sm font-medium",children:"Total Schools"}),(0,a.jsx)(R.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(i.aY,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:Z.overallStats.totalSchools})})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ll,{className:"text-sm font-medium",children:"Avg Attendance Rate"}),(0,a.jsx)(I.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(i.aY,{children:(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[Z.overallStats.averageAttendanceRate,"%"]})})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ll,{className:"text-sm font-medium",children:"Total Session Days"}),(0,a.jsx)(P.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(i.aY,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:Z.overallStats.totalSessionDays})})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(E.Z,{className:"h-5 w-5"}),"Provider Attendance Summary (",Z.providerSummaries.length," providers)"]})}),(0,a.jsx)(i.aY,{children:0===Z.providerSummaries.length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No provider attendance data found for the selected filters"}):(0,a.jsx)("div",{className:"overflow-auto",children:(0,a.jsxs)(j,{children:[(0,a.jsx)(g,{children:(0,a.jsxs)(f,{children:[(0,a.jsx)(v,{children:"Provider"}),(0,a.jsx)(v,{children:"Days Attended"}),(0,a.jsx)(v,{children:"Total Sessions"}),(0,a.jsx)(v,{children:"Total Duration"}),(0,a.jsx)(v,{children:"Avg Session"}),(0,a.jsx)(v,{children:"Schools Visited"}),(0,a.jsx)(v,{children:"Attendance Rate"}),(0,a.jsx)(v,{children:"Last Session"})]})}),(0,a.jsx)(p,{children:Z.providerSummaries.map(e=>(0,a.jsxs)(f,{children:[(0,a.jsx)(y,{className:"font-medium",children:e.providerName}),(0,a.jsx)(y,{children:e.totalDays}),(0,a.jsx)(y,{children:e.totalSessions}),(0,a.jsx)(y,{children:(0,L.LU)(e.totalDuration)}),(0,a.jsx)(y,{children:(0,L.LU)(e.averageSessionDuration)}),(0,a.jsx)(y,{children:e.schoolsVisited.length}),(0,a.jsx)(y,{children:(0,a.jsxs)(N.C,{variant:e.attendanceRate>=80?"default":e.attendanceRate>=60?"secondary":"destructive",children:[e.attendanceRate,"%"]})}),(0,a.jsx)(y,{children:e.lastSession?e.lastSession.toLocaleDateString():"N/A"})]},e.providerId))})]})})})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(_.Z,{className:"h-5 w-5"}),"School Coverage Summary (",Z.schoolSummaries.length," ","schools)"]})}),(0,a.jsx)(i.aY,{children:0===Z.schoolSummaries.length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No school coverage data found for the selected filters"}):(0,a.jsx)("div",{className:"overflow-auto",children:(0,a.jsxs)(j,{children:[(0,a.jsx)(g,{children:(0,a.jsxs)(f,{children:[(0,a.jsx)(v,{children:"School"}),(0,a.jsx)(v,{children:"Providers"}),(0,a.jsx)(v,{children:"Total Sessions"}),(0,a.jsx)(v,{children:"Total Duration"}),(0,a.jsx)(v,{children:"Avg Session"}),(0,a.jsx)(v,{children:"Coverage Rate"})]})}),(0,a.jsx)(p,{children:Z.schoolSummaries.map(e=>(0,a.jsxs)(f,{children:[(0,a.jsx)(y,{className:"font-medium",children:e.schoolName}),(0,a.jsx)(y,{children:e.totalProviders}),(0,a.jsx)(y,{children:e.totalSessions}),(0,a.jsx)(y,{children:(0,L.LU)(e.totalDuration)}),(0,a.jsx)(y,{children:(0,L.LU)(e.averageSessionDuration)}),(0,a.jsx)(y,{children:(0,a.jsxs)(N.C,{variant:e.coverageRate>=50?"default":e.coverageRate>=25?"secondary":"destructive",children:[e.coverageRate,"%"]})})]},e.schoolId))})]})})})]}),(Z.overallStats.mostActiveProvider||Z.overallStats.mostVisitedSchool)&&(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(T.Z,{className:"h-5 w-5"}),"Key Insights"]})}),(0,a.jsx)(i.aY,{children:(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[Z.overallStats.mostActiveProvider&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Most Active Provider"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:Z.overallStats.mostActiveProvider})]}),Z.overallStats.mostVisitedSchool&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Most Visited School"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:Z.overallStats.mostVisitedSchool})]})]})})]})]})}var U=t(23675),Y=t(74291),V=t(15868),q=t(76865),K=t(32489),B=t(83229),H=t(5978);function W(){let[e,s]=(0,l.useState)([]),[t,n]=(0,l.useState)([]),[r,h]=(0,l.useState)([]),[u,m]=(0,l.useState)(!1),[w,k]=(0,l.useState)(null),[D,T]=(0,l.useState)(null),[I,O]=(0,l.useState)(!1),[Z,A]=(0,l.useState)(!1),[R,M]=(0,l.useState)({checkInTime:"",checkInDate:"",checkOutTime:"",checkOutDate:"",status:"",notes:"",checkInLatitude:"",checkInLongitude:"",checkOutLatitude:"",checkOutLongitude:""});(0,l.useEffect)(()=>{(async()=>{try{m(!0);let[e,t,a]=await Promise.all([(0,F._N)(F.Ul.LOCATIONS),(0,F._N)(F.Ul.USERS),(0,F._N)(F.Ul.SESSIONS)]);n(e),h(t.filter(e=>"provider"===e.role)),s(a)}catch(e){console.error("Error loading initial data:",e),k("Failed to load session data")}finally{m(!1)}})()},[]);let E=e=>{let s=t.find(s=>s.id===e);return(null==s?void 0:s.name)||"Unknown School"},_=e=>{let s=r.find(s=>s.id===e);return(null==s?void 0:s.displayName)||(null==s?void 0:s.email)||"Unknown Provider"},z=e=>{var s,t,a,l,n;T(e);let r=e.checkInTime.toDate(),i=null===(s=e.checkOutTime)||void 0===s?void 0:s.toDate();M({checkInDate:r.toISOString().split("T")[0],checkInTime:r.toTimeString().split(" ")[0].slice(0,5),checkOutDate:i?i.toISOString().split("T")[0]:"",checkOutTime:i?i.toTimeString().split(" ")[0].slice(0,5):"",status:e.status,notes:e.notes||"",checkInLatitude:e.checkInLocation.latitude.toString(),checkInLongitude:e.checkInLocation.longitude.toString(),checkOutLatitude:(null===(a=e.checkOutLocation)||void 0===a?void 0:null===(t=a.latitude)||void 0===t?void 0:t.toString())||"",checkOutLongitude:(null===(n=e.checkOutLocation)||void 0===n?void 0:null===(l=n.longitude)||void 0===l?void 0:l.toString())||""}),O(!0)},W=e=>{T(e);let s=new Date;M({checkInDate:e.checkInTime.toDate().toISOString().split("T")[0],checkInTime:e.checkInTime.toDate().toTimeString().split(" ")[0].slice(0,5),checkOutDate:s.toISOString().split("T")[0],checkOutTime:s.toTimeString().split(" ")[0].slice(0,5),status:"completed",notes:e.notes||"Force-closed by administrator",checkInLatitude:e.checkInLocation.latitude.toString(),checkInLongitude:e.checkInLocation.longitude.toString(),checkOutLatitude:e.checkInLocation.latitude.toString(),checkOutLongitude:e.checkInLocation.longitude.toString()}),A(!0)},X=(e,s)=>{M(t=>({...t,[e]:s}))},Q=async()=>{if(null==D?void 0:D.id)try{m(!0),k(null);let e=new Date("".concat(R.checkInDate,"T").concat(R.checkInTime)),t=R.checkOutDate&&R.checkOutTime?new Date("".concat(R.checkOutDate,"T").concat(R.checkOutTime)):void 0,a={checkInTime:H.EK.fromDate(e),checkOutTime:t?H.EK.fromDate(t):void 0,status:R.status,notes:R.notes,checkInLocation:{latitude:parseFloat(R.checkInLatitude),longitude:parseFloat(R.checkInLongitude)}};R.checkOutLatitude&&R.checkOutLongitude&&(a.checkOutLocation={latitude:parseFloat(R.checkOutLatitude),longitude:parseFloat(R.checkOutLongitude)}),await (0,F.gU)(F.Ul.SESSIONS,D.id,a),s(e=>e.map(e=>e.id===D.id?{...e,...a}:e)),O(!1),A(!1),T(null)}catch(e){console.error("Error saving session corrections:",e),k("Failed to save session corrections")}finally{m(!1)}},$=(()=>{let s=new Date(new Date().getTime()-432e5);return e.filter(e=>{let t="active"===e.status&&e.checkInTime.toDate()<s,a="error"===e.status,l="paused"===e.status;return t||a||l})})();return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(V.Z,{className:"h-5 w-5"}),"Session Management & Corrections"]})}),(0,a.jsx)(i.aY,{children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Manage and correct session data, force-close stuck sessions, and resolve error states."})})]}),w&&(0,a.jsxs)(b.bZ,{variant:"destructive",children:[(0,a.jsx)(q.Z,{className:"h-4 w-4"}),(0,a.jsx)(b.X,{children:w})]}),$.length>0&&(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2 text-orange-600",children:[(0,a.jsx)(q.Z,{className:"h-5 w-5"}),"Sessions Needing Attention (",$.length,")"]})}),(0,a.jsx)(i.aY,{children:(0,a.jsx)("div",{className:"overflow-auto",children:(0,a.jsxs)(j,{children:[(0,a.jsx)(g,{children:(0,a.jsxs)(f,{children:[(0,a.jsx)(v,{children:"Provider"}),(0,a.jsx)(v,{children:"School"}),(0,a.jsx)(v,{children:"Check In"}),(0,a.jsx)(v,{children:"Duration"}),(0,a.jsx)(v,{children:"Status"}),(0,a.jsx)(v,{children:"Actions"})]})}),(0,a.jsx)(p,{children:$.map(e=>(0,a.jsxs)(f,{children:[(0,a.jsx)(y,{className:"font-medium",children:_(e.userId)}),(0,a.jsx)(y,{children:E(e.schoolId)}),(0,a.jsx)(y,{children:e.checkInTime.toDate().toLocaleString()}),(0,a.jsx)(y,{children:e.checkOutTime?(0,L.LU)((0,L.Kc)(e.checkInTime,e.checkOutTime)):(0,L.LU)(Math.floor((Date.now()-e.checkInTime.toDate().getTime())/6e4))}),(0,a.jsx)(y,{children:(0,a.jsx)(N.C,{variant:"error"===e.status?"destructive":"active"===e.status?"secondary":"default",children:(0,L.Cp)(e.status).label})}),(0,a.jsx)(y,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(c.z,{size:"sm",variant:"outline",onClick:()=>z(e),children:[(0,a.jsx)(V.Z,{className:"h-3 w-3"}),"Edit"]}),"active"===e.status&&(0,a.jsxs)(c.z,{size:"sm",variant:"destructive",onClick:()=>W(e),children:[(0,a.jsx)(K.Z,{className:"h-3 w-3"}),"Force Close"]})]})})]},e.id))})]})})})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(C.Z,{className:"h-5 w-5"}),"All Sessions (",e.length,")"]})}),(0,a.jsx)(i.aY,{children:0===e.length?u?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading sessions..."}):(0,a.jsx)(S.ub,{type:"sessions",title:"No sessions found",message:"No check-in sessions have been recorded yet. Sessions will appear here once providers start checking in.",showAction:!1}):(0,a.jsx)("div",{className:"overflow-auto",children:(0,a.jsxs)(j,{children:[(0,a.jsx)(g,{children:(0,a.jsxs)(f,{children:[(0,a.jsx)(v,{children:"Provider"}),(0,a.jsx)(v,{children:"School"}),(0,a.jsx)(v,{children:"Check In"}),(0,a.jsx)(v,{children:"Check Out"}),(0,a.jsx)(v,{children:"Duration"}),(0,a.jsx)(v,{children:"Status"}),(0,a.jsx)(v,{children:"Actions"})]})}),(0,a.jsx)(p,{children:e.map(e=>(0,a.jsxs)(f,{children:[(0,a.jsx)(y,{className:"font-medium",children:_(e.userId)}),(0,a.jsx)(y,{children:E(e.schoolId)}),(0,a.jsx)(y,{children:e.checkInTime.toDate().toLocaleString()}),(0,a.jsx)(y,{children:e.checkOutTime?e.checkOutTime.toDate().toLocaleString():"Active"}),(0,a.jsx)(y,{children:e.checkOutTime?(0,L.LU)((0,L.Kc)(e.checkInTime,e.checkOutTime)):(0,L.LU)(Math.floor((Date.now()-e.checkInTime.toDate().getTime())/6e4))}),(0,a.jsx)(y,{children:(0,a.jsx)(N.C,{variant:"error"===e.status?"destructive":"active"===e.status?"secondary":"completed"===e.status?"default":"outline",children:(0,L.Cp)(e.status).label})}),(0,a.jsx)(y,{children:(0,a.jsxs)(c.z,{size:"sm",variant:"outline",onClick:()=>z(e),children:[(0,a.jsx)(V.Z,{className:"h-3 w-3"}),"Edit"]})})]},e.id))})]})})})]}),(0,a.jsx)(Y.Vq,{open:I,onOpenChange:O,children:(0,a.jsxs)(Y.cZ,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)(Y.fK,{children:[(0,a.jsxs)(Y.$N,{className:"flex items-center gap-2",children:[(0,a.jsx)(V.Z,{className:"h-5 w-5"}),"Edit Session"]}),(0,a.jsxs)(Y.Be,{children:["Correct session data for"," ",D?_(D.userId):""," at ",D?E(D.schoolId):""]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h4",{className:"font-medium flex items-center gap-2",children:[(0,a.jsx)(P.Z,{className:"h-4 w-4"}),"Check In Details"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d._,{htmlFor:"checkInDate",children:"Check In Date"}),(0,a.jsx)(o.I,{id:"checkInDate",type:"date",value:R.checkInDate,onChange:e=>X("checkInDate",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d._,{htmlFor:"checkInTime",children:"Check In Time"}),(0,a.jsx)(o.I,{id:"checkInTime",type:"time",value:R.checkInTime,onChange:e=>X("checkInTime",e.target.value)})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d._,{htmlFor:"checkInLatitude",children:"Check In Latitude"}),(0,a.jsx)(o.I,{id:"checkInLatitude",type:"number",step:"any",value:R.checkInLatitude,onChange:e=>X("checkInLatitude",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d._,{htmlFor:"checkInLongitude",children:"Check In Longitude"}),(0,a.jsx)(o.I,{id:"checkInLongitude",type:"number",step:"any",value:R.checkInLongitude,onChange:e=>X("checkInLongitude",e.target.value)})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h4",{className:"font-medium flex items-center gap-2",children:[(0,a.jsx)(C.Z,{className:"h-4 w-4"}),"Check Out Details"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d._,{htmlFor:"checkOutDate",children:"Check Out Date"}),(0,a.jsx)(o.I,{id:"checkOutDate",type:"date",value:R.checkOutDate,onChange:e=>X("checkOutDate",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d._,{htmlFor:"checkOutTime",children:"Check Out Time"}),(0,a.jsx)(o.I,{id:"checkOutTime",type:"time",value:R.checkOutTime,onChange:e=>X("checkOutTime",e.target.value)})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d._,{htmlFor:"checkOutLatitude",children:"Check Out Latitude"}),(0,a.jsx)(o.I,{id:"checkOutLatitude",type:"number",step:"any",value:R.checkOutLatitude,onChange:e=>X("checkOutLatitude",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d._,{htmlFor:"checkOutLongitude",children:"Check Out Longitude"}),(0,a.jsx)(o.I,{id:"checkOutLongitude",type:"number",step:"any",value:R.checkOutLongitude,onChange:e=>X("checkOutLongitude",e.target.value)})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d._,{htmlFor:"status",children:"Session Status"}),(0,a.jsx)(x,{options:[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"paused",label:"Paused"},{value:"cancelled",label:"Cancelled"},{value:"error",label:"Error"}],value:R.status,onValueChange:e=>X("status",e)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d._,{htmlFor:"notes",children:"Session Notes"}),(0,a.jsx)(U.g,{id:"notes",value:R.notes,onChange:e=>X("notes",e.target.value),placeholder:"Add notes about this session or correction...",rows:3})]})]})]}),(0,a.jsxs)(Y.cN,{children:[(0,a.jsx)(c.z,{variant:"outline",onClick:()=>O(!1),disabled:u,children:"Cancel"}),(0,a.jsxs)(c.z,{onClick:Q,disabled:u,className:"flex items-center gap-2",children:[(0,a.jsx)(B.Z,{className:"h-4 w-4"}),u?"Saving...":"Save Changes"]})]})]})}),(0,a.jsx)(Y.Vq,{open:Z,onOpenChange:A,children:(0,a.jsxs)(Y.cZ,{children:[(0,a.jsxs)(Y.fK,{children:[(0,a.jsxs)(Y.$N,{className:"flex items-center gap-2",children:[(0,a.jsx)(K.Z,{className:"h-5 w-5"}),"Force Close Session"]}),(0,a.jsxs)(Y.Be,{children:["This will force-close the active session for"," ",D?_(D.userId):""," at ",D?E(D.schoolId):"",". The check-out time will be set to now."]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d._,{htmlFor:"forceCloseDate",children:"Check Out Date"}),(0,a.jsx)(o.I,{id:"forceCloseDate",type:"date",value:R.checkOutDate,onChange:e=>X("checkOutDate",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d._,{htmlFor:"forceCloseTime",children:"Check Out Time"}),(0,a.jsx)(o.I,{id:"forceCloseTime",type:"time",value:R.checkOutTime,onChange:e=>X("checkOutTime",e.target.value)})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d._,{htmlFor:"forceCloseNotes",children:"Notes"}),(0,a.jsx)(U.g,{id:"forceCloseNotes",value:R.notes,onChange:e=>X("notes",e.target.value),placeholder:"Reason for force-closing this session...",rows:2})]})]}),(0,a.jsxs)(Y.cN,{children:[(0,a.jsx)(c.z,{variant:"outline",onClick:()=>A(!1),disabled:u,children:"Cancel"}),(0,a.jsxs)(c.z,{variant:"destructive",onClick:Q,disabled:u,className:"flex items-center gap-2",children:[(0,a.jsx)(K.Z,{className:"h-4 w-4"}),u?"Closing...":"Force Close Session"]})]})]})})]})}var X=t(47625),Q=t(5481),$=t(56940),G=t(97059),J=t(2027),ee=t(78155),es=t(53250),et=t(88822),ea=t(21156),el=t(52797),en=t(77031),er=t(40626),ei=t(86810),ec=t(10062),eo=t(20407),ed=t(42488),eh=t(40370);function eu(){let[e,s]=(0,l.useState)([]),[t,n]=(0,l.useState)([]),[r,c]=(0,l.useState)([]),[o,h]=(0,l.useState)(!1),[u,m]=(0,l.useState)(null),[j,g]=(0,l.useState)({dateRange:"month",chartType:"volume"});(0,l.useEffect)(()=>{(async()=>{try{h(!0);let[e,t,a]=await Promise.all([(0,F._N)(F.Ul.LOCATIONS),(0,F._N)(F.Ul.USERS),(0,F._N)(F.Ul.SESSIONS)]);n(e),c(t.filter(e=>"provider"===e.role)),s(a)}catch(e){console.error("Error loading analytics data:",e),m("Failed to load analytics data")}finally{h(!1)}})()},[]);let p=(0,l.useMemo)(()=>{let s;let t=new Date;switch(j.dateRange){case"week":s=new Date(t.getTime()-6048e5);break;case"month":default:s=new Date(t.getTime()-2592e6);break;case"quarter":s=new Date(t.getTime()-7776e6);break;case"year":s=new Date(t.getTime()-31536e6)}return e.filter(e=>e.checkInTime.toDate()>=s)},[e,j.dateRange]),f=e=>{let s=t.find(s=>s.id===e);return(null==s?void 0:s.name)||"Unknown School"},v=e=>{let s=r.find(s=>s.id===e);return(null==s?void 0:s.displayName)||(null==s?void 0:s.email)||"Unknown Provider"},y=(0,l.useMemo)(()=>{let e=new Map;return p.forEach(s=>{let t=s.checkInTime.toDate().toISOString().split("T")[0],a=e.get(t)||{sessions:0,duration:0};a.sessions+=1,s.checkOutTime&&(a.duration+=(0,L.Kc)(s.checkInTime,s.checkOutTime)),e.set(t,a)}),Array.from(e.entries()).map(e=>{let[s,t]=e;return{date:new Date(s).toLocaleDateString(),sessions:t.sessions,duration:t.duration}}).sort((e,s)=>new Date(e.date).getTime()-new Date(s.date).getTime()).slice(-30)},[p]),N=(0,l.useMemo)(()=>{let e=new Map;return p.forEach(s=>{let t=e.get(s.userId)||{sessions:0,duration:0};t.sessions+=1,s.checkOutTime&&(t.duration+=(0,L.Kc)(s.checkInTime,s.checkOutTime)),e.set(s.userId,t)}),Array.from(e.entries()).map(e=>{let[s,t]=e;return{name:v(s).split(" ")[0]||v(s).substring(0,10),sessions:t.sessions,duration:t.duration,avgDuration:t.sessions>0?Math.round(t.duration/t.sessions):0}}).sort((e,s)=>s.sessions-e.sessions).slice(0,10)},[p,r]),S=(0,l.useMemo)(()=>{let e=new Map;return p.forEach(s=>{let t=e.get(s.schoolId)||{sessions:0,providers:new Set,duration:0};t.sessions+=1,t.providers.add(s.userId),s.checkOutTime&&(t.duration+=(0,L.Kc)(s.checkInTime,s.checkOutTime)),e.set(s.schoolId,t)}),Array.from(e.entries()).map(e=>{let[s,t]=e;return{name:f(s).substring(0,15),sessions:t.sessions,providers:t.providers.size,avgDuration:t.sessions>0?Math.round(t.duration/t.sessions):0}}).sort((e,s)=>s.sessions-e.sessions).slice(0,10)},[p,t]),w=(0,l.useMemo)(()=>{let e=new Map;p.forEach(s=>{let t=e.get(s.status)||0;e.set(s.status,t+1)});let s=p.length;return Array.from(e.entries()).map(e=>{let[t,a]=e;return{status:(0,L.Cp)(t).label,count:a,percentage:s>0?Math.round(a/s*100):0}}).sort((e,s)=>s.count-e.count)},[p]),k=(0,l.useMemo)(()=>{let e=new Map;return p.forEach(s=>{let t=s.checkInTime.toDate().getHours(),a=e.get(t)||{sessions:0,duration:0};a.sessions+=1,s.checkOutTime&&(a.duration+=(0,L.Kc)(s.checkInTime,s.checkOutTime)),e.set(t,a)}),Array.from({length:24},(s,t)=>{let a=e.get(t)||{sessions:0,duration:0};return{hour:"".concat(t.toString().padStart(2,"0"),":00"),sessions:a.sessions,avgDuration:a.sessions>0?Math.round(a.duration/a.sessions):0}})},[p]),Z=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8","#82CA9D"],A=(e,s)=>{g(t=>({...t,[e]:s}))},M=(()=>{switch(j.chartType){case"volume":return{title:"Session Volume Over Time",description:"Daily session counts showing activity levels"};case"duration":return{title:"Session Duration Trends",description:"Total session duration per day"};case"providers":return{title:"Top Provider Performance",description:"Most active providers by session count"};case"schools":return{title:"School Activity Analysis",description:"Session and provider distribution across schools"};case"status":return{title:"Session Status Distribution",description:"Breakdown of session statuses"};case"trends":return{title:"Hourly Activity Trends",description:"Session patterns throughout the day"};default:return{title:"Analytics",description:"Select a chart type"}}})();return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(T.Z,{className:"h-5 w-5"}),"Session Analytics & Visualization"]})}),(0,a.jsx)(i.aY,{children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Visual analytics and insights for session data, provider performance, and activity trends."})})]}),u&&(0,a.jsxs)(b.bZ,{variant:"destructive",children:[(0,a.jsx)(D.Z,{className:"h-4 w-4"}),(0,a.jsx)(b.X,{children:u})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{className:"text-lg",children:"Analytics Filters"})}),(0,a.jsx)(i.aY,{children:(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"dateRange",children:"Date Range"}),(0,a.jsx)(x,{options:[{value:"week",label:"Last 7 Days"},{value:"month",label:"Last 30 Days"},{value:"quarter",label:"Last 90 Days"},{value:"year",label:"Last Year"}],value:j.dateRange,onValueChange:e=>A("dateRange",e),placeholder:"Select date range"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"chartType",children:"Chart Type"}),(0,a.jsx)(x,{options:[{value:"volume",label:"Session Volume"},{value:"duration",label:"Duration Trends"},{value:"providers",label:"Provider Performance"},{value:"schools",label:"School Activity"},{value:"status",label:"Status Distribution"},{value:"trends",label:"Hourly Trends"}],value:j.chartType,onValueChange:e=>A("chartType",e),placeholder:"Select chart type"})]})]})})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ll,{className:"text-sm font-medium",children:"Total Sessions"}),(0,a.jsx)(ed.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:p.length}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"In selected period"})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ll,{className:"text-sm font-medium",children:"Active Providers"}),(0,a.jsx)(O.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:new Set(p.map(e=>e.userId)).size}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Unique providers"})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ll,{className:"text-sm font-medium",children:"Schools Visited"}),(0,a.jsx)(R.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:new Set(p.map(e=>e.schoolId)).size}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Unique schools"})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ll,{className:"text-sm font-medium",children:"Avg Duration"}),(0,a.jsx)(C.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:p.length>0?(0,L.LU)(Math.round(p.filter(e=>e.checkOutTime).reduce((e,s)=>e+(0,L.Kc)(s.checkInTime,s.checkOutTime),0)/p.filter(e=>e.checkOutTime).length)):"0m"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Per session"})]})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:["volume"===j.chartType&&(0,a.jsx)(I.Z,{className:"h-5 w-5"}),"duration"===j.chartType&&(0,a.jsx)(C.Z,{className:"h-5 w-5"}),"providers"===j.chartType&&(0,a.jsx)(O.Z,{className:"h-5 w-5"}),"schools"===j.chartType&&(0,a.jsx)(R.Z,{className:"h-5 w-5"}),"status"===j.chartType&&(0,a.jsx)(eh.Z,{className:"h-5 w-5"}),"trends"===j.chartType&&(0,a.jsx)(P.Z,{className:"h-5 w-5"}),M.title]})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:M.description}),o?(0,a.jsx)("div",{className:"flex items-center justify-center h-[400px]",children:(0,a.jsx)("div",{className:"text-muted-foreground",children:"Loading chart data..."})}):0===p.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-[400px]",children:(0,a.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,a.jsx)(T.Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"No data available for the selected period"})]})}):(()=>{switch(j.chartType){case"volume":return(0,a.jsx)(X.h,{width:"100%",height:400,children:(0,a.jsxs)(Q.T,{data:y,children:[(0,a.jsx)($.q,{strokeDasharray:"3 3"}),(0,a.jsx)(G.K,{dataKey:"date"}),(0,a.jsx)(J.Q,{}),(0,a.jsx)(ee.u,{}),(0,a.jsx)(es.D,{}),(0,a.jsx)(et.uN,{type:"monotone",dataKey:"sessions",stackId:"1",stroke:"#8884d8",fill:"#8884d8",name:"Sessions"})]})});case"duration":return(0,a.jsx)(X.h,{width:"100%",height:400,children:(0,a.jsxs)(ea.w,{data:y,children:[(0,a.jsx)($.q,{strokeDasharray:"3 3"}),(0,a.jsx)(G.K,{dataKey:"date"}),(0,a.jsx)(J.Q,{}),(0,a.jsx)(ee.u,{formatter:e=>[(0,L.LU)(Number(e)),"Total Duration"]}),(0,a.jsx)(es.D,{}),(0,a.jsx)(el.x,{type:"monotone",dataKey:"duration",stroke:"#82ca9d",strokeWidth:3,name:"Duration (minutes)"})]})});case"providers":return(0,a.jsx)(X.h,{width:"100%",height:400,children:(0,a.jsxs)(en.v,{data:N,layout:"horizontal",children:[(0,a.jsx)($.q,{strokeDasharray:"3 3"}),(0,a.jsx)(G.K,{type:"number"}),(0,a.jsx)(J.Q,{dataKey:"name",type:"category",width:80}),(0,a.jsx)(ee.u,{}),(0,a.jsx)(es.D,{}),(0,a.jsx)(er.$,{dataKey:"sessions",fill:"#8884d8",name:"Sessions"})]})});case"schools":return(0,a.jsx)(X.h,{width:"100%",height:400,children:(0,a.jsxs)(en.v,{data:S,children:[(0,a.jsx)($.q,{strokeDasharray:"3 3"}),(0,a.jsx)(G.K,{dataKey:"name",angle:-45,textAnchor:"end",height:80}),(0,a.jsx)(J.Q,{}),(0,a.jsx)(ee.u,{}),(0,a.jsx)(es.D,{}),(0,a.jsx)(er.$,{dataKey:"sessions",fill:"#0088FE",name:"Sessions"}),(0,a.jsx)(er.$,{dataKey:"providers",fill:"#00C49F",name:"Providers"})]})});case"status":return(0,a.jsx)(X.h,{width:"100%",height:400,children:(0,a.jsxs)(ei.u,{children:[(0,a.jsx)(ec.b,{data:w,cx:"50%",cy:"50%",labelLine:!1,label:e=>"".concat(e.status,": ").concat(e.percentage,"%"),outerRadius:120,fill:"#8884d8",dataKey:"count",children:w.map((e,s)=>(0,a.jsx)(eo.b,{fill:Z[s%Z.length]},"cell-".concat(s)))}),(0,a.jsx)(ee.u,{})]})});case"trends":return(0,a.jsx)(X.h,{width:"100%",height:400,children:(0,a.jsxs)(ea.w,{data:k,children:[(0,a.jsx)($.q,{strokeDasharray:"3 3"}),(0,a.jsx)(G.K,{dataKey:"hour"}),(0,a.jsx)(J.Q,{}),(0,a.jsx)(ee.u,{}),(0,a.jsx)(es.D,{}),(0,a.jsx)(el.x,{type:"monotone",dataKey:"sessions",stroke:"#8884d8",strokeWidth:2,name:"Sessions"})]})});default:return(0,a.jsx)("div",{children:"Select a chart type"})}})()]})]}),p.length>0&&(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(I.Z,{className:"h-5 w-5"}),"Quick Insights"]})}),(0,a.jsx)(i.aY,{children:(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Most Active Day"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:y.length>0?y.reduce((e,s)=>s.sessions>e.sessions?s:e).date:"No data"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Peak Hour"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:k.length>0?k.reduce((e,s)=>s.sessions>e.sessions?s:e).hour:"No data"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Completion Rate"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:p.length>0?"".concat(Math.round(p.filter(e=>"completed"===e.status).length/p.length*100),"%"):"0%"})]})]})})]})]})}var em=t(48736),ex=t(98728),ej=t(99397),eg=t(89345),ep=t(41671),ef=t(33276),ev=t(89227),ey=t(18930);function eN(){let[e,s]=(0,l.useState)([]),[t,n]=(0,l.useState)(!1),[r,h]=(0,l.useState)(null),[u,m]=(0,l.useState)(!1),[j,g]=(0,l.useState)(null),[p,f]=(0,l.useState)({name:"",description:"",reportType:"sessions",frequency:"weekly",deliveryTime:"09:00",recipients:"",format:"pdf"});(0,l.useEffect)(()=>{s([{id:"sched-1",name:"Weekly Session Summary",description:"Weekly overview of all session activities",reportType:"sessions",frequency:"weekly",deliveryTime:"09:00",recipients:["admin@schoolsin.com","manager@schoolsin.com"],filters:{dateRange:"week"},format:"pdf",isActive:!0,lastRun:new Date(Date.now()-6048e5),nextRun:new Date(Date.now()+864e5),createdAt:new Date(Date.now()-2592e6),createdBy:"admin@schoolsin.com"},{id:"sched-2",name:"Monthly Analytics Report",description:"Comprehensive monthly analytics and insights",reportType:"analytics",frequency:"monthly",deliveryTime:"08:00",recipients:["analytics@schoolsin.com","director@schoolsin.com"],filters:{dateRange:"month"},format:"excel",isActive:!0,lastRun:new Date(Date.now()-2592e6),nextRun:new Date(Date.now()+432e6),createdAt:new Date(Date.now()-7776e6),createdBy:"admin@schoolsin.com"},{id:"sched-3",name:"Daily Attendance Check",description:"Daily attendance summary for operational review",reportType:"attendance",frequency:"daily",deliveryTime:"17:00",recipients:["operations@schoolsin.com"],filters:{dateRange:"day"},format:"csv",isActive:!1,lastRun:new Date(Date.now()-864e5),nextRun:void 0,createdAt:new Date(Date.now()-5184e6),createdBy:"operations@schoolsin.com"}])},[]);let v=(e,s)=>{let t=new Date,[a,l]=s.split(":").map(Number),n=new Date(t);switch(n.setHours(a,l,0,0),e){case"daily":n<=t&&n.setDate(n.getDate()+1);break;case"weekly":n.setDate(n.getDate()+(7-n.getDay())%7||7);break;case"monthly":n.setMonth(n.getMonth()+1,1);break;case"quarterly":let r=Math.floor(n.getMonth()/3);n.setMonth((r+1)*3,1)}return n},y=e=>{s(s=>s.map(s=>s.id===e?{...s,isActive:!s.isActive,nextRun:s.isActive?void 0:v(s.frequency,s.deliveryTime)}:s))},w=e=>{s(s=>s.filter(s=>s.id!==e))},k=e=>{n(!0),setTimeout(()=>{s(s=>s.map(s=>s.id===e?{...s,lastRun:new Date,nextRun:v(s.frequency,s.deliveryTime)}:s)),n(!1)},2e3)},T=e=>{switch(e){case"sessions":return{label:"Session Reports",icon:em.Z,color:"status-brand"};case"attendance":return{label:"Attendance Summary",icon:O.Z,color:"bg-success/10 text-success"};case"analytics":return{label:"Analytics Dashboard",icon:P.Z,color:"bg-primary/10 text-primary"};case"management":return{label:"Session Management",icon:ex.Z,color:"bg-warning/10 text-warning"};default:return{label:"Unknown",icon:em.Z,color:"bg-gray-100 text-gray-800"}}},I=e=>{switch(e){case"daily":return"bg-error/10 text-error";case"weekly":return"bg-primary/10 text-primary";case"monthly":return"bg-success/10 text-success";case"quarterly":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(P.Z,{className:"h-5 w-5"}),"Automated Report Scheduling"]})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Configure automated delivery of reports via email. Set up recurring schedules for session reports, attendance summaries, analytics dashboards, and management overviews."}),(0,a.jsxs)(Y.Vq,{open:u,onOpenChange:m,children:[(0,a.jsx)(Y.hg,{asChild:!0,children:(0,a.jsxs)(c.z,{className:"flex items-center gap-2",children:[(0,a.jsx)(ej.Z,{className:"h-4 w-4"}),"Create Schedule"]})}),(0,a.jsxs)(Y.cZ,{className:"max-w-2xl",children:[(0,a.jsxs)(Y.fK,{children:[(0,a.jsx)(Y.$N,{children:"Create Report Schedule"}),(0,a.jsx)(Y.Be,{children:"Set up a new automated report to be delivered via email on a recurring basis."})]}),r&&(0,a.jsx)(S.XE,{message:r,onRetry:()=>h(null)}),(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"name",children:"Schedule Name *"}),(0,a.jsx)(o.I,{id:"name",value:p.name,onChange:e=>f(s=>({...s,name:e.target.value})),placeholder:"e.g., Weekly Session Summary"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"reportType",children:"Report Type"}),(0,a.jsx)(x,{options:[{value:"sessions",label:"Session Reports"},{value:"attendance",label:"Attendance Summary"},{value:"analytics",label:"Analytics Dashboard"},{value:"management",label:"Session Management"}],value:p.reportType,onValueChange:e=>f(s=>({...s,reportType:e}))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"description",children:"Description"}),(0,a.jsx)(o.I,{id:"description",value:p.description,onChange:e=>f(s=>({...s,description:e.target.value})),placeholder:"Brief description of this report schedule"})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"frequency",children:"Frequency"}),(0,a.jsx)(x,{options:[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"quarterly",label:"Quarterly"}],value:p.frequency,onValueChange:e=>f(s=>({...s,frequency:e}))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"deliveryTime",children:"Delivery Time"}),(0,a.jsx)(o.I,{id:"deliveryTime",type:"time",value:p.deliveryTime,onChange:e=>f(s=>({...s,deliveryTime:e.target.value}))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"format",children:"Format"}),(0,a.jsx)(x,{options:[{value:"pdf",label:"PDF Document"},{value:"csv",label:"CSV File"},{value:"excel",label:"Excel Spreadsheet"}],value:p.format,onValueChange:e=>f(s=>({...s,format:e}))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"recipients",children:"Email Recipients *"}),(0,a.jsx)(o.I,{id:"recipients",value:p.recipients,onChange:e=>f(s=>({...s,recipients:e.target.value})),placeholder:"email1@example.com, email2@example.com"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Separate multiple email addresses with commas"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(c.z,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),(0,a.jsx)(c.z,{onClick:()=>{if(!p.name||!p.recipients){h("Please fill in all required fields");return}let e={id:"sched-".concat(Date.now()),name:p.name,description:p.description,reportType:p.reportType,frequency:p.frequency,deliveryTime:p.deliveryTime,recipients:p.recipients.split(",").map(e=>e.trim()),filters:{dateRange:"daily"===p.frequency?"day":"weekly"===p.frequency?"week":"month"},format:p.format,isActive:!0,nextRun:v(p.frequency,p.deliveryTime),createdAt:new Date,createdBy:"current-user@schoolsin.com"};s(s=>[...s,e]),m(!1),f({name:"",description:"",reportType:"sessions",frequency:"weekly",deliveryTime:"09:00",recipients:"",format:"pdf"}),h(null)},children:"Create Schedule"})]})]})]})]})]})]}),r&&(0,a.jsxs)(b.bZ,{variant:"destructive",children:[(0,a.jsx)(D.Z,{className:"h-4 w-4"}),(0,a.jsx)(b.X,{children:r})]}),(0,a.jsx)("div",{className:"grid gap-4",children:0===e.length?(0,a.jsx)(S.ub,{type:"reports",title:"No Scheduled Reports",message:"Create your first automated report schedule to receive regular updates via email.",actionLabel:"Create Report Schedule",onAction:()=>m(!0)}):e.map(e=>{let s=T(e.reportType),l=s.icon;return(0,a.jsxs)(i.Zb,{className:"".concat(e.isActive?"":"opacity-75"),children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg ".concat(s.color),children:(0,a.jsx)(l,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(i.ll,{className:"text-lg",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(N.C,{className:I(e.frequency),children:e.frequency}),(0,a.jsx)(N.C,{variant:e.isActive?"default":"secondary",children:e.isActive?"Active":"Paused"})]})]})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:"Schedule Details"}),(0,a.jsxs)("div",{className:"space-y-1 text-sm text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(C.Z,{className:"h-3 w-3"}),e.deliveryTime," (",e.frequency,")"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(em.Z,{className:"h-3 w-3"}),e.format.toUpperCase()," format"]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:"Recipients"}),(0,a.jsx)("div",{className:"space-y-1",children:e.recipients.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(eg.Z,{className:"h-3 w-3"}),e]},s))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:"Status"}),(0,a.jsxs)("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.lastRun&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(ep.Z,{className:"h-3 w-3 text-green-600"}),"Last: ",e.lastRun.toLocaleDateString()]}),e.nextRun&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(P.Z,{className:"h-3 w-3 text-brand-primary"}),"Next: ",e.nextRun.toLocaleDateString()]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t",children:[(0,a.jsxs)(c.z,{size:"sm",variant:"outline",onClick:()=>k(e.id),disabled:t,className:"flex items-center gap-2",children:[(0,a.jsx)(ef.Z,{className:"h-3 w-3"}),"Run Now"]}),(0,a.jsx)(c.z,{size:"sm",variant:"outline",onClick:()=>y(e.id),className:"flex items-center gap-2",children:e.isActive?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ev.Z,{className:"h-3 w-3"}),"Pause"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ef.Z,{className:"h-3 w-3"}),"Resume"]})}),(0,a.jsxs)(c.z,{size:"sm",variant:"outline",onClick:()=>g(e),className:"flex items-center gap-2",children:[(0,a.jsx)(V.Z,{className:"h-3 w-3"}),"Edit"]}),(0,a.jsxs)(c.z,{size:"sm",variant:"destructive",onClick:()=>w(e.id),className:"flex items-center gap-2",children:[(0,a.jsx)(ey.Z,{className:"h-3 w-3"}),"Delete"]})]})]})]},e.id)})}),e.length>0&&(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{className:"text-lg",children:"Schedule Statistics"})}),(0,a.jsx)(i.aY,{children:(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:e.length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Schedules"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:e.filter(e=>e.isActive).length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Active"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-brand-primary",children:e.filter(e=>"daily"===e.frequency).length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Daily Reports"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:e.reduce((e,s)=>e+s.recipients.length,0)}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Recipients"})]})]})})]})]})}function eb(){let[e,s]=(0,l.useState)("sessions");return(0,a.jsx)(n.ProtectedRoute,{roles:["admin"],children:(0,a.jsx)(r.AdminNavigation,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Reports & Management"})}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(c.z,{variant:"sessions"===e?"default":"outline",onClick:()=>s("sessions"),className:"flex items-center gap-2",children:[(0,a.jsx)(T.Z,{className:"h-4 w-4"}),"Session Reports"]}),(0,a.jsxs)(c.z,{variant:"attendance"===e?"default":"outline",onClick:()=>s("attendance"),className:"flex items-center gap-2",children:[(0,a.jsx)(E.Z,{className:"h-4 w-4"}),"Attendance Summary"]}),(0,a.jsxs)(c.z,{variant:"management"===e?"default":"outline",onClick:()=>s("management"),className:"flex items-center gap-2",children:[(0,a.jsx)(V.Z,{className:"h-4 w-4"}),"Session Management"]}),(0,a.jsxs)(c.z,{variant:"analytics"===e?"default":"outline",onClick:()=>s("analytics"),className:"flex items-center gap-2",children:[(0,a.jsx)(I.Z,{className:"h-4 w-4"}),"Analytics"]}),(0,a.jsxs)(c.z,{variant:"scheduler"===e?"default":"outline",onClick:()=>s("scheduler"),className:"flex items-center gap-2",children:[(0,a.jsx)(P.Z,{className:"h-4 w-4"}),"Scheduling"]})]})})}),"sessions"===e&&(0,a.jsx)(M,{}),"attendance"===e&&(0,a.jsx)(z,{}),"management"===e&&(0,a.jsx)(W,{}),"analytics"===e&&(0,a.jsx)(eu,{}),"scheduler"===e&&(0,a.jsx)(eN,{})]})})})}},74291:function(e,s,t){"use strict";t.d(s,{$N:function(){return j},Be:function(){return g},Vq:function(){return c},cN:function(){return x},cZ:function(){return u},fK:function(){return m},hg:function(){return o}});var a=t(57437),l=t(2265),n=t(44182),r=t(32489),i=t(93448);let c=n.fC,o=n.xz,d=n.h_;n.x8;let h=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n.aV,{ref:s,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...l})});h.displayName=n.aV.displayName;let u=l.forwardRef((e,s)=>{let{className:t,children:l,...c}=e;return(0,a.jsxs)(d,{children:[(0,a.jsx)(h,{}),(0,a.jsxs)(n.VY,{ref:s,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...c,children:[l,(0,a.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(r.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=n.VY.displayName;let m=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};m.displayName="DialogHeader";let x=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};x.displayName="DialogFooter";let j=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n.Dx,{ref:s,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",t),...l})});j.displayName=n.Dx.displayName;let g=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n.dk,{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",t),...l})});g.displayName=n.dk.displayName},15804:function(e,s,t){"use strict";t.d(s,{DE:function(){return v},Te:function(){return g},XE:function(){return f},ub:function(){return p}});var a=t(57437);t(2265);var l=t(75395),n=t(49322),r=t(83774),i=t(82431),c=t(56096),o=t(91723),d=t(95805),h=t(73247),u=t(48736),m=t(12381),x=t(95937),j=t(79820);function g(e){let{title:s,message:t,actionLabel:c="Try Again",onAction:o,type:d="generic",showRetry:h=!0,className:u=""}=e,x=(()=>{switch(d){case"network":return{icon:l.Z,defaultTitle:"Connection Error",defaultMessage:"Unable to connect to the server. Please check your internet connection and try again.",iconColor:"text-red-500"};case"auth":return{icon:n.Z,defaultTitle:"Authentication Error",defaultMessage:"You need to be signed in to access this feature. Please sign in and try again.",iconColor:"text-orange-500"};case"location":return{icon:r.Z,defaultTitle:"Location Error",defaultMessage:"Unable to access your location. Please enable location services and try again.",iconColor:"text-blue-500"};case"permission":return{icon:n.Z,defaultTitle:"Permission Denied",defaultMessage:"You don't have permission to access this feature. Please contact your administrator.",iconColor:"text-red-500"};default:return{icon:n.Z,defaultTitle:"Something went wrong",defaultMessage:"An unexpected error occurred. Please try again.",iconColor:"text-red-500"}}})(),g=x.icon;return(0,a.jsx)(j.Zb,{className:"text-center ".concat(u),children:(0,a.jsx)(j.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,a.jsx)(g,{className:"h-12 w-12 ".concat(x.iconColor)}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:s||x.defaultTitle}),(0,a.jsx)("p",{className:"text-sm text-gray-600 max-w-sm",children:t||x.defaultMessage})]}),h&&o&&(0,a.jsxs)(m.z,{onClick:o,variant:"outline",className:"mt-4",children:[(0,a.jsx)(i.Z,{className:"h-4 w-4 mr-2"}),c]})]})})})}function p(e){let{title:s,message:t,actionLabel:l="Get Started",onAction:n,type:r="generic",showAction:i=!0,className:x=""}=e,g=(()=>{switch(r){case"schools":return{icon:c.Z,defaultTitle:"No schools assigned",defaultMessage:"You don't have any schools assigned yet. Contact your administrator to get started.",defaultAction:"Contact Support",iconColor:"text-blue-500"};case"sessions":return{icon:o.Z,defaultTitle:"No sessions found",defaultMessage:"No check-in sessions have been recorded yet. Start your first session to see it here.",defaultAction:"Start Session",iconColor:"text-green-500"};case"users":return{icon:d.Z,defaultTitle:"No users found",defaultMessage:"No users match your current filters. Try adjusting your search criteria.",defaultAction:"Clear Filters",iconColor:"text-purple-500"};case"search":return{icon:h.Z,defaultTitle:"No results found",defaultMessage:"We couldn't find anything matching your search. Try different keywords or check your spelling.",defaultAction:"Clear Search",iconColor:"text-gray-500"};case"assignments":return{icon:u.Z,defaultTitle:"No assignments",defaultMessage:"No assignments have been created yet. Create your first assignment to get started.",defaultAction:"Create Assignment",iconColor:"text-indigo-500"};case"reports":return{icon:u.Z,defaultTitle:"No reports available",defaultMessage:"No reports are available for the selected criteria. Try adjusting your filters.",defaultAction:"Clear Filters",iconColor:"text-orange-500"};default:return{icon:u.Z,defaultTitle:"Nothing here yet",defaultMessage:"This section is empty. Start by adding some content.",defaultAction:"Get Started",iconColor:"text-gray-500"}}})(),p=g.icon;return(0,a.jsx)(j.Zb,{className:"text-center ".concat(x),children:(0,a.jsx)(j.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,a.jsx)(p,{className:"h-12 w-12 ".concat(g.iconColor)}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:s||g.defaultTitle}),(0,a.jsx)("p",{className:"text-sm text-gray-600 max-w-sm",children:t||g.defaultMessage})]}),i&&n&&(0,a.jsx)(m.z,{onClick:n,className:"mt-4",children:l||g.defaultAction})]})})})}function f(e){let{message:s="Something went wrong",onRetry:t,className:l=""}=e;return(0,a.jsxs)(x.bZ,{variant:"destructive",className:l,children:[(0,a.jsx)(n.Z,{className:"h-4 w-4"}),(0,a.jsx)(x.Cd,{children:"Error"}),(0,a.jsxs)(x.X,{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:s}),t&&(0,a.jsxs)(m.z,{variant:"outline",size:"sm",onClick:t,className:"ml-2 h-7",children:[(0,a.jsx)(i.Z,{className:"h-3 w-3 mr-1"}),"Retry"]})]})]})}function v(e){let{message:s="Nothing to show",className:t=""}=e;return(0,a.jsx)("div",{className:"text-center py-8 text-gray-500 ".concat(t),children:(0,a.jsx)("p",{className:"text-sm",children:s})})}},40279:function(e,s,t){"use strict";t.d(s,{I:function(){return r}});var a=t(57437),l=t(2265),n=t(93448);let r=l.forwardRef((e,s)=>{let{className:t,type:l,...r}=e;return(0,a.jsx)("input",{type:l,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...r})});r.displayName="Input"},75060:function(e,s,t){"use strict";t.d(s,{_:function(){return o}});var a=t(57437),l=t(2265),n=t(6394),r=t(90535),i=t(93448);let c=(0,r.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n.f,{ref:s,className:(0,i.cn)(c(),t),...l})});o.displayName=n.f.displayName},23675:function(e,s,t){"use strict";t.d(s,{g:function(){return r}});var a=t(57437),l=t(2265),n=t(93448);let r=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...l})});r.displayName="Textarea"},20705:function(e,s,t){"use strict";t.d(s,{Cp:function(){return n},Kc:function(){return a},LU:function(){return l}});let a=(e,s)=>{if(!s)return 0;let t=e.toMillis();return Math.round((s.toMillis()-t)/6e4)},l=e=>{if(e<=0)return"0m";if(e<60)return"".concat(e,"m");let s=Math.floor(e/60),t=e%60;return 0===t?"".concat(s,"h"):"".concat(s,"h ").concat(t,"m")},n=e=>{switch(e){case"active":return{label:"Active",color:"bg-green-100 text-green-800 border-green-200",icon:"Clock",description:"Session is currently in progress"};case"completed":return{label:"Completed",color:"bg-primary/10 text-primary border-primary/20",icon:"CheckCircle",description:"Session has been completed successfully"};case"paused":return{label:"Paused",color:"bg-yellow-100 text-yellow-800 border-yellow-200",icon:"Pause",description:"Session is temporarily paused"};case"error":return{label:"Error",color:"bg-red-100 text-red-800 border-red-200",icon:"AlertCircle",description:"Session encountered an error"};case"cancelled":return{label:"Cancelled",color:"bg-gray-100 text-gray-800 border-gray-200",icon:"X",description:"Session was cancelled"};default:return{label:e,color:"bg-gray-100 text-gray-800 border-gray-200",icon:"HelpCircle",description:"Unknown status"}}}}},function(e){e.O(0,[609,15,569,806,145,972,691,258,831,304,695,971,208,744],function(){return e(e.s=30574)}),_N_E=e.O()}]);